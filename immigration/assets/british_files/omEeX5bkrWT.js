/*!CK:1480500987!*//*1456276975,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["C3jQW"]); }

__d('P2PChatThreadBanner.react',['Image.react','Layout.react','P2PAPI','P2PLogger','P2PPaymentLoggerEvent','React','Set','cx','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=i.FillColumn,r=i.Column,s=new n(),t=m.PropTypes,u=m.createClass({displayName:'P2PChatThreadBanner',propTypes:{bannerType:t.string.isRequired,bodyText:t.string,buttonText:t.string,loggerEventFlow:t.string.isRequired,onClick:t.func,titleText:t.string.isRequired},_isRendered:false,componentDidMount:function(){var v=this.props.bannerType;if(!s.has(v)){s.add(v);this._isRendered=true;this.log(l.UI_ACTN_CHAT_THREAD_BANNER_VIEWED,{});j.incrementBannerViews(this.props.bannerType);}},log:function(v,w){k.log(v,babelHelpers['extends']({www_event_flow:this.props.loggerEventFlow},w));},handleClick:function(v){v.stopPropagation();if(this.props.onClick)this.props.onClick();this.log(l.UI_ACTN_CHAT_THREAD_BANNER_CLICKED,{});j.incrementBannerDismissals(this.props.bannerType);},handleClose:function(v){v.stopPropagation();this.log(l.UI_ACTN_CHAT_THREAD_BANNER_DISMISSED,{});j.incrementBannerDismissals(this.props.bannerType);},hasRenderedSameBanner:function(){return !this._isRendered&&s.has(this.props.bannerType);},render:function(){var v,w;if(this.hasRenderedSameBanner())return null;if(this.props.bodyText)v=m.createElement('div',{className:"_1w2e"},this.props.bodyText);if(this.props.buttonText)w=m.createElement('a',{className:"_2hrk"},this.props.buttonText);return (m.createElement('div',{className:"_1w2f",onClick:this.handleClick},m.createElement('div',{className:"_3jht",onClick:this.handleClose},m.createElement(h,{className:"_47dg",height:9,src:p('/images/p2p/chat-thread-banner-close.png'),width:9})),m.createElement(i,null,m.createElement(r,{className:"_1w2g"},m.createElement(h,{className:"_1w2h",height:15,src:p('/images/p2p/thread-banner-dollar.png'),width:15})),m.createElement(q,{className:"_1w2i"},m.createElement('div',{className:"_1w2j"+(!!v?' '+"_1w2k":'')},this.props.titleText),v,w))));}});f.exports=u;},null);
__d('P2PProductItemChatThreadBanner.react',['AsyncRequest','ContextualLayerAutoFlip','BackgroundImage.react','Image.react','Layout.react','LineClamp.react','Link.react','MercuryIDs','MercuryMessages','P2PActions','P2PAPI','P2PLogger','P2PLinkConstants','P2PMessageSellerConfirmationDialog.react','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PPlatformContextShape','P2PPlatformContextStore','P2PUserEligibilityStore','PopoverMenu.react','ReactComponentWithPureRenderMixin','React','ReactLayeredComponentMixin','ReactXUIMenu','Set','StoreAndPropBasedStateMixin','Tooltip.react','URI','XC2CPayNUXBannerImpressionsUpdateController','XUIAmbientNUX.react','XUIButton.react','XUIGrayText.react','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa){'use strict';if(c.__markCompiled)c.__markCompiled();var qa=l.Column,ra=l.FillColumn,sa=ea.Item,ta=false,ua=new fa(),va=ca.createClass({displayName:'P2PProductItemChatThreadBanner',mixins:[da,ba,ga(z)],propTypes:{platformContext:x.isRequired},getInitialState:function(){return {showConfirmationDialog:false,showNUX:false};},statics:{calculateState:function(wa){return {canSendToRecipient:z.getEligibilityByThreadID(y.getThreadIDFromPlatformContext(wa.platformContext))};}},componentDidMount:function(){var wa=this.props.platformContext,xa=y.getThreadIDFromPlatformContext(wa);this.handleShouldShowPayNUX();if(!ua.has(xa)){ua.add(xa);if(y.isViewerSellerForPlatformContext(wa)){this.log(v.UI_ACTN_PLATFORM_BANNER_SELLER_VIEWED);}else this.log(v.UI_ACTN_PLATFORM_BANNER_BUYER_VIEWED);}},componentDidUpdate:function(wa,xa){if(!xa.canSendToRecipient&&this.state.canSendToRecipient)this.handleShouldShowPayNUX();},log:function(wa,xa){var ya={platform_logging_data:this.props.platformContext.product.loggingData};s.log(wa,babelHelpers['extends']({www_event_flow:w.UI_FLOW_PLATFORM_BANNER},ya,xa));},handleShouldShowPayNUX:function(){var wa=this.props.platformContext,xa=!ta&&this.shouldRenderPayButton()&&wa.banner.shouldShowPayNux;if(xa){this.log(v.UI_ACTN_PLATFORM_BANNER_PAY_NUX_SHOWN);ta=true;this.setState({showNUX:true});new h().setURI(ja.getURIBuilder().getURI()).setMethod('POST').send();}},handleDismissClick:function(wa){wa.preventDefault();var xa=this.props.platformContext;r.dismissPlatformContextBanner(xa.id);if(y.isViewerSellerForPlatformContext(xa)){this.log(v.UI_ACTN_PLATFORM_BANNER_SELLER_HIDE_CLICKED);}else this.log(v.UI_ACTN_PLATFORM_BANNER_BUYER_HIDE_CLICKED);},handleSoldClick:function(wa){wa.preventDefault();r.markSoldPlatformContextProductItem(this.props.platformContext.id);this.log(v.UI_ACTN_PLATFORM_BANNER_SOLD_CLICKED);},hasNoMessagesFromSeller:function(){var wa=this.props.platformContext,xa=y.getThreadIDFromPlatformContext(wa),ya=p.get().getCurrentlyLoadedMessages(xa);if(!ya)return true;var za=o.getParticipantIDFromUserID(wa.sellerID),ab=ya.some(function(bb){return bb.author===za;});return !ab;},handlePayClick:function(wa){wa.preventDefault();if(this.hasNoMessagesFromSeller()){this.setState({showConfirmationDialog:true});this.log(v.UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_SHOWN);}else this.openSendMoneyFlyout();},openSendMoneyFlyout:function(){var wa=this.props.platformContext,xa=wa.product,ya=y.getThreadIDFromPlatformContext(wa);q.chatSendViewOpened({threadID:ya,amount:xa.formattedAmount,platformData:{platformContextID:wa.id,loggingData:xa.loggingData}});this.setState({showNUX:false});this.log(v.UI_ACTN_PLATFORM_BANNER_PAY_CLICKED);},handleImageClicked:function(){this.log(v.UI_ACTN_PLATFORM_BANNER_IMAGE_CLICKED);},handleTitleClicked:function(){this.log(v.UI_ACTN_PLATFORM_BANNER_TITLE_CLICKED);},renderMarkSold:function(){var wa=this.props.platformContext,xa;if(!wa.product.isAvailable)return null;if(y.isViewerSellerForPlatformContext(wa))xa=ca.createElement('div',null,ca.createElement(n,{href:'#',onClick:this.handleSoldClick},oa._("Mark Sold")));return xa;},renderPayButton:function(){if(!this.shouldRenderPayButton())return null;var wa=ca.createElement(la,{label:oa._("Pay"),onClick:this.handlePayClick,ref:'pay_button',use:'confirm'});if(!this.state.showNUX)wa=ca.createElement(ha,{alignH:'right',display:'block',tooltip:oa._("You can confirm the amount next.")},wa);return (ca.createElement('div',{className:!this.isCompactMode()?"_3-8x":''},wa));},shouldRenderPayButton:function(){var wa=this.props.platformContext,xa=y.isViewerBuyerForPlatformContext(this.props.platformContext);return !!(this.state.canSendToRecipient&&wa.product.isAvailable&&xa&&wa.product.rawAmount.amount>0);},getAmountText:function(){var wa=this.props.platformContext,xa=wa.product;return (xa.rawAmount.amount>0?xa.formattedAmount:oa._("FREE"));},renderAskingPriceRow:function(){var wa=this.props.platformContext,xa=wa.product;if(xa.isAvailable)return (ca.createElement(m,{lines:1,lineHeight:16},ca.createElement(ma,{shade:'light'},oa._("Price: {price of the item}",[oa.param('price of the item',this.getAmountText())]))));},renderNameLine:function(){var wa=this.props.platformContext,xa=wa.product,ya='dark',za;if(!xa.isAvailable){ya='light';za=oa._("SOLD");}return (ca.createElement(n,{href:xa.refURL||'#',onClick:this.handleTitleClicked},ca.createElement(ma,{shade:ya},za?'('+za+') ':null,xa.name)));},renderImageColumn:function(){var wa=this.props.platformContext,xa=wa.product;if(this.isCompactMode())return null;return (ca.createElement(qa,null,ca.createElement('div',{className:"_5qnr"},ca.createElement('div',{className:"_5qn-"},ca.createElement(n,{href:xa.refURL||'#',onClick:this.handleImageClicked},ca.createElement(j,{backgroundPosition:'50% 50%',backgroundSize:'cover',height:45,src:xa.image,width:45}))))));},renderPopoverMenu:function(){var wa=this.props.platformContext,xa=wa.product,ya=ca.createElement(ea,{className:"_1z1u"},ca.createElement(sa,{className:"_1z1_"},ca.createElement('div',{onClick:this.handleDismissClick},oa._("Hide from conversation"))),ca.createElement(sa,{ajaxify:new ia('/ajax/groups/mall/report_to_admin').addQueryData({message_id:xa.loggingData.post_id}),rel:'async-post'},oa._("Report to admin")),ca.createElement(sa,{href:t.helpCenterURI,target:'_blank'},oa._("Learn more")));return (ca.createElement(aa,{alignh:'right',layerBehaviors:[i],menu:ya,className:"_3fqa"},ca.createElement('div',{className:"_1z20"},ca.createElement(n,{className:"_1z21",href:'#'}))));},isCompactMode:function(){var wa=this.props.platformContext,xa=wa.product;return !xa.image||!xa.isAvailable;},onNUXCloseButtonClick:function(){this.setState({showNUX:false});},renderLayers:function(){var wa={};if(this.state.showNUX){wa.ambientNUX=ca.createElement(ka,{alignment:'left',contextRef:function(){return this.refs.pay_button;}.bind(this),customwidth:234,onCloseButtonClick:this.onNUXCloseButtonClick,position:'above',shown:true,width:'custom'},ca.createElement('div',{className:"_3-95"},oa._("You can pay for this item right from your messages.")),ca.createElement('div',null,ca.createElement(k,{className:"_3fqb",height:14,src:pa('/images/p2p/white-privacy-lock.png'),width:10}),ca.createElement('span',{className:"_3fqc"},oa._("It's free and secure."))));}else if(this.state.showConfirmationDialog)wa.confirmationDialog=ca.createElement(u,{onCancel:function(){this.setState({showConfirmationDialog:false});this.log(v.UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_CANCEL_CLICK);}.bind(this),onPay:function(){this.setState({showConfirmationDialog:false});this.openSendMoneyFlyout();this.log(v.UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_PAY_CLICK);}.bind(this)});return wa;},render:function(){return (ca.createElement('div',{className:"_319c"+(this.isCompactMode()?' '+"_5qn_":'')},ca.createElement(l,null,this.renderImageColumn(),ca.createElement(ra,null,ca.createElement('div',{className:(!this.isCompactMode()?"_2pis":'')+(' '+"_5qo0")},ca.createElement('div',{className:"_5qo1"},ca.createElement(m,{lines:1,lineHeight:16},this.renderNameLine()),this.renderAskingPriceRow(),this.renderMarkSold()))),ca.createElement(qa,null,ca.createElement('div',{className:"_1_68"},this.renderPopoverMenu(),this.renderPayButton())))));}});f.exports=va;},null);
__d('P2PSendMoneyNUXChatThreadBanner.react',['MercuryIDs','P2PActions','P2PChatThreadBanner.react','P2PUserEligibilityStore','React','StoreAndPropBasedStateMixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=l.PropTypes,o=l.createClass({displayName:'P2PSendMoneyNUXChatThreadBanner',mixins:[m(k)],propTypes:{bannerType:n.string.isRequired,bodyText:n.string,buttonText:n.string,loggerEventFlow:n.string.isRequired,openRequestTab:n.bool,threadID:n.string.isRequired,titleText:n.string.isRequired},getDefaultProps:function(){return {openRequestTab:false};},statics:{calculateState:function(p){var q=h.isGroupChat(p.threadID)||k.getEligibilityByThreadID(p.threadID);return {isThreadEligible:q};}},handleClick:function(){i.chatSendViewOpened({openRequestTab:this.props.openRequestTab,threadID:this.props.threadID});},render:function(){if(!this.state.isThreadEligible)return null;return (l.createElement(j,babelHelpers['extends']({},this.props,{onClick:this.handleClick})));}});f.exports=o;},null);