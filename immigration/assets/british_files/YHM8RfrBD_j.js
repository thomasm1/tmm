/*!CK:1193836468!*//*1456252848,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["rpDYb"]); }

__d("ContentSearchEvents",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CONTENT_SEARCH:"content_search",OPEN_TRAY:"open_tray",QUERY_RESULTS_LOADED:"query_results_loaded",RESULT_SENT:"result_sent",namesByValue:{content_search:"CONTENT_SEARCH",open_tray:"OPEN_TRAY",query_results_loaded:"QUERY_RESULTS_LOADED",result_sent:"RESULT_SENT"}};},null);
__d("MessengerPlatformQueryType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SEARCH:0,MEDIAFY:1,TRENDING:2,SAMPLE:3,namesByValue:["SEARCH","MEDIAFY","TRENDING","SAMPLE"]};},null);
__d('CloseButton.atlas',['PureRenderComponent.atlas','React','XUICloseButton.react','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';var m,n;if(c.__markCompiled)c.__markCompiled();var o=i.PropTypes;m=babelHelpers.inherits(p,i.Component);n=m&&m.prototype;p.propTypes={onClick:o.func,shade:o.oneOf(['light','dark']),size:o.oneOf(['small','medium'])};function p(q,r){n.constructor.call(this,q,r);this.$CloseButton1=this.$CloseButton1.bind(this);}p.prototype.$CloseButton1=function(event){event.preventDefault();if(this.props.onClick)this.props.onClick(event);};p.prototype.render=function(){var q=l(this.props.className,"_5tdj");return (i.createElement('label',{className:q},i.createElement(j,{onClick:this.$CloseButton1,shade:this.props.shade,size:this.props.size})));};f.exports=h.create(p);},null);
__d('Notice.atlas',['CloseButton.atlas','Icon.atlas','PureRenderComponent.atlas','React','Text.atlas','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o,p;if(c.__markCompiled)c.__markCompiled();var q=k.PropTypes,r={error:'warning',information:'information-open',success:'check',warning:'warning'},s={type:'warning'};o=babelHelpers.inherits(t,k.Component);p=o&&o.prototype;t.defaultProps=s;t.propTypes={type:q.oneOf(['information','success','warning','error']).isRequired,onClose:q.func};t.prototype.render=function(){return (k.createElement('div',{className:n(this.props.className,"_2c4l"+(this.props.type==='error'?' '+"_2c4m":'')+(this.props.type==='warning'?' '+"_2c4n":'')+(this.props.type==='information'?' '+"_2c4p":'')+(this.props.type==='success'?' '+"_2c4q":'')+(!!this.props.onClose?' '+"_2c4r":''))},k.createElement(i,{className:"_2c4s",name:r[this.props.type]}),k.createElement(l,{className:"_2c4t",color:'dark',display:'block',size:'s'},this.props.children),this.props.onClose?k.createElement(h,{className:"_2c4u",onClick:this.props.onClose}):null));};function t(){o.apply(this,arguments);}f.exports=j.create(t);},null);
__d('relativeTimeString.atlas',['fbt'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j,k){var l=Date.now(),m='',n=null,o=Math.floor((j-l)/1000),p=o<0;o=Math.abs(o);if(o<60){if(k){m=p?h._("just now"):h._("now");}else m=p?h._("Just now"):h._("Now");}else if(o<60*2){m=p?h._("1 minute ago"):h._("1 minute");}else if(o<3600){n=Math.floor(o/60);m=p?h._("{number} minutes ago",[h.param('number',n)]):h._("{number} minutes",[h.param('number',n)]);}else if(o<3600*2){if(k){m=p?h._("about an hour ago"):h._("about an hour");}else m=p?h._("About an hour ago"):h._("About an hour");}else if(o<3600*24){n=Math.floor(o/3600);m=p?h._("{number} hours ago",[h.param('number',n)]):h._("{number} hours",[h.param('number',n)]);}else if(o<3600*24*2){if(k){m=p?h._("about a day ago"):h._("about a day");}else m=p?h._("About a day ago"):h._("About a day");}else if(o<3600*24*30){n=Math.floor(o/3600/24);m=p?h._("{number} days ago",[h.param('number',n)]):h._("{number} days",[h.param('number',n)]);}else if(o<3600*24*30*2){if(k){m=p?h._("about a month ago"):h._("about a month");}else m=p?h._("About a month ago"):h._("About a month");}else if(o<3600*24*30*12){n=Math.floor(o/3600/24/30);m=p?h._("{number} months ago",[h.param('number',n)]):h._("{number} months",[h.param('number',n)]);}else if(o<3600*24*30*24){if(k){m=p?h._("over a year ago"):h._("over a year");}else m=p?h._("Over a year ago"):h._("Over a year");}else{n=Math.floor(o/3600/24/365);m=p?h._("{number} years ago",[h.param('number',n)]):h._("{number} years",[h.param('number',n)]);}return m;}f.exports=i;},null);
__d('FBPaymentsCreditCardExpDateFormField.react',['Image.react','FBPaymentsFormField.react','FBPaymentsFormFieldUtils','React','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=k.PropTypes,o=k.createClass({displayName:'FBPaymentsCreditCardExpDateFormField',propTypes:{initiallyFocused:n.bool,name:n.string.isRequired,onChange:n.func.isRequired,showIcon:n.bool,showPlaceholder:n.bool},getDefaultProps:function(){return {showIcon:true,showPlaceholder:true};},getLimit:function(){return 5;},formatValue:function(p,q,r){var s=String.fromCharCode(r);p=p.replace(/[^0-9\/]+/g,'');var t=p.split('/'),u=t[0],v=t[1];if(v&&v.length===4)p=u+'/'+v.substr(-2);if(!/^\d+$/.test(s)&&r!==191&&r!==111)return p;p=j.stripNonDigits(p);if(/^\d$/.test(p)&&p!=='0'&&p!=='1'){p='0'+p+'/';}else if(p.length>=2&&p.indexOf('/')===-1)p=p.substr(0,2)+'/'+p.substr(2,2);return p;},validate:function(p){var q=p.split('/'),r=new Date(),s=parseInt(r.getFullYear().toString().substring(2),10),t=r.getMonth()+1,u=parseInt(q[0],10),v=parseInt(q[1],10);if(p.length!==5||!u||!v||isNaN(u)||isNaN(v)||u<1||u>12)return false;if(v<s||v===s&&u<t)return false;return true;},render:function(){var p,q,r;if(this.props.showLabel)q=l._("Expiration");if(this.props.showPlaceholder)p=l._("MM\/YY");if(this.props.showIcon)r={normal:k.createElement(h,{height:12,src:m('/images/p2p/events-grey_s.png'),width:12}),focused:k.createElement(h,{height:12,src:m('/images/p2p/events-blue_s.png'),width:12})};return (k.createElement(i,babelHelpers['extends']({autoCompleteName:'cc-exp',formatValue:this.formatValue,icon:r,label:q,limit:this.getLimit(),placeholder:p,ref:'input',validate:this.validate},this.props)));}});f.exports=o;},null);
__d('FBPaymentsCreditCardNumberFormField.react',['Image.react','FBPaymentsFormField.react','FBPaymentsFormFieldUtils','PaymentMethodUtils','React','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=l.PropTypes,p=l.createClass({displayName:'FBPaymentsCreditCardNumberFormField',propTypes:{allowCredit:o.bool,disabled:o.bool,shouldValidateBIN:o.bool,initiallyFocused:o.bool,name:o.string.isRequired,onChange:o.func.isRequired,showIcon:o.bool,showPlaceholder:o.bool,showSecondaryIcon:o.bool,value:o.string},getDefaultProps:function(){return {allowCredit:true,showIcon:true,showPlaceholder:true,showSecondaryIcon:false};},getInitialState:function(){return {errorMessage:null};},calculateLimit:function(q){return (k.getCardType(q).digits+(this.getGrouping(q).length-2));},getGrouping:function(q){var r=[0,4,8,12,16],s=r;switch(k.getCardType(q).name){case 'visa':case 'mc':case 'disc':s=r;break;case 'amex':s=[0,4,10,15];break;case 'diners':s=[0,4,10,14];break;default:s=r;break;}return s;},formatValue:function(q,r,s){return j.formatCardNumber(q,r,s,this.getGrouping(q),' ');},validate:function(q){var r=this.isValidCardType(q),s;if(!this.props.allowCredit){s=m._("Please enter a debit card. Credit cards can't be used.");}else s=m._("Please enter a valid debit or credit card number.");this.setState({errorMessage:!r?s:null});return !!(k.isValidCCNumber(q)&&r&&!this.props.binError);},isValidCardType:function(q){var r=['mc','visa','unknown'];if(this.props.allowCredit)r.push('diners','disc','jcb','amex');var s=k.getCardType(q),t=s?s.name:'',u=r.indexOf(t)>=0;return u;},getSaveError:function(){return this.props.binError||this.props.saveError;},getSecondaryIcon:function(q){var r,s;if(!this.props.showSecondaryIcon)return null;s=k.getCardType(q).name;switch(s){case 'visa':r=n('/images/payments/icons/modularization/visa-cc.png');break;case 'mc':r=n('/images/payments/icons/modularization/mastercard-cc.png');break;case 'amex':r=n('/images/payments/icons/modularization/amex-cc.png');break;case 'disc':r=n('/images/payments/icons/modularization/discover-cc.png');break;case 'jcb':r=n('/images/payments/icons/modularization/jcb-cc.png');break;default:r=n('/images/payments/icons/modularization/CC.png');break;}return (l.createElement(h,{height:20,src:r,width:30}));},render:function(){var q=m._("Card Number"),r,s,t;if(this.props.showLabel){s=q;r='0000 0000 0000 0000';}else if(this.props.showPlaceholder)r=q;if(this.props.showIcon)t={normal:l.createElement(h,{height:12,src:n('/images/p2p/card-grey_s.png'),width:12}),focused:l.createElement(h,{height:12,src:n('/images/p2p/card-blue_s.png'),width:12})};return (l.createElement(i,babelHelpers['extends']({autoCompleteName:'cc-number',cursorPositionUpdater:j.getUpdatedCursorPosition,errorMessage:this.state.errorMessage,formatValue:this.formatValue,getSecondaryIcon:this.getSecondaryIcon,icon:t,label:s,limit:this.calculateLimit,placeholder:r,ref:'input',validate:this.validate,value:this.props.value},this.props,{saveError:this.getSaveError()})));}});f.exports=p;},null);
__d('FBPaymentsForm.react',['FBPaymentsErrorNotice.react','React','cx','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=i.PropTypes,m=i.createClass({displayName:'FBPaymentsForm',propTypes:{errorTitle:l.string,onValidation:l.func.isRequired,prefilledFormData:l.object,saveErrors:l.object,showIcons:l.bool,showLabels:l.bool,showPlaceholderOnFocus:l.bool,showSecondaryIcons:l.bool,useGutters:l.bool},getDefaultProps:function(){return {prefilledFormData:{},saveErrors:null,showIcons:true,showLabels:false,showPlaceholderOnFocus:false,showSecondaryIcons:false,useGutters:false};},getInitialState:function(){var n=this.props.prefilledFormData,o=this.props.children,p={};i.Children.forEach(o,function(q,r){p[q.props.name]={valid:!q.props.required,value:n?n[q.props.name]:''};});return {fields:p,isValid:false};},_fieldKeyOrder:[],handleFormValueChange:function(n,o,p,q){var r=this.state.fields;r[n]={valid:p,value:o};this.validateForm();if(this.props.autoTab===true&&q&&p){var s=this._fieldKeyOrder.indexOf(n);if(s!==-1){var t=this._fieldKeyOrder[s+1];if(t){var u=this.refs[t];u&&u.refs.input.focusInput();}}}},validateForm:function(){var n=true,o=this.state.fields;n=!k(o).some(function(p){return !p.valid;});this.setState({isValid:n});this.props.onValidation(n,this.serializeFormFields());},serializeFormFields:function(){var n=this.state.fields,o={};for(var p in n)if(n.hasOwnProperty(p))o[p]=n[p].value;return o;},getSaveError:function(n){var o='',p=this.props.saveErrors;if(p&&p.fields&&p.fields[n]){o=p.fields[n].message;if(o.__html)o=o.__html;}return o;},renderGeneralError:function(){var n=this.getGeneralError();if(n)return (i.createElement(h,{error:n}));},getGeneralError:function(){if(this.props.saveErrors&&this.props.saveErrors.general)return this.props.saveErrors.general;return null;},renderFormFields:function(){var n=[],o=[],p=[],q=0,r=this.props.children,s=i.Children.count(r),t=[];i.Children.forEach(r,function(u,v){var w=v===s-1;if(!u)return null;var x=parseInt(u.props.width||'100',10),y=u.props.name;u=i.cloneElement(u,{key:y,onChange:this.handleFormValueChange,saveError:this.getSaveError(y),showIcon:this.props.showIcons,showLabel:this.props.showLabels,showPlaceholderOnFocus:this.props.showPlaceholderOnFocus,showSecondaryIcon:this.props.showSecondaryIcons,useGutter:this.props.useGutters,value:this.state.fields[y].value,ref:y});t.push(y);if(!u.props.ignoreStyling){if(Math.round(q)<100)n.push(u);q+=x;if(Math.round(q)===100||w){o.push(i.createElement('div',{className:(this.props.useGutters?"_284-":'')+(' '+"_284_")+(n.length>1?' '+"_2850":'')+(o.length===0?' '+"_2851":'')+(w?' '+"_2852":''),key:o.length},n));n=[];q=0;}}else p.push(u);}.bind(this));this._fieldKeyOrder=t;return p.concat(o);},render:function(){return (i.createElement('form',{className:"_2853"},this.renderGeneralError(),this.renderFormFields()));}});f.exports=m;},null);
__d('FBPaymentsCreditCardForm.react',['CreditCardFormParam','KappaWrapper','FBPaymentsCreditCardCVCFormField.react','FBPaymentsCreditCardExpDateFormField.react','FBPaymentsCreditCardNumberFormField.react','FBPaymentsCreditCardZipCodeFormField.react','FBPaymentsForm.react','React','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=o.PropTypes,s=o.createClass({displayName:'FBPaymentsCreditCardForm',propTypes:{allowCredit:r.bool,autoTab:r.bool,binError:r.string,compactMode:r.bool,cscMaxLength:r.number,editMode:r.bool,onValidation:r.func,prefilledFormData:r.object,saveErrors:r.object,showIcons:r.bool,showLabels:r.bool,showPlaceholderOnFocus:r.bool,showSecondaryIcons:r.bool,useGutters:r.bool},getDefaultProps:function(){return {autoTab:false,allowCredit:true,binError:'',compactMode:false,cscMaxLength:null,editMode:false,onValidation:p,prefilledFormData:{},saveErrors:null,showIcons:true,showSecondaryIcons:false,showLabels:false,showPlaceholderOnFocus:false,useGutters:false};},getInitialState:function(){return {formData:{},isValid:false};},componentWillMount:function(){i.start(6,3,0);},handleValidation:function(t,u){this.setState({formData:u,isValid:t});this.props.onValidation(t,u);},isCreditCardNumberMasked:function(){return this.props.editMode;},isCreditCardNumberFocused:function(){return !this.props.editMode;},isExpFocused:function(){return this.props.editMode;},getSaveErrors:function(){if(this.props.binError)return {general:{message:this.props.binError}};return this.props.saveErrors;},render:function(){var t=this.props.compactMode;return (o.createElement(n,{autoTab:this.props.autoTab,errorTitle:q._("Problem Saving Card"),prefilledFormData:this.props.prefilledFormData,onValidation:this.handleValidation,saveErrors:this.getSaveErrors(),showIcons:this.props.showIcons,showLabels:this.props.showLabels,showPlaceholderOnFocus:this.props.showPlaceholderOnFocus,showSecondaryIcons:this.props.showSecondaryIcons,useGutters:this.props.useGutters},o.createElement(l,{allowCredit:this.props.allowCredit,binError:this.props.binError,disabled:this.isCreditCardNumberMasked(),initiallyFocused:this.isCreditCardNumberFocused(),name:h.CARD_NUMBER,required:true,width:t?75:100}),o.createElement(k,{initiallyFocused:this.isExpFocused(),name:h.CARD_EXPIRATION,required:true,width:t?25:50}),o.createElement(j,{creditCardNumber:this.state.formData[h.CARD_NUMBER],cscMaxLength:this.props.cscMaxLength,name:h.CSC,required:true,width:t?25:50}),o.createElement(m,{name:h.ZIP,required:true,width:t?30:100})));}});f.exports=s;},null);
__d("XMessengerPlatformContentSearchController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/content_search\/",{q:{type:"String",defaultValue:""},qtype:{type:"Enum",defaultValue:0,enumType:0},resume:{type:"String",defaultValue:""}});},null);
__d('ChatContentSearch',['AsyncRequest','MessengerPlatformQueryType','XMessengerPlatformContentSearchController'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k={getContentForQuery:function(l){var m=l.query,n=l.callback,o=l.resume,p=j.getURIBuilder().setString('q',m).setString('resume',o).getURI(),q=new h().setURI(p).setHandler(n);q.send();return q;},getTrending:function(l,m){var n=j.getURIBuilder().setEnum('qtype',i.TRENDING).setString('resume',m).getURI(),o=new h().setURI(n).setHandler(l);o.send();return o;}};f.exports=k;},null);
__d('ChatContentSearchContextualDialog.react',['ContextualLayerAutoFlipHorizontal','LayerHideOnEscape','ReactAbstractContextualDialog','ReactLayer','cx'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=k.createClass(j.createSpec({addedBehaviors:[h,i],displayName:'StickerXUIContextualDialog',theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:47,length:16}}}));f.exports=m;},null);
__d('ChatContentSearchResult.react',['Image.react','ReactComponentWithPureRenderMixin','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=274,n=137,o=j.createClass({displayName:'ChatContentSearchResult',mixins:[i],propTypes:{isWide:l.bool.isRequired,onClick:l.func.isRequired,result:l.object.isRequired,src:l.string.isRequired},statics:{isWide:function(p){var q=p.media.preview;return q.width>q.height*1.2;},getScaledDimensions:function(p,q){var r=p.media.preview,s=r.height,t=r.width,u=(q?m:n)/t;s*=u;t*=u;return {height:s,width:t};}},render:function(){var p=o.getScaledDimensions(this.props.result,this.props.isWide);return (j.createElement(h,{className:"_358"+(this.props.isWide?' '+"_26n6":''),onClick:this._handleClick,src:this.props.src,style:p}));},_handleClick:function(p){p.stopPropagation();this.props.onClick(this.props.result);}});f.exports=o;},null);
__d('ChatContentSearchResults.react',['ChatContentSearch','ChatContentSearchResult.react','MercuryConfig','MessengerSpinner.react','ReactComponentWithPureRenderMixin','React','ScrollableArea.react','debounce','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=m.PropTypes,r={},s=m.createClass({displayName:'ChatContentSearchResults',_inflightRequest:undefined,_requestResults:p,_reset:p,_inflightTimeStart:undefined,mixins:[l],propTypes:{onResultsLoaded:q.func,onSelect:q.func.isRequired,query:q.string.isRequired},getInitialState:function(){return {isLoading:false,response:null,results:[]};},componentDidMount:function(){this._reset=o(this._resetImpl,100);this._requestResults=o(this._requestResultsImpl,200);this._requestResults();},componentWillUnmount:function(){this._cancelInflightRequest();},componentWillReceiveProps:function(t){if(t.query!==this.props.query)this._reset(this._requestResults);},render:function(){return (m.createElement(n,{fade:true,onScroll:this._handleScroll,ref:'scrollable'},this._renderResults(),this._renderLoadingIndicator()));},_renderLoadingIndicator:function(){if(!this.state.isLoading)return null;return (m.createElement('div',{style:{marginTop:this.state.response?'10px':'140px',textAlign:'center'}},m.createElement(k,{color:'grey',size:k.Sizes.SMALL})));},_requestResultsImpl:function(){this._cancelInflightRequest();this._inflightTimeStart=Date.now();if(this.state.response&&(!this.state.response.resultNextCursor||!this.props.query))return;var t;this.setState({isLoading:true});if(this.props.query){t=h.getContentForQuery({query:this.props.query,resume:this.state.response?this.state.response.resultNextCursor:undefined,callback:this._handleAsyncResponse});}else t=h.getTrending(this._handleAsyncResponse,this.state.response?this.state.response.resultNextCursor:undefined);this._inflightRequest=t;},_handleAsyncResponse:function(t){if(this._inflightRequest===t.request){r=babelHelpers['extends']({},r,t.payload.attribution);this.setState({isLoading:false,response:t.payload,results:t.payload.resultGroup[0]?this.state.results.concat(t.payload.resultGroup[0].results):this.state.results},function(){if(this._inflightTimeStart){if(this.props.onResultsLoaded)this.props.onResultsLoaded(Date.now()-this._inflightTimeStart);delete this._inflightTimeStart;}}.bind(this));delete this._inflightRequest;}},_cancelInflightRequest:function(){this.setState({isLoading:false});if(this._inflightRequest){this._inflightRequest.abort();delete this._inflightRequest;delete this._inflightTimeStart;}},_renderResults:function(){if(!this.state.response||!this.state.results.length)return null;return this.state.results.map(function(t,u){var v=i.isWide(t);if(!v&&t.platformFBID.toString()!==j.MessengerAppID){var w=u-this._getPrevWideIndex(u),x=this._getNextWideIndex(u)-u;v=(w<=1||w%2!==0)&&x<=1;}return (m.createElement(i,{isWide:v,key:'result:'+u+':'+t.resultID,onClick:this._handleResultClick,result:t,src:t.media.preview.url}));}.bind(this));},_getPrevWideIndex:function(t){while(t>0){--t;if(i.isWide(this.state.results[t]))return t;}return t;},_getNextWideIndex:function(t){var u=this.state.results.length;while(t<u-1){++t;if(i.isWide(this.state.results[t]))return t;}return t;},_handleResultClick:function(t){this.props.onSelect(t,r[t.platformFBID]);},_handleScroll:function(){if(this._isScrolledNearBottom()&&!this._inflightRequest)this._requestResults();},_isScrolledNearBottom:function(){var t=this.refs.scrollable.getArea();return !!(t&&t.distanceToBottom()<=50);},_resetImpl:function(t){this.setState(this.getInitialState(),t);}});f.exports=s;},null);
__d('ChatContentSearchTrendingIndicator.react',['Image.react','React','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';var m,n;if(c.__markCompiled)c.__markCompiled();m=babelHelpers.inherits(o,i.Component);n=m&&m.prototype;function o(p){n.constructor.call(this,p);}o.prototype.shouldComponentUpdate=function(p){return p.shown!==this.props.shown;};o.prototype.render=function(){return this.props.shown?i.createElement('div',{className:"_515"},i.createElement(h,{src:l('/images/chat/composer/composerSearchTrending.png')}),k._("Trending")):null;};f.exports=o;},null);
__d('MessengerSearchInput.react',['AbstractTextInput.react','ReactComponentWithPureRenderMixin','React','XUICloseButton.react','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=j.PropTypes,o=j.createClass({displayName:'MessengerSearchInput',mixins:[i],propTypes:{isFocused:n.bool,onBlur:n.func,onChange:n.func,onClear:n.func,onEnter:n.func,onFocus:n.func,placeholder:n.string,value:n.string.isRequired},render:function(){return (j.createElement('div',{className:m(this.props.className,"_5iwm"+(this.props.isFocused||!!this.props.value?' '+"_5iwn":'')),role:'search'},j.createElement(h,{className:"_3deo",onBlur:this.props.onBlur,onChange:this.props.onChange,onEnter:this.props.onEnter,onFocus:this.props.onFocus,placeholder:this.props.placeholder,ref:'inputField',value:this.props.value}),j.createElement(k,{size:'small',onMouseDown:this.props.onClear,className:(this.props.value.length===0?"hidden_elem":'')+(' '+"_2xme")})));},focusInput:function(){this.refs.inputField.focusInput();}});f.exports=o;},null);
__d('ChatContentSearchFlyout.react',['ChatContentSearchResults.react','ChatContentSearchTrendingIndicator.react','Keys','MessengerSearchInput.react','ReactComponentWithPureRenderMixin','React','MercuryShareAttachmentRenderLocations','XUITextInput.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=m.PropTypes,s=' ',t=/\s+/g,u=m.createClass({displayName:'ChatContentSearchFlyout',mixins:[l],propTypes:{location:r.oneOf(n.getValues()),onEscKeyDown:r.func,onResultsLoaded:r.func,onSelect:r.func.isRequired,query:r.string},getInitialState:function(){return {query:this.props.query,viewerEnteredText:false};},componentWillReceiveProps:function(v){if(!this.state.viewerEnteredText)this.setState({query:v.query});},render:function(){var v=this._normalize(this.state.query);return (m.createElement('div',{className:"_1er4",onKeyDown:this._handleKeyDown},m.createElement('div',{className:"_3mtr"},this._renderTextInput()),m.createElement('div',{className:"_3mts"},m.createElement(h,{onResultsLoaded:this.props.onResultsLoaded,onSelect:this.props.onSelect,query:v}),m.createElement(i,{shown:v.length===0}))));},_renderTextInput:function(){var v=this.props.location===n.MESSENGER?k:o;return (m.createElement(v,{className:"_4qcs",isFocused:true,onChange:this._handleInputChange,onClear:function(){this.setState({query:'',viewerEnteredText:false});}.bind(this),placeholder:q._("Search GIFs & stickers across apps..."),ref:'input',value:this.state.query||''}));},_handleInputChange:function(v){this.setState({query:v.target.value,viewerEnteredText:v.target.value.length>0});},_normalize:function(v){return (v||'').trim().replace(t,s).toLowerCase();},_handleKeyDown:function(v){if(v.keyCode===j.ESC&&this.props.onEscKeyDown)this.props.onEscKeyDown();}});f.exports=u;},null);
__d('ChatContentSearchButton.react',['BanzaiLogger','ChatContentSearchFlyout.react','ContentSearchEvents','ChatContentSearchContextualDialog.react','Link.react','ReactComponentWithPureRenderMixin','React','ReactLayeredComponentMixin','MercuryShareAttachmentRenderLocations','cx','fbt','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=n.PropTypes,u=n.createClass({displayName:'ChatContentSearchButton',_clickGuard:false,mixins:[m,o],propTypes:{ContextualDialogClass:t.func,flyoutAlignment:t.oneOf(['left','right']),getQuery:t.func.isRequired,location:t.oneOf(p.getValues()),onLoad:t.func,onSelect:t.func.isRequired},getDefaultProps:function(){return {flyoutAlignment:'left',location:p.CHAT};},getInitialState:function(){return {query:'',shown:false};},componentDidMount:function(){this.props.onLoad&&this.props.onLoad(this);},updateQuery:function(){this.setState({query:this.props.getQuery()});},hideFlyout:function(){this.setState(this.getInitialState());},render:function(){return (n.createElement(l,{className:s(this.props.className,this.state.shown?"open":''),href:'#',onMouseDown:this._handleMouseDown,onClick:this._handleClick,role:'button',title:r._("Choose a gif or sticker"),ref:'link'}));},renderLayers:function(){if(!this.state.shown)return {contextualDialog:null};var v=this.props.ContextualDialogClass||k;return {contextualDialog:n.createElement(v,{alignment:this.props.flyoutAlignment,contextRef:function(){return this.refs.link;}.bind(this),onBlur:this.hideFlyout,onToggle:this._handleContextualDialogToggle,shown:this.state.shown,width:278},n.createElement(i,{location:this.props.location,onEscKeyDown:this.hideFlyout,onResultsLoaded:this._handleResultsLoaded,onSelect:this._handleSelect,query:this.state.query}))};},_handleMouseDown:function(v){this._clickGuard=this.state.shown;},_handleClick:function(v){if(this.state.shown||this._clickGuard)return;v.stopPropagation();this.setState({query:this.props.getQuery(),shown:!this.state.shown});h.log('ContentSearchLoggerConfig',{event:j.OPEN_TRAY,query:this.state.query});},_handleSelect:function(v,w){this.props.onSelect(v,w);this.setState(this.getInitialState());h.log('ContentSearchLoggerConfig',{event:j.RESULT_SENT,query:this.state.query,resultid:v.resultID});},_handleContextualDialogToggle:function(v){this.setState({shown:v});},_handleResultsLoaded:function(v){h.log('ContentSearchLoggerConfig',{event:j.QUERY_RESULTS_LOADED,query:this.state.query,inflighttime:v});}});f.exports=u;},null);
__d('MessengerSignals',['EventEmitter'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=new h(),j='resize',k={resize:function(){i.emit(j);},onResize:function(l){return i.addListener(j,l);}};f.exports=k;},null);
__d('MessengerAttachmentImageBlock.react',['React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=h.PropTypes,l=h.createClass({displayName:'MessengerAttachmentImageBlock',propTypes:{attachment:k.object.isRequired},render:function(){return (h.createElement('div',{className:j(this.props.className,this._computeClass())},this._renderImage(),h.createElement('div',{className:"_5swm"},this.props.children)));},_renderImage:function(){if(!this.props.attachment.media||!this.props.attachment.media.image)return null;var n=this._getDimensions(),o=n.height,p=n.width,q=o>p,r=m(o,p),s=o&&p?o/p*100:100,t=q||r?.2:1,u=q||r?s:52,v={backgroundImage:'url('+this.props.attachment.media.image+')',minHeight:'0px',paddingBottom:q&&s>150?'136px':u*t+'%'};if(this.props.attachment.description&&this.props.attachment.source)v.minHeight='112px';return (h.createElement('div',{className:"_3xn1",style:v}));},_computeClass:function(){if(!this.props.attachment.media||!this.props.attachment.media.image)return "_3xn3 _5swn";var n=this._getDimensions(),o=n.height,p=n.width,q=o>p,r=m(o,p);return "_3xn3"+(r&&!q?' '+"_3xn5":'')+(q?' '+"_3xn6":'')+(p>=o&&!r?' '+"_3xn7":'');},_getDimensions:function(){var n=this.props.attachment.properties||this.props.attachment.media.image_size||{},o=n.height,p=n.width;if(o&&p){o=parseInt(o,10);p=parseInt(p,10);return {height:o,width:p};}return {height:0,width:0};}});function m(n,o){return n<=300&&o<=300;}f.exports=l;},null);
__d('MessengerFlexArea.react',['Event','MessengerSignals','React','ReactDOM','ResponsiveBlock.react','Style','SubscriptionsHandler','Vector','getScrollPosition','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=j.PropTypes,s=j.createClass({displayName:'MessengerFlexArea',propTypes:{beforeResize:r.func,onResize:r.func},_subscriptions:null,_onResizeTimeout:null,getInitialState:function(){return {height:0};},componentDidMount:function(){var t=new n();t.addSubscriptions(h.listen(window,'resize',q(this.recalculateHeight,51)),i.onResize(function(){this.recalculateHeight();}.bind(this)));this._subscriptions=t;this.recalculateHeight();},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();clearTimeout(this._onResizeTimeout);},render:function(){return (j.createElement(l,{className:this.props.className,onResize:this._handleResponsiveBlockResize,style:{height:this.state.height+'px'}},this.props.children));},recalculateHeight:function(){if(!this.isMounted())return;var t=k.findDOMNode(this),u=t.parentNode,v=this.state.height,w=o.getViewportDimensions().y,x=false;if(u&&m.get(u,'display')==='none'){m.set(u,'display','initial');x=true;}w-=o.getElementPosition(u||t).y;var y=p(window);w+=y.y;if(u){Array.from(u.childNodes).forEach(function(z){if(z.nodeType===Node.COMMENT_NODE||m.get(z,'position')==='absolute')return;w-=o.getElementDimensions(z).y;});w+=o.getElementDimensions(t).y;}if(x)m.set(u,'display','');if(isNaN(w)||w<0)w=0;if(w!==v){this.props.beforeResize&&this.props.beforeResize();this.setState({height:w},this.props.onResize);}},_handleResponsiveBlockResize:q(function(t,u){if(!this.isMounted())return;if(u===this.state.height){this.props.beforeResize&&this.props.beforeResize();clearTimeout(this._onResizeTimeout);if(this.props.onResize)this._onResizeTimeout=setTimeout(this.props.onResize,0);}},51)});f.exports=s;},null);
__d('MessengerScrollableArea.react',['React','ReactDOM','ScrollableArea.react','Style','UserAgent','clearImmediate','cx','joinClasses','setImmediate','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=h.PropTypes,s=20,t=h.createClass({displayName:'MessengerScrollableArea',propTypes:{onScroll:r.func,width:r.number},_resizeCallback:null,componentDidMount:function(){this._resizeCallback=p(this._resize);},componentWillUnmount:function(){m(this._resizeCallback);},render:function(){return (h.createElement(j,{className:o("_5f0v",this.props.className),onScroll:this._handleScroll,ref:'scrollable',shadow:false,style:this.props.style,tabIndex:this.props.tabIndex,width:this.props.width},this.props.children));},_handleScroll:q(function(){var u;this.props.onScroll&&(u=this.props).onScroll.apply(u,arguments);},50),_resize:function(){if(!l.isBrowser('IE'))return;var u=this.refs.scrollable.refs.wrap,v=this.refs.scrollable.refs.body;if(!v||!u)return;v=i.findDOMNode(v);u=i.findDOMNode(u);var w=u.offsetWidth-u.clientWidth;if(w>0)k.set(v,'margin-right',-w+'px');},getArea:function(){return this.refs.scrollable.getArea();},scrollToBottom:function(){var u=this.getArea();if(u)this.scrollToPosition(u.getScrollHeight());},scrollToTop:function(u){var v=this.getArea();if(v)v.scrollToTop(!!u);},scrollToPosition:function(u){var v=this.getArea();if(!v)return;v.setScrollTop(u,false);},isScrolledToBottom:function(){return this.isScrolledToBottomWithHeight(0);},isScrolledToBottomWithHeight:function(u){var v=this.getArea();if(!v)return false;return v.getScrollTop()+v.getClientHeight()+u>=v.getScrollHeight()-s;},isScrolledToTop:function(){var u=this.getArea();if(!u)return true;return u.getScrollTop()<=s;},getScrollTop:function(){var u=this.getArea();if(!u)return 0;return u.getScrollTop();}});f.exports=t;},null);
__d('MessengerFlexScrollableArea.react',['MessengerFlexArea.react','MessengerScrollableArea.react','React'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j.PropTypes,l=j.createClass({displayName:'MessengerFlexScrollableArea',propTypes:{flexChildren:k.node,onScroll:k.func,shouldStickToBottom:k.bool},render:function(){return (j.createElement(h,{beforeResize:this._prepareForResize,className:this.props.className,onResize:this._handleResize,ref:'flexArea'},this.props.flexChildren,j.createElement(i,{height:'100%',onScroll:this.props.onScroll,ref:'scrollable',tabIndex:this.props.tabIndex},this.props.children)));},getArea:function(){return this.refs.scrollable.getArea();},_prepareForResize:function(){this._wasScrolledToBottom=this.refs.scrollable.isScrolledToBottom();},_handleResize:function(){if(this._wasScrolledToBottom&&this.props.shouldStickToBottom)this.refs.scrollable.scrollToBottom();},handleResize:function(){this.refs.flexArea&&this.refs.flexArea.recalculateHeight();},scrollToBottom:function(){this.refs.scrollable.scrollToBottom();},scrollToTop:function(m){this.refs.scrollable.scrollToTop(m);},scrollToPosition:function(m){this.refs.scrollable.scrollToPosition(m);},isScrolledToBottom:function(){return this.refs.scrollable.isScrolledToBottom();},isScrolledToBottomWithHeight:function(m){return this.refs.scrollable.isScrolledToBottomWithHeight(m);},isScrolledToTop:function(){return this.refs.scrollable.isScrolledToTop();},getScrollTop:function(){return this.refs.scrollable.getScrollTop();}});f.exports=l;},null);
__d('MNCommerceBubbleImage.react',['React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=h.PropTypes,l=h.createClass({displayName:'MNCommerceBubbleImage',propTypes:{location:k.string,source:k.string.isRequired,width:k.number},render:function(){return (h.createElement('div',{className:j("_4y9n",this.props.className),style:{backgroundImage:'url(\''+this.props.source+'\')'}}));}});f.exports=l;},null);
__d('MNCommerceAgentItemSuggestionMercuryAttachment.react',['Image.react','LeftRight.react','Link.react','LineClamp.react','MercuryShareAttachmentRenderLocations','MNCommerceAgenItemSuggestionReactShape','MNCommerceBubbleImage.react','React','ReactComponentWithPureRenderMixin','ix','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=o.PropTypes,u=3,v=o.createClass({displayName:'MNCommerceAgentItemSuggestionMercuryAttachment',mixins:[p],propTypes:{isPurchased:t.bool,itemSuggestion:m.isRequired,location:t.oneOf(l.getValues()),onBuyClick:t.func,width:t.number},render:function(){var w=this.props.itemSuggestion,x=w.thumb_url?o.createElement('div',{className:"_522n"},o.createElement(n,{location:this.props.location,source:w.thumb_url,width:this.props.width})):null,y=null;if(w.desc)y=o.createElement(k,{lines:u},w.desc);var z={};if(this.props.location===l.CHAT&&this.props.width)z.width=this.props.width;var aa=o.createElement('div',{className:(!w.target_url?"_522-":'')+(this.props.location===l.WEB_INBOX?' '+"_1hf9":''),style:z},x,o.createElement('div',{className:"_522o"},o.createElement('div',{className:"_522p"},w.name),y,o.createElement('div',{className:"_522q"},w.merchant_name)),this._renderFooter());if(w.target_url)return (o.createElement(j,{className:"_522-",href:w.target_url,target:'_blank',shimhash:w.shimhash},aa));return aa;},_renderFooter:function(){var w=this.props.itemSuggestion.total_cost;if(!w||w.amount<=0)return null;var x;if(!this.props.isPurchased){x=o.createElement('div',{className:"_522s",onClick:this._onBuyClick},s._("Get"));}else x=o.createElement('div',{className:"_1x98"},o.createElement(h,{className:"_1x99",src:q('/images/messaging/commerce/paid_check.png')}),s._("Paid"));return (o.createElement(i,{className:"_522r"},s._("Total: {total cost}",[s.param('total cost',this.props.itemSuggestion.display_total_cost)]),x));},_onBuyClick:function(w){w.preventDefault();this.props.onBuyClick&&this.props.onBuyClick();}});f.exports=v;},null);
__d('MercuryFallbackShareAttachmentTextBlock.react',['LineClamp.react','MercuryShareAttachmentRenderLocations','MercuryShareAttachmentReactShape','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=k.PropTypes,n=k.createClass({displayName:'MercuryFallbackShareAttachmentTextBlock',propTypes:{attachment:j,location:m.oneOf(i.getValues())},render:function(){if(!this.props||!this.props.attachment)return k.createElement('div',{className:"__6j"});var o,p,q;if(i.MESSENGER===this.props.location){if(this.props.attachment.description)p=k.createElement('div',{className:"__6l"},k.createElement(h,{customEllipsis:" ",lines:2,lineHeight:16},this.props.attachment.description));if(this.props.attachment.title)o=k.createElement('div',{className:"__6k"},k.createElement(h,{customEllipsis:" ",lines:2,lineHeight:18},this.props.attachment.title));if(this.props.attachment.source)q=k.createElement('div',{className:"__6m"},this.props.attachment.source);return (k.createElement('div',{className:"__6j"},o,p,q));}if(this.props.attachment.title)o=k.createElement('div',{className:"__6k"},this.props.attachment.title);if(this.props.attachment.description)p=k.createElement('div',{className:"__6l"},this.props.attachment.description);if(this.props.attachment.source)q=k.createElement('div',{className:"__6m"},this.props.attachment.source);return (k.createElement('div',{className:"__6j"},o,p,q));}});f.exports=n;},null);
__d('MercuryShareImage.react',['ChatImageArrowDirection','ChatImageWithArrow.react','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'MercuryShareImage',propTypes:{height:l.number.isRequired,round:l.bool,source:l.string.isRequired,width:l.number.isRequired},render:function(){return (j.createElement('div',{className:"_4hsl"},j.createElement(i,{arrowDirection:h.BOTH,height:this.props.height,round:!!this.props.round,source:this.props.source,width:this.props.width})));}});f.exports=m;},null);
__d('MercuryFallbackShareAttachmentContent.react',['Image.react','ImageBlock.react','MercuryFallbackShareAttachmentTextBlock.react','MercuryShareAttachmentRenderLocations','MercuryShareAttachmentReactShape','MercuryShareImage.react','MessengerAttachmentImageBlock.react','React','URI','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){'use strict';if(c.__markCompiled)c.__markCompiled();var s=o.PropTypes,t=72,u=o.createClass({displayName:'MercuryFallbackShareAttachmentContent',propTypes:{attachment:l,location:s.oneOf(k.getValues())},render:function(){var v=this.props.attachment,w=this.props.location,x=(k.CHAT===w?"_49or":'')+(k.WEB_INBOX===w?' '+"__nm":'')+(k.CHAT_PREVIEW===w?' '+"_324d":'')+(k.CHAT!==w?' '+"_tih":'')+(!(v&&v.media.image)?' '+"_49ou":'');if(v.media&&v.media.image){if(k.CHAT===w||k.CHAT_PREVIEW===w){return (o.createElement(i,{className:x,spacing:'medium'},o.createElement(m,{height:t,source:v.media.image,width:t}),o.createElement('div',{style:{display:'flex',justifyContent:'center',flexDirection:'column',height:t}},o.createElement(j,this.props))));}else if(k.MESSENGER===w)return (o.createElement(n,{className:x,attachment:v},o.createElement(j,this.props),this.props.children));return (o.createElement(i,{className:r(this.props.className,x)},o.createElement(h,{className:"__6n",src:v.media.image,width:t}),o.createElement(j,this.props),this.props.children));}return (o.createElement('div',{className:r(this.props.className,x)},o.createElement(j,this.props),this.props.children));}});f.exports=u;},null);
__d('MercuryFallbackShareAttachment.react',['Link.react','MercuryFallbackShareAttachmentContent.react','MercuryShareAttachmentRenderLocations','MercuryShareAttachmentReactShape','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=l.PropTypes,o=l.createClass({displayName:'MercuryFallbackShareAttachment',propTypes:{attachment:k,location:n.oneOf(j.getValues())},renderLink:function(p){if(j.isPreview(this.props.location))return p;return (l.createElement(h,{className:"_5rw4",href:this.props.attachment.uri,target:'_blank'},p));},render:function(){return this.renderLink(l.createElement(i,this.props));}});f.exports=o;},null);
__d('P2PCreditCardForm.react',['CreditCardFormParam','FBPaymentsCreditCardForm.react','MessengerPaymentProductType','P2PAPIUtils','P2PAPI','React','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=m.PropTypes,p=m.createClass({displayName:'P2PCreditCardForm',propTypes:{asyncRequestState:o.object,onValidation:o.func.isRequired,productType:o.oneOf(n(j))},getDefaultProps:function(){return {asyncRequestState:{},productType:j.P2P};},getInitialState:function(){return {binError:'',previousBINNumber:'',validateBINRequestID:''};},componentWillReceiveProps:function(q){var r=q.asyncRequestState,s=r?r[this.state.validateBINRequestID]:null;if(s){this.setState({validateBINRequestID:''});if(s.error){this.handleValidateBINNumberError(s.error);}else this.handleValidateBINNumberSuccess();}},handleValidateBINNumberSuccess:function(){this.setState({binError:''});},handleValidateBINNumberError:function(q){var r=q.message;this.setState({binError:r});},validateBIN:function(q){var r,s;q=q.replace(/ /g,'');r=q.substr(0,6);if(r!==this.state.previousBINNumber&&r.length>=6){s=k.genRequestID();this.setState({validateBINRequestID:s});l.validateBINNumber({binNumber:r,requestID:s});}else if(r.length<6)this.setState({binError:'',validateBINRequestID:''});this.setState({previousBINNumber:r});},handleValidation:function(q,r){var s=r[h.CARD_NUMBER];if(!this.props.editMode&&this.props.productType===j.P2P&&s)this.validateBIN(s);this.props.onValidation(q,r);},render:function(){return (m.createElement(i,babelHelpers['extends']({},this.props,{allowCredit:this.props.productType===j.MESSENGER_COMMERCE,binError:this.state.binError,onValidation:this.handleValidation})));}});f.exports=p;},null);
__d('P2PAddCreditCardDialog.react',['CurrentEnvironment','Link.react','MessengerPaymentProductType','P2PAPI','P2PAPIUtils','P2PCreditCardStore','P2PCreditCardForm.react','P2PLoadingMask.react','P2PLogger','P2PPaymentLoggerEvent','P2PLinkConstants','React','P2PButton.react','P2PDialog.react','P2PDialogTitle.react','P2PDialogBody.react','P2PDialogFooter.react','P2PText.react','cx','emptyFunction','fbt','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){'use strict';if(c.__markCompiled)c.__markCompiled();var da=s.PropTypes,ea='fbP2PAddCreditCardDialog_learnMoreSentenceID',fa=s.createClass({displayName:'P2PAddCreditCardDialog',propTypes:{cancelButtonText:da.string,eventFlow:da.string.isRequired,loggingData:da.object,loggingObjectID:da.string,onCancel:da.func,onSuccess:da.func,productType:da.oneOf(ca(j)),saveButtonText:da.string,showCancelButton:da.bool,text:da.string,title:da.string},getDefaultProps:function(){var ga;if(h.messengerdotcom){ga=480;}else ga=430;return {cancelButtonText:ba._("Cancel"),loggingData:{},onCancel:aa,onSuccess:aa,productType:j.P2P,saveButtonText:ba._("Save"),showCancelButton:true,text:ba._("Please enter a debit card. Credit cards can't be used."),title:ba._("Add Debit Card"),width:ga};},getInitialState:function(){return {isValid:false,formData:{},loading:false,requestID:'',saveErrors:null};},onCreditCardStoreChange:function(){var ga=m.getAsyncRequestState(),ha=ga[this.state.requestID];this.setState({asyncRequestState:ga});if(ha){this.setState({requestID:''});if(ha.error){this.handleOnSaveError(ha.error);}else this.handleOnSaveSuccess(ha);}},componentDidMount:function(){this.log(q.UI_ACTN_INITIATE_ADD_CARD);this.creditCardStoreSub=m.addListener('change',this.onCreditCardStoreChange);},componentWillUnmount:function(){if(this.creditCardStoreSub){this.creditCardStoreSub.remove();this.creditCardStoreSub=null;}},log:function(ga,ha){p.log(ga,babelHelpers['extends']({www_event_flow:this.props.eventFlow,object_id:this.props.loggingObjectID},this.props.loggingData,ha));},onSaveClick:function(){var ga=l.genRequestID();this.setState({loading:true,requestID:ga,saveErrors:null});this.log(q.UI_ACTN_CONFIRM_CARD_DETAILS);k.addCreditCard(babelHelpers['extends']({requestID:ga,product_type:this.props.productType},this.state.formData));},handleOnSaveSuccess:function(ga){this.props.onSuccess(ga);this.log(q.UI_ACTN_ADD_CARD_SUCCESS);},handleOnSaveError:function(ga){this.setState({loading:false,saveErrors:ga});this.log(q.UI_ACTN_ADD_CARD_FAIL,{message:ga&&ga.general?ga.general.message:''});},handleValidation:function(ga,ha){this.setState({isValid:ga,formData:ha});},isSaveButtonDisabled:function(){return this.state.loading||!this.state.isValid;},onToggle:function(ga){if(!ga){this.props.onCancel();this.log(q.UI_ACTN_CANCEL_ADD_CARD);}},onCancelClicked:function(){this.onToggle(false);},renderAddCardForm:function(){var ga,ha=this.props.title;if(this.props.showCancelButton)ga=s.createElement(t,{use:'default',size:'medium',label:this.props.cancelButtonText,disabled:this.state.loading,onClick:this.onCancelClicked});return (s.createElement('div',null,s.createElement(v,null,ha),s.createElement(w,null,s.createElement(y,{type:'primary',className:"_3-96"},this.props.text),s.createElement(n,{asyncRequestState:this.state.asyncRequestState,compactMode:true,onValidation:this.handleValidation,productType:this.props.productType,saveErrors:this.state.saveErrors,showIcons:false,showLabels:true,showPlaceholderOnFocus:true,showSecondaryIcons:true,useGutters:true}),s.createElement(y,{className:"_3-8y",id:ea,type:'secondary'},ba._("Your payment info is stored securely."),s.createElement('div',null,s.createElement(i,{'aria-describedby':ea,href:r.addDebitCardHelpURI,target:'_blank'},ba._("Learn More"))))),s.createElement(x,{leftContent:this.props.leftContent},ga,s.createElement(t,{use:'confirm',size:'medium',label:this.props.saveButtonText,disabled:this.isSaveButtonDisabled(),onClick:this.onSaveClick}))));},render:function(){return (s.createElement(u,{behaviors:this.props.behaviors,layerHideOnBlur:false,ref:'dialog',onToggle:this.onToggle,repositionOnUpdate:true,shown:true,width:this.props.width},this.renderAddCardForm(),s.createElement(o,{visible:this.state.loading})));}});f.exports=fa;},null);
__d('P2PChooseCreditCardDialog.react',['CurrentEnvironment','P2PButton.react','P2PChooseCreditCardForm.react','P2PCreditCard','P2PDialog.react','P2PDialogBody.react','P2PDialogFooter.react','P2PDialogTitle.react','P2PLoadingMask.react','P2PText.react','React','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';if(c.__markCompiled)c.__markCompiled();var u=h.messengerdotcom,v=r.PropTypes,w=r.createClass({displayName:'P2PChooseCreditCardDialog',propTypes:{addCardOptionText:v.string,cancelButtonText:v.string,creditCards:v.arrayOf(v.instanceOf(k)).isRequired,onAddDebitCardOptionSelected:v.func.isRequired,onClose:v.func.isRequired,onSelected:v.func.isRequired,saveButtonText:v.string.isRequired,selectedCreditCard:v.instanceOf(k).isRequired,showCancelButton:v.bool,showLoading:v.bool,text:v.string,title:v.string,width:v.number},getDefaultProps:function(){return {cancelButtonText:t._("Cancel"),showCancelButton:false,text:t._("You can use a debit card you've already added to Facebook or add a new one."),title:t._("Select Debit Card")};},getInitialState:function(){return {loading:false,selectedCreditCard:this.props.selectedCreditCard};},handleAddDebitCardOptionClicked:function(){this.props.onAddDebitCardOptionSelected();},handleCreditCardSelected:function(x){this.setState({selectedCreditCard:x});},handleSelected:function(){this.setState({loading:true});this.props.onSelected(this.state.selectedCreditCard);},handleToggle:function(x){if(!x)this.props.onClose();},render:function(){var x;if(this.props.showCancelButton)x=r.createElement(i,{disabled:this.props.showLoading,label:this.props.cancelButtonText,onClick:this.props.onClose,size:'medium',use:'default'});return (r.createElement(l,{behaviors:this.props.behaviors,className:u?"_auz":'',onToggle:this.handleToggle,width:this.props.width},r.createElement(o,null,this.props.title),r.createElement(m,{className:"_383d"},r.createElement(q,{type:'primary',className:"_au_"},this.props.text),r.createElement(j,{addCardOptionText:this.props.addCardOptionText,className:"_2pi4",creditCards:this.props.creditCards,onAddDebitCardOptionSelected:this.handleAddDebitCardOptionClicked,onChange:this.handleCreditCardSelected,selectedCard:this.props.selectedCreditCard,showAddDebitCardOption:true})),r.createElement(n,null,x,r.createElement(i,{disabled:this.props.showLoading,label:this.props.saveButtonText,onClick:this.handleSelected,size:'medium',use:'confirm'})),r.createElement(p,{visible:this.props.showLoading})));}});f.exports=w;},null);
__d('P2PEditCreditCardDialog.react',['CreditCardFormParam','CurrentEnvironment','Link.react','React','P2PAPI','P2PAPIUtils','P2PCreditCard','P2PCreditCardForm.react','P2PLoadingMask.react','P2PLinkConstants','P2PDialog.react','P2PDialogTitle.react','P2PDialogBody.react','P2PDialogFooter.react','P2PButton.react','P2PText.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){'use strict';if(c.__markCompiled)c.__markCompiled();var z='fbP2PEditCreditCardDialog_learnMoreSentenceID',aa=k.PropTypes,ba=k.createClass({displayName:'P2PEditCreditCardDialog',propTypes:{asyncRequestState:aa.object.isRequired,creditCard:aa.instanceOf(n).isRequired,onCancel:aa.func.isRequired,onSuccess:aa.func.isRequired,saveButtonText:aa.string,showCancelButton:aa.bool},getInitialState:function(){return {formData:{},isValid:false,loading:false,requestID:'',saveErrors:null};},getDefaultProps:function(){return {saveButtonText:y._("Save"),showCancelButton:true,width:i.messengerdotcom?350:300};},componentWillReceiveProps:function(ca){var da=ca.asyncRequestState?ca.asyncRequestState[this.state.requestID]:null;if(da){this.setState({requestID:''});if(da.error){this.handleOnSaveError(da.error);}else this.handleOnSaveSuccess(da);}},clearSaveErrors:function(){this.setState({saveErrors:null});},onSaveClick:function(ca){var da={},ea=m.genRequestID();da[h.CREDENTIAL_ID]=this.props.creditCard.getCredentialId();this.clearSaveErrors();this.setState({loading:true,requestID:ea});l.updateCreditCard(babelHelpers['extends']({requestID:ea},da,this.state.formData));},handleOnSaveSuccess:function(ca){this.props.onSuccess(ca);},onCancelClick:function(ca){this.props.onCancel();},handleOnSaveError:function(ca){this.setState({loading:false,saveErrors:ca});},isSaveDisabled:function(){return !this.state.isValid||this.state.loading;},isCancelDisabled:function(){return this.state.loading;},handleValidation:function(ca,da){this.setState({isValid:ca,formData:da});},getPrefilledFormData:function(){var ca={};ca[h.CARD_NUMBER]=this.props.creditCard.getCreditCardNumberMask();ca[h.CARD_EXPIRATION]=this.props.creditCard.getExpFormattedShort();ca[h.ZIP]=this.props.creditCard.getZipCode();return ca;},handleErrorDialogOKClick:function(){this.clearSaveErrors();},onToggle:function(ca){if(!ca)this.props.onCancel();},render:function(){var ca,da=this.props.text;if(!da)da=y._("Please update the expiration date for your card ending in {card numbers}.",[y.param('card numbers',this.props.creditCard.getCreditCardNumber())]);if(this.props.showCancelButton)ca=k.createElement(v,{use:'default',size:'medium',label:y._("Cancel"),disabled:this.isCancelDisabled(),onClick:this.onCancelClick});return (k.createElement(r,{behaviors:this.props.behaviors,layerHideOnBlur:false,onToggle:this.onToggle,repositionOnUpdate:true,shown:true,width:this.props.width},k.createElement(s,null,y._("Update Debit Card")),k.createElement(t,null,k.createElement(w,{className:"_3-96",type:'primary'},da),k.createElement(o,{onValidation:this.handleValidation,saveErrors:this.state.saveErrors,editMode:true,prefilledFormData:this.getPrefilledFormData(),cscMaxLength:this.props.creditCard.getMaxCSCLength()}),k.createElement(w,{className:"_3-8y",id:z,type:'secondary'},y._("Your payment info is stored securely. {Learn more about p2p link}",[y.param('Learn more about p2p link',k.createElement(j,{'aria-describedby':z,href:q.addDebitCardHelpURI,target:'_blank'},y._("Learn more.")))]))),k.createElement(u,null,ca,k.createElement(v,{use:'confirm',size:'medium',label:this.props.saveButtonText,disabled:this.isSaveDisabled(),onClick:this.onSaveClick})),k.createElement(p,{visible:this.state.loading})));}});f.exports=ba;},null);
__d('P2PMoneypennyCheckoutDialog.react',['CurrentEnvironment','Link.react','MNCommerceAgenItemSuggestionReactShape','P2PBigAmount.react','P2PButton.react','P2PCreditCard','P2PDialog.react','P2PDialogBody.react','P2PDialogFooter.react','P2PDialogTitle.react','P2PLoadingMask.react','P2PMoneypennyProductItemDetails.react','P2PText.react','React','ReactComponentWithPureRenderMixin','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){'use strict';if(c.__markCompiled)c.__markCompiled();var z=u.PropTypes,aa=u.createClass({displayName:'P2PMoneypennyCheckoutDialog',mixins:[v],propTypes:{cancelButtonText:z.string,item:j.isRequired,leftContentText:z.string,onClose:z.func.isRequired,onChangeCreditCard:z.func.isRequired,onNextClicked:z.func.isRequired,onPurchaseClicked:z.func.isRequired,selectedCreditCard:z.instanceOf(m),showCancelButton:z.bool,showLoading:z.bool},getDefaultProps:function(){return {cancelButtonText:x._("Cancel"),leftContentText:x._("You'll add a debit card next."),showCancelButton:false,width:360};},handleToggle:function(ba){if(!ba)this.props.onClose();},renderPaymentDetails:function(){var ba=this.props.selectedCreditCard;if(!ba)return null;return (u.createElement(t,{className:"_1t0k",shade:'light',size:'small',type:'secondary'},ba.getDetailsFormatted()+' \u00b7 ',u.createElement(i,{className:"_1t0l",onClick:this.props.onChangeCreditCard,href:'#'},x._("Change"))));},renderFooter:function(){var ba,ca,da;if(!this.props.selectedCreditCard){ba=u.createElement(t,{className:"_1t0n",type:'secondary'},this.props.leftContentText);ca=u.createElement(l,{label:x._("Next"),onClick:this.props.onNextClicked,size:'medium',type:'primary',use:'default'});}else ca=u.createElement(l,{label:x._("Pay"),onClick:this.props.onPurchaseClicked,size:'medium',type:'primary',use:'confirm'});if(this.props.showCancelButton)da=u.createElement(l,{use:'default',size:'medium',label:this.props.cancelButtonText,disabled:this.props.showLoading,onClick:this.props.onClose});return (u.createElement(p,{leftContent:ba},da,ca));},renderAmountSection:function(){return (u.createElement('div',{className:"_1t0o"},u.createElement('div',{className:"_4qbr"},u.createElement(k,{amount:this.props.item.raw_amount,size:'large'})),this.renderPaymentDetails(),u.createElement(t,{className:"_1wb1",shade:'light',size:'small',type:'secondary'},'We',"'",'ll place your order with the business when we receive your payment.')));},render:function(){var ba;if(!h.messengerdotcom)ba=u.createElement(q,null,x._("Payment"));return (u.createElement(n,{layerHideOnBlur:false,onToggle:this.handleToggle,shown:true,width:this.props.width},ba,u.createElement(o,null,u.createElement('div',{className:"_b0z"},u.createElement(s,{item:this.props.item})),this.renderAmountSection()),this.renderFooter(),u.createElement(r,{visible:this.props.showLoading})));}});f.exports=aa;},null);
__d('P2PMoneypennyStore',['P2PActionConstants','EventEmitter','ImmutableObject','P2PDispatcher'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';var l,m;if(c.__markCompiled)c.__markCompiled();var n,o,p;function q(t,u){if(t)p[t]=new j(u);}function r(t,u){if(t)p[t]={error:u};}l=babelHelpers.inherits(s,i);m=l&&l.prototype;function s(){m.constructor.call(this);p={};o=[];n=k.register(this.onEventDispatched.bind(this));}s.prototype.onEventDispatched=function(t){var u=t.data,v=t.type;switch(v){case h.MONEYPENNY_TRANSFER_CREATED:this.handleMoneypennyTransferCreated(u);this.emit('change');break;case h.MONEYPENNY_TRANSFER_CREATED_ERROR:this.handleMoneypennyTransferCreatedError(u);this.emit('change');break;}};s.prototype.getAsyncRequestState=function(){return p;};s.prototype.handleMoneypennyTransferCreated=function(t){var u;q(t.requestID,t);u=o.filter(function(v){return (v.payment_id===t.payment_id);})[0];if(!u)o.push(new j(t));};s.prototype.handleMoneypennyTransferCreatedError=function(t){r(t.requestID,t.error);};s.prototype.getTransferByID=function(t){return o.filter(function(u){return u.item_id===t;})[0];};f.exports=new s();},null);
__d('P2PPasswordProtectionNUXDialog.react',['CurrentEnvironment','Link.react','P2PAPI','P2PErrorDialog.react','P2PLinkConstants','P2PLoadingMask.react','P2PLogger','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PPasswordProtectionParam','P2PPasswordProtectionStatusTypes','React','P2PButton.react','P2PDialog.react','P2PDialogTitle.react','P2PDialogBody.react','P2PDialogFooter.react','P2PText.react','cx','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){'use strict';if(c.__markCompiled)c.__markCompiled();var ca=s.PropTypes,da=s.createClass({displayName:'P2PPasswordProtectionNUXDialog',propTypes:{onComplete:ca.func},getDefaultProps:function(){return {onComplete:aa,width:h.messengerdotcom?320:300};},getInitialState:function(){return {saveErrorObject:null,loading:false};},componentWillMount:function(){this.log(o.UI_ACTN_INITIATE_PASSWORD_PROTECTION_NUX);},log:function(ea,fa){n.log(ea,babelHelpers['extends']({www_event_flow:p.UI_FLOW_P2P_SETTINGS},fa));},onSaveClick:function(){this.setState({loading:true,saveErrorObject:null});this.setPasswordProtection(r.ENABLED);this.log(o.UI_ACTN_OPT_IN_PASSWORD_PROTECTION_NUX);},setPasswordProtection:function(ea){var fa={};fa[q.STATUS]=ea;j.setPasswordProtectionSetting({formData:fa,success:this.handleOnSaveSuccess,error:this.handleOnSaveError});},handleOnSaveSuccess:function(){this.setState({loading:false});this.props.onComplete();},handleOnSaveError:function(ea){this.setState({loading:false,saveErrorObject:ea});},isSaveButtonDisabled:function(){return this.state.loading;},isCancelButtonDisabled:function(){return this.state.loading;},onCancelClick:function(){this.setState({loading:true,saveErrorObject:null});this.setPasswordProtection(r.DISABLED);this.log(o.UI_ACTN_OPT_OUT_PASSWORD_PROTECTION_NUX);},handleErrorBackClick:function(){this.setState({saveErrorObject:null});},handleErrorOKClick:function(){this.setState({saveErrorObject:null});this.props.onComplete();},render:function(){if(this.state.saveErrorObject)return (s.createElement(k,{allowBack:true,title:ba._("Problem Saving"),onBackClick:this.handleErrorBackClick,onOKClick:this.handleErrorOKClick,error:this.state.saveErrorObject}));return (s.createElement(u,{className:h.messengerdotcom?"_-el":'',behaviors:{LayerFadeOnShow:false},layerHideOnBlur:false,shown:true,width:this.props.width},s.createElement(v,{showCloseButton:false},ba._("Use Password?")),s.createElement(w,null,s.createElement(y,{className:"_5sor",type:'primary'},ba._("For additional security, you can enter your Facebook password to send money. You can always update this in {link}.",[ba.param('link',s.createElement(i,{href:l.settingsWWWURI,target:'_blank'},ba._("Settings")))]))),s.createElement(x,null,s.createElement(t,{className:"_5sov",disabled:this.isCancelButtonDisabled(),label:ba._("Not Now"),onClick:this.onCancelClick,size:'medium',use:'default'}),s.createElement(t,{className:"_5sox",disabled:this.isSaveButtonDisabled(),label:ba._("Use Password"),onClick:this.onSaveClick,size:'medium',use:'confirm'})),s.createElement(m,{visible:this.state.loading})));}});f.exports=da;},null);
__d('P2PSuccessDialog.react',['CurrentEnvironment','Image.react','LayerSlowlyFadeOnShow','P2PConfirmationDialog.react','React','emptyFunction','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=l.PropTypes,q=l.createClass({displayName:'P2PSuccessDialog',propTypes:{buttonLabel:p.node,buttonUse:p.string,onOKClick:p.func,onSecondaryClick:p.func,showCloseButton:p.bool,showSecondaryButton:p.bool,secondaryButtonLabel:p.node,secondaryButtonUse:p.string,title:p.string.isRequired},getDefaultProps:function(){return {allowBack:false,buttonLabel:n._("OK"),buttonUse:'default',onOKClick:m,showCloseButton:false,width:h.messengerdotcom?350:300};},getImage:function(){if(h.messengerdotcom){return (l.createElement(i,{height:62,width:62,src:o('/images/p2p/checkmark-messenger.png')}));}else return (l.createElement(i,{height:56,width:56,src:o('/images/p2p/check_mark-sm.png')}));},render:function(){var r=this.getImage();return (l.createElement(k,{behaviors:babelHelpers['extends']({LayerSlowlyFadeOnShow:j},this.props.behaviors),allowBack:this.props.allowBack,buttonLabel:this.props.buttonLabel,buttonUse:this.props.buttonUse,centered:this.props.centered,image:r,onOKClick:this.props.onOKClick,onSecondaryClick:this.props.onSecondaryClick,showCloseButton:this.props.showCloseButton,showSecondaryButton:this.props.showSecondaryButton,secondaryButtonLabel:this.props.secondaryButtonLabel,secondaryButtonUse:this.props.secondaryButtonUse,title:this.props.title,width:this.props.width},this.props.children));}});f.exports=q;},null);
__d('P2PMoneypennyCheckoutDialogContainer.react',['Arbiter','CreditCardFormParam','CurrentEnvironment','MessengerPaymentProductType','MNCommerceAgenItemSuggestionReactShape','P2PAPI','P2PAPIUtils','P2PAddCreditCardDialog.react','P2PChooseCreditCardDialog.react','P2PCreditCardStore','P2PEditCreditCardDialog.react','P2PErrorDialog.react','P2PGKValues','P2PLogger','P2PMoneypennyCheckoutDialog.react','P2PMoneypennyStore','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PPasswordProtectionNUXDialog.react','P2PPasswordProtectionStatusTypes','P2PSuccessDialog.react','P2PText.react','P2PVerifyCreditCardDialog.react','React','cx','fbt','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){'use strict';if(c.__markCompiled)c.__markCompiled();var ia=ga._("Pay"),ja={LayerFadeOnShow:false},ka=360,la=y.UI_FLOW_MONEYPENNY_CHECKOUT,ma=ea.PropTypes,na=ea.createClass({displayName:'P2PMoneypennyCheckoutDialogContainer',propTypes:{item:l.isRequired,onClose:ma.func.isRequired},getInitialState:function(){var oa=this.getCards();return {addCreditCardDialogShown:false,editCreditCardDialogShown:false,creditCards:oa,creditCardAsyncRequestState:q.getAsyncRequestState(),chooseCreditCardDialogShown:false,loading:false,moneypennyAsyncRequestState:w.getAsyncRequestState(),p2pPasswordProtectionNUXDialogShown:false,transferErrors:null,transferRequestID:'',selectedCreditCard:oa[0],successDialogPending:false,successDialogShown:false,verifyCreditCardDialogShown:false};},componentWillMount:function(){this.log(x.UI_ACTN_INITIATE_MONEYPENNY_ORDER,{});this.creditCardStoreSub=q.addListener('change',this.onCreditCardStoreChange);this.moneypennyTransferStoreSub=w.addListener('change',this.onMoneypennyStoreChange);},componentWillUnmount:function(){if(this.creditCardStoreSub){this.creditCardStoreSub.remove();this.creditCardStoreSub=null;}if(this.moneypennyTransferStoreSub){this.moneypennyTransferStoreSub.remove();this.moneypennyTransferStoreSub=null;}if(this.passwordCancelSubscribeToken!==null){h.unsubscribe(this.passwordCancelSubscribeToken);this.passwordCancelSubscribeToken=null;}},creditCardStoreSub:null,moneypennyTransferStoreSub:null,passwordCancelSubscribeToken:null,passwordNUXPending:false,successDialogPending:false,getProductType:function(){return k.MESSENGER_COMMERCE;},getCards:function(){return q.getAll(this.getProductType());},log:function(oa,pa){u.log(oa,babelHelpers['extends']({raw_amount:this.props.item.raw_amount,currency:this.props.item.total_cost.currency,object_id:this.props.item.id,www_event_flow:la},pa));},onCreditCardStoreChange:function(){var oa=this.getCards(),pa;if(this.state.selectedCreditCard)pa=q.getCreditCardByCredentialID(this.state.selectedCreditCard.getCredentialId());if(!pa)pa=oa[0];this.setState({creditCards:oa,creditCardAsyncRequestState:q.getAsyncRequestState(),selectedCreditCard:pa});},onMoneypennyStoreChange:function(){var oa=w.getAsyncRequestState(),pa=oa[this.state.transferRequestID];this.setState({moneypennyAsyncRequestState:oa});if(pa){this.setState({transferRequestID:''});if(pa.error){this.handleMoneypennyTransferError(pa.error);}else this.handleMoneypennyTransferSuccess(pa);}},handleChangeCreditCardClicked:function(){this.hideAllDialogs();if(this.state.creditCards.length>1){this.setState({chooseCreditCardDialogShown:true});this.log(x.UI_ACTN_INITIATE_CHOOSE_CARD,{});}else this.setState({addCreditCardDialogShown:true});},handleAddDebitCardClicked:function(){this.hideAllDialogs();this.setState({addCreditCardDialogShown:true});},handleCreditCardSelected:function(oa){this.setState({selectedCreditCard:oa},function(){this.purchase();}.bind(this));},purchase:function(){var oa;if(!this.state.selectedCreditCard.getIsVerified()){this.log(x.UI_ACTN_VERIFY_CSC,{});this.hideAllDialogs();this.setState({verifyCreditCardDialogShown:true});return;}else if(this.state.selectedCreditCard.isExpired()){this.log(x.UI_ACTN_EDIT_CARD,{});this.hideAllDialogs();this.setState({editCreditCardDialogShown:true});return;}this.passwordCancelSubscribeToken=h.subscribeOnce('PasswordReauthDialogCancelClick',this.handlePasswordReauthDialogCancelClick);oa=n.genRequestID();this.setState({loading:true,transferRequestID:oa,transferErrors:null});m.createMoneypennyTransfer({amount:this.props.item.raw_amount,credential_id:this.state.selectedCreditCard.getCredentialId(),item_id:this.props.item.id,external_request_id:n.genRequestID(),requestID:oa});this.log(x.UI_ACTN_CONFIRM_MONEYPENNY_ORDER,{});},handleMoneypennyTransferSuccess:function(oa){this.hideAllDialogs();this.log(x.UI_ACTN_MONEYPENNY_ORDER_SUCCESS,{});if(oa.passwordProtection===aa.NOT_SET)this.passwordNUXPending=true;if(this.successDialogPending){this.successDialogPending=false;this.setState({successDialogShown:true});}else this.handleCheckoutSuccess();},handleMoneypennyTransferError:function(oa){this.hideAllDialogs();this.log(x.UI_ACTN_MONEYPENNY_ORDER_FAIL,{});this.setState({loading:false,transferErrors:oa});},handlePasswordReauthDialogCancelClick:function(){this.passwordCancelSubscribeToken=null;this.setState({loading:false});this.hideAllDialogs();},handleCheckoutSuccess:function(){this.hideAllDialogs();if(this.passwordNUXPending){this.passwordNUXPending=false;this.setState({p2pPasswordProtectionNUXDialogShown:true});}else ha(this.props.onClose);},handleAddCreditCardSuccess:function(oa){this.successDialogPending=this.getCards().length===1;this.setState({selectedCreditCard:q.getCreditCardByCredentialID(oa[i.CREDENTIAL_ID])},function(){this.purchase();}.bind(this));},handleCheckoutCancel:function(){this.log(x.UI_ACTN_MONEYPENNY_ORDER_CANCEL,{});this.props.onClose();},hideAllDialogs:function(){this.setState({addCreditCardDialogShown:false,editCreditCardDialogShown:false,chooseCreditCardDialogShown:false,successDialogShown:false,transferErrors:null,verifyCreditCardDialogShown:false,p2pPasswordProtectionNUXDialogShown:false});},render:function(){var oa=this.props.item,pa=j.messengerdotcom,qa,ra,sa,ta,ua,va;if(this.getProductType()===k.MESSENGER_COMMERCE){qa=ga._("Please enter a debit or credit card to get {Product name}.",[ga.param('Product name',oa.name)]);ra=ga._("Add Card");ta=ga._("Select Card");sa=ga._("You can use a card you've already added to Facebook or add a new one to get {Product name}.",[ga.param('Product name',this.props.item.name)]);ua=ga._("New Card");va=ga._("You'll add a card next.");}else{qa=ga._("Please enter a debit card to get {Product name}. Credit cards can't be used yet.",[ga.param('Product name',oa.name)]);sa=ga._("You can use a debit card you've already added to Facebook or add a new one to get {Product name}.",[ga.param('Product name',this.props.item.name)]);}if(this.state.p2pPasswordProtectionNUXDialogShown){return (ea.createElement(z,{onComplete:this.props.onClose,width:ka}));}else if(this.state.transferErrors){return (ea.createElement(s,{behaviors:ja,error:this.state.transferErrors,onOKClick:this.handleCheckoutCancel,title:ga._("Problem with your payment"),width:ka}));}else if(this.state.verifyCreditCardDialogShown){return (ea.createElement(da,{asyncRequestState:this.state.creditCardAsyncRequestState,behaviors:ja,creditCard:this.state.selectedCreditCard,isPurchasing:true,purchaseName:this.props.item.name,onCancel:this.handleCheckoutCancel,onSuccess:this.purchase,saveButtonText:ia,showCancelButton:pa,width:ka}));}else if(this.state.editCreditCardDialogShown){return (ea.createElement(r,{asyncRequestState:this.state.creditCardAsyncRequestState,behaviors:ja,creditCard:this.state.selectedCreditCard,onCancel:this.handleCheckoutCancel,onSuccess:this.purchase,saveButtonText:ia,showCancelButton:pa,text:ga._("Please update the expiration date for your card ending in {card numbers} to get {Product name}.",[ga.param('card numbers',this.state.selectedCreditCard.getCreditCardNumber()),ga.param('Product name',this.props.item.name)]),width:ka}));}else if(this.state.successDialogShown){return (ea.createElement(ba,{behaviors:babelHelpers['extends']({LayerSlowlyFadeOnShow:false},ja),onOKClick:this.handleCheckoutSuccess,title:ga._("Payment Sent"),width:ka},ea.createElement(ca,{className:"_3-97",type:'primary'},ga._("We received your payment and are placing your order with the business.")),ea.createElement(ca,{type:'primary'},ga._("{Bold text that says, Tip:} You can also use {Credit card name and number} to send money to friends in your conversations.",[ga.param('Bold text that says, Tip:',ea.createElement(ca,{display:'inline',type:'primary',weight:'bold'},ga._("Tip:"))),ga.param('Credit card name and number',this.state.selectedCreditCard.getDetailsFormatted())]))));}else if(this.state.chooseCreditCardDialogShown){return (ea.createElement(p,{addCardOptionText:ua,behaviors:ja,creditCards:this.state.creditCards,onAddDebitCardOptionSelected:this.handleAddDebitCardClicked,onClose:this.handleCheckoutCancel,onSelected:this.handleCreditCardSelected,saveButtonText:ia,selectedCreditCard:this.state.selectedCreditCard,showCancelButton:pa,showLoading:this.state.loading,text:sa,title:ta,width:ka}));}else if(this.state.addCreditCardDialogShown){return (ea.createElement(o,{behaviors:ja,eventFlow:la,loggingData:{amount:oa.raw_amount,object_id:oa.id},onCancel:this.handleCheckoutCancel,onSuccess:this.handleAddCreditCardSuccess,productType:this.getProductType(),saveButtonText:ia,showCancelButton:pa,text:qa,title:ra,width:ka}));}else return (ea.createElement(v,{item:this.props.item,leftContentText:va,onChangeCreditCard:this.handleChangeCreditCardClicked,onClose:this.handleCheckoutCancel,onNextClicked:this.handleAddDebitCardClicked,onPurchaseClicked:this.purchase,selectedCreditCard:this.state.selectedCreditCard,showCancelButton:pa,showLoading:this.state.loading,width:ka}));}});f.exports=na;},null);
__d('MNCommerceAgentItemSuggestionMercuryShareAttachment.react',['MercuryFallbackShareAttachment.react','MercuryShareAttachmentReactShape','MercuryShareAttachmentRenderLocations','MNCommerceAgentItemSuggestionMercuryAttachment.react','P2PActions','P2PMoneypennyCheckoutDialogContainer.react','P2PMoneypennyStore','React','ReactComponentWithPureRenderMixin','StoreAndPropBasedStateMixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=o.PropTypes,s=o.createClass({displayName:'MNCommerceAgentItemSuggestionMercuryShareAttachment',mixins:[p,q(n)],propTypes:{attachment:i,maxWidth:r.number,location:r.oneOf(j.getValues())},statics:{calculateState:function(t){var u=t.attachment&&t.attachment.target,v=!!(u&&u.payment_id);if(!v){var w=n.getTransferByID(u.id);v=!!(w&&w.payment_id);}return {isItemPurchased:v};}},_handleBuyClick:function(){l.showDialog(m,{item:this._getItem(),onClose:l.hideDialog});},_getItem:function(){var t=this.props.attachment;return t&&t.target;},render:function(){var t=this._getItem();if(!t)return o.createElement(h,this.props);return (o.createElement(k,{itemSuggestion:t,isPurchased:this.state.isItemPurchased,location:this.props.location,onBuyClick:this._handleBuyClick,width:this.props.maxWidth}));}});f.exports=s;},null);
__d('OzActions',['Reflux'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={};i.activateThread=h.createAction();i.activateIntent=h.createAction();i.updateThreads=h.createAction();i.maybeUpdateThreads=h.createAction();i.clearReassignState=h.createAction();i.updateMerchants=h.createAction();i.deleteMerchants=h.createAction();i.updateWitIntents=h.createAction();i.updateReps=h.createAction();i.replaceReps=h.createAction();i.replaceHumans=h.createAction();i.updateRequirements=h.createAction();i.showDialog=h.createAction();i.hideDialog=h.createAction();i.updateComposer=h.createAction();i.addBubble=h.createAction();i.addAutopilot=h.createAction();i.isActive=h.createAction();i.isInactive=h.createAction();i.sendPulse=h.createAction();i.updateQueueFilters=h.createAction();i.twilio=h.createActions(['connect','endCall','hangUp','incoming','incomingAccept','incomingReject','mute','ready','setup','startCall','unmute','updateIncomingInfo','useIntent','updateRating','dialAgain']);i.twilio.changeTo=h.createAction({sync:true});i.twilio.sendDigits=h.createAction({sync:true});i.sendMessageStart=h.createAction();i.sendMessageFinish=h.createAction();i.addHandledEvents=h.createAction();i.updateServerOffset=h.createAction();f.exports=i;},null);
__d('OzNotify',['immutable','ReactComponentWithPureRenderMixin','React','ReactCSSTransitionGroup','Reflux','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=h.OrderedMap,p=h.Map,q={addNotif:l.createAction({sync:true}),removeNotif:l.createAction({sync:true})},r=l.createStore({init:function(){this.data=o();this.listenTo(q.addNotif,this._onAddNotif);this.listenTo(q.removeNotif,this._onRemoveNotif);},getInitialState:function(){return this.data;},_onAddNotif:function(y){this.data=this.data.set(y.get('id'),y);this.trigger(this.data);},_onRemoveNotif:function(y){this.data=this.data['delete'](y);this.trigger(this.data);}}),s=p({info:"_4nqo",warn:"_4nqp",error:"_4nqq"}),t=j.createClass({displayName:'OzNotify',mixins:[l.connect(r,'notifs'),i],render:function(){return (j.createElement(k,{component:'div',transitionName:'oz-fade-in-out',className:"_4nqr",transitionEnterTimeout:500,transitionLeaveTimeout:500},this.state.notifs.reverse().map(function(y,z){return (j.createElement('div',{key:z,className:n("_4nqs",s.get(y.get('level')))},y.get('msg'),j.createElement('span',{className:"_ok9",onClick:function(){return q.removeNotif(z);}},'×')));}).valueSeq()));}}),u=7000,v=0;function w(y){return function(z){v+=1;q.addNotif(p({id:v,level:y,msg:z}));(function(aa){window.setTimeout(function(ba){return q.removeNotif(aa);},u);})(v);};}var x={Component:t,info:w('info'),warn:w('warn'),error:w('error')};f.exports=x;},null);
__d('OzAPI',['OzHelpers','OzNotify','Arbiter','ChannelConstants','ChannelManager','immutable','invariant','OzActions','OzAJAX','OzConfig','OzStores','promiseFinally','RTISubscriptionManager'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=m.List,v=m.Map,w=p.ajax,x=p.beacon,y=p.buildURI,z=r.ActiveThreadStore;l.getConfig;function aa(ka){if(ka.attachment&&!ka.attachments)ka.attachments=[ka.attachment];var la=m.fromJS(ka);return la;}function ba(ka){return u(ka.map(function(la){la=aa(la);return [h.msgID(la),la];})).fromEntrySeq().toMap();}function ca(ka){if(!ka.messages)ka.messages=(ka['last-events']||[]).map(function(ma){ma.sender=ma.from;return ma;});ka.messages=ba(ka.messages);var la=m.fromJS(ka);return la;}function da(ka){return u(ka.map(ca));}function ea(ka){var la=da([ka]);o.updateThreads(la);!(la.count()===1)?n(0):undefined;return la.first();}function fa(ka){!Number.isSafeInteger(ka.offset)?n(0):undefined;!Number.isSafeInteger(ka.limit)?n(0):undefined;return w({type:'GET',url:y('threads',h.getConfig('PAGE_ID')),params:ka}).then(function(la){var ma=la.threads,na=da(ma);o.updateThreads(na);return na;});}function ga(ka){var la=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],ma=arguments.length<=2||arguments[2]===undefined?{}:arguments[2],na=arguments.length<=3||arguments[3]===undefined?null:arguments[3];!(typeof ka==='string')?n(0):undefined;!(typeof la==='object')?n(0):undefined;var oa,pa=false;if(la instanceof FormData){oa=la;}else{oa=JSON.stringify(la);pa=true;}var qa={type:'PUT',url:y('sync'),params:{t:ka,'intent-id':na||z.data.get('activeIntent'),page:h.getConfig('PAGE_ID')},body:oa};qa=Object.assign(qa,ma);if(pa){qa.headers=qa.headers||{};qa.headers['content-type']='application/json';}h.info('[sync] '+ka,la);return w(qa);}function ha(ka){return function(la){return ga(ka,{tid:la}).then(function(ma){var na=ca(ma);o.updateThreads(u([na]));return na;});};}var ia={_witIntentCSV:function(){ia.witIntents().done(function(ka){var la='data:text/csv;charset=utf-8,';ka.forEach(function(ma){return la+='"'+ma.get('name')+'","'+ma.get('id')+'","'+ma.get('doc')+'"\n';});window.open(window.encodeURI(la));});},grab:ha('grab'),release:ha('release'),ready:ha('ready'),notready:ha('notready'),ack:ha('ack'),lockThread:ha('lock-thread'),unlockThread:function(ka,la){return ga('unlock-thread',{tid:ka,'locked-at':la}).then(ea);},assignTo:function(ka,la){return ga('assign-to',{tid:ka,id:la});},escalate:function(ka){return ia.createTag(ka,'escalated');},escalateTo:function(ka,la){return ia.escalate(ka).then(function(){return ia.assignTo(ka,la);});},typing:function(ka){return ga('rep-typing',{tid:ka});},createReminder:function(ka,la){return ga('create-reminder',babelHelpers['extends']({tid:ka},la.toJS())).then(ea);},closeReminder:function(ka,la,ma){return ga('close-reminder',{tid:ka,id:la,all:ma}).then(ea);},editReminder:function(ka,la){return ga('edit-reminder',{tid:ka,reminder:la.toJS()}).then(ea);},snoozeReminder:function(ka,la){return ga('snooze-reminder',{tid:ka,id:la}).then(ea);},deleteIntentRequirement:function(ka,la,ma){return ga('delete-intent-requirement',{tid:ka,'intent-id':la,'requirement-id':ma}).then(ea);},deleteThreadRequirement:function(ka,la){return ga('delete-thread-requirement',{tid:ka,'requirement-id':la}).then(ea);},createIntentRequirement:function(ka,la,ma){return ga('create-intent-requirement',{tid:ka,'intent-id':la,'requirement-name':ma}).then(ea);},createThreadRequirement:function(ka,la){return ga('create-thread-requirement',{tid:ka,'requirement-name':la}).then(ea);},createIntent:function(ka,la){return ga('create-intent',babelHelpers['extends']({tid:ka},la.toJS())).then(ea);},deleteIntent:function(ka,la){return ga('delete-intent',{tid:ka,id:la},{},la).then(ea);},openIntent:function(ka,la){return ga('open-intent',{tid:ka,id:la},{},la).then(ea);},closeIntent:function(ka,la){return ga('close-intent',{tid:ka,id:la},{},la).then(ea);},blockIntent:function(ka,la){return ga('block-intent',{tid:ka,id:la}).then(ea);},unblockIntent:function(ka,la){return ga('unblock-intent',{tid:ka,id:la}).then(ea);},addPhoneNumber:function(ka,la){return ga('add-phone-number',{tid:ka,'intent-id':la},{},la).then(ea);},editIntent:function(ka,la){return ga('edit-intent',babelHelpers['extends']({tid:ka},la.toJS()));},createTag:function(ka,la){return ga('add-thread-tag',{tid:ka,tag:la}).then(ea);},deleteTag:function(ka,la){return ga('remove-thread-tag',{tid:ka,tag:la}).then(ea);},view:ha('create-subscription'),unview:ha('delete-subscription'),updateMessage:function(ka,la){return ga('update-message',{tid:ka,message:la.toJS()}).then(ea);},everstoreUpload:function(ka){var la=new FormData();ka.forEach(function(ma,na){return la.append(na,ma);});return ga('everstore-upload',la);},upload:function(ka){var la=new FormData();ka.forEach(function(ma,na){return la.append(na,ma);});return ga('upload',la).then(function(ma){return m.fromJS(ma);});},sendMessage:function(ka){var la=ga('send',ka).then(function(ma){return ea({'user-id':ka.tid,'last-events':ma});});s(la,function(ma){return o.sendMessageFinish(ka.tid);});window.setTimeout(function(){return o.sendMessageStart(ka.tid);},200);return la;},scheduleMessage:function(ka){return ga('schedule-send',ka).then(ea);},suggest:function(ka){return ga('suggest',ka).then(ea);},scheduleSuggest:function(ka){return ga('schedule-suggest',ka).then(ea);},deleteScheduled:function(ka,la){return ga('delete-scheduled',{tid:ka,id:la}).then(ea);},saveNote:function(ka,la){var ma={tid:ka,infos:{notes:la}};return ga('update-infos',ma).then(ea);},saveMeta:function(ka,la){var ma={tid:ka,infos:{'metadata-json':la.toJS()}};return ga('update-infos',ma).then(ea);},saveMuted:function(ka,la){var ma={tid:ka,infos:{muted:la}};return ga('update-infos',ma).then(ea);},createMerchant:function(ka){return ga('create-merchant',ka.toJS()).then(function(la){var ma=u([v(la)]);o.updateMerchants(ma);return ma;});},editMerchant:function(ka){return ga('edit-merchant',ka.toJS()).then(function(la){var ma=u([v(la)]);o.updateMerchants(ma);return ma;});},deleteMerchant:function(ka){return ga('delete-merchant',ka.toJS()).then(function(la){if(la&&la.id){var ma=u([la.id]);o.deleteMerchants(ma);return ma;}else h.warn('[api] unexpected delete-merchant response',la);});},sendEmail:function(ka){return ga('send-email',ka.toJS());},sendInvite:function(ka){return ga('send-calendar',ka.toJS());},everstoreURI:function(ka){return ga('everstore-uri',{handle:ka});},witIntents:function(){return w({type:'GET',url:y('wit-intents',h.getConfig('PAGE_ID'))}).then(function(ka){var la=m.fromJS(ka);o.updateWitIntents(la);return la;});},merchants:function(){return w({type:'GET',url:y('merchants')}).then(function(ka){o.updateMerchants(u(ka).map(function(la){return v(la);}));});},repsSync:function(){return w({type:'GET',url:y('reps-sync')});},requirements:function(){return w({type:'GET',url:y('requirements')}).then(function(ka){o.updateRequirements(m.fromJS(ka));});},AIModules:function(){return w({type:'GET',url:y('ai-modules')}).then(function(ka){return u(ka);});},authorFeedback:function(ka){return w({type:'GET',url:y('author-feedback'),params:{author_id:ka}}).then(function(la){return v(la.map(function(ma){ma=m.fromJS(ma);return [h.msgID(ma),ma];}));});},myThreads:function(){var ka=h.getConfig('PAGE_ID');return w({type:'GET',params:{page:ka},url:y('mythreads')}).then(function(la){var ma=la.mythreads;o.updateThreads(da(ma));});},allThreads:function(ka,la,ma,na){var oa={all:true,first_tags:ka.toJS(),last_tags:la.toJS(),offset:ma,limit:na};if(ka.has('ready')){ka=ka['delete']('ready');oa.ready=true;}else if(la.has('ready')){la=la['delete']('ready');oa.ready=false;}return fa(oa);},thread:function(ka){return w({type:'GET',url:y('threads',h.getConfig('PAGE_ID'),ka)}).then(ea);},handledEvents:function(ka){return w({type:'GET',params:{'intent-id':ka},url:y('handled-events')}).then(function(la){o.addHandledEvents(m.fromJS(la['handled-events']));});},history:function(ka,la,ma){return w({type:'GET',params:{timestamp:la,limit:ma},url:y('threads',h.getConfig('PAGE_ID'),ka,'history')}).then(function(na){var oa=ea({'user-id':ka,messages:na});return oa.get('messages');});},topIntents:function(){return w({type:'GET',url:y('top-intents')}).then(function(ka){return m.fromJS(ka);});},intentsDashboard:function(ka){return w({type:'GET',params:ka,url:y('dashboard','intent',h.getConfig('PAGE_ID'))}).then(function(la){return m.fromJS(la);});},aiDashboard:function(ka){return w({type:'GET',params:ka,url:y('dashboard','ai',h.getConfig('PAGE_ID'))}).then(function(la){return m.fromJS(la);});},statsDashboard:function(ka){return w({type:'GET',params:ka,url:y('dashboard','trainer',ka['trainer-id'])}).then(function(la){return m.fromJS(la);});},teamStatsDashboard:function(ka){return w({type:'GET',params:ka,url:y('dashboard','trainer-team-stats')}).then(function(la){return m.fromJS(la);});},humans:function(){return w({type:'GET',url:y('humans')}).then(function(ka){return o.replaceHumans(m.fromJS(ka));});},requestAutopilot:function(ka){window.postMessage(ka,'*');},notifyExtension:function(ka){h.debug('[oz-ext] notifying toto',ka);window.postMessage(babelHelpers['extends']({type:'notification'},{data:ka}),'*');},recordActivity:function(ka,la){return ga('activity',babelHelpers['extends']({tid:ka},{activity:la}));},sendPulse:function(ka,la){return w({type:'POST',url:y('pulse'),headers:{'content-type':'application/json'},params:{page:h.getConfig('PAGE_ID'),duration:ka},body:JSON.stringify(la)});},sendDisconnectPulse:function(ka,la){return x({url:y('pulse'),params:{page:h.getConfig('PAGE_ID'),duration:ka},body:JSON.stringify(la)});},threadFocus:function(ka,la){return ga('thread-focus',babelHelpers['extends']({tid:ka},{intentID:la}));},away:function(ka){return ga('away',{away:ka});},coachMode:function(ka){return ga('coach-mode',{'coach-mode':ka});},timestamp:function(){var ka=Date.now();return w({type:'POST',url:y('timestamp')}).then(function(la){var ma=la.timestamp,na=Date.now();if(na-ka>1000){h.warn('[oz-api] timestamp took over 1 second, not updating offset');}else{var oa=na-(ma+(na-ka)/2);o.updateServerOffset({offsetMs:oa});}});},init:function(){return w({type:'GET',url:y('init')}).then(function(ka){ka['twilio-token']&&o.twilio.setup(ka['twilio-token']);});},realTime:function(ka,la){var ma,na=60000,oa=function(){var ta=Date.now();clearInterval(ma);ma=setInterval(function(ua){var va=Math.round((Date.now()-ta)/1000);h.warn('[rti] no payload in '+va+'seconds');i.warn('We have not received anything from the server in '+va+'           seconds. You may want to refresh the page.');},na);},pa={repsVersion:-1},qa=function(ta,ua){var va=ua.payload,wa=ua.topic;!(ta==='sky'||ta==='msg')?n(0):undefined;oa();var xa,ya,za=ta==='sky'?ta+' '+wa+' ->':ta,ab=va.type,bb=ab||'';h.debug('[rti] '+za+' '+bb,va);if(!va.data){h.error('[sky] got sky event without data',va,wa);return;}ya=va.data['page-id'];if(ya&&ya!==h.getConfig('PAGE_ID')){h.debug('[sky] junk event on '+wa,va);return;}switch(ab){case 'thread':xa=va.data;ea(xa);break;case 'maybe-thread':xa=va.data;o.maybeUpdateThreads(da([xa]));break;case 'delivered':case 'seen':xa=va.data;ea({'user-id':xa['user-id'],'last-seen':xa['last-seen']});break;case 'presence':xa=va.data;ea({'user-id':xa['user-id'],'last-presence':xa['last-presence']});break;case 'carebear':(function(){var cb=va.data,db=cb.type,eb=cb.tid,fb={'user-id':eb};fb['ui-'+db]=true;ea(fb);})();break;case 'inactive':o.isInactive();break;case 'updated-merchant':o.updateMerchants(u([v(va.data)]));break;case 'deleted-merchant':o.deleteMerchants(u([va.data.id]));break;case 'phone-call':o.twilio.updateIncomingInfo(m.fromJS(va.data));break;case 'humans':o.replaceHumans(m.fromJS(va.data));break;case 'reps-sync':pa=babelHelpers['extends']({},pa,{repsVersion:va.version});o.replaceReps(m.fromJS(va.data));break;case 'reps-diff':if(pa.repsVersion!==va.version-1){h.warn('[api] reps version out of sync',{'our-version':pa.repsVersion,'next-version':va.version});pa=babelHelpers['extends']({},pa,{repsVersion:-1});ia.repsSync();}else{pa.repsVersion=va.version;o.updateReps(m.fromJS(va.data));}break;case 'handled-events':o.addHandledEvents(m.fromJS(va.data));default:h.debug('[sky] unk type',ab,va);}},ra=j.subscribe(k.getArbiterType('msg'),function(ta,ua){qa('msg',ua.obj);}),sa=ja(function(){j.unsubscribe(ra);t.unsubscribeAll();});t.subscribe(ka,qa.bind(this,'sky'),null,ja(function(ta){var ua=ta.data,va=ta.error;if(va){sa();la(va,ua);}else{oa();la(null,ua,ra);}}));return sa;}};function ja(ka){var la,ma,na=this;return function(){if(!la){ma=ka.apply(na,arguments);la=true;}return ma;};}f.exports=ia;},null);
__d('OzHelpers',['BanzaiScuba','DatePickerRestraints','ErrorUtils','getURLRanges','immutable','LogHistory','OzConstants','ReactComponentWithPureRenderMixin','React','URI','OzServerTime'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=l.List,t=l.Map,u=l.Set,v=l.OrderedMap,w=n.AUTHOR_TYPES,x=n.REMINDERS,y=/^image\//,z={blobURI:function(la){return window.URL.createObjectURL(la);},blobFromDataURI:function(la){var ma=la.split(','),na=atob(ma[1]),oa=ma[0].split(':')[1].split(';')[0],pa=new ArrayBuffer(na.length),qa=new Uint8Array(pa);for(var ra=0;ra<na.length;ra++)qa[ra]=na.charCodeAt(ra);return new Blob([pa],{type:oa});},toLocaleDate:function(la){return new Date(la).toLocaleDateString();},toLocaleTime:function(la){return new Date(la).toLocaleTimeString();},hasCmdOrCtrl:function(la){return la.getModifierState('Meta')||la.getModifierState('Control');},keysIn:function(){var la=u(arguments);return function(ma,na){return la.has(na);};},safeParse:function(la){var ma={};try{ma=JSON.parse(la);}catch(na){z.info('invalid json',la);}return ma;},safeURI:function(la){var ma=null;try{ma=q.isValidURI(la)&&new q(la)||null;}catch(na){z.info('invalid uri',la);}return ma;},pure:ba,memoize:ca,values:function(la){return Object.keys(la).map(function(ma){return la[ma];});},debug:ha('debug',false),info:ha('info',true),warn:ha('warn',true),error:ha('error',true),isImageType:function(la){return y.test(la);},getConfig:fa,setConfig:ga,dateRestraints:da,threadID:function(la){return la.get('user-id');},isNew:function(la){return !z.intents(la).find(z.isClosedIntent);},hasOwner:function(la){return la.getIn(['owner','id']);},hasAllTags:function(la,ma){return ma.every(function(na){return z.hasTag(la,na);});},hasSomeTag:function(la,ma){return ma.some(function(na){return z.hasTag(la,na);});},hasTag:function(la,ma){return la.get('tags')&&la.get('tags').contains(ma);},isEscalated:function(la){return z.hasTag(la,'escalated');},hasEngage:function(la){return !!la.get('engagement-type');},photo:function(la){return la.getIn(['user-vcard','photo'])||la.getIn(['user-vcard','picture']);},compareNums:function(la,ma){if(la&&ma){return ma-la;}else if(la){return -1;}else if(ma){return 1;}else return 0;},compareBools:function(la,ma){if(la&&ma){return 0;}else if(la){return -1;}else if(ma)return 1;},getIncomingThreads:function(la){return la.filter(function(ma){return ma.get('ready')&&!z.hasOwner(ma);}).sort(z.threadComparator);},threadComparator:function(la,ma){var na=z.compareBools(z.hasTag(la,'vip'),z.hasTag(ma,'vip')),oa=z.compareBools(z.hasTag(la,'urgent'),z.hasTag(ma,'urgent')),pa=z.compareNums(z.urgentReminders(la).getIn([0,'scheduled-time']),z.urgentReminders(ma).getIn([0,'scheduled-time'])),qa=z.compareNums(la.get('last-event-at'),ma.get('last-event-at'));return (na||oa||pa||qa);},lastEvents:function(la){return la.get('last-events',s()).sortBy(function(ma){return ma.get('timestamp');});},lastUserMessage:function(la){var ma=z.lastEvents(la).reverse();return ma.find(function(na){return z.authorType(na)===w.USER;})||ma.first();},shortDesc:function(la){var ma=la.getIn(['attachments',0,'mime_type']),na=la.getIn(['attachments',0,'sticker_id']);return la.get('text')||na&&'sent a sticker.'||ma&&(ma.match(/video/i)&&'sent a video.'||ma.match(/audio/i)&&'sent an audio clip.'||ma.match(/image/i)&&'sent an image');},preferredName:function(la){return (la.getIn(['metadata-json','preferred-name'])||la.getIn(['user-vcard','first-name']));},userEmail:function(la){return (la.getIn(['metadata-json','email']));},intents:function(la){return la.get('intents',s()).sortBy(function(ma){return ma.get('created-at');});},isOwner:function(la,ma){var na=la.getIn(['owner','id']);return na&&ma&&na==ma;},wasOwner:function(la,ma){var na=la.getIn(['last-owner','id']);return na&&ma&&na==ma;},isLocker:function(la,ma){return la.get('locked')&&la.get('locker-id')===ma;},nameOrId:function(la){return la&&(la.get('name')||la.get('id'))||'';},isSubscriber:function(la,ma){return !!la.get('subscriptions',s()).find(function(na){return na===ma;});},hasUnblockedIntents:function(la){return la.get('intents',s()).some(function(ma){return !z.isBlockedIntent(ma);});},hasOpenIntents:function(la){return la.get('intents',s()).some(function(ma){return z.isOpenIntent(ma);});},openIntents:function(la){return z.intents(la).filter(z.isOpenIntent);},isBlockedIntent:function(la){return la.get('blocked');},isOpenIntent:function(la){return la.get('state')==='open';},isClosedIntent:function(la){return la.get('state')==='closed';},getName:function(la){return la.getIn(['user-vcard','name'],'Unknown user');},lastPresence:function(la){return Math.max(la.get('last-seen')||0,la.get('last-presence')||0);},timeSpent:function(la){if(la.get('ready')&&la.get('last-ready-at'))return z.serverNow()-la.get('last-ready-at');},locationLastSeen:function(la){if(la.getIn(['location','last-seen']))return new Date(la.getIn(['location','last-seen']));},serverNow:function(){return r.serverNow();},repName:function(la,ma){var na=ma.get(la);return na&&na.get('name')||la||null;},authorType:function(la){var ma=w.BOT,na=w.USER,oa=w.TRAINER,pa=la.get('sender')||la.get('from'),qa=la.get('author-type');return (qa===ma&&ma||(qa===oa||pa===fa('PAGE_ID'))&&oa||na);},msgID:function(la){return la.get('offline-threading-id')||la.get('mid')||z.warn('[msgID] had to resort to timestamp',la)&&null||la.get('timestamp');},isActivePulse:function(la){var ma=la&&la.get('pulse-data');if(!ma)return false;return !ma.get('away?')&&ma.get('inactive-ms',Infinity)<30000;},urgentReminders:function(la){return la.get('reminders',s()).sortBy(function(ma){return ma.get('scheduled-time');}).filter(z.isUrgentReminder);},paidReminders:function(la){return z.urgentReminders(la).filter(z.isPaidReminder);},isUrgentReminder:function(la){var ma=la.get('state');return ma==='active'||ma==='active-snoozed';},isPaidReminder:function(la){return !!la.getIn(['body','suggestion']);},isSnoozedReminder:function(la){var ma=la.get('state');return ma==='snoozed'||ma==='active-snoozed';},isUnread:function(la){return la.get('read-state')==='unread';},hasPaid:function(la){return !!z.paidReminders(la).size;},hasReminder:function(la){return !!z.urgentReminders(la).size;},minAge:function(la){var ma=+la.getIn(['user-vcard','age-range','min']);return Number.isSafeInteger(ma)?ma:0;},shimURI:function(la){return new q('https://l.facebook.com/l.php').setQueryData({u:la,h:fa('shimhash')}).toString();},uiSuggestion:function(la){var ma=la.has('amount')?'$'+(la.get('amount')/100).toFixed(2):'';return {id:la.get('item-id')||'-1',name:la.get('name'),desc:la.get('description'),thumb_url:la.get('thumb-url'),merchant_name:la.get('merchant-name')||'',total_cost:la.get('amount')?t({amount:la.get('amount')}):null,display_total_cost:ma,target_url:z.shimURI(la.get('target-url')),payment_id:la.get('payment-id')};},parsePhoneNumber:function(la){if(!la)return '';if(la.length==12&&la[0]=='+')la=la.substr(1);if(la.length==11&&la[0]=='1')la=la.substr(1);switch(la.length){case 10:return '('+la.substr(0,3)+') '+la.substr(3,3)+'-'+la.substr(6,4);case 7:return la.substr(0,3)+'-'+la.substr(3,4);default:return la;}},validateURL:function(la){return (!!la&&typeof la==='string'&&k(la).length&&q.isValidURI(la));},normalizeMerchant:function(la){return la.updateIn(['website'],function(ma){if(!ma)return ma;var na=k(ma);if(!na||na.length===0)return ma;return na[0].entity.url;}).updateIn(['page-id'],function(ma){if(Number.isFinite(ma)||typeof ma==='string')return parseInt(ma,10);return null;});},validateMerchant:function(la){var ma=u(['name-dba','country']),na=u(['address','website','page-id']),oa={},pa=la.get('website','');if(pa&&!this.validateURL(pa))oa.website='Website is an invalid URL';var qa=la.get('page-id',null);if(qa!=null&&!Number.isFinite(qa))oa['page-id']='FB Page must be a number';ma.map(function(sa){if(!la.get(sa))oa[sa]='This field is required';});if(u(la.filter(function(sa){return sa;}).keys()).intersect(na).isEmpty()){var ra='At least one of '+na.join(', ')+' is required';na.forEach(function(sa){oa[sa]=ra;});}return t(oa);},isDaytime:function(la){var ma=la/3600000,na=(new Date().getUTCHours()+ma+24)%24;return na>5;},fullThreadData:function(la,ma,na){var oa=la.get(na);if(!oa)return null;return oa.update('intents',function(pa){return pa.map(function(qa){return aa(ma,qa);});});}};function aa(la,ma){var na=la.getIn(['byIntent',ma.get('id')],t());return ma.set('events',na);}function ba(la){var ma=arguments.length<=1||arguments[1]===undefined?'OzPureComponent':arguments[1];return (p.createClass({displayName:ma,mixins:[o],render:function(){return la(this.props);}}));}function ca(la,ma){var na=arguments.length<=2||arguments[2]===undefined?1000:arguments[2],oa=v();return function(){for(var pa=arguments.length,qa=Array(pa),ra=0;ra<pa;ra++)qa[ra]=arguments[ra];var sa=ma.apply(this,qa);if(oa.get(sa)){return oa.get(sa);}else{var ta=la.apply(this,qa);oa=oa.set(sa,ta).takeLast(na);return ta;}}.bind(this);}function da(){var la=new Date(),ma=new Date(Date.UTC(la.getFullYear(),la.getMonth(),la.getDate())),na=new Date(+ma);na.setFullYear(ma.getFullYear()+x.RANGE_IN_YEARS);return {dateRestraints:[i.enforceDateIsNoEarlierThan(ma),i.enforceDateIsNoLaterThan(na)]};}var ea={};function fa(la){return ea[la];}function ga(la){ea=la;}j.addListener(function(la){var ma=ka({level:'error',message:'[unhandled-error]['+la.name+'] '+la.message,data:'--stack\n'+la.stack+'\n\n--originalError\n'+la._originalError});ja(ma);ia(ma);});function ha(la,ma){return function(){for(var na=arguments.length,oa=Array(na),pa=0;pa<na;pa++)oa[pa]=arguments[pa];var qa=oa[0],ra=oa.slice(1);window.console.log(la,qa,ra);var sa=ka({level:la,message:qa,data:ra});ja(sa);ma&&ia(sa);};}function ia(la){var ma=new h(fa('scubaCategory'));Object.entries(la).forEach(function(na){var oa=na[0],pa=na[1];Number.isSafeInteger(pa)?ma.addInteger(oa,pa):ma.addNormal(oa,pa);});ma.post();}function ja(la){var ma=m.getInstance('oz-logger');(ma[la.level]||ma.debug).call(ma,la.message,'');}function ka(la){return babelHelpers['extends']({},la,{uid:fa('uid'),public_name:fa('publicName'),rev:fa('rev'),timestamp:z.serverNow()});}f.exports=z;},null);
__d('OzStores',['OzHelpers','immutable','invariant','OzActions','Reflux'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=i.List,n=i.Map,o=i.OrderedMap,p=i.OrderedSet,q=i.Set,r=l.createStore({init:function(){this.data=n();this.listenTo(k.updateRequirements,this._onUpdateRequirements);},getInitialState:function(){return this.data;},_onUpdateRequirements:function(ka){this.data=this.data.withMutations(function(la){ka.forEach(function(ma){var na=ma.get('name'),oa=la.get(na,n()).merge(ma).update('wit-intent-uuids',function(pa){return pa&&pa.toSet()||q();});la.set(na,oa);});});h.debug('[oz] updated RequirementStore');this.trigger(this.data);}}),s=l.createStore({init:function(){this.data=p();this.listenTo(k.addBubble,this._onAddBubble);},getInitialState:function(){return this.data;},_onAddBubble:function(ka){!n.isMap(ka)?j(0):undefined;this.data=this.data.add(ka).takeLast(100);this.trigger(this.data);}}),t=l.createStore({init:function(){this.data=o();this.listenTo(k.addAutopilot,this._onAddAutopilot);},getInitialState:function(){return this.data;},_onAddAutopilot:function(ka){!n.isMap(ka)?j(0):undefined;this.data=this.data.set(ka.get('id'),ka.get('data')).takeLast(100);this.trigger(this.data);}}),u='id',v=l.createStore({init:function(){this.data=n();this.listenTo(k.updateWitIntents,this._onUpdateWitIntents);},getInitialState:function(){return this.data;},_onUpdateWitIntents:function(ka){!i.List.isList(ka)?j(0):undefined;this.data=this.data.withMutations(function(la){return ka.reduce(function(ma,na){return ma.set(na.get(u),na);},la);});this.trigger(this.data);}}),w=l.createStore({init:function(){this.data=n();this.listenTo(k.activateThread,this._onActivateThread);this.listenTo(k.activateIntent,this._onActivateIntent);},getInitialState:function(){return this.data;},_onActivateThread:function(ka){h.info('[store/activeThread] set active thread: ',ka);this.data=this.data.set('oldThreadID',this.data.get('threadID')).set('threadID',ka).set('activeIntent',null);this.trigger(this.data);},_onActivateIntent:function(ka){this.data=this.data.set('activeIntent',ka);this.trigger(this.data);}}),x='user-id',y=function(ka,la){!(n.isMap(ka)&&n.isMap(la))?j(0):undefined;var ma=ka.reduce(function(na,oa,pa){na[oa.get('offline-threading-id')]=oa;return na;},{});return ka.withMutations(function(na){return la.valueSeq().filterNot(function(oa){var pa=oa.get('attachments');if(pa)return pa.first()&&pa.first().getIn(['xma','body'])===null;return false;}).reduce(function(oa,pa){var qa=pa.get('offline-threading-id'),ra=qa&&ma[qa]||oa.get(h.msgID(pa));if(ra){oa=oa['delete'](h.msgID(ra));pa=ra.merge(pa);}return oa.set(h.msgID(pa),pa);},na);});},z=function(ka,la,ma){if(ma==='messages'){return y(ka,la);}else return la;},aa=function(ka){!(typeof ka==='function')?j(0):undefined;return function(la,ma){!(n.isMap(ma)&&n.isMap(la))?j(0):undefined;var na=ma.get(x),oa=la.get(na,n()),pa=oa.mergeWith(ka,ma);return la.set(na,pa);};},ba=l.createStore({init:function(){this.data=n();this.updatedAt=Date.now();this.listenTo(k.updateThreads,this._onUpdateThreads);this.listenTo(k.maybeUpdateThreads,this._onMaybeUpdateThreads);this.listenTo(k.clearReassignState,this._onClearReassignState);},getInitialState:function(){return this.data;},_onUpdateThreads:function(ka){!m.isList(ka)?j(0):undefined;this.data=this.data.withMutations(function(la){return ka.reduce(aa(z),la);});this.updatedAt=Date.now();this.trigger(this.data);},_onMaybeUpdateThreads:function(ka){!m.isList(ka)?j(0):undefined;var la=ka.filter(function(ma){return this.data.has(ma.get(x));}.bind(this));if(la.isEmpty()){h.debug('[threads] not updating partial threads');return;}this.data=this.data.withMutations(function(ma){return la.reduce(aa(z),ma);});this.updatedAt=Date.now();this.trigger(this.data);},_onClearReassignState:function(){this.data=this.data.map(function(ka){return (ka.get('ui-reassign')?ka['delete']('ui-reassign'):ka);});this.trigger(this.data);}}),ca=l.createStore({init:function(){this.data=this._make(null,null);this.listenTo(k.showDialog,this._onShowDialog);this.listenTo(k.hideDialog,this._onHideDialog);},getInitialState:function(){return this.data;},_make:function(ka,la){return {dialogClass:ka,dialogProps:la};},_onShowDialog:function(ka,la){this.data=this._make(ka,la);this.trigger(this.data);},_onHideDialog:function(){this.data=this._make(null,null);this.trigger(this.data);}}),da=l.createStore({init:function(){this.data=n();this.listenTo(k.updateMerchants,this._onUpdateMerchants);this.listenTo(k.deleteMerchants,this._onDeleteMerchants);},getInitialState:function(){return this.data;},_onUpdateMerchants:function(ka){!m.isList(ka)?j(0):undefined;this.data=this.data.withMutations(function(la){return ka.reduce(function(ma,na){var oa=na.get('id'),pa=ma.get(oa,n()).merge(na);return ma.set(oa,pa);},la);});h.debug('[oz] updated merchants',this.data.toJS());this.trigger(this.data);},_onDeleteMerchants:function(ka){!m.isList(ka)?j(0):undefined;this.data=ka.reduce(function(la,ma){return la['delete'](ma);},this.data);h.debug('[oz] deleted merchants',this.data.toJS());this.trigger(this.data);}}),ea=l.createStore({init:function(){this.data=n();this.listenTo(k.updateReps,this._onUpdateReps);this.listenTo(k.replaceReps,this._onReplaceReps);},getInitialState:function(){return this.data;},_onReplaceReps:function(ka){this.data=n().withMutations(function(la){ka.reduce(function(ma,na){return ma.set(na.get('fbid'),na);},la);});this.trigger(this.data);},_onUpdateReps:function(ka){this.data=this.data.withMutations(function(la){return ka.reduce(function(ma,na){return ma.mergeIn([na.get('fbid')],na);},la);});this.trigger(this.data);}}),fa=l.createStore({init:function(){this.data=n();this.listenTo(k.replaceHumans,this._onReplace);},getInitialState:function(){return this.data;},_onReplace:function(ka){this.data=ka;this.trigger(this.data);}}),ga=l.createStore({init:function(){this.data=n({queue:n({showTags:q(),hideTags:q()}),all:n({showTags:q(),hideTags:q()})});this.listenTo(k.updateQueueFilters,this._onUpdateFilters);},getInitialState:function(){return this.data;},_onUpdateFilters:function(ka){this.data=this.data.merge(ka);this.trigger(this.data);}}),ha=l.createStore({init:function(){this._data=n();this.listenTo(k.sendMessageStart,this._onShiftSending.bind(this,1));this.listenTo(k.sendMessageFinish,this._onShiftSending.bind(this,-1));},getInitialState:function(){return this._data;},_onShiftSending:function(ka,la){this._data=this._data.update(la,function(ma){return (ma||0)+ka;});this.trigger(this._data);}}),ia=l.createStore({init:function(){this.data=n({byIntent:n(),byThread:n(),byId:n()});this.listenTo(k.addHandledEvents,this._onAddHandledEvents);},getInitialState:function(){return this.data;},_onAddHandledEvents:function(ka){this.data=this.data.withMutations(function(la){ka.reduce(function(ma,na){return (ma.setIn(['byIntent',na.get('intent-id'),na.get('id')],na).setIn(['byId',na.get('id')],na));},la);});this.trigger(this.data);}}),ja=l.createStore({init:function(){this.data=n({offsetMs:0});this.listenTo(k.updateServerOffset,this._onUpdateServerOffset);},getInitialState:function(){return this.offsetMs;},_onUpdateServerOffset:function(ka){var la=ka.offsetMs;this.data=this.data.set('offsetMs',la);this.trigger(this.data);}});f.exports={ActiveThreadStore:w,BubbleStore:s,DialogStore:ca,MerchantStore:da,AutopilotStore:t,QueueFilterStore:ga,RepStore:ea,HumanStore:fa,RequirementStore:r,ThreadStore:ba,WitIntentStore:v,PendingMessageStateStore:ha,HandledEventsStore:ia,ServerOffsetStore:ja};},null);
__d('OzAJAX',['Promise','OzHelpers','OzNotify','URI','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m={ajax:function(q){var r=q.type,s=q.headers,t=q.params,u=q.body,v=q.url;t=o(t);var w={type:r,url:v,headers:s,params:t,body:u};return n(w).then(function(x){return JSON.parse(x.responseText);},function(x){var y;try{y=JSON.parse(x.responseText);}catch(z){}p(y||{},x,w);throw y||x;});},beacon:function(q){!(window.navigator&&window.navigator.sendBeacon)?l(0):undefined;var r=q.params,s=q.body,t=q.url;r=o(r);return window.navigator.sendBeacon(new k(t).addQueryData(r).toString(),new Blob([s],{type:'application/json'}));},buildURI:function(){var q=i.getConfig('API_PATH');!q?l(0):undefined;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return [q].concat(s).join('/');}};function n(q){var r=q.type,s=q.headers,t=q.params,u=q.body,v=q.url;return new h(function(w,x){var y=new XMLHttpRequest(),z=new k(v);if(t)z.addQueryData(t);y.open(r,z.toString(),true);if(s)for(var aa=Object.keys(s),ba=Array.isArray(aa),ca=0,aa=ba?aa:aa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var da;if(ba){if(ca>=aa.length)break;da=aa[ca++];}else{ca=aa.next();if(ca.done)break;da=ca.value;}var ea=da;y.setRequestHeader(ea,s[ea]);}y.onreadystatechange=function(){if(y.readyState!==4)return;if(y.status===200){w(y);}else x(y);};y.send(u);});}function o(q){!i.getConfig('authToken')?l(0):undefined;!i.getConfig('uid')?l(0):undefined;!i.getConfig('API_VERSION')?l(0):undefined;return babelHelpers['extends']({xs:i.getConfig('authToken'),c_user:i.getConfig('uid'),rep_name:i.getConfig('fullName'),v:i.getConfig('API_VERSION')},q);}function p(q,r,s){i.error('[oz-api] backend rejected',q,r,s);var t=q.error||'Something went wrong, the team has been notified already.';if(q.info){j.info(t);}else if(r.status===400){j.warn(t);}else if(r.status===0){j.error('Something went wrong. If this continues, please contact the Wit oncall');}else j.error(t);}f.exports=m;},null);
__d('OzEditorStateHelpers',['ContentState','OzHelpers','DraftModifier','EditorState','UnicodeUtils'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();function m(x,y){var z=h.createFromText(y),aa=k.push(x,z,'remove-range');aa=k.forceSelection(aa,aa.getSelection());return aa;}function n(x){var y=x.getCurrentContent().getBlockMap(),z=x.getSelection().getStartKey();return y.get(z);}function o(x,y){return x.getCurrentContent().getPlainText().indexOf(y)>=0;}function p(x){var y=v(x,function(z){var aa=z.getSelection();if(aa.getStartOffset()===0)return w(z,1);var ba=n(z).getText().length;return aa.merge({anchorOffset:ba,focusOffset:0,isBackward:true});},'backward');if(y===x.getCurrentContent())return x;return k.push(x,y,'remove-range');}function q(x,y){var z=x.getCurrentContent(),aa=n(x).getText(),ba=x.getSelection().merge({anchorOffset:0,focusOffset:aa.length}),ca=j.replaceText(z,ba,y);i.debug('[replaceLine]',y,aa,ca.getPlainText());if(ca===z)return x;return k.push(x,ca,'remove-range');}function r(x,y){var z=x.getCurrentContent(),aa=j.insertText(z,z.getSelectionAfter(),y);if(aa===z)return x;return k.push(x,aa,'insert-characters');}function s(x,y){var z=n(x).getText(),aa=z.length;if(aa===0)return false;y=Math.min(y,aa-1);return z[y];}function t(x,y){var z=x.getSelection().merge({focusOffset:y,anchorOffset:y});return k.forceSelection(x,z);}function u(x,y){var z=v(x,function(ba){var ca=ba.getSelection(),da=ba.getCurrentContent(),ea=ca.getAnchorKey(),fa=ca.getAnchorOffset(),ga=da.getBlockForKey(ea).getText().slice(fa-y,fa);return w(ba,ga?l.strlen(ga):1);},'backward');if(z===x.getCurrentContent())return x;z=z.set('selectionBefore',x.getSelection());var aa=x.getSelection().isCollapsed()?'backspace-character':'remove-range';return k.push(x,z,aa);}function v(x,y,z){var aa=x.getSelection(),ba=x.getCurrentContent(),ca=aa;if(aa.isCollapsed()){if(z==='forward'){if(x.isSelectionAtEndOfContent())return ba;}else if(x.isSelectionAtStartOfContent())return ba;ca=y(x);if(ca===aa)return ba;}return j.removeRange(ba,ca,z);}function w(x,y){var z=x.getSelection(),aa=x.getCurrentContent(),ba=z.getStartKey(),ca=z.getStartOffset(),da=ba,ea=0;if(y>ca){var fa=aa.getKeyBefore(ba);if(fa==null){da=ba;}else{da=fa;var ga=aa.getBlockForKey(fa);ea=ga.getText().length;}}else ea=ca-y;return z.merge({focusKey:da,focusOffset:ea,isBackward:true});}f.exports={append:r,backspaceTimes:u,charAt:s,currentBlock:n,deleteCurrentLine:p,editorStateHas:o,forceCollapsedSelection:t,replaceContentWithText:m,replaceLine:q};},null);
__d('OzHistory',['invariant','immutable'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=i.List,k=i.OrderedMap,l='oz-history',m=10,n=100;function o(){return k(JSON.parse(localStorage.getItem(l)||'{}')).map(function(t){return j(t);});}function p(t){!k.isOrderedMap(t)?h(0):undefined;return localStorage.setItem(l,JSON.stringify(t));}function q(t){var u=o();if(u.has(t))return;p(u.set(t,[]).takeLast(m));}function r(t){var u={},v={items:function(){if(!u.items)u.items=o().get(t);return u.items;},persist:function(w){!j.isList(w)?h(0):undefined;p(o().set(t,w));u.items=w;v.resetPos();},resetPos:function(){u.pos=v.items().size;},pos:function(){if(!Number.isSafeInteger(u.pos))v.resetPos();return u.pos;},dec:function(){u.pos=Math.max(v.pos()-1,0);},inc:function(){u.pos=Math.min(v.pos()+1,v.items().size);},val:function(){return v.items().get(v.pos());}};return v;}function s(t){q(t);var u=r(t);return {up:function(){u.dec();return u.val();},down:function(){u.inc();return u.val();},push:function(v){var w=u.items();if(!v||w.last()===v)return;u.persist(w.push(v).takeLast(n));}};}f.exports=s;},null);
__d('OzHumans',['OzHelpers'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=60000,j=45000,k=-1;function l(t){return t.get('coach-mode?');}function m(t){return t.get('is-coach');}function n(t){return t.get('away?');}function o(t){return t&&!n(t)&&h.serverNow()-t.get('at',0)<j;}function p(t){return o(t)&&t.get('inactive-ms',0)<i;}function q(t){return p(t)&&t.get('load',0)<=0&&t.get('team',k)!==k;}function r(t){return p(t)&&!l(t);}function s(t){var u=t.filter(r).count(),v=t.reduce(function(w,x){return w+x.get('load',0);},0);return v/u;}f.exports={inCoachMode:l,isCoach:m,isAway:n,isPresent:o,isActive:p,isIdle:q,isWorking:r,avgLoad:s};},null);
__d('OzInboxThreads',['OzHelpers'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i='GRABBED',j='VIEWING',k='PAST';function l(n){var o=function(p){return p.get('locked-at')&&p.get('locker-id')===n;};return function(p,q){if(o(p)&&!o(q)){return -1;}else if(!o(p)&&o(q)){return 1;}else return h.compareNums(p.get('last-event-at'),q.get('last-event-at'));};}var m=h.memoize(function(n,o){var p=arguments.length<=2||arguments[2]===undefined?'':arguments[2],q=l(o);return n.filter(function(r){var s=h.isOwner(r,o),t=h.isLocker(r,o),u=h.isSubscriber(r,o),v=h.wasOwner(r,o),w=h.hasOpenIntents(r);switch(p){case i:return ((s||r.get('ui-reassign')&&v)&&(r.get('ready')||w||t));case j:return u;case k:return (v||s&&!r.get('ready')&&!w);default:return s||u;}}).sort(q);},function(n,o){var p=arguments.length<=2||arguments[2]===undefined?'':arguments[2];return n.hashCode()+o+p;},3);f.exports={getInboxThreads:m,OZ_GRABBED_TAB:i,OZ_VIEWING_TAB:j,OZ_PAST_TAB:k};},null);
__d('OzBugNub.react',['Link.react','ReactComponentWithPureRenderMixin','React','Tooltip','URI','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=1031744366845008,p='Error:\n\nExpected Result:\n\nSteps taken before error occurred:\n',q=j.createClass({displayName:'MessengerBugNub',mixins:[i],render:function(){var r=new l('/ajax/bugs/report').setQueryData({config_id:o,defaultText:p});return (j.createElement('div',{className:"_gml"},j.createElement(h,babelHelpers['extends']({href:'#',ajaxify:r,className:"_gmm",rel:'dialog'},k.propsFor(n._("Report a bug"))),j.createElement('span',{className:"_gmn"}))));}});f.exports=q;},null);
__d('OzDialogContainer.react',['OzStores','React','ReactLayeredComponentMixin','Reflux'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=h.DialogStore,m=i.createClass({displayName:'OzDialogContainer',mixins:[k.connect(l,'dialog'),j],renderLayers:function(){var n=this.state.dialog.dialogClass;if(n){var o=this.state.dialog.dialogProps||{};return {dialog:i.createElement(n,babelHelpers['extends']({ref:'dialog'},o))};}return {};},render:function(){return null;}});f.exports=m;},null);
__d('OzExtensionCheck.react',['MessengerDialogHeader.react','MessengerDialogTitle.react','Notice.atlas','OzActions','React','ReloadPage','XUIDialog.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=l.PropTypes,q=l.createClass({displayName:'InstallDialog',propTypes:{onInstall:p.func.isRequired},render:function(){return (l.createElement(n,{width:544,shown:true,layerHideOnBlur:false,className:"_4ebx"},l.createElement('div',{className:"_4eby _2c9g _1-6z"},l.createElement(h,null,l.createElement(i,null,'The Oz Chrome Extension is missing')),l.createElement(j,{type:'error'},l.createElement('div',{className:"_4d80"},'Toto, the oz chrome extension that helps you manage your tabs, and record what was done for each task in the background is missing!',l.createElement('strong',null,l.createElement('a',{onClick:this.props.onInstall},' Click here to install it.')))))));}}),r=l.createClass({displayName:'OzExtensionCheck',componentDidMount:function(){var s=!!document.querySelector('#toto-installed');if(s)return;k.showDialog(q,{onInstall:this._handleInstall});},render:function(){return null;},_handleInstall:function(){window.chrome.webstore.install(undefined,function(s){return m.now();});}});f.exports=r;},null);
__d('OzLoading.react',['MessengerFlexArea.react','MessengerSpinner.react','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'OzLoading',propTypes:{message:l.node,color:l.oneOf(["grey","blue"])},getDefaultProps:function(){return {color:"blue"};},render:function(){return (j.createElement('div',{className:"_30r7"},j.createElement(i,{color:this.props.color}),j.createElement('div',{className:"_30r8"},this.props.message)));}});m.Inline=j.createClass({displayName:'Inline',propTypes:{loading:l.bool.isRequired},render:function(){var n=this.props,o=n.loading,p=babelHelpers.objectWithoutProperties(n,['loading']);if(!o)return null;return (j.createElement('div',{className:"_nkb"},j.createElement(m,p)));}});m.Flex=j.createClass({displayName:'Flex',render:function(){return (j.createElement(h,null,j.createElement(m,this.props)));}});f.exports=m;},null);
__d('OzButton.react',['OzLoading.react','React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=i.createClass({displayName:'OzButton',getInitialState:function(){return {loading:false};},render:function(){var m=this.props,n=m.children,o=m.className,p=m.disabled,q=m.onClick,r=m.use,s=babelHelpers.objectWithoutProperties(m,['children','className','disabled','onClick','use']),t=this.state.loading;return (i.createElement('a',babelHelpers['extends']({},s,{onClick:this._handleClick,className:k(o,"_3e2t"+(t?' '+"_3e2u":'')+(r==='confirm'?' '+"_3e2v":'')+(p?' '+"_ysb":'')+(!p?' '+"_30yy":''))}),t?i.createElement(h,{color:'blue',message:'Sending...'}):n));},_handleClick:function(m){var n=this.props.onClick;if(!n)return;if(n.length>1)this.setState({loading:true});n(m,this._done);},_done:function(){if(this.isMounted())this.setState({loading:false});}});f.exports=l;},null);
__d('OzReps',['OzHelpers'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=1000*60*60*8;function j(m){return !m||h.serverNow()-m.get('updated-at',0)>i;}function k(m){var n=m.get('stats');return j(n)?0:n.get('closed-intents',0);}function l(m,n){var o=m.get('team');return n.reduce(function(p,q){return p+(q.get('team')===o?k(q):0);},0);}f.exports={closedIntentCount:k,teamClosedIntentCount:l};},null);
__d('OzTriSwitch.react',['React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(m){var n=m.className,o=m.value,p=m.onClick,q=m.label,r=m.animated,s=babelHelpers.objectWithoutProperties(m,['className','value','onClick','label','animated']);return (h.createElement('div',babelHelpers['extends']({},s,{className:j(n,"_56de"+(s.reverseColors?' '+"_3tyl":'')+(r?' '+"_56df":'')+(o==='on'?' '+"_56dg":'')+(o==='off'?' '+"_56dh":'')+(o==='neutral'?' '+"_56di":'')),onClick:function(t){return p(l[o]);},role:'checkbox'}),h.createElement('div',{className:"_56dj",tabIndex:'0'},h.createElement('div',{className:"_56dk"})),q?h.createElement('span',{className:"_56dn"},q):null));}var l={on:'off',off:'neutral',neutral:'on'};k.toBoolean=function(m){if(m==='neutral')return undefined;if(m==='on')return true;if(m==='off')return false;throw new Error('OzTriSwitch: unknown state '+m);};k.fromBoolean=function(m){return m==null?'neutral':m?'on':'off';};f.exports=k;},null);
__d('OzSwitch.react',['ReactComponentWithPureRenderMixin','OzTriSwitch.react','React'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j.PropTypes,l=j.createClass({displayName:'OzSwitch',mixins:[h],propTypes:{isAnimated:k.bool.isRequired,isOn:k.bool.isRequired,label:k.node.isRequired,onToggle:k.func.isRequired,reverseColors:k.bool},getDefaultProps:function(){return {isAnimated:false};},render:function(){var m=this.props,n=m.className,o=m.isAnimated,p=m.isOn,q=m.label,r=m.onToggle;return (j.createElement(i,{animated:o,className:n,reverseColors:!!this.props.reverseColors,label:q,onClick:function(){return r(!p);},value:i.fromBoolean(p)}));}});f.exports=l;},null);
__d('OzTwilio',['cx','OzHelpers','immutable','Keys','MessengerButton.react','OzNotify','OzActions','OzConfig','OzDraggable.react','ReactComponentWithPureRenderMixin','React','Reflux','ReactRouter_DEPRECATED','StarsInput.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v,w,x,y;if(c.__markCompiled)c.__markCompiled();var z=j.Record,aa=j.Set,ba=n.twilio;function ca(){var ya=window.Twilio.Device,za=function(ab,bb){return function(){i.info('[twilio] '+ab,fa.data.toJS());bb.apply(undefined,arguments);};};ba.setup.listen(function(ab){ya.setup(ab,{rtc:o.GK.webRTC,debug:true});});ba.hangUp.listen(function(ab){ya.disconnectAll();ba.endCall();});ba.startCall.listen(za('start-call',ya.connect));ya.ready(ba.ready);ya.error(function(ab){var bb=ab.message;m.error('VOIP is having issues. '+(bb?bb:'')+'. Please contact the wit oncall');i.error('[twilio] had an error',ab);ba.endCall();});ya.connect(za('connect',ba.connect));ya.disconnect(za('disconnect',ba.endCall));ya.cancel(za('cancel',ba.endCall));ya.incoming(za('incoming',ba.incoming));}ca();v=babelHelpers.inherits(da,z({'intent-id':null,tid:null,extension:null}));w=v&&v.prototype;function da(){'use strict';v.apply(this,arguments);}x=babelHelpers.inherits(ea,z({from:null,meta:new da(),muted:false,status:'pending',to:null,wasIncoming:null,rating:null,sentDigits:null}));y=x&&x.prototype;function ea(){'use strict';x.apply(this,arguments);}var fa=s.createStore({init:function(){this.data=new ea();this.listenToMany(ba);},getInitialState:function(){return this.data;},onChangeTo:function(ya){this._u(function(za){return za.set('to',ya);});},onDialAgain:function(){this._conn=null;this._u(function(ya){return new ea({status:'dial',meta:ya.get('meta'),from:ya.get('from'),to:ya.get('to')});});},onConnect:function(ya){this._conn=ya;},onEndCall:function(){this._conn=null;this._u(function(ya){return ya.merge({status:'ended'});});},onIncoming:function(ya){this._conn=ya;this._u(function(za){return za.mergeDeep({status:'incoming',to:ya.parameters.From,wasIncoming:true});});},onIncomingAccept:function(){if(this._conn){this._conn.accept();this._u(function(ya){return ya.merge({status:'in-call'});});}},onIncomingReject:function(){if(this._conn){this._conn.reject();this._conn=null;}this.onEndCall();},onMute:function(){if(this._conn){this._conn.mute(true);this._u(function(ya){return ya.set('muted',true);});}},onReady:function(){this._u(function(ya){return new ea({status:'ready'});});},onSendDigits:function(ya){if(this._conn){this._conn.sendDigits(ya);this._u(function(za){return za.update('sentDigits',function(ab){return (ab||'')+ya;});});}},onStartCall:function(){this._u(function(ya){return ya.set('status','in-call');});},onUnmute:function(){if(this._conn){this._conn.mute(false);this._u(function(ya){return ya.set('muted',false);});}},onUseIntent:function(ya){if(this.data.get('status')!=='ready'){m.error('End your call before starting another one');return;}this._u(function(za){return new ea({status:'dial',from:ya.get('phone-number'),meta:new da({tid:ya.get('user-id'),'intent-id':ya.get('id'),extension:ya.get('phone-extension')})});});},onUpdateIncomingInfo:function(ya){this._u(function(za){return za.merge({meta:new da({tid:ya.get('user-id'),'intent-id':ya.get('intent-id'),extension:ya.get('phone-extension')}),from:ya.get('to'),to:ya.get('from')});});},onUpdateRating:function(ya){this._u(function(za){return za.set('rating',ya);});},_u:function(ya){this.data=ya(this.data);this.trigger(this.data);}}),ga=r.createClass({displayName:'OzTwilio',mixins:[q,s.connect(fa,'store'),t.Navigation],componentDidMount:function(){var ya=window.setInterval(function(za){this.state.store.get('status')==='in-call'&&n.isActive();}.bind(this),5000);this._cleanup=function(za){return window.clearInterval(ya);};},componentDidUpdate:function(ya,za){var ab=za.store.get('status'),bb=this.state.store.get('status');if(ab==='in-call'&&bb==='ended')window.clearInterval(this._callDurationInterval);},componentWillUnmount:function(){this._cleanup();},render:function(){var ya=this.state,za=ya.store,ab=ya.callDuration;return (r.createElement('span',{className:"_221-"},ha(za)&&r.createElement(ia,{callDuration:ab,onCallStart:this._handleStartCall,onDialAgain:ba.dialAgain,onHangUp:this._handleHangUp,onIncomingAccept:this._handleIncomingAccept,onIncomingReject:ba.incomingReject,onMute:ba.mute,onRatingChange:this._handleRatingChange,onReady:ba.ready,onSendDigits:ba.sendDigits,onThreadClick:this._handleThreadClick,onToChange:ba.changeTo,onUnmute:ba.unmute,store:za})));},_handleThreadClick:function(ya){this.transitionTo('inbox/show',{threadid:ya});},_handleStartCall:function(){var ya=this.state.store;this._startDurationTimer();ba.startCall(babelHelpers['extends']({},ya.get('meta').toJS(),{from:ya.get('from'),to:ya.get('to'),page:i.getConfig('PAGE_ID'),type:'outgoing'}));},_handleIncomingAccept:function(){this._startDurationTimer();ba.incomingAccept();},_startDurationTimer:function(){var ya=Date.now();clearInterval(this._callDurationInterval);this._callDurationInterval=setInterval(function(){this.setState({callDuration:Date.now()-ya});}.bind(this),950);this.setState({callDuration:0});},_handleHangUp:function(){ba.hangUp();clearInterval(this._callDurationInterval);},_handleRatingChange:function(ya){i.info('[twilio] rating='+ya,this.state.store.toJS());ba.updateRating(ya);}});function ha(ya){return aa(['dial','in-call','incoming','ended']).has(ya.get('status'));}var ia=i.pure(function(ya){return (r.createElement(p,{className:"_2221"},r.createElement(ja,{store:ya.store}),r.createElement(ka,ya)));}),ja=i.pure(function(ya){var za=ya.store,ab=za.get('status'),bb=za.get('wasIncoming')?'Incoming':'Outgoing';return (r.createElement('h2',{className:"_1su5"},ab==='ended'&&bb+' Call End'||bb+' Phone Call'));}),ka=i.pure(function(ya){switch(ya.store.get('status')){case 'dial':return r.createElement(la,ya);case 'in-call':return r.createElement(pa,ya);case 'incoming':return r.createElement(ua,ya);case 'ended':return r.createElement(va,ya);default:i.debug('[twilio] unknown status',ya);return null;}}),la=i.pure(function(ya){var za=ya.store,ab=ya.onToChange,bb=ya.onCallStart,cb=ya.onReady;return (r.createElement('div',{className:"_3hon"},r.createElement(xa,{placeholder:'Type a phone number...',value:za.get('to'),onChange:function(db){return ab(db.target.value);},onKeyDown:function(db){return (db.which===k.RETURN?ma(za)&&bb():null);}}),r.createElement('div',{className:"_1su6"},oa(za)),r.createElement('div',{className:"_1su7"},r.createElement(l,{onClick:cb,type:'secondary',label:'Cancel'}),r.createElement(l,{disabled:!ma(za),onClick:bb,type:'primary',label:'Call'}))));});function ma(ya){return (ya.get('from')&&ya.get('to')&&ya.get('to').length>=10);}var na=function(ya){var za=60000,ab=Math.floor(ya/za);ya%=za;var bb=Math.floor(ya/1000);if(ab<10)ab='0'+ab;if(bb<10)bb='0'+bb;return ab+':'+bb;},oa=function(ya){var za=ya.getIn(['meta','extension']);return 'My Number: '+i.parsePhoneNumber(ya.get('from'))+' ext. '+za;},pa=i.pure(function(ya){var za=ya.callDuration,ab=ya.onHangUp,bb=ya.onMute,cb=ya.onSendDigits,db=ya.onThreadClick,eb=ya.onUnmute,fb=ya.store;return (r.createElement('div',{className:"_2225"},r.createElement('div',{className:"_1su8"},na(za)),r.createElement('div',{className:"_1su9"},i.parsePhoneNumber(fb.get('to'))),r.createElement(qa,{sentDigits:fb.get('sentDigits'),onSendDigits:cb}),r.createElement('div',{className:"_1su6"},fb.get('from')?oa(fb):'Searching for our number...'),r.createElement('div',{className:"_1su7"},r.createElement(ta,{tid:fb.getIn(['meta','tid']),onThreadClick:db}),fb.get('muted')?r.createElement(l,{onClick:eb,type:'secondary',use:'danger',label:'Unmute'}):r.createElement(l,{onClick:bb,type:'secondary',use:'default',label:'Mute'}),r.createElement(l,{onClick:ab,type:'primary',label:'End Call'}))));}),qa=i.pure(function(ya){var za=ya.onSendDigits,ab=ya.sentDigits;return (r.createElement('div',null,r.createElement(xa,{placeholder:'Type numbers using keyboard',value:'',onChange:function(bb){var cb=sa(bb.target.value);cb&&za(cb);}}),r.createElement('div',{className:"_538o"},ab)));}),ra=aa(['1','2','3','4','5','6','7','8','9','0','#','*']);function sa(ya){return ya.split('').filter(function(za){return ra.has(za);}).join('');}var ta=i.pure(function(ya){var za=ya.onThreadClick,ab=ya.tid;return ab?r.createElement(l,{onClick:function(){return za(ab);},type:'secondary',label:'Go to Thread'}):null;}),ua=i.pure(function(ya){var za=ya.store,ab=ya.onIncomingAccept,bb=ya.onIncomingReject;return (r.createElement('div',{className:"_2226"},r.createElement('div',{className:"_1su9"},i.parsePhoneNumber(za.get('to'))),r.createElement('div',{className:"_1su6"},oa(za)),r.createElement('div',{className:"_1su7"},r.createElement(l,{onClick:bb,type:'secondary',label:'Ignore'}),r.createElement(l,{onClick:ab,type:'primary',label:'Answer'}))));}),va=i.pure(function(ya){var za=ya.callDuration,ab=ya.store,bb=ya.onHideDialog,cb=ya.onRatingChange,db=ya.onDialAgain,eb=ya.onReady;return (r.createElement('div',{className:"_5gaw"},r.createElement('div',{className:"_1su8"},na(za)),r.createElement('div',{className:"_1su9"},i.parsePhoneNumber(ab.get('to'))),r.createElement('div',{className:"_1su6"},oa(ab)),r.createElement(wa,{rating:ab.get('rating'),onRatingChange:cb}),r.createElement('div',{className:"_1su7"},r.createElement(l,{onClick:db,type:'secondary',label:'New Call'}),r.createElement(l,{onClick:eb,type:'primary',label:'Close'}))));}),wa=i.pure(function(ya){var za=ya.rating,ab=ya.onRatingChange;return (r.createElement('div',{className:"_5rvp"},za?r.createElement('h3',{className:"_5rvu"},'Thank you for rating!'):r.createElement('span',null,r.createElement('h3',{className:"_5rvu"},'How would you rate your experience?'),r.createElement(u,{large:true,count:0,onClick:ab}))));}),xa=i.pure(function(ya){return (r.createElement('input',babelHelpers['extends']({},ya,{className:"_1-i0 _2224"})));});f.exports=ga;},null);
__d('OzHeader.react',['OzHelpers','immutable','Layout.react','OzButton.react','OzConfig','OzHumans','OzReps','OzStores','OzSwitch.react','OzTwilio','React','Reflux','ReactRouter_DEPRECATED','Tooltip','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=i.Map,x=o.RepStore,y=o.HumanStore,z=t.Link,aa=r.PropTypes,ba=h.pure(function(da){var ea=da.reps,fa=da.humans,ga=da.uid,ha=ea.get(ga,w()),ia=n.closedIntentCount(ha),ja=n.teamClosedIntentCount(ha,ea),ka=Math.round(m.avgLoad(fa)),la=fa.filter(m.isWorking).count();return (r.createElement('span',{className:"_3fr"},r.createElement('span',{className:"_3fs"},r.createElement('span',u.propsFor('Your closed intents'),ia),' ',r.createElement('span',u.propsFor('Closed intents for your entire team'),'(',ja,')')),'intents closed',r.createElement('span',{className:"_3fs"},ka),'avg load',r.createElement('span',{className:"_3fs"},la),la===1?'trainer':'trainers'));}),ca=r.createClass({displayName:'OzHeader',mixins:[t.Navigation,t.State,s.connect(y,'humans'),s.connect(x,'reps')],propTypes:{coachMode:aa.bool.isRequired,rev:aa.number.isRequired,version:aa.string.isRequired,onAway:aa.func.isRequired,onCoachModeToggle:aa.func.isRequired},contextTypes:{uid:aa.string.isRequired},render:function(){var da=this.getParams().threadid?'inbox/show':'inbox',ea=this.state.humans.getIn([this.context.uid,'load'],0),fa='Inbox'+(ea?' ('+ea+')':''),ga=this.props.rev+'/'+this.props.version;return (r.createElement(j,{className:"_2d86"},r.createElement('div',{className:"_2d87"},r.createElement('img',{className:"_2d88"}),this._renderItem(fa,da),this._renderItem('Merchants','merchants'),this._renderItem('Feedback','feedback'),this._renderItem('Stats','stats'),l.GK.supervisor&&this._renderItem('Top','top'),l.GK.IntentDashboard&&this._renderItem('Intents','intents'),l.GK.AIDashboard&&this._renderItem('AI','ai'),l.GK.supervisor&&this._renderItem('Trainers','trainers'),this._renderItem('All Threads','all')),r.createElement('div',{className:"_j6m"},r.createElement(ba,{humans:this.state.humans,reps:this.state.reps,uid:this.context.uid}),l.GK.supervisor?r.createElement(p,{className:"_b8c",isAnimated:true,isOn:this.props.coachMode,label:'Coach Mode',onToggle:this.props.onCoachModeToggle}):null,r.createElement(q,null),!this.props.away?r.createElement(k,{onClick:this.props.onAway},'I\'m going away'):null)));},_renderItem:function(da,ea){return (r.createElement(z,{className:"_33os",to:ea,params:this.getParams()},r.createElement('span',null,da)));}});f.exports=ca;},null);
__d('OzSuggestions',['OzHelpers','immutable','OzConstants'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=j.ATTS,l=i.List,m=i.Map;f.exports={toServer:function(p,q){return p.set('type',k.SUGG).update('data',function(r){return m({name:r.get('title'),description:r.get('description')||'','merchant-name':this.findMerchantName(r.get('merchant'),q),'thumb-url':r.get('images',l()).find(h.validateURL)||null,'thumb-urls':r.get('images',l()).filter(h.validateURL),'target-url':r.get('url'),'expiration-time':r.get('expiration-time'),currency:'USD',amount:r.has('price')?n(r.get('price')):null});}.bind(this));},findMerchantName:function(p,q){var r=q&&p&&q.find(function(s){return (s.get('name-dba')||'').toLowerCase()===p.toLowerCase();});if(r){h.info('[sugg] found merchant',p,r);return r.get('name-dba');}return null;}};function n(p){return Math.round(100*parseFloat(o(p,'$'),10));}function o(p,q){if(!p||!p.startsWith(q))return p;return p.substr(q.length);}},null);
__d('Oz.react',['OzAPI','OzHelpers','immutable','Layout.react','OzActions','OzBugNub.react','OzDialogContainer.react','OzExtensionCheck.react','OzHeader.react','OzConfig','OzStores','OzSuggestions','ReactComponentWithPureRenderMixin','React','Reflux','ReactRouter_DEPRECATED','Run','XUIDialog.react','XUINotice.react','cx','OzNotify'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){if(c.__markCompiled)c.__markCompiled();var ba=c('OzNotify').Component,ca=r.ActiveThreadStore,da=r.MerchantStore,ea=r.RepStore,fa=r.RequirementStore,ga=r.ThreadStore,ha=r.WitIntentStore,ia=w.RouteHandler,ja=u.PropTypes,ka=j.Map,la=20000,ma=60000,na=5000,oa=u.createClass({displayName:'Oz',mixins:[v.connect(da,'merchants'),v.connect(ea,'reps'),v.connect(ha,'witIntents'),v.connect(fa,'requirements')],propTypes:{rev:ja.number.isRequired,uid:ja.string.isRequired,version:ja.string.isRequired,skipToto:ja.bool,onUnmount:ja.func.isRequired},childContextTypes:{uid:ja.string.isRequired,merchants:ja.instanceOf(ka).isRequired,reps:ja.instanceOf(ka).isRequired,witIntents:ja.instanceOf(ka).isRequired},getChildContext:function(){return {uid:this.props.uid,merchants:this.state.merchants,reps:this.state.reps,witIntents:this.state.witIntents};},getInitialState:function(){return {almostInactive:false,away:false,coachMode:false,inactive:false};},componentDidMount:function(){window.addEventListener('message',this._handleMessage);window.postMessage({type:'consolemounted'},'*');this.lastPulseAt=Date.now();var ua=l.sendPulse.listen(this._handlePulse),va=l.activateIntent.listen(this._handleActivateIntent),wa=setInterval(l.sendPulse,na);this.lastActiveAt=Date.now();window.addEventListener('mousemove',function(za){return l.isActive();});window.addEventListener('keydown',function(za){return l.isActive();});var xa=l.isActive.listen(function(){this.lastActiveAt=Date.now();if(this.state.almostInactive||this.state.inactive)this.setState({almostInactive:false,inactive:false});}.bind(this));l.updateThreads.preEmit=ra.bind(null,this.props.uid);var ya=l.isInactive.listen(function(za){if(Date.now()-this.lastActiveAt>na)this.setState({almostInactive:false,inactive:true});}.bind(this));x.onBeforeUnload(function(){h.sendDisconnectPulse(Math.floor((Date.now()-this.lastPulseAt)/1000),this._buildPulse(true));this.props.onUnmount();}.bind(this));this._cleanup=function(){window.removeEventListener('message');ua();va();clearInterval(wa);window.removeEventListener('mousemove');xa();ya();};},componentWillUnmount:function(){this._cleanup();},render:function(){return (u.createElement(k,{className:"_3_ps _li",onKeyPress:this._handleKeyPress},u.createElement(ba,null),!this.props.skipToto&&u.createElement(o,null),this.state.away?u.createElement(pa,{onClick:this._handleAway,shown:this.state.away,text:'You\'re currently away.',className:"_1tir"}):this.state.almostInactive?u.createElement(qa,{lastActiveAt:this.lastActiveAt,onZero:this._handleZero}):this.state.inactive?u.createElement(pa,{shown:this.state.inactive,text:'You\'re currently inactive.',className:"_4da6"}):null,u.createElement(p,{away:this.state.away,coachMode:!!this.state.coachMode,onAway:this._handleAway,onCoachModeToggle:this._handleCoachModeToggle,rev:this.props.rev,version:this.props.version,reps:this.state.reps}),u.createElement(ia,{witIntents:this.state.witIntents,requirements:this.state.requirements,merchants:this.state.merchants,reps:this.state.reps}),u.createElement(m,null),u.createElement(n,null)));},_handleKeyPress:function(){l.isActive();},_handlePulse:function(){var ua=Date.now(),va=Math.round((ua-this.lastPulseAt)/1000),wa=this._buildPulse();h.sendPulse(va,wa);ta(ca.data,ga.data);this.lastPulseAt=ua;if(!this.state.almostInactive&&!this.state.inactive&&wa.get('inactive-ms')>=ma-la)this.setState({almostInactive:true});},_handleActivateIntent:function(ua){if(ua)h.handledEvents(ua);},_handleMessage:function(ua){if(ua.source!==window)return;if(!ua.data)return;switch(ua.data.type){case 'active':l.isActive();break;case 'recordactivity':var va=ca.data,wa=ua.data.data,xa=va.get('threadID');i.debug('[oz-ext] received activity',wa);if(!xa){i.debug('[oz-ext] skipping event, no threadID');return;}h.recordActivity(xa,wa);break;case 'bubble':i.debug('[toto] got bubble',ua.data);l.addBubble(s.toServer(j.fromJS(ua.data),this.state.merchants));break;case 'autopilot-data':i.debug('[toto] got autopilot',ua.data);if(ua.data)l.addAutopilot(j.fromJS(ua.data));break;}},_handleAway:function(ua){h.away(!this.state.away).done(function(va){this.setState({away:!!va});}.bind(this));},_handleCoachModeToggle:function(ua){h.coachMode(ua).done(function(){this.setState({coachMode:ua});}.bind(this));},_handleZero:function(){this.setState({almostInactive:false,inactive:true});},_buildPulse:function(ua){return sa(this.props.uid,ca.data,ga.data,this.lastActiveAt,this.state.away||ua||false,this.state.coachMode);}});function pa(ua){var va=ua.shown,wa=ua.onClick,xa=ua.text,ya=ua.className;return (u.createElement(y,{width:544,shown:va,layerHideOnBlur:false},u.createElement('div',{className:"_1tip"},u.createElement('div',{className:ya}),u.createElement('div',{className:"_1tis"},xa),wa?u.createElement('a',{className:"_1tit _57lt _30yy",onClick:wa},'I\'m back :)'):null)));}var qa=u.createClass({displayName:'OzCountdownDialog',mixins:[t],propTypes:{lastActiveAt:ja.number.isRequired,onZero:ja.func.isRequired},getInitialState:function(){return {countdown:Math.floor((ma-(Date.now()-this.props.lastActiveAt))/1000)};},componentDidMount:function(){this._interval=setInterval(function(){this.setState({countdown:Math.max(this.state.countdown-1,0)});}.bind(this),1000);},componentDidUpdate:function(){if(this.state.countdown===0){clearInterval(this._interval);this.props.onZero();}},componentWillUnmount:function(){clearInterval(this._interval);},render:function(){return (u.createElement(y,{width:544,shown:true,layerHideOnBlur:false},u.createElement('div',{className:"_1tip"},u.createElement('div',{className:"_4da6"}),u.createElement(z,{use:'warn'},'You\'ll be inactive (and your threads will be reassigned) in approximately ',this.state.countdown,' seconds...'))));}});function ra(ua,va){var wa=ga.data;if(wa.isEmpty())return;va.filter(function(xa){return ((i.isOwner(xa,ua)||i.isSubscriber(xa,ua))&&(xa.get('ready')||i.isUnread(xa)||i.hasPaid(xa)||i.hasReminder(xa)));}).forEach(function(xa){var ya=i.isUnread(xa)&&i.shortDesc(i.lastUserMessage(xa))||i.hasPaid(xa)&&'Payment received.'||i.hasReminder(xa)&&'Reminder triggered.';if(!ya)return;var za=i.threadID(xa),ab=wa.getIn([za,'last-event-at']);if(xa.get('last-event-at')===ab)return;var bb=i.photo(xa),cb=bb?bb.getIn(['data','url'])||bb.get('mime_type')+','+bb.get('data'):null;h.notifyExtension({action:'show',title:i.getName(xa),desc:ya,picture:cb,id:i.threadID(xa)});});}function sa(ua,va,wa,xa,ya,za){var ab=va.get('threadID'),bb=ab&&wa.get(ab),cb=ka();if(ab)cb=cb.merge({tid:ab});if(bb)cb=cb.merge({'intent-id':va.get('activeIntent'),'owner-id':bb.getIn(['owner','id']),'user-name':bb.getIn(['user-vcard','name'])});if(Number.isFinite(xa))cb=cb.set('inactive-ms',Date.now()-xa);cb=cb.set('load',wa.toSeq().filter(function(db){return i.isOwner(db,ua)&&db.get('ready');}).count());cb=cb.set('away?',ya);cb=cb.set('coach-mode?',za);return cb;}function ta(ua,va){var wa=ua.get('threadID'),xa=wa&&va.get(wa),ya=ka();if(xa)ya=ya.merge({tid:wa,'intent-id':ua.get('activeIntent'),'user-vcard':xa.get('user-vcard')});window.postMessage({type:'consolepulse',data:ya.toJS()},'*');}f.exports=oa;},null);
__d('OzAIDashboardFilters.react',['immutable','InputLabel.react','ReactComponentWithPureRenderMixin','React','XUISingleSelector.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=h.List,o=h.Map,p=k.PropTypes,q=l.Option,r=k.createClass({displayName:'OzAIDashboardFilters',mixins:[j],propTypes:{intentMetas:p.instanceOf(o).isRequired,modules:p.instanceOf(n).isRequired,isReversed:p.bool.isRequired,onIsReversedChange:p.func.isRequired,onSortByChange:p.func.isRequired,onUUIDChange:p.func.isRequired,onModuleChange:p.func.isRequired,sortBy:p.string,sortableFields:p.instanceOf(o).isRequired,uuid:p.string,selectedModule:p.string},render:function(){return (k.createElement('ul',{className:"_1bo-"},k.createElement('li',null,this._renderModuleFilter()),k.createElement('li',null,this._renderUUIDFilter()),k.createElement('li',null,this._renderSortByFilter()),k.createElement('li',null,this._renderIsReversedFilter())));},_renderModuleFilter:function(){return (k.createElement(l,{maxheight:400,onChange:this._handleModuleChange,value:this.props.selectedModule||'__none__'},k.createElement(q,{value:'__none__'},'Select a module'),this.props.modules.valueSeq().map(function(t){return (k.createElement(q,{key:t,value:t},t));})));},_renderUUIDFilter:function(){return (k.createElement(l,{maxheight:400,onChange:this._handleUUIDChange,value:this.props.uuid||'__none__'},k.createElement(q,{value:'__none__'},'Select an intent category'),this.props.intentMetas.sortBy(function(t){return t.get('name');}).valueSeq().map(function(t){return (k.createElement(q,{key:t.get('id'),value:t.get('id')},t.get('name')));})));},_renderIsReversedFilter:function(){return (k.createElement(i,null,k.createElement('input',{checked:this.props.isReversed,onChange:function(t){this.props.onIsReversedChange(t.target.checked);}.bind(this),type:'checkbox'}),k.createElement('label',null,'Reversed?')));},_renderSortByFilter:function(){return (k.createElement(l,{maxheight:400,onChange:this._handleSortByChange,value:this.props.sortBy||'__none__'},k.createElement(q,{value:'__none__'},'Select a field to sort by'),this.props.sortableFields.map(function(t,u){return (k.createElement(q,{key:u,value:u},t));}).valueSeq()));},_handleSortByChange:function(t){this.props.onSortByChange(s(t.value));},_handleUUIDChange:function(t){this.props.onUUIDChange(s(t.value));},_handleModuleChange:function(t){this.props.onModuleChange(t.value);}});function s(t){return t!=='__none__'?t:undefined;}f.exports=r;},null);
__d('OzAIDashboardEventSuggestions.react',['cx','immutable','OzConstants','ReactComponentWithPureRenderMixin','React','XUITable.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=i.List,o=i.Map,p=j.ATTS,q=l.PropTypes,r=l.createClass({displayName:'OzAIDashboardEventSuggestions',mixins:[k],propTypes:{gold:q.instanceOf(o).isRequired,guesses:q.instanceOf(n).isRequired},render:function(){return (l.createElement(m,{outerBorder:true},l.createElement('thead',null,l.createElement('tr',null,l.createElement('th',null,'Source'),l.createElement('th',null,'Guess'),l.createElement('th',null,'Class'),l.createElement('th',null,'Confidence'))),l.createElement('tbody',null,this._getSuggestions().map(this._renderRow))));},_buildGuess:function(s){switch(s.get('type')){case p.TEMPLATE:return (l.createElement('span',null,s.get('ui-body')||JSON.stringify(s.get('body'))));case p.SUGG:case 'bubble':return (l.createElement('a',{href:s.get('target-url'),target:'_blank'},s.get('name')));default:return l.createElement('span',null,JSON.stringify(s));}},_renderRow:function(s,t){var u=this.props.gold,v=s.get('source');return (l.createElement('tr',{className:u.get('source')===v&&u.get('position')===s.get('position')?"_31bp":'',key:t},l.createElement('td',null,v),l.createElement('td',null,this._buildGuess(s)),l.createElement('td',null,s.get('class')),l.createElement('td',null,s.get('confidence'))));},_getSuggestions:function(){return this.props.guesses.flatMap(function(s){return s.get('items')||[s].map(function(t){return t.merge(o({position:s.get('position'),confidence:s.get('confidence'),'class':s.get('class')}));});}).toSeq();}});f.exports=r;},null);
__d('OzAIDashboardEventsDialog.react',['DialogFitHeight','immutable','InputLabel.react','OzAIDashboardEventSuggestions.react','ReactComponentWithPureRenderMixin','React','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogOkayButton.react','XUIDialogTitle.react','XUITable.react','cx','formatDate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=i.Map,w=m.PropTypes,x=m.createClass({displayName:'OzAIDashboardEventsDialog',mixins:[l],propTypes:{session:w.instanceOf(v).isRequired,onToggle:w.func.isRequired,shown:w.bool.isRequired},getInitialState:function(){return {isFiltered:true};},render:function(){return (m.createElement(n,{behaviors:{DialogFitHeight:h},onToggle:this.props.onToggle,shown:this.props.shown,width:800},m.createElement(r,null,m.createElement('span',null,'Events for Session  ',this.props.session.get('id'))),m.createElement(o,null,m.createElement(j,null,m.createElement('input',{checked:this.state.isFiltered,onChange:function(aa){this.setState({isFiltered:aa.target.checked});}.bind(this),type:'checkbox'}),m.createElement('label',null,'Filter Non-Message Events?')),this._renderTable()),m.createElement(p,null,m.createElement(q,{use:'confirm',action:'cancel'}))));},_renderTable:function(){return (m.createElement(s,{className:"_4p5_",outerBorder:true},m.createElement('thead',null,m.createElement('tr',null,m.createElement('th',null,'Time'),m.createElement('th',null,'Text/Data'),m.createElement('th',null,'Suggestions'),m.createElement('th',null,'Winner'))),m.createElement('tbody',null,this._getEvents().map(this._renderRow))));},_renderRow:function(event,aa){var ba=event.get('type'),ca=event.getIn(['aiusage','guesses']),da=event.get('suggestion');return (m.createElement('tr',{key:aa},m.createElement('td',{className:"_4p60"},y(event.get('time'))),m.createElement('td',{className:"_4p61"+(ba!=='message'?' '+"_31bp":'')},event.get('text')||da&&z(da)),m.createElement('td',null,ca?m.createElement(k,{gold:event.getIn(['aiusage','gold'])||v(),guesses:ca}):''),m.createElement('td',null,event.getIn(['aiusage','gold','source']))));},_getEvents:function(){var aa=this.props.session.get('events').toSeq();if(this.state.isFiltered)aa=aa.filter(function(event){var ba=event.get('type');return ba==='send'||ba==='message'||ba==='suggest';});return aa;}});function y(aa){return u(aa/1000,'M d, Y g:ia');}function z(aa){return (m.createElement('a',{href:aa.get('target-url'),target:'_blank'},aa.get('name')));}f.exports=x;},null);
__d('OzAIDashboardRow.react',['immutable','ReactLayeredComponentMixin','OzAIDashboardEventsDialog.react','ReactComponentWithPureRenderMixin','React','formatDate'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=h.Map,o=l.PropTypes,p=l.createClass({displayName:'OzAIDashboardRow',mixins:[i,k],propTypes:{session:o.instanceOf(n).isRequired,intentMeta:o.instanceOf(n),selectedModule:o.string},getInitialState:function(){return {isDialogOpen:false};},render:function(){var r=this.props,s=r.session,t=r.intentMeta,u=r.selectedModule;return (l.createElement('tr',null,l.createElement('td',null,s.get('id')),l.createElement('td',null,q(s.get('created-at'))),l.createElement('td',null,t&&t.get('name')),l.createElement('td',null,s.get('sends')||0),l.createElement('td',null,s.get('texts')||0),l.createElement('td',null,s.get('suggs')||0),l.createElement('td',null,s.get('humans')||0),l.createElement('td',null,s.getIn(['shown',u])||0),l.createElement('td',null,s.getIn(['won',u])||0),l.createElement('td',null,this._renderEventsLink())));},renderLayers:function(){if(!this.state.isDialogOpen)return {};return {dialog:l.createElement(j,{session:this.props.session,onToggle:this._handleDialogToggle,shown:this.state.isDialogOpen})};},_renderEventsLink:function(){var r=this.props.session.get('events');if(!r||r.isEmpty())return l.createElement('span',null,'None');return (l.createElement('a',{href:'#',onClick:this._handleEventsLinkClick},'Click to View'));},_handleDialogToggle:function(r){this.setState({isDialogOpen:r});},_handleEventsLinkClick:function(r){r.preventDefault();this.setState({isDialogOpen:true});}});function q(r){return m(r/1000,'M d, Y g:ia');}f.exports=p;},null);
__d('OzAIDashboard.react',['OzAPI','immutable','MessengerFlexScrollableArea.react','OzAIDashboardFilters.react','OzAIDashboardRow.react','ReactComponentWithPureRenderMixin','React','XUITable.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=i.List,q=i.Map,r=n.PropTypes,s=q({id:'ID','created-at':'Created At',sends:'Sends',texts:'Texts',suggs:'Suggs',humans:'Humans',shown:'Shown',won:'Won'}),t=n.createClass({displayName:'OzAIDashboard',mixins:[m],propTypes:{intentMetas:r.instanceOf(q).isRequired,sessions:r.instanceOf(p).isRequired,isLoaded:r.bool.isRequired,isLoading:r.bool.isRequired,isReversed:r.bool.isRequired,onFetchRequest:r.func.isRequired,onIsReversedChange:r.func.isRequired,onSortByChange:r.func.isRequired,onUUIDChange:r.func.isRequired,onModuleChange:r.func.isRequired,selectedModule:r.string,sortBy:r.string,uuid:r.string},getInitialState:function(){return {modules:p()};},componentDidMount:function(){h.AIModules().done(function(u){if(!this.isMounted())return;this.setState({modules:u});if(u.size>0)this.props.onModuleChange(u.get(0));}.bind(this));},render:function(){return (n.createElement(j,{onScroll:this._handleScroll,ref:'scrollable'},n.createElement(k,{intentMetas:this.props.intentMetas,modules:this.state.modules,isReversed:this.props.isReversed,onIsReversedChange:this.props.onIsReversedChange,onSortByChange:this.props.onSortByChange,onUUIDChange:this.props.onUUIDChange,onModuleChange:this.props.onModuleChange,sortBy:this.props.sortBy,sortableFields:s,uuid:this.props.uuid,selectedModule:this.props.selectedModule}),this._renderTable(),this._renderLoadMoreLink()));},_renderTable:function(){var u=this.props,v=u.intentMetas,w=u.selectedModule;return (n.createElement(o,{outerBorder:false},n.createElement('thead',null,n.createElement('tr',null,n.createElement('th',null,'ID'),n.createElement('th',null,'Created At'),n.createElement('th',null,'Intent'),n.createElement('th',null,'Sends'),n.createElement('th',null,'Texts'),n.createElement('th',null,'Suggs'),n.createElement('th',null,'Humans'),n.createElement('th',null,'Shown'),n.createElement('th',null,'Won'),n.createElement('th',null,'Events'))),n.createElement('tbody',null,this.props.sessions.map(function(x){return (n.createElement(l,{session:x,intentMeta:v.get(x.get('wit-intent-uuid')),selectedModule:w,key:x.get('id')}));}))));},_renderLoadMoreLink:function(){if(this.props.isLoaded)return null;if(this.props.isLoading)return n.createElement('div',null,'Loading...');return (n.createElement('div',null,n.createElement('a',{href:'#',onClick:function(u){u.preventDefault();this.props.onFetchRequest();}.bind(this)},'Fetch More Sessions')));},_handleScroll:function(){if(!this.props.isLoading&&!this.props.isLoaded&&this.refs.scrollable&&this.refs.scrollable.isScrolledToBottom())this.props.onFetchRequest();}});f.exports=t;},null);
__d('OzAIDashboardContainer.react',['immutable','OzAPI','OzAIDashboard.react','React'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.List,m=h.Map,n=k.PropTypes,o=30,p={sessions:l(),isLoaded:false,offset:0},q=k.createClass({displayName:'OzAIDashboardContainer',propTypes:{witIntents:n.instanceOf(m).isRequired},getInitialState:function(){return babelHelpers['extends']({},p,{isLoading:false,isReversed:true,sortBy:'won',uuid:undefined,selectedModule:undefined});},componentDidMount:function(){this._handleFetchRequest();},render:function(){return (k.createElement(j,{intentMetas:this.props.witIntents,sessions:this.state.sessions,modules:this.state.modules,selectedModule:this.state.selectedModule,isLoaded:this.state.isLoaded,isLoading:this.state.isLoading,isReversed:this.state.isReversed,onFetchRequest:this._handleFetchRequest,onIsReversedChange:this._handleIsReversedChange,onSortByChange:this._handleSortByChange,onUUIDChange:this._handleUUIDChange,onModuleChange:this._handleModuleChange,sortBy:this.state.sortBy,uuid:this.state.uuid}));},_handleFetchRequest:function(){if(this.state.isLoading||this.state.isLoaded)return;this.setState({isLoading:true});i.aiDashboard({offset:this.state.offset,limit:o,uuid:this.state.uuid,reverse:this.state.isReversed||undefined,'sort-by':this.state.sortBy||undefined,module:this.state.selectedModule}).done(function(r){this.setState({sessions:this.state.sessions.concat(r),isLoaded:r.size<o,isLoading:false,offset:this.state.offset+r.size});}.bind(this));},_handleModuleChange:function(r){this.setState(babelHelpers['extends']({},p,{selectedModule:r}),this._handleFetchRequest);},_handleUUIDChange:function(r){this.setState(babelHelpers['extends']({},p,{uuid:r}),this._handleFetchRequest);},_handleIsReversedChange:function(r){this.setState(babelHelpers['extends']({},p,{isReversed:r}),this._handleFetchRequest);},_handleSortByChange:function(r){this.setState(babelHelpers['extends']({},p,{sortBy:r}),this._handleFetchRequest);}});f.exports=q;},null);
__d('OzDate.react',['formatDate','joinClasses','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'OzDate',propTypes:{date:l.instanceOf(Date).isRequired},render:function(){var n=h(this.props.date,{today:'g:ia',withinWeek:'D g:ia',thisYear:'M jS, g:ia',older:'m/d/Y g:ia'});return (j.createElement('time',{title:n,className:i("_2s4p",this.props.className)},n));}});f.exports=m;},null);
__d('OzLastEvent.react',['cx','OzHelpers','OzConstants','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=j.AUTHOR_TYPES,n=l.PropTypes,o=l.createClass({displayName:'OzLastEvent',mixins:[k],propTypes:{name:n.string.isRequired,lastEvent:n.object.isRequired},render:function(){var p=this.props.lastEvent,q=i.authorType(p)===m.USER?this.props.name.split(' ')[0].substr(0,10):'M',r=p.get('text'),s=i.shortDesc(p)||'did something',t=r&&q+': '+r||q+' '+s;return (l.createElement('div',{className:"_4-_6 _4-_7",title:t},this._renderText(q,s)));},_renderText:function(p,q){return (l.createElement('span',null,l.createElement('span',{className:"_3ikz"},p,': '),q));}});f.exports=o;},null);
__d('OzStrings',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports={NOTREADY_BUTTON:'I\'m waiting',IS_NOTREADY:'Currently waiting',READY_BUTTON:'The user is waiting for us!',USER_FILTER_ALL:'All users',USER_FILTER_PUBLIC:'Public only',USER_FILTER_EMPLOYEE:'Employee only',READY_FILTER_ALL:'All threads',READY_FILTER_ATTENTION:'Needs attention',READY_FILTER_WAITING:'I\'m waiting'};},null);
__d('OzThreadLabels.react',['OzHelpers','OzAPI','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','joinClasses','immutable','ReactLayeredComponentMixin','ReactComponentWithPureRenderMixin','React','ReactDOM','XUICloseButton.react','XUIContextualDialog.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=m.Map,v=m.OrderedMap,w=m.List,x=p.PropTypes,y=p.createClass({displayName:'Label',mixins:[o],propTypes:{noColor:x.bool,removable:x.bool,shade:x.oneOf(['dark','light']),thread:x.instanceOf(u).isRequired},getDefaultProps:function(){return {shade:'dark'};},render:function(){if(!this.props.shown)return null;return (p.createElement('div',{className:l("_2yqb"+(this.props.noColor?' '+"_2yqc":'')+(' '+"_2yqd"),this.props.className)},this.props.text,this.props.removable&&this.props.onRemove?p.createElement(r,{className:"_2yqe",onClick:this.props.onRemove,shade:this.props.shade}):null));}});function z(ma){return (p.createElement(y,babelHelpers['extends']({},ma,{className:"_2yqi",text:'REMINDER',shown:!h.urgentReminders(ma.thread).isEmpty()})));}function aa(ma){return (p.createElement(y,babelHelpers['extends']({},ma,{className:"_2yqj",text:'PAID',shown:!h.paidReminders(ma.thread).isEmpty()})));}function ba(ma){var na=h.minAge(ma.thread);return (p.createElement(y,babelHelpers['extends']({},ma,{className:"_2yqm",text:na<18&&'UNDER 18'||na<21&&'UNDER 21',shown:na<21})));}function ca(ma){return (p.createElement(y,babelHelpers['extends']({},ma,{className:"_2yql",text:'ENGAGE',shown:h.hasEngage(ma.thread)})));}var da=v({OzVIPLabel:['vip',"_2yqf"],OzUrgentLabel:['urgent',"_2yqg"],OzAbuserLabel:['abuser',"_2yqh"],OzEscalatedLabel:['escalated',"_1jce"]}),ea=v({OzEmployeeLabel:['employee',"_2yqk"]}),fa=da.merge(ea).map(function(ma){var na=ma[0],oa=ma[1];return na;}).toSet();function ga(ma,na,oa){return function(pa){return (p.createElement(y,babelHelpers['extends']({},pa,{className:na,text:la(ma),shown:h.hasTag(pa.thread,ma),onRemove:function(){return i.deleteTag(h.threadID(pa.thread),ma);}})));};}var ha=da.map(function(ma){return ga.apply(undefined,ma);}),ia=ea.map(function(ma){return ga.apply(undefined,ma);});function ja(ma){var na=ma.className,oa=ma.removable,pa=ma.addable,qa=babelHelpers.objectWithoutProperties(ma,['className','removable','addable']);return (p.createElement('div',{className:na},ha.map(function(ra,sa){return p.createElement(ra,babelHelpers['extends']({key:sa,removable:oa},qa));}).valueSeq(),(qa.thread.get('tags')||w()).filterNot(function(ra){return fa.has(ra);}).sort().map(function(ra){var sa=ga(ra,"_tch");return sa(babelHelpers['extends']({key:ra,removable:oa},qa));}),ia.map(function(ra,sa){return p.createElement(ra,babelHelpers['extends']({key:sa},qa));}).valueSeq(),p.createElement(ca,qa),p.createElement(aa,qa),p.createElement(z,qa),pa?p.createElement(ka,{thread:qa.thread}):null));}var ka=p.createClass({displayName:'OzAddLabel',mixins:[o,n],propTypes:{thread:x.instanceOf(u).isRequired},getInitialState:function(){return {shown:false};},render:function(){return (p.createElement('span',{ref:'add'},this._tags().isEmpty()?null:p.createElement('button',{className:"_1-hv _2yqb _2yqn _2yqo",onClick:function(){return this.setState({shown:true});}.bind(this)},'+')));},renderLayers:function(){var ma=this.state.shown;if(!ma)return null;var na=this.props.thread;return {contextualDialog:p.createElement(s,{behaviors:{ContextualLayerAutoFlip:j,ContextualLayerUpdateOnScroll:k},position:'below',shown:ma,context:q.findDOMNode(this.refs.add),onBlur:function(oa){return this.setState({shown:false});}.bind(this)},p.createElement('div',{className:"_2yqp"},this._tags().map(function(oa){var pa=oa[0],qa=oa[1];return (p.createElement('button',{key:pa,className:l(qa,"_1-hv _2yqq"),onClick:function(){this.setState({shown:false});i.createTag(h.threadID(na),pa);}.bind(this)},la(pa)));}.bind(this))))};},_tags:function(){return da.filterNot(function(ma){var na=ma[0],oa=ma[1];return h.hasTag(this.props.thread,na);}.bind(this)).valueSeq();}});function la(ma){return ma.split('m_experiment_').join('').toUpperCase();}f.exports={OzLabelList:ja,OzUnderageLabel:ba};},null);
__d('OzUserImage.react',['joinClasses','Image.react','immutable','ReactComponentWithPureRenderMixin','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=j.Map,o=l.PropTypes,p=l.createClass({displayName:'OzUserImage',mixins:[k],propTypes:{photo:o.object},render:function(){var q=h(this.props.className,"_3c52 _3c53"),r=function(t){return l.createElement(i,{className:q,src:t});},s=this.props.photo||n();return (s.getIn(['data','url'])&&r(s.getIn(['data','url']))||s.get('data')&&r(s.get('mime_type')+','+s.get('data'))||l.createElement('span',{className:h(q,"_3ejm")}));}});f.exports=p;},null);
__d('OzAllRow.react',['OzStrings','cx','OzHelpers','immutable','OzButton.react','OzConfig','OzConstants','OzDate.react','OzLastEvent.react','OzThreadLabels.react','OzUserImage.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=k.Map,v=k.List,w=n.AUTHOR_TYPES,x=t.PropTypes,y=q.OzLabelList,z=j.pure(function(ia){var ja=ia.thread,ka=ia.witIntents,la=babelHelpers.objectWithoutProperties(ia,['thread','witIntents']);return (t.createElement('div',{className:"_-66"},t.createElement(fa,{width:'220px'},t.createElement(aa,{thread:ja})),t.createElement(fa,{marginLeft:'10px',width:'250px'},t.createElement(ba,{thread:ja,witIntents:ka})),t.createElement(fa,{marginLeft:'10px',width:'350px'},t.createElement(ca,{thread:ja})),t.createElement(fa,{marginLeft:'10px',width:'150px'},t.createElement(da,{thread:ja})),t.createElement(fa,{margineft:'10px',flex:'1',alignItems:'right'},t.createElement(ea,babelHelpers['extends']({thread:ja},la)))));}),aa=j.pure(function(ia){var ja=ia.thread;return (t.createElement('div',{className:"_-67"},t.createElement(r,{photo:j.photo(ja)}),t.createElement('div',{className:"_-68"},t.createElement('h1',{className:"_-69"},j.getName(ja)),t.createElement(y,{className:"_-6a",thread:ja}))));}),ba=j.pure(function(ia){var ja=ia.thread,ka=ia.witIntents,la=j.openIntents(ja).toSeq().map(function(na){return ka.getIn([na.get('wit-intent-uuid'),'name']);}).filter(function(na){return na;}).map(function(na){return 'Intent: '+na;}),ma=j.urgentReminders(ja).toSeq().map(function(na){return na.getIn(['body','description']);}).filter(function(na){return na;}).map(function(na){return 'Reminder: '+na;});return (t.createElement('div',{className:"_-6q"},t.createElement('div',{className:"_-6r"},la.concat(ma).map(function(na,oa){return (t.createElement('div',{key:oa,className:"_4-_7 _-6s"},na));}))));}),ca=j.pure(function(ia){var ja=ia.thread;return (t.createElement('div',{className:"_-6u"},ga(ja).map(function(ka){return (t.createElement('div',{key:j.msgID(ka),className:"_-6v"+(j.authorType(ka)!==w.USER?' '+"_-6w":'')},t.createElement('span',{className:"_4-_7 _-6x"},t.createElement(o,{date:new Date(ka.get('timestamp'))})),t.createElement(p,{key:j.msgID(ka),name:j.getName(ja),lastEvent:ka})));})));}),da=j.pure(function(ia){var ja=ia.thread,ka=ja.getIn(['owner','name'])||'No owner',la=ja.getIn(['last-owner','name']);return (t.createElement('div',{className:"_-6y"},t.createElement('div',{className:"_-6z"},ka),la?t.createElement('div',{className:"_-6-"},'Last owner: ',la):null));}),ea=t.createClass({displayName:'Actions',mixins:[s],contextTypes:{uid:x.string.isRequired},propTypes:{thread:x.instanceOf(u).isRequired,onThreadNotReady:x.func.isRequired,onThreadReady:x.func.isRequired,onThreadRelease:x.func.isRequired,onThreadView:x.func.isRequired},render:function(){return (t.createElement('div',{className:"_-6_"},ha(babelHelpers['extends']({},this.props,{uid:this.context.uid})).map(function(ia){var ja=ia.body,ka=ia.f;return (t.createElement(l,{key:ja,onClick:function(la,ma){return ka(this.props.thread,ma,la);}.bind(this)},ja));}.bind(this))));}}),fa=j.pure(function(ia){var ja=ia.children,ka=babelHelpers.objectWithoutProperties(ia,['children']);return (t.createElement('div',{className:"_-70",style:ka},ja));});function ga(ia){var ja=j.lastEvents(ia).groupBy(j.authorType);return v([ja.get(w.USER),ja.get(w.TRAINER),ja.get(w.BOT)]).toSeq().filter(function(ka){return ka;}).map(function(ka){return ka.last();}).sortBy(function(ka){return ka.get('timestamp');});}function ha(ia){var ja=ia.onThreadNotReady,ka=ia.onThreadReady,la=ia.onThreadRelease,ma=ia.onThreadView,na=ia.thread,oa=ia.uid,pa=na,qa=[];if(m.GK.supervisor&&j.hasOwner(pa))qa.push({body:'Release',f:la});if(pa.get('ready')){qa.push({body:h.NOTREADY_BUTTON,f:ja});}else if(m.GK.supervisor)qa.push({body:h.READY_BUTTON,f:ka});if(pa.getIn(['owner','id'])!==oa&&!j.isSubscriber(pa,oa))qa.push({body:'View',f:ma});return qa;}f.exports=z;},null);
__d('OzAll.react',['OzStrings','OzAPI','cx','OzHelpers','immutable','MessengerFlexScrollableArea.react','OzActions','OzAllRow.react','OzLoading.react','OzStores','promiseFinally','ReactComponentWithPureRenderMixin','React','Reflux','ReactRouter_DEPRECATED','XUIButton.react','XUIRadioButtonGroup.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();var y=l.Map,z=p.Flex,aa=p.Inline,ba=q.QueueFilterStore,ca=q.ThreadStore,da=t.PropTypes,ea=t.createClass({displayName:'OzAll',mixins:[u.connect(ba,'filters'),u.connect(ca,'threads'),v.Navigation],propTypes:{witIntents:da.instanceOf(y).isRequired},getInitialState:function(){return {clientLimit:oa};},componentWillMount:function(){if(this.state.threads.size<oa)this._fetchThreads();},componentDidUpdate:function(sa,ta){var ua=ta.filters.get('all'),va=this.state.filters.get('all');if(!l.is(ua,va))this._fetchThreads();},render:function(){var sa=this._getFilters(),ta=sa[0],ua=sa[1],va=this._threads();return (t.createElement('div',{className:"_3l5z"},t.createElement(ga,{showTags:ta,hideTags:ua,onChange:this._handleFilterChange}),t.createElement(fa,{threads:va,loading:!!ma[qa(ta,ua)],clientLimit:this.state.clientLimit,onScrollBottom:this._handleScrollBottom,onThreadNotReady:this._handleThreadNotReady,onThreadReady:this._handleThreadReady,onThreadRelease:this._handleThreadRelease,onThreadView:this._handleThreadView,witIntents:this.props.witIntents})));},_getFilters:function(){var sa=this.state.filters.get('all');return [sa.get('showTags'),sa.get('hideTags')];},_fetchThreads:function(){ra(this._getFilters());},_threads:function(){return ja(ia(this.state.threads),this._getFilters());},_handleFilterChange:function(sa){n.updateQueueFilters(y({all:y(sa)}));this.setState({clientLimit:oa});},_handleScrollBottom:function(){var sa=this.state.clientLimit,ta=this._threads(),ua=sa+oa;this.setState({clientLimit:ua});ta.slice(sa,ua).size||this._fetchThreads();},_handleThreadNotReady:function(sa,ta){i.notready(k.threadID(sa)).done(ta,ta);},_handleThreadReady:function(sa,ta){i.ready(k.threadID(sa)).done(ta,ta);},_handleThreadRelease:function(sa,ta){i.release(k.threadID(sa)).done(ta,ta);},_handleThreadView:function(sa,ta,ua){var va=k.threadID(sa),wa=k.hasCmdOrCtrl(ua);i.view(va).done(function(xa){ta();wa||this.transitionTo('inbox/show',{threadid:va});}.bind(this),ta);}}),fa=t.createClass({displayName:'ThreadList',mixins:[s],propTypes:{clientLimit:da.number.isRequired,loading:da.bool.isRequired,onScrollBottom:da.func.isRequired,onThreadNotReady:da.func.isRequired,onThreadReady:da.func.isRequired,onThreadRelease:da.func.isRequired,onThreadView:da.func.isRequired,threads:da.instanceOf(y).isRequired,witIntents:da.instanceOf(y).isRequired},render:function(){var sa=this.props,ta=sa.loading,ua=sa.threads,va=sa.clientLimit;if(ta&&!ua.count())return t.createElement(z,null);return (t.createElement(m,{ref:'scrollable',onScroll:this._handleScroll},t.createElement('div',{className:"_3l5-"},ua.take(va).map(function(wa){return (t.createElement(o,{key:k.threadID(wa),thread:wa,witIntents:this.props.witIntents,onThreadNotReady:this.props.onThreadNotReady,onThreadReady:this.props.onThreadReady,onThreadRelease:this.props.onThreadRelease,onThreadView:this.props.onThreadView}));}.bind(this)).valueSeq()),t.createElement(aa,{loading:ta})));},_handleScroll:function(){var sa=this.refs.scrollable;sa&&sa.isScrolledToBottom()&&this.props.onScrollBottom();}}),ga=k.pure(function(sa){var ta,ua,va=sa.showTags,wa=sa.hideTags,xa=sa.onChange,ya=function(za){var ab=za.tagName,bb=za.value,cb=la({tagName:ab,value:bb,showTags:va,hideTags:wa});xa(cb);};return (t.createElement('div',{className:"_3l5_"},t.createElement(ha,{tagName:'employee',value:ka('employee',va,wa),onChange:ya,buttons:(ta={},ta[ka.NEUTRAL]=h.USER_FILTER_ALL,ta[ka.OFF]=h.USER_FILTER_PUBLIC,ta[ka.ON]=h.USER_FILTER_EMPLOYEE,ta)}),t.createElement(ha,{tagName:'ready',value:ka('ready',va,wa),onChange:ya,buttons:(ua={},ua[ka.NEUTRAL]=h.READY_FILTER_ALL,ua[ka.OFF]=h.READY_FILTER_ATTENTION,ua[ka.ON]=h.READY_FILTER_WAITING,ua)})));}),ha=k.pure(function(sa){var ta=sa.tagName,ua=sa.value,va=sa.buttons,wa=sa.onChange;return (t.createElement('div',{key:ta,className:"_3l60"},t.createElement(x,{selectedValue:ua,selectedUse:'confirm',onValueChange:function(xa){wa({tagName:ta,value:xa});}},Object.keys(va).map(function(xa){return t.createElement(w,{key:xa,value:xa,label:va[xa]});}))));});function ia(sa){return sa.sortBy(function(ta){return -ta.get('last-event-at');});}function ja(sa,ta){var ua=ta[0],va=ta[1];return sa.filter(function(wa){var xa=true;if(ua.size)xa=k.hasAllTags(wa,ua);if(va.size)xa=!k.hasSomeTag(wa,va);return xa;});}var ka=function(sa,ta,ua){return ta.has(sa)?ka.ON:ua.has(sa)?ka.OFF:ka.NEUTRAL;};ka.ON='on';ka.OFF='off';ka.NEUTRAL='neutral';function la(sa){var ta=sa.tagName,ua=sa.value,va=sa.showTags,wa=sa.hideTags,xa,ya;switch(ua){case ka.ON:xa=va.add(ta);ya=wa.remove(ta);break;case ka.OFF:xa=va.remove(ta);ya=wa.add(ta);break;default:xa=va.remove(ta);ya=wa.remove(ta);break;}return {showTags:xa,hideTags:ya};}var ma={},na={},oa=20,pa=2*oa;function qa(sa,ta){var ua=sa.toJS().join('-'),va=ta.toJS().join('-');return 'show['+ua+']hide['+va+']';}function ra(sa){var ta=sa[0],ua=sa[1],va=qa(ta,ua),wa=ma[va];k.debug('[oz-all] fetchThreads',va);if(wa){k.debug('[oz-all] abort fetchthreads : loading',va);return;}var xa=na[va]||0;ma[va]=true;r(i.allThreads(ta,ua,xa,pa),function(ya){return ma[va]=false;}).done(function(ya){return na[va]=xa+pa;});}f.exports=ea;},null);
__d('OzMessage.react',['cx','getURLRanges','OzHelpers','Image.react','immutable','Link.react','MNCommerceAgentItemSuggestionMercuryShareAttachment.react','ReactComponentWithPureRenderMixin','React','TextWithEntities.react','XStickerAssetController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=l.Map,t=l.List,u=p.PropTypes,v=p.createClass({displayName:'OzMessage',mixins:[o],propTypes:{message:u.instanceOf(s).isRequired},render:function(){var sa=this.props.message,ta=sa.get('attachments')||t(),ua=t([sa.get('text')&&qa(sa.get('text'))]).concat(ta.map(function(va){var wa=da(va)&&ea(va)||ka(va)&&ma(la(va))||ja(va)&&ma(va.get('uri'))||ha(va)&&ia(va)||fa(va)&&ga(va)||aa(va)&&ba(va)||w(va)&&z(y(va.get('metadata')))||x(va)&&z(j.uiSuggestion(va.get('suggestion')))||na(va)&&oa(va.getIn(['xma','link']))||va.get('uri')&&oa(va.get('uri'));if(wa){return wa;}else{j.error('could not render attachment',va.toJS(),sa.toJS());return ra('Oops. We could not render this attachment.');}})).filter(function(va){return !!va;}).map(function(va,wa){return p.createElement('frag',{key:wa},va);});if(ua.size){return p.createElement('span',null,ua);}else{j.error('no text or attachments',sa.toJS());return ra('Oops. We did not get text or attachments.');}}}),w=function(sa){return sa.hasIn(['metadata','target_url']);},x=function(sa){return sa.has('suggestion');},y=function(sa){if(!s.isMap(sa.get('total_cost'))&&sa.has('raw_amount'))sa=sa.set('total_cost',s({amount:+sa.get('raw_amount')}));return sa.update('target_url',j.shimURI).toJS();};function z(sa){return (p.createElement('div',{className:"_53qw"},p.createElement(n,{attachment:{target:sa}})));}var aa=function(sa){var ta=sa.get('metadata');return ta&&ta.get('location')&&ta.get('url')&&ta.get('image_url');};function ba(sa){return ma(sa.getIn(['metadata','image_url']),sa.getIn(['metadata','url']));}var ca=function(sa){var ta=sa.get('uri'),ua=sa.get('sticker_id');if(ua)ta=r.getURIBuilder().setInt('sticker_id',ua).getURI().toString();return ta;},da=function(sa){return sa.get('sticker_id')&&ca(sa);};function ea(sa){return (p.createElement(k,{className:"__vl",src:ca(sa)}));}var fa=function(sa){return (/video/.test(sa.get('mime_type'))&&sa.get('uri'));};function ga(sa){return (p.createElement('video',{controls:true,height:'300',width:'300'},p.createElement('source',{src:sa.get('uri'),type:sa.get('mime_type')})));}var ha=function(sa){return (/audio/.test(sa.get('mime_type'))&&sa.get('uri'));};function ia(sa){return (p.createElement('audio',{className:"_1d86",controls:true},p.createElement('source',{src:sa.get('uri'),type:sa.get('mime_type')})));}var ja=function(sa){var ta=/blob:/.test(sa.get('uri')),ua=/\.(jpg|gif|png)/.test(sa.get('uri'));return sa.get('uri')&&(j.isImageType(sa.get('mime_type'))||ta||ua);},ka=function(sa){return (/base64/.test(sa.get('mime_type'))&&sa.get('data'));},la=function(sa){return sa.get('mime_type')+','+sa.get('data');};function ma(sa,ta){return (p.createElement('a',{href:ta||sa,target:'_blank',className:"_4y6l",style:{backgroundImage:'url(\''+sa+'\')'}}));}var na=function(sa){return !!sa.getIn(['xma','link']);};function oa(sa){return (p.createElement('div',{className:"_4y6k"},p.createElement('a',{href:sa,target:'_blank'},'Attachment Link')));}function pa(sa,ta){return (p.createElement(m,{target:'_blank',href:j.shimURI(ta.entity.url)},sa));}function qa(sa){return (p.createElement(q,{className:"_4y6k",text:sa,interpolator:pa,ranges:i(sa),renderEmoticons:true,renderEmoji:true}));}function ra(sa){return (p.createElement('div',{className:"_4y6k _5kng"},sa));}f.exports=v;},null);
__d('OzSearchSource',['AbstractSearchSource'],function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,h);j=i&&i.prototype;function k(l){'use strict';j.constructor.call(this);this.$OzSearchSource1=l;}k.prototype.bootstrap=function(){'use strict';return this.$OzSearchSource1({});};k.prototype.suggest=function(l){'use strict';return this.$OzSearchSource1(l);};k.prototype.searchImpl=function(l,m){'use strict';return this.$OzSearchSource1({query:l}).then(function(n){return m(n,l);},function(n){return m([],l);});};f.exports=k;},null);
__d('OzFeedbackDashboard.react',['Promise','OzAPI','cx','OzHelpers','immutable','OzButton.react','OzConfig','OzMessage.react','OzSearchSource','ReactComponentWithPureRenderMixin','React','ReactRouter_DEPRECATED','SearchableDropdownInput.contrib','SearchableEntry','Stars.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=l.Map,x=r.PropTypes,y=r.createClass({displayName:'OzFeedbackDashboard',mixins:[s.Navigation,q],propTypes:{reps:x.instanceOf(w).isRequired},contextTypes:{uid:x.string.isRequired},getInitialState:function(){return {messages:w(),authorID:this.context.uid};},componentWillMount:function(){this._searchSource=new p(function(oa){var pa=(oa.query||'').toLowerCase();return new h(function(qa){return qa(this.props.reps.valueSeq().map(ga).concat([ga('autoresponse-bot'),ga('survey-bot')]).sortBy(function(ra){return ra.getTitle();}).filter(function(ra){return (ra.getTitle()||'').toLowerCase().indexOf(pa)>-1;}).toJS());}.bind(this));}.bind(this));},componentDidMount:function(){this._fetchFeedback();},render:function(){return (r.createElement('div',{className:"_60f"},n.GK.supervisor?r.createElement(z,{reps:this.props.reps,authorID:this.state.authorID,searchSource:this._searchSource,onSelect:function(oa){return this.setState({messages:w(),activeMessage:null,authorID:oa.getUniqueID()},this._fetchFeedback);}.bind(this)}):null,r.createElement(aa,{messages:this.state.messages}),r.createElement(da,{messages:this.state.messages,reps:this.props.reps,activeMessage:this.state.activeMessage||this.state.messages.first(),onMessageClick:function(oa){return this.setState({activeMessage:oa});}.bind(this),onSeeThreadClick:function(oa){return this.transitionTo('inbox/show',{threadid:oa});}.bind(this)})));},_fetchFeedback:function(){i.authorFeedback(this.state.authorID).done(function(oa){oa=oa.sortBy(function(pa){return -pa.get('timestamp');});this.isMounted()&&this.setState({messages:oa});}.bind(this));}}),z=k.pure(function(oa){var pa=oa.reps,qa=oa.authorID,ra=oa.searchSource,sa=oa.onSelect;return (r.createElement('div',{className:"_5p66"},r.createElement('div',{className:"_wa_"},r.createElement(t,{value:ga(pa.get(qa)||qa),onSelect:sa,placeholder:'Pick a rep',emptySearchResultsText:'No Rep found',searchSource:ra}))));}),aa=k.pure(function(oa){var pa=oa.messages,qa=na(pa,-7,0),ra=na(pa,-14,-7);return (r.createElement('div',{className:"_wb0"},r.createElement('div',{className:"_wb1"},r.createElement(ba,{label:'OVERALL RATING'},ma(qa),'%'),r.createElement(ba,{label:'SINCE LAST WEEK'},r.createElement(ca,{value:ma(qa)-ma(ra)}))),r.createElement('div',{className:"_wb2"},r.createElement(ba,{label:'TONE'},ka(qa),'%'),r.createElement(ba,{label:'RESPONSIVENESS'},ja(qa),'%'),r.createElement(ba,{label:'EXECUTION'},ia(qa),'%'),r.createElement(ba,{label:'POLICY'},la(qa),'%')),r.createElement('div',{className:"_3gch"},r.createElement(ba,{label:'FEEDBACK GIVEN LAST WEEK'},qa.size))));}),ba=k.pure(function(oa){var pa=oa.label,qa=oa.children;return (r.createElement('div',{className:"_wb3"},r.createElement('span',{className:"_wb4"},qa),r.createElement('span',{className:"_wb5"},pa)));}),ca=k.pure(function(oa){var pa=oa.value;return (r.createElement('div',{className:(pa>0?"_wb6":'')+(pa<0?' '+"_wb7":'')},pa>0?'+':null,pa,'%'));}),da=k.pure(function(oa){var pa=oa.messages,qa=oa.reps,ra=oa.activeMessage,sa=oa.onMessageClick,ta=oa.onSeeThreadClick,ua=ra&&ra.get('reviews'),va=ra&&ra.get('user-id');return (r.createElement('div',{className:"_wb8"},r.createElement('div',{className:"_wbc"},r.createElement('div',{className:"_4fj7"},pa.map(function(wa){return (r.createElement('div',{key:k.msgID(wa),onClick:function(xa){return sa(wa);},className:"_wbf"+(wa===ra?' '+"_wbg":'')},r.createElement(o,{message:wa})));}).valueSeq())),r.createElement('div',{className:"_wbh"},r.createElement('div',{className:"_wbe"},ua?ua.map(function(wa){return (r.createElement(ea,{key:wa.get('id'),rep:qa.get(wa.get('reviewer-id')),review:wa}));}).valueSeq():null)),r.createElement('div',{className:"_wbi"},va?r.createElement(m,{onClick:function(wa){return ta(va);}},'See Thread'):null)));}),ea=k.pure(function(oa){var pa=oa.review,qa=oa.rep;return (r.createElement('div',{className:"_wbj"},r.createElement('div',{className:"_wbk"},r.createElement('h2',{className:"_wbl"},qa&&qa.get('name')),pa.has('tone')?r.createElement(fa,{label:'Tone'},r.createElement(v,{count:pa.get('tone'),max:3,size:'large'})):null,pa.has('responsiveness')?r.createElement(fa,{label:'Responsiveness'},r.createElement(v,{count:pa.get('responsiveness'),max:3,size:'large'})):null,pa.has('execution')?r.createElement(fa,{label:'Execution'},r.createElement(v,{count:pa.get('execution'),max:3,size:'large'})):null,pa.has('followed-policy')?r.createElement(fa,{label:'Followed Policy?'},r.createElement('div',{className:"_wbm"},pa.get('followed-policy')?'YES':'NO')):null),r.createElement('div',{className:"_wbn"},pa.get('body'))));}),fa=k.pure(function(oa){var pa=oa.label,qa=oa.children;return (r.createElement('div',{className:"_wbo"},qa,r.createElement('div',{className:"_wbp"},pa)));});function ga(oa){var pa=function(qa){return new u(qa);};return oa?oa.get?pa({title:oa.get('name'),uniqueID:oa.get('fbid')}):pa({title:oa,uniqueID:oa}):null;}function ha(oa,pa){return function(qa){var ra=qa.valueSeq().flatMap(function(va){return va.get('reviews');}).filter(function(va){return va&&va.has(oa);}),sa=ra.reduce(function(va,wa){var xa=va[0],ya=va[1];return [xa+pa,ya+wa.get(oa)];},[0,0]),ta=sa[0],ua=sa[1];return ta?Math.round(ua/ta*100):0;};}var ia=ha('execution',3),ja=ha('responsiveness',3),ka=ha('tone',3),la=ha('followed-policy',1);function ma(oa){return Math.round((ja(oa)+ka(oa)+la(oa)+ia(oa))/4);}function na(oa,pa,qa){var ra=new Date().getDate(),sa=+new Date(Date.now()).setDate(ra+pa),ta=+new Date(Date.now()).setDate(ra+qa);return oa.filter(function(ua){var va=+ua.get('timestamp');return va>=sa&&va<=ta;});}f.exports=y;},null);
__d('OzInboxThreadRow.react',['OzHelpers','cx','immutable','OzLastEvent.react','OzThreadLabels.react','OzUserImage.react','ReactComponentWithPureRenderMixin','React','Timestamp.react','Tooltip'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=j.Map,s=l.OzLabelList,t=o.PropTypes,u=o.createClass({displayName:'OzInboxThreadRow',mixins:[n],propTypes:{thread:t.object.isRequired,locker:t.object.isRequired,selected:t.bool.isRequired,onClick:t.func.isRequired,onUnview:t.func.isRequired,witIntents:t.instanceOf(r).isRequired},contextTypes:{uid:t.string.isRequired},render:function(){var x=this.props,y=x.thread,z=x.locker,aa=x.selected,ba=x.subscribed,ca=x.owned,da=x.onUnview,ea=h.getName(y),fa=h.photo(y),ga=h.lastEvents(y).last(),ha=!ca&&y.get('ui-reassign'),ia=h.hasPaid(y),ja=h.hasReminder(y),ka=y.get('locked'),la=ka?'Thread locked by '+z.get('name')+'\n       at '+new Date(y.get('locked-at')).toLocaleString():'',ma=ca&&(y.get('ready')||ia||ja)&&!ka,na=null,oa=ca&&y.get('ui-ping')&&!y.get('ui-reassign'),pa=ga&&ga.get('timestamp');if(!ca){var qa=y.get('ui-reassign')?'Reassigned to':'Grabbed by';na=qa+' '+h.nameOrId(y.get('owner'));}return (o.createElement('div',{onClick:this._handleClick,className:(oa?"_2q49":'')+(' '+"_2ic2")+(ma?' '+"_2ic3":'')+(ja?' '+"_2ic5":'')+(ia?' '+"_2ic6":'')+(aa?' '+"_2ic7":'')+(ha?' '+"_2q4a":'')},o.createElement('div',{className:"_2ic8"},o.createElement(m,{photo:fa}),ba?o.createElement('button',{className:"_1-hv _2ic9",onClick:function(ra){return da(y);}}):null),o.createElement('div',{className:"_2ica"},!ca?o.createElement(v,{name:na}):null,o.createElement('h1',{className:"_4-_7 _2ice"},ea),o.createElement(w,{thread:y,witIntents:this.props.witIntents}),o.createElement('div',{className:"_2icb"},ga?o.createElement(k,{lastEvent:ga,name:ea}):null),o.createElement('div',{className:"_3lxn"},o.createElement(s,{className:"_2icc",thread:y}))),o.createElement('div',{className:"_6f"},pa?o.createElement('div',{className:"_2icf"},o.createElement(p,{autoUpdate:true,shorten:true,time:pa/1000})):null,o.createElement('div',babelHelpers['extends']({className:ka?"_1hw":''},q.propsFor(la))))));},_handleClick:function(){this.props.onClick(this.props.thread);}});function v(x){var y=x.name,z=x.lastEvent,aa=z&&z.get('timestamp');return (o.createElement('div',{className:"_2icd"},o.createElement('h1',{className:"_4-_7 _2ice"},y),aa?o.createElement('div',{className:"_2icf"},o.createElement(p,{autoUpdate:true,shorten:true,time:aa/1000})):null));}function w(x){var y=x.thread,z=x.witIntents,aa=h.openIntents(y).first(),ba=aa&&z.getIn([aa.get('wit-intent-uuid'),'name']);return ba?o.createElement('div',{className:"_2icg"},ba):o.createElement('span',null);}f.exports=u;},null);
__d('OzInboxThreadList.react',['cx','OzHelpers','joinClasses','OzInboxThreadRow.react','immutable','OzLoading.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=l.Map,q=l.OrderedMap,r=o.PropTypes,s=m.Inline,t=o.createClass({displayName:'OzInboxThreadList',mixins:[n],contextTypes:{uid:r.string.isRequired},propTypes:{loading:r.bool.isRequired,onThreadClick:r.func.isRequired,onUnview:r.func.isRequired,threadGroups:r.instanceOf(q).isRequired,witIntents:r.instanceOf(p).isRequired,className:r.string,selectedThread:r.string},render:function(){return (o.createElement('div',{className:j("_36ob",this.props.className)},this.props.threadGroups.map(this._renderRows).valueSeq(),this.props.threadGroups.some(function(v){return v.count();})?o.createElement(s,{key:'l',loading:this.props.loading}):o.createElement(u,null)));},_renderRows:function(v,w){var x=v.map(function(y){return (o.createElement(k,{key:i.threadID(y),thread:y,locker:this.props.reps.get(y.get('locker-id'),p()),owned:i.isOwner(y,this.context.uid),selected:i.threadID(y)===this.props.selectedThread,subscribed:i.isSubscriber(y,this.context.uid),onClick:this.props.onThreadClick,onUnview:this.props.onUnview,witIntents:this.props.witIntents}));}.bind(this)).valueSeq();return (o.createElement('span',{className:"_36oc",key:w},x));}});function u(){return (o.createElement('div',{className:"_725"},'You do not own any threads at the moment.',o.createElement('br',null)));}f.exports=t;},null);
__d('OzTabHeader.react',['cx','React'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k){var l=k.tabs,m=k.onChange,n=k.active;return (i.createElement('div',{className:"_2j6l"},l.map(function(o){var p=o[0],q=o[1];return (i.createElement('button',{key:q,role:'button',className:"_1-hv"+(' '+"_2j6m")+(q===n?' '+"_2j6n":''),onClick:function(r){return m([p,q]);}},p));})));}f.exports=j;},null);
__d('OzInbox.react',['OzAPI','cx','OzHelpers','DataTransfer','immutable','OzActions','OzInboxThreadList.react','OzInboxThreads','OzStores','OzTabHeader.react','ReactComponentWithPureRenderMixin','React','Reflux','ReactRouter_DEPRECATED','promiseFinally'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=l.Map,x=l.OrderedMap,y=l.List,z=p.HandledEventsStore,aa=p.HumanStore,ba=p.ThreadStore,ca=s.PropTypes,da=u.RouteHandler,ea=o.OZ_GRABBED_TAB,fa=o.OZ_VIEWING_TAB,ga=o.OZ_PAST_TAB,ha=5000,ia=30000,ja=120*1000,ka=ea,la=s.createClass({displayName:'OzInbox',mixins:[t.connect(ba,'threads'),t.connect(aa,'humans'),t.connect(z,'handledEvents'),u.State,u.Navigation],propTypes:{requirements:ca.instanceOf(w).isRequired,witIntents:ca.instanceOf(w).isRequired,merchants:ca.instanceOf(w).isRequired,reps:ca.instanceOf(w).isRequired},contextTypes:{uid:ca.string.isRequired},getInitialState:function(){return {activeTab:null,loading:false};},componentDidMount:function(){this._fetchThreads();var ra=window.setInterval(function(ta){var ua=Date.now()-ba.updatedAt;if(ua>ja){j.warn('[oz] last thread update > '+ja);this._fetchThreads();}}.bind(this),ia),sa=window.setInterval(function(){var ta=this.threads(this._getActiveTab());if(ta.some(function(ua){return ua.get('ui-reassign');}))m.clearReassignState();}.bind(this),ha);this._cleanup=function(){ka=this._getActiveTab();window.clearInterval(sa);window.clearInterval(ra);}.bind(this);},componentDidUpdate:function(ra,sa){var ta=this.getParams().threadid;if(ta){var ua=!!this.state.threads.get(ta);j.debug('[ozinbox] tid='+ta+' hasThread='+ua);ua||na(ta);}else{var va=this.threads(),wa=p.ActiveThreadStore.data.get('oldThreadID'),xa=va.get(wa)||va.first();j.debug('[ozinbox] search for best thread, found:',xa);if(xa)this.transitionTo('inbox/show',{threadid:j.threadID(xa)});}},componentWillUnmount:function(){this._cleanup();},render:function(){var ra=this._getActiveTab(),sa=this.threads(ra),ta=this.state.humans.getIn([this.context.uid,'load'],0),ua=function(va){return va.preventDefault();};return (s.createElement('div',{className:"_4b5_",onDragStart:ua,onDragEnd:ua,onDragOver:ua,onDrop:function(va){ua(va);var wa=new k(va.nativeEvent.dataTransfer);m.updateComposer({files:wa.getFiles()});}},s.createElement(ma,{threadGroups:pa(sa,this.context.uid,ra),reps:this.props.reps,loading:this.state.loading,activeCount:ta,activeTab:ra,selectedThread:this.getParams().threadid,onTabChange:this._handleTabChange,onUnview:this._handleUnview,onThreadClick:this._handleThreadClick,witIntents:this.props.witIntents}),this._renderDetails()));},_getActiveTab:function(){var ra=this.state.threads.get(this.getParams().threadid);return this.state.activeTab||ra&&j.isOwner(ra,this.context.uid)&&ea||ra&&j.isSubscriber(ra,this.context.uid)&&fa||ka||ea;},_handleUnview:function(ra){this._callAPIAndShift('unview',ra);},_handleThreadClick:function(ra){this.transitionTo('inbox/show',{threadid:j.threadID(ra)});},_handleTabChange:function(ra){var sa=ra[0],ta=ra[1];this.setState({activeTab:ta});},_callAPIAndShift:function(ra,sa){var ta=oa(this.threads(ea),sa),ua=function(wa){this.transitionTo('inbox/show',{threadid:j.threadID(wa)});}.bind(this),va=h[ra](j.threadID(sa));ta&&ua(ta);va.done(null,function(wa){j.error('[inbox] could not shift',wa);ua(sa);});},_renderDetails:function(){var ra=this.getParams(),sa=ra.threadid;if(this.threads().isEmpty())return this._renderFinished();var ta=j.fullThreadData(this.state.threads,this.state.handledEvents,sa);if(!ta)return null;return (s.createElement(da,{thread:ta,witIntents:this.props.witIntents,requirements:this.props.requirements,merchants:this.props.merchants,humans:this.state.humans,reps:this.props.reps}));},_renderFinished:function(){return (s.createElement('div',{className:"_57l3"},s.createElement('div',{className:"_57l8"},s.createElement('div',{className:"_57lo"}),s.createElement('h2',null,'Congrats! You\'ve made a lot of people happy'),s.createElement('p',null,'Sit tight, new messages should be coming soon!'))));},_fetchThreads:function(){var ra=this.state.loading;if(ra)return;this.setState({loading:true});v(h.myThreads(),function(sa){return this.isMounted()&&this.setState({loading:false});}.bind(this)).done();},threads:function(ra){return o.getInboxThreads(this.state.threads,this.context.uid,ra);}}),ma=s.createClass({displayName:'OzThreadListPanel',mixins:[r],propTypes:babelHelpers['extends']({activeTab:ca.oneOf([ea,fa,ga]).isRequired,onTabChange:ca.func.isRequired},n.propTypes),render:function(){var ra=this.props,sa=ra.activeTab,ta=ra.onTabChange,ua=ra.activeCount,va=babelHelpers.objectWithoutProperties(ra,['activeTab','onTabChange','activeCount']),wa=ua?'Open ('+ua+')':'Open';return (s.createElement('div',{className:"_4b61"},s.createElement('div',{className:"_4cwh"},s.createElement(q,{active:sa,tabs:[[wa,ea],['Viewing',fa],['Closed',ga]],onChange:ta})),s.createElement('div',{className:"_3_cz"},s.createElement('div',{className:"_4fj7"},s.createElement(n,babelHelpers['extends']({className:sa===ea?"_2sav":''},va))))));}}),na=j.memoize(h.thread,function(ra){return ra;});function oa(ra,sa){var ta=j.threadID(sa),ua=ra.toList(),va=ua.findIndex(function(ya){return j.threadID(ya)===ta;}),wa=va-1,xa=va+1;if(xa<ua.count()){return ua.get(xa);}else if(wa>=0)return ua.get(wa);}function pa(ra,sa,ta){var ua;switch(ta){case ea:return qa(ra,sa,ta);default:return x((ua={},ua[ta]=ra,ua));}}function qa(ra,sa,ta){var ua='Needs Attention',va='Up For Grabs',wa='Waiting',xa=function(ya){var za=j.isOwner(ya,sa),ab=ya.get('ready'),bb=j.isLocker(ya,sa),cb=j.hasOpenIntents(ya);return za&&(bb||ab&&cb)?ua:ab?va:wa;};return x().withMutations(function(ya){ya.set(ua,[]);ya.set(va,[]);ya.set(wa,[]);ra.forEach(function(za){return ya.update(xa(za),function(ab){ab.push(za);return ab;});});}).map(function(ya){return y(ya);});}f.exports=la;},null);
__d('OzPhotoCropper.react',['cx','OzHelpers','BasicVector','Photocrop2','React'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=l.PropTypes,n=l.createClass({displayName:'OzPhotoCropper',propTypes:{src:m.string.isRequired},getInitialState:function(){return {imageSize:null};},componentDidMount:function(){this._image=new Image();this._image.src=this.props.src;this._image.onload=function(o){var p=new j(this._image.width,this._image.height);this.setState({imageSize:p});this._photocrop=new k(this.refs.img,{},p);}.bind(this);},componentWillUnmount:function(){this._image=null;},render:function(){return (l.createElement('div',{className:"_3x2x"},l.createElement('canvas',{ref:'canvas',style:{display:'none'}}),l.createElement('img',{src:this.props.src,ref:'img',className:"_3x2y"})));},finalizeCrop:function(o){var p=this.refs.canvas,q=this._photocrop.done(o),r=q.x,s=q.y,t=q.height,u=q.width;p.width=u;p.height=t;p.getContext('2d').drawImage(this._image,Math.max(0,r),Math.max(0,s),u,t,0,0,u,t);return i.blobFromDataURI(p.toDataURL());}});f.exports=n;},null);
__d('OzAttachmentCropper.react',['OzHelpers','DialogFitHeight','immutable','OzPhotoCropper.react','ReactComponentWithPureRenderMixin','React','XUIButton.react','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogTitle.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=j.Map,t=j.OrderedMap,u=m.PropTypes,v=m.createClass({displayName:'OzAttachmentCropper',mixins:[l],propTypes:{attachment:u.instanceOf(s).isRequired,onSave:u.func.isRequired,onClose:u.func.isRequired},_handleSubmit:function(){var w=this.props,x=w.attachment,y=w.onSave,z=this.refs.photoCropper.finalizeCrop();y(x.set('ui-blob',z));},render:function(){return (m.createElement(o,{behaviors:{DialogFitHeight:i},onToggle:this.props.onClose,shown:true,width:900},m.createElement(r,null,m.createElement('span',null,'Crop tool')),m.createElement(p,null,m.createElement(k,{src:h.blobURI(this.props.attachment.get('ui-blob')),ref:'photoCropper'})),m.createElement(q,null,m.createElement(n,{onClick:this._handleSubmit,label:'Crop'}))));}});f.exports=v;},null);
__d('OzAttachmentOverlay.react',['cx','joinClasses','OzLoading.react','ReactComponentWithPureRenderMixin','React','XUICloseButton.react','XUIEditButton.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=l.PropTypes,p=l.createClass({displayName:'OzAttachmentOverlay',mixins:[k],propTypes:{onClick:o.func,onEdit:o.func,onRemove:o.func,loading:o.bool},render:function(){var q=this.props,r=q.onClick,s=q.onEdit,t=q.onRemove,u=q.loading;return (l.createElement('div',{className:i(this.props.className,"_18wc")},u?l.createElement(j,null):null,l.createElement('div',{className:"_4xe8",onClick:r},s?l.createElement(n,{className:"_1yll",type:'button',size:'medium',title:'Add Image',onClick:this._handleEdit}):null,t?l.createElement(m,{type:'button',className:"_1ylm",size:'medium',shade:'dark',onClick:this._handleRemove}):null),this.props.children));},_handleEdit:function(q){q.stopPropagation();this.props.onEdit&&this.props.onEdit();},_handleRemove:function(q){q.stopPropagation();this.props.onRemove&&this.props.onRemove();}});f.exports=p;},null);
__d('OzBubbleImageSelector.react',['Image.react','immutable','OzAttachmentOverlay.react','ReactComponentWithPureRenderMixin','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=i.List,o=l.PropTypes,p=l.createClass({displayName:'OzBubbleImageSelector',mixins:[k],propTypes:{onImageAdd:o.func.isRequired,onImageSelect:o.func.isRequired,selectedURI:o.string,thumbURIs:o.instanceOf(n).isRequired},render:function(){var r=this.props,s=r.onImageSelect,t=r.selectedURI,u=r.thumbURIs;return (l.createElement('div',{className:"_1-i2"},u.map(function(v,w){return (l.createElement(q,{index:w,isSelected:v===t,key:w,onSelect:s,uri:v}));}),this._renderAddButton()));},_renderAddButton:function(){return (l.createElement('button',{type:'button',className:"_1-hv _1-i4",onClick:this.props.onImageAdd},'+'));}}),q=l.createClass({displayName:'Thumbnail',mixins:[k],propTypes:{index:o.number.isRequired,isSelected:o.bool.isRequired,uri:o.string.isRequired},render:function(){return (l.createElement(j,{className:this.props.isSelected?"_4-8e":'',onClick:this._handleSelect},l.createElement(h,{src:this.props.uri,className:"_1-i3",alt:'image thumb'})));},_handleSelect:function(){this.props.onSelect(this.props.uri);}});f.exports=p;},null);
__d('OzFormPreview.react',['cx','OzHelpers','React'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=i.pure(function(m){var n=m.children;return (j.createElement('div',{className:"_5bwr"},n));}),l=i.pure(function(m){var n=m.label,o=m.children;if(!o)return null;return (j.createElement('div',{className:"_5bws _5bwt"},j.createElement('div',{className:"_5bwv"},n),j.createElement('div',{className:"_5bx2"},o)));});k.Row=l;f.exports=k;},null);
__d('OzBubblePreview.react',['OzAPI','cx','OzHelpers','formatDate','AdsCurrencyFormatter','immutable','MessengerButton.react','OzFormPreview.react','OzStores','ReactComponentWithPureRenderMixin','React','Reflux','TextWithHighlights.atlas','XUIContextualDialog.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v=m.Map,w=m.List,x=r.PropTypes,y=o.Row,z=p.AutopilotStore,aa=r.createClass({displayName:'OzBubblePreview',mixins:[q],propTypes:{bubble:x.instanceOf(v).isRequired,highlight:x.string,meta:x.instanceOf(v),source:x.string},render:function(){return va(this.props)?r.createElement(fa,this.props):r.createElement(ba,this.props);}}),ba=j.pure(function(eb){var fb=eb.bubble,gb=eb.highlight,hb=null;if(Number.isSafeInteger(fb.get('amount')))hb=l.formatCurrencyFullFormat(fb.get('currency'),fb.get('amount'));return (r.createElement(qa,{thumbURL:fb.get('thumb-url')},r.createElement(sa,{text:fb.get('name'),highlight:gb}),r.createElement(ta,null,r.createElement(ua,{color:'grey',highlight:gb},fb.get('description')||'No Description')),r.createElement(ta,null,r.createElement(ua,null,fb.get('merchant-name')||'No Merchant')),r.createElement(ta,null,r.createElement(ua,{color:'blue',weight:'bold'},hb))));}),ca='__overviewTab',da='__hoursTab',ea='__moreInfoTab',fa=r.createClass({displayName:'PlacesPreview',mixins:[q,s.connect(z,'autopilot')],propTypes:{bubble:x.instanceOf(v).isRequired,meta:x.instanceOf(v).isRequired,highlight:x.string},getInitialState:function(){return {shown:false,activeTab:ca};},_makeOpentableRequest:function(eb,fb){var gb=bb(eb);if(gb){var hb=gb.getIn(['data','id']),ib=fb.get(hb);if(!ib)h.requestAutopilot(gb.toJS());}},componentWillMount:function(){this._makeOpentableRequest(this.props.meta,this.state.autopilot);window.clearTimeout(this.timeout);},componentWillReceiveProps:function(eb){var fb=eb.meta;if(cb(fb)!==cb(this.props.meta))this._makeOpentableRequest(fb,this.state.autopilot);},_handleToggle:function(eb){window.clearTimeout(this.timeout);var fb=function(gb){return this.setState({shown:eb});}.bind(this);eb?fb():this.timeout=window.setTimeout(fb,100);},render:function(){var eb=this.props,fb=eb.bubble,gb=eb.meta,hb=eb.highlight,ib=this.state,jb=ib.shown,kb=ib.activeTab,lb=ib.autopilot;return (r.createElement('div',{ref:'root',tabIndex:'0',onMouseEnter:function(mb){return this._handleToggle(true);}.bind(this),onMouseLeave:function(mb){return this._handleToggle(false);}.bind(this)},r.createElement(qa,{thumbURL:fb.get('thumb-url')},r.createElement(sa,{text:fb.get('name'),highlight:hb}),r.createElement(ga,{rating:gb.get('rating')}),r.createElement(ta,null,r.createElement(ua,null,gb.get('cuisine')),' ',r.createElement(ua,null,gb.get('price'))),r.createElement(ta,null,r.createElement(ha,{meta:gb,autopilot:lb}))),r.createElement(ia,babelHelpers['extends']({activeTab:kb,contextRef:function(mb){return this.refs.root;}.bind(this),onTabChange:this._handleTabChange,shown:jb,onToggle:this._handleToggle,autopilot:lb},this.props))));},_handleTabChange:function(eb){this.setState({activeTab:eb});}}),ga=j.pure(function(eb){var fb=eb.rating;return fb?r.createElement(ta,null,r.createElement(ua,{weight:'500'},fb.get('value'),'/',fb.get('scale')),' ',r.createElement(ua,{color:'grey'},fb.get('rating-count')?'('+fb.get('rating-count')+' reviews)':null)):null;}),ha=j.pure(function(eb){var fb=eb.meta,gb=eb.autopilot,hb=bb(fb);if(!hb)return (r.createElement(ua,null,'No OT info'));var ib=gb.get(hb.getIn(['data','id']));if(!ib)return (r.createElement(ua,null,'Checking OT...'));if(ib.size===0)return (r.createElement(ua,{color:'red'},'No Tables Available!'));return (r.createElement(ua,null,'Table at ',za(fb,ib)));}),ia=j.pure(function(eb){var fb=eb.activeTab,gb=eb.contextRef,hb=eb.meta,ib=eb.onTabChange,jb=eb.onToggle,kb=eb.shown,lb=babelHelpers.objectWithoutProperties(eb,['activeTab','contextRef','meta','onTabChange','onToggle','shown']);return (r.createElement(u,{contextRef:gb,hoverHideDelay:0,position:'above',shown:kb,hasActionableContext:true},r.createElement('div',{className:"_53qb",onMouseEnter:function(mb){return jb(true);},onMouseLeave:function(mb){return jb(false);}},r.createElement('div',{className:"_c38"},r.createElement(ja,babelHelpers['extends']({meta:hb},lb)),r.createElement(pa,{tabs:[['Overview',ca],['Hours',da],['More Info',ea]],active:fb,onChange:ib})),r.createElement(ka,babelHelpers['extends']({activeTab:fb,meta:hb},lb)))));}),ja=j.pure(function(eb){var fb=eb.bubble,gb=eb.meta,hb=eb.highlight;return (r.createElement('div',{className:"_53qc"},r.createElement(ra,{url:fb.get('thumb-url')}),r.createElement('div',{className:"_53qd"},r.createElement(sa,{text:fb.get('name'),highlight:hb}),r.createElement(ga,{rating:gb.get('rating')}),r.createElement(ta,null,r.createElement(ua,null,gb.get('cuisine'))),r.createElement(ta,null,r.createElement(ua,null,gb.get('price'))))));}),ka=j.pure(function(eb){var fb=eb.activeTab,gb=babelHelpers.objectWithoutProperties(eb,['activeTab']);return (r.createElement('div',{className:"_53qe"},fb===ca&&r.createElement(la,gb)||fb===da&&r.createElement(na,gb)||fb===ea&&r.createElement(oa,gb)||null));}),la=j.pure(function(eb){var fb=eb.bubble,gb=eb.highlight,hb=eb.meta,ib=eb.autopilot,jb=(hb.getIn(['address','street'],'')+'\n     '+hb.getIn(['address','city'],'')+'\n    ').trim();return (r.createElement(o,null,r.createElement(y,{label:'Address'},jb),r.createElement(y,{label:'Phone'},ma(fb,hb)),r.createElement(y,{label:'Website'},r.createElement('a',{href:fb.get('target-url'),target:'_blank'},'Link')),r.createElement(y,{label:'OpenTable'},wa(hb,ib)),r.createElement(y,{label:'Description'},fb.get('description'))));}),ma=function(eb,fb){var gb=fb.get('phone');return gb?r.createElement(ua,{weight:'bold'},j.parsePhoneNumber(gb)):null;},na=j.pure(function(eb){var fb=eb.meta;return (r.createElement(o,null,ya(fb.get('hours')||w()).map(function(gb,hb){return r.createElement(y,{key:hb,label:hb},gb);}).valueSeq()));}),oa=j.pure(function(eb){var fb=eb.bubble,gb=eb.meta,hb=gb.get('payment'),ib=gb.get('infos');if(hb&&hb.size||ib&&ib.size){var jb=function(){var kb=function(lb){return lb[0].toUpperCase()+lb.slice(1).toLowerCase();};return {v:r.createElement(o,null,ib.map(function(lb,mb){return (r.createElement(y,{label:kb(mb),key:mb},lb));}).toList(),hb?r.createElement(y,{label:'Payments'},hb.map(kb).toJS().join(', ')):null)};}();if(typeof jb==="object")return jb.v;}else return r.createElement('div',null,'No additional info for this place...');}),pa=j.pure(function(eb){var fb=eb.tabs,gb=eb.onChange,hb=eb.active;return (r.createElement('div',{className:"_c39"},fb.map(function(ib){var jb=ib[0],kb=ib[1],lb=kb===hb?{weight:'bold',color:'blue'}:{color:'grey'};return (r.createElement('button',{key:kb,role:'button',className:"_1-hv",onClick:function(mb){return gb(kb);}},r.createElement(ua,lb,jb)));})));}),qa=j.pure(function(eb){var fb=eb.children,gb=eb.thumbURL;return (r.createElement('div',{className:"_1q15 _5rxk"},r.createElement(ra,{url:gb}),r.createElement('div',{className:"_1q17"},fb)));}),ra=j.pure(function(eb){var fb=eb.url;return fb?r.createElement('div',{className:"_1q16",style:{backgroundImage:'url(\''+fb+'\')'}}):null;}),sa=j.pure(function(eb){var fb=eb.text,gb=eb.highlight;return (r.createElement(ta,null,r.createElement(ua,{weight:'bold',highlight:gb},fb||'No Title')));}),ta=j.pure(function(eb){var fb=eb.children;return (r.createElement('div',{className:"_4-_7 _5rxl"},fb));}),ua=j.pure(function(eb){var fb=eb.children,gb=eb.color,hb=eb.highlight,ib=eb.size,jb=eb.weight,kb=jb===undefined?'normal':jb;return fb?r.createElement('span',{className:"_5rxm"+(ib==='large'?' '+"_5rxn":'')+(gb==='blue'?' '+"_5ryf":'')+(gb==='grey'?' '+"_5ryk":'')+(gb==='red'?' '+"_5emd":'')+(gb==='green'?' '+"_5emf":''),style:{fontWeight:kb}},hb?r.createElement(t,{text:fb,highlight:hb}):fb):null;});function va(eb){var fb=eb.meta,gb=eb.source;return gb==='places'&&fb;}function wa(eb,fb){var gb=eb.get('open-table');if(gb){var hb=fb.get(cb(eb));if(hb){var ib;if(hb.size===0){ib=r.createElement(ua,{color:'red'},'No tables available!');}else ib=r.createElement(ua,null,'Tables available at '+db(hb));}return (r.createElement('div',null,r.createElement('a',{href:gb.get('url'),target:'_blank'},'Link (',gb.get('area'),')'),r.createElement('br',null),ib));}}var xa=w(['Sun','Mon','Tues','Wed','Thurs','Fri','Sat']);function ya(eb){var fb=function(){var kb=new Date(j.serverNow());kb.setHours(0,0,0,0);kb.setDate(kb.getDate()-kb.getDay()+1);return +kb;},gb=fb(),hb=function(kb){return new Date(gb+kb*60*1000);},ib=function(kb){return k(kb,'h:i A',{skipPatternLocalization:true});},jb=function(kb){return kb.map(ib).join(' - ');};return eb.map(function(kb){return kb.map(hb);}).groupBy(function(kb){return kb.get('start').getDay();}).mapKeys(function(kb){return xa.get(kb);}).map(function(kb){return kb.map(jb).join(', ');});}function za(eb,fb){var gb=function(ib){var jb=ib.split(':'),kb=jb[0],lb=jb[1];return parseInt(lb,10)+parseInt(kb,10)*60;},hb=gb(eb.getIn(['open-table','availability','data','hour']));return ab(fb.map(function(ib){return ib.get('hour');}).minBy(function(ib){return Math.abs(hb-gb(ib));}));}function ab(eb){var fb=eb.split(':'),gb=fb[0],hb=fb[1];gb=parseInt(gb,10);if(gb===0){return '12:'+hb+'AM';}else if(gb<12){return eb+'AM';}else if(gb===12){return eb+'PM';}else return gb-12+':'+hb+'PM';}function bb(eb){return eb.getIn(['open-table','availability']);}function cb(eb){return eb.getIn(['open-table','availability','data','id']);}function db(eb){return eb.map(function(fb){return ab(fb.get('hour'));}).toJS().join(', ');}f.exports=aa;},null);
__d('OzMerchantDialog.react',['cx','OzHelpers','immutable','Layout.react','MessengerDialog.react','MessengerDialogHeader.react','MessengerDialogTitle.react','OzActions','React','ReactDOM','XUIDatePicker.react','XUIError.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=k.Column,u=k.FillColumn,v=p.PropTypes,w=j.Map,x=j.Set,y=x(['name-dba','name-legal','website','phone','address','page-id','country','type','owner-name']),z=w({country:'US'}),aa=p.createClass({displayName:'OzMerchantDialog',propTypes:{onMerchant:v.func.isRequired,title:v.string,initialMerchant:v.instanceOf(w)},getDefaultProps:function(){return {title:"Create a merchant",initialMerchant:w()};},getInitialState:function(){var ba=this.props.initialMerchant,ca=z.filterNot(function(da,ea){return ba.get(ea);});return {inputs:ca,errors:w()};},componentDidMount:function(){var ba=q.findDOMNode(this.refs['name-dba']);ba&&ba.focus();},render:function(){return (p.createElement(l,{className:"_18w8",onToggle:this._handleToggle,ref:'dialog',type:'default',width:544},p.createElement(m,null,p.createElement(n,null,this.props.title)),this._renderFields(),p.createElement('div',null,this._renderDialogAction('Save',this._handleSave),this._renderDialogAction('Cancel',o.hideDialog))));},_renderDialogAction:function(ba,ca){return p.createElement('button',{onClick:ca,className:"_bx0 _3e2t _30yy"},ba);},_renderFields:function(){return (p.createElement('div',{className:"_374d _18w9"},this._renderTextField('name-dba','Name *'),this._renderTextField('name-legal','Legal Name'),this._renderTextField('website','Website'),this._renderTextField('phone','Phone'),this._renderTextField('address','Address'),this._renderTextField('page-id','Facebook Page Id'),this._renderTextField('country','Country *'),this._renderTextField('type','Business Type'),this._renderTextField('owner-name','Owner Name'),this._renderDateField('owner-birth-date','Owner Birth Date')));},_renderTextField:function(ba,ca){var da=this.props.initialMerchant,ea=this.state,fa=ea.inputs,ga=ea.errors;return (p.createElement(k,{key:ba},p.createElement(t,{className:"mrm _bx1"},ca),p.createElement(u,null,p.createElement(s,{xuiError:ga.get(ba)||null},p.createElement('input',{ref:ba,type:'text',className:"_7q5 _bx2",defaultValue:da.get(ba),value:fa.get(ba),onChange:function(ha){this.setState({inputs:fa.set(ba,ha.target.value),errors:w()});}.bind(this)})))));},_renderDateField:function(ba,ca){var da={},ea=this.props.initialMerchant,fa=ea.get('owner-birth-date');if(fa)da.initialTime=fa;return (p.createElement(k,{key:ba},p.createElement(t,{className:"mrm _bx1"},ca),p.createElement(t,null,p.createElement(r,babelHelpers['extends']({ref:ba,shouldSetDefaultDate:false},da)))));},_handleSave:function(){var ba=this._validateData();if(ba){ba.id=this.props.initialMerchant.get('id');this.props.onMerchant(ba);}},_handleToggle:function(ba){if(!ba)o.hideDialog();},_validateData:function(){var ba=w(),ca=this.props.initialMerchant,da=function(ga){var ha=this.state.inputs.get(ga,undefined);if(ha===undefined)return ca.get(ga);return ha||null;}.bind(this);ba=w(y.map(function(ga){return [ga,da(ga)];})).set('id',ca.get('id'));var ea=this.refs['owner-birth-date'].state.selectTime;ba=ba.set('owner-birth-date',ea);ba=i.normalizeMerchant(ba);var fa=i.validateMerchant(ba);this.setState({errors:fa});if(!fa.isEmpty())return null;return ba;}});f.exports=aa;},null);
__d('OzSetPicURLDialog.react',['cx','getURLRanges','OzHelpers','Image.react','Keys','MessengerDialog.react','MessengerDialogHeader.react','MessengerDialogTitle.react','ReactComponentWithPureRenderMixin','React','ReactDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=q.PropTypes,t=q.createClass({displayName:'OzSetPicURLDialog',mixins:[p],PropTypes:{onURL:s.func.isRequired,onEscape:s.func},componentDidMount:function(){var u=r.findDOMNode(this.refs.url);u&&u.focus();},getInitialState:function(){return {errors:[],url:''};},render:function(){return (q.createElement(m,{className:"_18w8",onToggle:this._handleToggle,ref:'dialog',type:'default',width:544},q.createElement(n,null,q.createElement(o,null,'Enter a URL for your picture')),this._renderImage(),this._renderErrors(),q.createElement('div',{className:"_374d _18w9"},q.createElement('input',{onChange:this._handleChange,onKeyDown:this._handleKeyDown,ref:'url',type:'text',className:"_7q5",placeholder:'URL to picture'})),q.createElement('div',{className:"_18wa"},'Press Enter when you\'re done.')));},_renderImage:function(){var u=this.state.url,v=this.state.errors||[];if(v.length>0||!u||u.length===0)return null;return (q.createElement(k,{className:"_24p-",src:u}));},_renderErrors:function(){var u=this.state.errors;if(!u||u.length===0)return null;return (q.createElement('div',{key:'errors',className:"_1yln"},u.map(function(v){var w=v[0],x=v[1];return (q.createElement('div',{key:w,className:"_1ylp"},x));})));},_handleChange:function(u){if(u.target.value.length&&!i(u.target.value).length){this.setState({errors:[['invalid_url','You must provide a valid uri']]});return;}var v=u.target.value.length?i(u.target.value)[0].entity.url:'';this.setState({errors:[],url:v});},_handleKeyDown:function(u){if(u.keyCode===l.ESC){var v=this.props.onEscape;if(v)v(u);return;}var w=this.state.errors||[];if(w.length===0&&u.keyCode===l.RETURN){u.preventDefault();var x=u.target.value.length?i(u.target.value)[0].entity.url:'';this.props.onURL(x);}return;},_handleToggle:function(){j.debug('[OzSetPicURLDialog] toggled',arguments);}});f.exports=t;},null);
__d('OzBubbleEditor.react',['Promise','OzAPI','cx','getURLRanges','OzHelpers','OzNotify','AdsCurrencyInput.react','immutable','Keys','OzActions','OzBubbleImageSelector.react','OzBubblePreview.react','OzConfig','OzMerchantDialog.react','OzSearchSource','OzSetPicURLDialog.react','ReactComponentWithPureRenderMixin','React','SearchableDropdownInput.contrib','SearchableEntry','XUICloseButton.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){if(c.__markCompiled)c.__markCompiled();var ca=o.List,da=o.Map,ea=y.PropTypes,fa=['thumb-url'],ga=['thumb-urls'],ha=ka('No Merchant'),ia=69,ja=y.createClass({displayName:'OzBubbleEditor',mixins:[x],propTypes:{merchants:ea.instanceOf(da).isRequired,seedBubble:ea.instanceOf(da).isRequired,onSave:ea.func.isRequired,onClose:ea.func.isRequired},getInitialState:function(){return {newData:da()};},componentWillMount:function(){this._searchSource=new v(function(oa){var pa=oa.query||'',qa=this.props.merchants.valueSeq().filter(function(ra){return ra.get('name-dba').toLowerCase().indexOf(pa.toLowerCase())>-1;}).map(function(ra){return ka(ra.get('name-dba'));}).take(15).toArray();return h.resolve(this._data().get('merchant-name')?[ha].concat(qa):qa);}.bind(this));},componentDidMount:function(){this.focus('Title');},focus:function(oa){this.refs[oa]&&this.refs[oa].focus&&this.refs[oa].focus();},render:function(){return (y.createElement('div',{className:"_1-ht"},y.createElement('div',{className:"_2zfj"},this._renderSection('Preview',this._renderPreview)),y.createElement('form',{className:"_2zfk",onKeyDown:function(oa){oa.keyCode===p.ESC&&this.props.onClose(this._bubble());}.bind(this),onSubmit:function(oa){oa.stopPropagation();oa.preventDefault();this._handleSubmit();}.bind(this)},y.createElement(ba,{className:"_1-hu",shade:'dark',size:'medium',onClick:function(oa){return this.props.onClose(this._bubble());}.bind(this)}),this._renderSection('Image',this._renderImage),this._renderSection('Title',this._renderInput.bind(this,['name'])),this._renderSection('Description',this._renderDescription),this._renderSection('URL',this._renderInput.bind(this,['target-url'])),this._renderSection('Merchant',this._renderMerchant),this._renderSection('Price',this._renderPrice),this._renderSubmit())));},_bubble:function(){return this.props.seedBubble.set('data',this._data()).deleteIn(['data','thumb-urls']);},_data:function(){var oa=this.state.newData.updateIn(ga,function(pa){var qa=this.props.seedBubble.getIn(['data'].concat(ga));return (qa||ca()).concat(pa);}.bind(this));return this.props.seedBubble.get('data').merge(oa);},_handleSubmit:function(){var oa=this._bubble(),pa=oa.get('data'),qa=[[pa.get('name'),'Please enter a title.'],[pa.get('expires-in')||!pa.get('expiration-time'),'Since this bubble is old, please re-enter the expiration time.'],[l.validateURL(pa.get('target-url')),'Please enter a valid url. Usually, you need to add "www."'],[l.validateURL(pa.get('thumb-url'))||!pa.get('thumb-url'),'Please enter a valid url for your image.'],[pa.get('merchant-name')||!pa.get('amount'),'You need to specify a merchant if you\'ve listed a price.'],[pa.get('amount')||!pa.get('expires-in'),'You need to list a price if you\'ve set an expiration time.']].filter(function(ra){var sa=ra[0],ta=ra[1];return !sa;}).map(function(ra){var sa=ra[0],ta=ra[1];return ta;});if(qa.length){m.error(qa[0]);return;}this.props.onSave(oa.updateIn(['data','target-url'],function(ra){return (k(ra)[0].entity.url);}));},_handleCreateMerchant:function(){q.showDialog(u,{onMerchant:function(oa){i.createMerchant(oa);var pa=this.state.newData.set('merchant-name',oa.get('name-dba'));this.setState({newData:pa});q.hideDialog();}.bind(this)});},_handleAddImage:function(){q.showDialog(w,{onEscape:function(oa){q.hideDialog();this.focus('Title');}.bind(this),onURL:function(oa){q.hideDialog();this.setState(function(pa){return {newData:na(pa.newData,oa)};});this.focus('Title');}.bind(this)});},_handleSelectImage:function(oa){this.setState(function(pa){return {newData:pa.newData.setIn(fa,oa)};});},_renderSubmit:function(){return (y.createElement('button',{type:'submit',className:"_1-hv _1-hw"},'DONE'));},_renderSection:function(oa,pa){return (y.createElement('div',{className:"_1-hx"},y.createElement('div',{className:"_1-hz",onClick:function(qa){return this.focus(oa);}.bind(this)},oa),y.createElement('div',{className:"_1-h-"},pa(oa))));},_renderPrice:function(oa){var pa=this._data(),qa=pa.get('currency'),ra=pa.get('amount');return (y.createElement('div',{className:"_1-h_"},y.createElement(n,{placeholder:'(optional)',currency:qa||'USD',value:Number.isSafeInteger(ra)?ra:null,onDataUpdate:function(sa){this.setState({newData:pa.set('amount',sa)});}.bind(this),eventType:'change'}),this._renderExpiration()));},_renderExpiration:function(){if(!t.GK.expirationDate)return null;return (y.createElement('div',{className:"_51w3"},y.createElement('div',{className:"_1-hz"},'Expiration Time:'),y.createElement(ma,{expiresIn:this._data().get('expires-in'),onChange:function(oa){return this.setState({newData:this.state.newData.set('expires-in',oa)});}.bind(this)})));},_renderInput:function(oa,pa){var qa=this.state.newData;return (y.createElement('input',{ref:pa,type:'text',className:"_1-i0 _1-i1",value:this._data().getIn(oa),onChange:function(ra){return this.setState({newData:qa.setIn(oa,ra.target.value)});}.bind(this)}));},_renderImage:function(){var oa=this._data(),pa=oa.getIn(fa),qa=la(oa,pa);return (y.createElement(r,{onImageAdd:this._handleAddImage,onImageSelect:this._handleSelectImage,selectedURI:pa,thumbURIs:qa}));},_renderMerchant:function(){var oa=this._data(),pa=oa.get('merchant-name'),qa=pa?ka(pa):null;return (y.createElement('div',{className:"_1-i5"},y.createElement('div',{className:"_1-i6"},y.createElement(z,{divClassName:"_1-i7",value:qa,onSelect:function(ra){var sa=ra.getUniqueID()===ha.getUniqueID()?null:ra.getTitle(),ta=this.state.newData.set('merchant-name',sa);this.setState({newData:ta});}.bind(this),emptySearchResultsText:'No merchants found. Click + to add',placeholder:'Pick a Merchant (optional)',searchSource:this._searchSource})),y.createElement('div',{onClick:this._handleCreateMerchant,className:"_1-hv _4nd4 _1-i8"})));},_renderPreview:function(){return (y.createElement(s,{bubble:this._data()}));},_renderDescription:function(){var oa=this._data(),pa=oa.get('description'),qa=pa&&pa.length>ia;return (y.createElement('div',null,y.createElement('input',{ref:'description',type:'text',className:"_1-i0 _1-i1",value:pa,onChange:function(ra){return this.setState({newData:oa.set('description',ra.target.value)});}.bind(this)}),y.createElement('text',{className:qa?"_353q":''},ia-(pa?pa.length:0)+' characters left')));}});function ka(oa){return new aa({title:oa,uniqueID:oa});}function la(oa,pa){return oa.getIn(ga,ca()).toOrderedSet().add(pa).toList().filter(function(qa){return qa;});}var ma=l.pure(function(oa){var pa=oa.expiresIn,qa=oa.onChange,ra="_1-i0 _3owv",sa=pa||da({hours:0,minutes:0}),ta=function(wa){return Math.max(+wa,0);},ua=function(wa){return qa(sa.merge(da(wa)));},va=function(wa,xa){return (sa.get(xa)===1?wa:wa+'s');};return (y.createElement('div',{className:"_51wb"},y.createElement('label',{className:"_1-hz"},y.createElement('input',{className:ra,onChange:function(wa){return ua({hours:ta(wa.target.value)});},type:'number',value:pa?pa.get('hours'):null}),va('hour','hours')),y.createElement('label',{className:"_1-hz"},y.createElement('input',{className:ra,onChange:function(wa){return ua({minutes:ta(wa.target.value)});},type:'number',value:pa?pa.get('minutes'):null}),va('minute','minutes'))));});function na(oa,pa){return oa.withMutations(function(qa){qa.updateIn(ga,ca(),function(ra){return ra.push(pa);});qa.setIn(fa,pa);});}f.exports=ja;},null);
__d('OzComposerAI.react',['ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','cx','OzHelpers','joinClasses','immutable','Image.react','LayerHideOnBlur','MessengerSpinner.react','OzBubblePreview.react','OzConstants','ReactComponentWithPureRenderMixin','React','TextWithHighlights.atlas','MessengerButton.react','formatDate','XUIContextualDialog.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();var y=m.Map,z=m.List,aa=r.ATTS,ba=t.PropTypes,ca=t.createClass({displayName:'OzComposerAIList',mixins:[s],propTypes:{filter:ba.string,items:ba.instanceOf(z).isRequired,onItemClick:ba.func.isRequired},getInitialState:function(){return {};},render:function(){var oa=this.props,pa=oa.items,qa=oa.filter,ra=oa.onItemClick,sa={filter:qa,onItemClick:ra};return (t.createElement('div',{className:"_4285"},pa.map(function(ta,ua){return (z.isList(ta)?t.createElement('div',{key:ua,className:"_2961"},ta.map(function(va,wa){return (t.createElement(ia,babelHelpers['extends']({key:wa,column:wa,line:ua,item:va},sa)));})):t.createElement(da,babelHelpers['extends']({key:ua,line:ua,item:ta,onToggleDebug:function(va){return this.setState({debugLine:this.state.debugLine===ua?null:ua});}.bind(this),debugShown:this.state.debugLine===ua},sa)));}.bind(this)).reverse()));}}),da=t.createClass({displayName:'ItemRow',mixins:[s],propTypes:{onToggleDebug:ba.func.isRequired,debugShown:ba.bool.isRequired},render:function(){var oa=this.props,pa=oa.item,qa=oa.line,ra=oa.onItemClick,sa=oa.filter,ta=y({line:qa,column:0}),ua=pa.get('id'),va=pa.get('at'),wa=k.getConfig('debugAI');return (t.createElement('div',{className:"_2962",onClick:function(xa){xa.preventDefault();ra(ta);}},na(pa)?t.createElement(ha,{label:'AUTO-SENDING',at:va}):null,t.createElement('div',{className:"_58jk",ref:'root'},t.createElement('div',{className:"_2964"},t.createElement(ka,{item:pa,filter:sa})),t.createElement('span',{className:"_58jl"},na(pa)?t.createElement(v,{type:'secondary',label:'STOP'}):ua&&va?w(va/1000,'g:ia M j'):'⌘'+pa.get('shortcut',qa+1),wa&&t.createElement(ga,babelHelpers['extends']({contextRef:function(xa){return this.refs.root;}.bind(this)},this.props))))));}});function ea(oa,pa,qa,ra,sa){var ta='<span style="color: brown">',ua='<span style="color: navy">',va='<span style="color: navy">',wa=pa||'';if(qa)wa=wa+ta+qa.replace(/[": ]/g,'')+'</span>: ';if(ra)wa=wa+(ra[0]=='"'?va:ua)+ra+'</span>';return wa+(sa||'');}function fa(oa){var pa=/^( *)("[\w]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/mg,qa={__html:JSON.stringify(oa,null,3).replace(/&/g,'&amp;').replace(/\\"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(pa,ea)};return t.createElement('div',{dangerouslySetInnerHTML:qa});}var ga=t.createClass({displayName:'DebugInfo',mixins:[s],propTypes:{onToggleDebug:ba.func.isRequired,debugShown:ba.bool.isRequired},_handleToggleDebugInfo:function(event){this.props.onToggleDebug();event.stopPropagation();},render:function(){var oa=this.props,pa=oa.contextRef,qa=oa.item,ra=oa.debugShown,sa=qa.get('source'),ta=qa.get('debug');return (t.createElement('span',null,sa?' '+sa:'',ta?' ':'',ta&&t.createElement('span',null,t.createElement('a',{className:"_5ufb",onClick:this._handleToggleDebugInfo}),t.createElement(x,{behaviors:{ContextualLayerAutoFlip:h,ContextualLayerUpdateOnScroll:i,LayerHideOnBlur:o},contextRef:pa,hoverHideDelay:0,onBlur:this.props.onToggleDebug,position:'right',shown:ra,hasActionableContext:true},t.createElement('div',{className:"_5ufd"},fa(ta.toJS()))))));}}),ha=t.createClass({displayName:'TimeProgress',mixins:[s],propTypes:{at:ba.number.isRequired,label:ba.string},componentDidMount:function(){this._start=Date.now();var oa=window.setInterval(function(pa){return this.forceUpdate();}.bind(this));this.unlisten=function(pa){return window.clearInterval(oa,1000);};},componentWillUnmount:function(){this.unlisten();},render:function(){var oa=this.props,pa=oa.at,qa=oa.label,ra=ma(this._start,Date.now(),pa);return (t.createElement('div',{className:"_58jn"},t.createElement('div',{className:"_16bc",style:{width:ra+'%'}}),t.createElement('div',{className:"_16bd"},qa)));}}),ia=k.pure(function(oa){var pa=oa.column,qa=oa.filter,ra=oa.item,sa=oa.line,ta=oa.onItemClick,ua=y({line:sa,column:pa}),va=ra.get('at');return (t.createElement('div',{className:"_2966",onClick:function(wa){wa.preventDefault();ta(ua);}},na(ra)?t.createElement(ha,{label:'AUTO-SENDING',at:va}):null,t.createElement('div',{className:"_34mx"},na(ra)?t.createElement(v,{type:'secondary',label:'STOP'}):t.createElement('span',null,ra.get('id')&&va?w(va/1000,'g:ia M j'):'')),t.createElement(ka,{className:"_34mz",item:ra,filter:qa})));}),ja=k.pure(function(oa){var pa=oa.images;return (t.createElement('div',null,pa.map(function(qa,ra){return (t.createElement(n,{key:ra,className:"_1q16",src:qa.get('url'),alt:qa.get('filename')}));})));}),ka=k.pure(function(oa){var pa=oa.filter,qa=oa.item,ra=oa.className;switch(qa.get('type')){case aa.COMMAND:return t.createElement(la,{command:qa,highlight:pa});case aa.SURVEY:case 'send':case aa.TEMPLATE:var sa=qa.get('ui-body')&&'"'+qa.get('ui-body')+'"',ta=qa.getIn(['data','images']);return (t.createElement('div',{className:ra},sa?t.createElement(u,{text:sa,highlight:pa}):null,ta?t.createElement(ja,{images:ta}):null));case 'suggest':case aa.SUGG:return (t.createElement(q,{bubble:qa.get('data'),highlight:pa,meta:qa.get('meta'),source:qa.get('source')}));default:k.debug('[composerai] could not render item',qa);return null;}}),la=k.pure(function(oa){var pa=oa.command,qa=oa.highlight;return (t.createElement('div',{className:"_2_he"},t.createElement('i',{className:l("_2_hf",pa.get('iconCl'))}),t.createElement(u,{text:pa.get('text'),highlight:qa})));});function ma(oa,pa,qa){var ra=pa-oa,sa=qa-oa;return ra>=0&&sa>0?Math.min(100,Math.round(ra/sa*100)):0;}function na(oa){var pa=10000;return (oa.get('id')&&oa.get('at')&&k.serverNow()+pa>oa.get('at'));}f.exports={OzComposerAIList:ca};},null);
__d('OzComposerAttachments.react',['cx','OzHelpers','Image.react','immutable','MNCommerceAgentItemSuggestionMercuryAttachment.react','OzAttachmentOverlay.react','OzConstants','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=k.OrderedMap,r=k.Map,s=n.ATTS,t=p.PropTypes,u=p.createClass({displayName:'OzComposerAttachments',mixins:[o],propTypes:{attachments:t.instanceOf(q).isRequired,onAttachmentCrop:t.func.isRequired,onBubbleEdit:t.func.isRequired,onRemove:t.func.isRequired},render:function(){var w=this.props,x=w.attachments,y=w.onAttachmentCrop,z=w.onBubbleEdit,aa=w.onRemove;if(x.isEmpty())return null;return (p.createElement('div',{className:"_18wb"},x.map(function(ba,ca){return (p.createElement(v,{key:ca,id:ca,attachment:ba,onRemove:aa,onBubbleEdit:z,onAttachmentCrop:y}));}).valueSeq()));}}),v=p.createClass({displayName:'Attachment',mixins:[o],propTypes:{attachment:t.instanceOf(r).isRequired,id:t.number.isRequired,onAttachmentCrop:t.func.isRequired,onBubbleEdit:t.func.isRequired,onRemove:t.func.isRequired},render:function(){var w=this.props,x=w.attachment,y=w.id,z=w.onAttachmentCrop,aa=w.onBubbleEdit,ba=w.onRemove;switch(x.get('type')){case s.IMAGE:var ca=x.get('url')||i.blobURI(x.get('ui-blob'));return (p.createElement(m,{key:y,onEdit:function(da){return z(x,y);},onRemove:function(da){return ba(x,y);},loading:x.get('loading')},p.createElement(j,{className:"_4xee",onClick:function(da){return window.open(ca);},src:ca})));case s.SUGG:return (p.createElement(m,{key:y,onRemove:function(da){return ba(x,y);},onEdit:function(da){return aa(x,y);}},p.createElement(l,{itemSuggestion:i.uiSuggestion(x.get('data'))})));default:return (p.createElement(m,{key:y},p.createElement('span',null,JSON.stringify(x))));}}});f.exports=u;},null);
__d('OzConfirmDialog.react',['cx','joinClasses','OzActions','React','MessengerDialog.react'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=k.PropTypes,n=k.createClass({displayName:'OzConfirmDialog',propTypes:{body:m.node.isRequired,onOk:m.func.isRequired,onCancel:m.func},render:function(){var p=this.props,q=p.onOk,r=p.onCancel,s=p.body;return (k.createElement(l,{type:'default',width:500,onToggle:function(t){j.hideDialog();r&&r();}},k.createElement('div',{className:"_1vdh"},k.createElement('div',{className:"_1vdi"},s),k.createElement('div',{className:"_1vdj"},k.createElement(o,{className:"_1vdk",onClick:q}),k.createElement(o,{className:"_1vdl",onClick:r})))));}});function o(p){var q=p.className,r=p.onClick;return (k.createElement('button',{role:'button',className:i("_1-hv _30yy _1vdm",q),onClick:function(s){j.hideDialog();r&&r();}}));}f.exports=n;},null);
__d('OzSendLater.react',['cx','OzHelpers','React','XUIContextualDialog.react','ReactComponentWithPureRenderMixin','LayerHideOnBlur','XUIDateTimePicker.react','MessengerButton.react','Tooltip'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=j.PropTypes,r=j.createClass({displayName:'OzSendLater',mixins:[l],propTypes:{numScheduled:q.number.isRequired,onSendLater:q.func.isRequired,onTimeChange:q.func.isRequired,onToggle:q.func.isRequired,shown:q.bool.isRequired,timestamp:q.number,disabled:q.bool},render:function(){var s=this.props,t=s.shown,u=s.disabled,v=s.numScheduled,w=s.onToggle,x=s.onTimeChange,y=s.onSendLater;return (j.createElement('span',{className:"_40yd"},j.createElement('button',babelHelpers['extends']({ref:'btn',disabled:u,onClick:function(z){return w(true);}},u?p.propsFor('We can not schedule this message; '+'images are not supported yet'):null,{className:"_1-hv _40ye _30yy"}),j.createElement('div',null,j.createElement('i',{className:"_40yf"}),v?j.createElement('div',{className:"_2ism"},v):null)),j.createElement(k,{position:'above',contextRef:function(z){return this.refs.btn;}.bind(this),className:"_40yg",shown:t,onToggle:w,behaviors:{LayerHideOnBlur:m}},j.createElement('div',{className:"_40yg"},j.createElement(n,babelHelpers['extends']({className:"_40yh",date:new Date(this.props.timestamp||i.serverNow()),allowDuplicateDateSelection:true,onChange:function(z){return x(+z);}},i.dateRestraints())),j.createElement(o,{onClick:y,label:'Send Later',type:'primary'})))));}});f.exports=r;},null);
__d('OzUpdateDateTime.react',['immutable','OzHelpers','React'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=h.Map,l=j.PropTypes,m=j.createClass({displayName:'OzUpdateDateTime',propTypes:{timezoneOffset:l.number.isRequired,locale:l.string.isRequired,options:l.instanceOf(k).isRequired},componentDidMount:function(){var n=setInterval(function(){this.forceUpdate();}.bind(this),60000);this.setState({timer:n});},componentWillUnmount:function(){if(this.state.timer)clearInterval(this.state.timer);},render:function(){var n=new Date(i.serverNow()+this.props.timezoneOffset);return (j.createElement('span',null,n.toLocaleString(this.props.locale,this.props.options.set('timeZone','UTC').toJS())));}});f.exports=m;},null);
__d('OzComposer.react',['Promise','OzAPI','cx','OzEditorStateHelpers','fbt','formatDate','getDefaultKeyBinding','getEntityMatcher','getVisibleValueForContentState','OzHelpers','insertEmoticonIntoEditorState','invariant','OzNotify','promiseFinally','ChatContentSearchButton.react','ChatStickerButton.react','CompositeDraftDecorator','DraftEditor.react','DraftModifier','EditorState','EmoticonsList','EmoticonSpan.react','FileInput.react','immutable','KeyBindingUtil','Keys','MessengerContextualDialog.react','MercuryConfig','OzActions','OzAttachmentCropper.react','OzBubbleEditor.react','OzComposerAI.react','OzComposerAttachments.react','OzConfig','OzConfirmDialog.react','OzConstants','OzSendLater.react','OzStores','OzSuggestions','OzUpdateDateTime.react','React','Reflux','SelectionState','StickerActions','OzHistory'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya){if(c.__markCompiled)c.__markCompiled();var za=c('OzHistory')('composer-history'),ab=ea.Map,bb=ea.OrderedMap,cb=ea.List,db=va.PropTypes,eb=ma.OzComposerAIList,fb=qa.ATTS,gb=qa.TOKENS,hb=sa.ActiveThreadStore,ib=sa.BubbleStore,jb=8*1024*1024,kb={CREATE_BUBBLE:'CREATE_BUBBLE',CREATE_REMINDER:'CREATE_REMINDER',CREATE_INTENT:'CREATE_INTENT',CLOSE_INTENT:'CLOSE_INTENT',CLOSE_REMINDER:'CLOSE_REMINDER'},lb=va.createClass({displayName:'OzComposer',mixins:[wa.connect(ib,'bubbles'),wa.connect(hb,'activeThread')],propTypes:{thread:db.instanceOf(ab).isRequired,merchants:db.instanceOf(ab).isRequired,onResize:db.func},contextTypes:{uid:db.string.isRequired},getInitialState:function(){return qb(this.props.thread);},componentDidMount:function(){this._unlisten=ja.updateComposer.listen(this._onUpdateComposer);this._oldHeight=this.refs.root.offsetHeight;},componentWillReceiveProps:function(wc){if(q.threadID(wc.thread)!==q.threadID(this.props.thread)){rb(this.tid(),this.state);this.setState(qb(wc.thread));}},componentDidUpdate:function(){window.setTimeout(function(wc){var xc=this.refs.root.offsetHeight;if(xc!==this._oldHeight)this.props.onResize&&this.props.onResize();this._oldHeight=xc;}.bind(this));},componentWillUnmount:function(){rb(this.tid(),this.state);this._unlisten();},getValue:function(){return p(this.e().getCurrentContent());},focusInput:function(){this.refs.input.focus();},render:function(){return (va.createElement('div',{ref:'root',className:"_5751 _19ib"},this._renderWidgets(),va.createElement('div',{className:"_5754"},va.createElement('div',{className:"_19id"},this._renderTextEditor()),this._renderActions())));},_renderTextEditor:function(){return (va.createElement(y,{ref:'input',editorState:this.e(),keyBindingFn:this._toKeyCommand,handleKeyCommand:this._handleKeyCommand,handleBeforeInput:this._handleBeforeInput,onChange:this._handleChange,onDownArrow:this._handleDownArrow,onUpArrow:this._handleUpArrow,onTab:this._handleTab,handleReturn:this._handleReturn,onFocus:this._handleFocus,handlePastedFiles:this._handleFiles,handleDroppedFiles:function(wc,xc){this._handleFiles(xc);}.bind(this),placeholder:l._("Type a message then Cmd+Enter to send"),spellCheck:true,textAlignment:'left'}));},_handleFocus:function(){this.setState({isAIOpen:true});},_onUpdateComposer:function(wc){var xc=wc.text,yc=wc.files;xc&&this._handleChange(k.append(this.e(),xc));yc&&this._handleFiles(yc);this.refs.input.focus();},_validateSend:function(){return new h(function(wc,xc){var yc=[[bc(this.e().getCurrentContent()).length>0,'You have not filled in all the missing information.'],[this.state.attachments.some(function(zc){return zc.get('loading');}),'Your attachments are still loading. Please wait and send in a bit'],[!q.isOwner(this.t(),this.context.uid),'You do not own this thread. Assign yourself to send messages']].find(function(zc){var ad=zc[0],bd=zc[1];return ad;});yc?xc(yc[1]):wc();}.bind(this));},_sendWith:function(wc,xc){this._validateSend().done(function(yc){var zc=q.threadID(this.t()),ad=this.getValue().trim(),bd=this.state.attachments.groupBy(function(fd){return fd.get('type');}),cd=zb(this.t(),this.state),dd=bd.get(fb.IMAGE,cb()).map(function(fd){return fd['delete']('ui-blob');}).toList(),ed=ad||!dd.isEmpty()?wc({tid:zc,images:dd,text:ad,aiusage:cd}):h.resolve();bd.get(fb.SUGG,cb()).reduce(function(fd,gd){return u(fd,function(hd){return xc({tid:zc,suggestion:gd.get('data'),aiusage:cd});});},ed);i.notifyExtension({action:'discard',id:zc});this._toHistory();this.setState(babelHelpers['extends']({},ob(),{editorState:k.replaceContentWithText(this.e(),''),seedBubble:this.state.seedBubble,isAIOpen:this.state.isAIOpen}));}.bind(this),t.error);},_handleMessageSend:function(){var wc=function(){return this._sendWith(i.sendMessage,i.suggest);}.bind(this),xc=ab({hour:'numeric',minute:'numeric'}),yc=va.createElement('span',null,'Are you sure? ',q.preferredName(this.t()),' might be sleeping now.  It\'s ',va.createElement(ua,{locale:'en-US',options:xc,timezoneOffset:this.t().getIn(['location','timezone-offset'],0)}),' for ',q.preferredName(this.t()),'.');q.isDaytime(this.t().getIn(['location','timezone-offset'],0))?wc():ja.showDialog(pa,{onOk:wc,body:yc});},_handleSendLater:function(){var wc=this.state.schedule.timestamp;wc?this._sendWith(function(xc){return i.scheduleMessage(babelHelpers['extends']({},xc,{at:wc}));},function(xc){return i.scheduleSuggest(babelHelpers['extends']({},xc,{at:wc}));}):t.error('You need to pick a time to send later');},_handleReturn:function(wc){if(q.hasCmdOrCtrl(wc)){setTimeout(this._handleMessageSend);return true;}return false;},_handleFiles:function(wc){var xc=wc;if(xc.some(function(ad){return ad.size>=jb;})){t.error('The file you are trying to add is too large.');return false;}if(!xc.length)return false;var yc=this.state.attachments.merge(xc.map(function(ad,bd){return [bd,ab({type:fb.IMAGE,'ui-blob':ad,loading:true})];}));this.setState({attachments:yc});var zc=function(ad){return (xc.reduce(function(bd,cd,dd){return bd['delete'](dd);},ad));};h.all(xc.map(function(ad){return i.upload(ab({type:ad.type,blob:ad}));})).done(function(ad){!ad.every(function(bd){return bd.get('id');})?s(0):undefined;this.setState({attachments:sb(zc(this.state.attachments),ad.map(function(bd,cd){return bd.set('ui-blob',xc[cd]);}))});}.bind(this),function(ad){this.setState({attachments:zc(this.state.attachments)});}.bind(this));return true;},_handleStickerSelect:function(wc){ya.hideStickerTray();this._validateSend().then(function(xc){i.sendMessage({tid:q.threadID(this.t()),'sticker-id':wc});}.bind(this),t.error).done();},_handleContentSearchSelect:function(wc,xc){if(wc.platformFBID.toString()===ia.MessengerAppID){this._handleStickerSelect(wc.resultID.toString());return;}this._validateSend().then(function(yc){i.upload(ab({type:'image/url','attribution-app-id':wc.platformFBID,'image-url':wc.source.url})).done(function(zc){return i.sendMessage({tid:q.threadID(this.t()),images:[zc]});}.bind(this));}.bind(this),t.error).done();},_handleEmoticonSelect:function(wc){var xc=ba.symbols[wc];xc&&this._handleChange(r(xc,this.state.editorState));},_handleAttRemove:function(wc){this.setState({attachments:this.state.attachments['delete'](wc.get('id'))});},_handleBubbleEdit:function(wc){this.setState({seedBubble:wc});},_handleBubbleEditorSave:function(wc){this.setState({seedBubble:null,attachments:sb(this.state.attachments,[wc])},function(xc){return this.refs.input.focus();}.bind(this));},_handleBubbleEditorClose:function(wc){var xc={seedBubble:null},yc=wc.get('id');if(yc)xc.attachments=this.state.attachments['delete'](yc);this.setState(xc,function(zc){return this.refs.input.focus();}.bind(this));},_handleAttachmentCrop:function(wc){this.setState({cropAttachment:wc});},_handleAttCropperSave:function(wc){var xc=this.state.attachments['delete'](wc.get('id'));this.setState({cropAttachment:null,attachments:xc},function(yc){this._handleFiles([wc.get('ui-blob')]);this.refs.input.focus();}.bind(this));},_handleAttCropperClose:function(wc){this.setState({cropAttachment:null},function(xc){return this.refs.input.focus();}.bind(this));},_renderWidgets:function(){if(this.state.seedBubble)return (va.createElement(la,{merchants:this.props.merchants,seedBubble:this.state.seedBubble,onSave:this._handleBubbleEditorSave,onClose:this._handleBubbleEditorClose}));if(this.state.cropAttachment)return (va.createElement(ka,{attachment:this.state.cropAttachment,onSave:this._handleAttCropperSave,onClose:this._handleAttCropperClose}));return (va.createElement('div',null,va.createElement(eb,{filter:this.getValue(),items:this._AIItems(),onItemClick:this._handleAIItemClick}),va.createElement(na,{attachments:this.state.attachments,onRemove:this._handleAttRemove,onBubbleEdit:this._handleBubbleEdit,onAttachmentCrop:this._handleAttachmentCrop})));},_renderActions:function(){return (va.createElement('div',{className:"_575c"},va.createElement(w,{className:"_30yy"+(' '+"_1v3y"),flyoutAlignment:'right',flyoutClassName:"_293j",onStickerSelect:this._handleStickerSelect,onEmoticonSelect:this._handleEmoticonSelect}),va.createElement(da,{ref:'fileInput',display:'inline-block',accept:'*/*',multiple:true,onChange:function(wc){this._handleFiles([].slice.apply(wc.target.files));this.refs.fileInput.getFileInput().clear();}.bind(this)},va.createElement('a',{title:'add images',className:"_2e01 _30yy"})),va.createElement(v,{className:"_yht _30yy _592k",ref:'chatContentSearch',ContextualDialogClass:ha,flyoutAlignment:'right',flyoutClassName:"_293j",flyoutWidth:285,onStickerSelect:this._handleStickerSelect,getInput:function(){return this.refs.input;}.bind(this),getQuery:this.getValue,onSelect:this._handleContentSearchSelect}),va.createElement(ra,babelHelpers['extends']({},this.state.schedule,{numScheduled:this.props.thread.get('events')?this.props.thread.get('events').count():0,onTimeChange:this._handleScheduleTimeChange,onToggle:this._handleScheduleToggle,onSendLater:this._handleSendLater}))));},_handleChange:function(wc){var xc=this.e().getCurrentContent().getPlainText(),yc=wc.getCurrentContent().getPlainText();q.debug('[composer] changed from',xc,yc);var zc={editorState:wc};if(!xc.length&&yc.length)tb(this.t());this.setState(zc);},_handleDownArrow:function(wc){if(q.hasCmdOrCtrl(wc)&&this.e().isSelectionAtStartOfContent()){this._fromHistory('down');wc.preventDefault();return true;}},_handleUpArrow:function(wc){if(q.hasCmdOrCtrl(wc)&&this.e().isSelectionAtStartOfContent()){this._fromHistory('up');wc.preventDefault();return true;}},_handleTab:function(wc){var xc=dc(this.e());if(xc){this.setState({editorState:aa.forceSelection(this.e(),xc)});wc.preventDefault();return true;}var yc=xb(this._AIItems(),ab({line:0,column:0}));if(yc){this._handleAISelect(yc);wc.preventDefault();return true;}},_toKeyCommand:function(wc){var xc=function(){var yc=wc.keyCode-ga.ZERO;if(this.state.isAIOpen&&yc<=this._AIItems().size)return 'SELECT-AI-ITEM-'+(yc-1);}.bind(this);return (vb(wc)&&kb.CREATE_BUBBLE||yb(wc)&&xc()||wb(wc)&&'PREFERRED-NAME'||n(wc));},_handleKeyCommand:function(wc){switch(wc){case 'SELECT-AI-ITEM-0':case 'SELECT-AI-ITEM-1':case 'SELECT-AI-ITEM-2':case 'SELECT-AI-ITEM-3':case 'SELECT-AI-ITEM-4':case 'SELECT-AI-ITEM-5':case 'SELECT-AI-ITEM-6':case 'SELECT-AI-ITEM-7':case 'SELECT-AI-ITEM-8':case 'SELECT-AI-ITEM-9':this._handleAIItemClick(ab({line:+wc.slice(-1),column:0}));return true;case 'PREFERRED-NAME':this._handleChange(aa.push(this.e(),z.replaceText(this.e().getCurrentContent(),this.e().getSelection(),q.preferredName(this.t()))));return true;case kb.CREATE_BUBBLE:this.setState({seedBubble:ub()});return true;}return false;},_AIItems:function(wc){return gc(this.state.isAIOpen,this.props.thread,this.state.bubbles,this.props.merchants,this.getValue());},_handleAISelect:function(wc){this.setState({lastAIPick:wc,lastAIGuesses:this.t().get('guesses')},function(){var xc=wc.get('id');if(jc(wc)){i.deleteScheduled(q.threadID(this.t()),xc);this._handleScheduleTimeChange(wc.get('at'));}switch(wc.get('type')){case fb.COMMAND:if(!jc(wc))switch(wc.get('action')){case kb.CREATE_REMINDER:this._handleCreateReminder(wc);break;case kb.CREATE_INTENT:this._handleCreateIntent(wc);break;case kb.CLOSE_INTENT:this._handleCloseIntent(wc);break;default:this._handleKeyCommand(wc.get('action'));}break;case fb.SURVEY:case 'send':case fb.TEMPLATE:var yc=wc.get('f'),zc=yc&&yc()||wc.get('ui-body'),ad=wc.getIn(['data','images']),bd=k.replaceLine(this.e(),zc+' '),cd=dc(bd);if(zc)this._handleChange(cd?aa.forceSelection(bd,cd):bd);if(ad)this.setState({attachments:sb(this.state.attachments,ad.toArray())});break;case 'suggest':case fb.SUGG:this.setState({seedBubble:wc});break;}}.bind(this));this.focusInput();},_handleAIItemClick:function(wc){this._handleAISelect(xb(this._AIItems(),wc));},_handleCreateReminder:function(wc){i.createReminder(this.tid(),ab({body:wc.get('body'),'scheduled-time':wc.get('scheduled-time')}));},_handleCreateIntent:function(wc){i.createIntent(this.tid(),ab({'wit-intent-uuid':wc.get('wit-intent-uuid'),name:wc.get('name'),metadata:wc.get('metadata'),params:wc.get('params'),actions:wc.get('actions'),notes:wc.get('notes'),requirements:wc.get('requirements')}));},_handleCloseIntent:function(wc){i.closeIntent(this.tid(),wc.getIn(['data','id']));},_toHistory:function(){var wc=this.state.attachments,xc=wc.filter(function(zc){return zc.get('type')===fb.SUGG;}),yc=this.getValue();za.push(JSON.stringify({bubbles:xc,text:yc}));},_fromHistory:function(wc){var xc=q.safeParse(za[wc]()),yc=xc.bubbles,zc=xc.text;zc&&this._handleChange(k.replaceContentWithText(this.e(),zc));yc&&this.setState({attachments:bb(yc).mapEntries(function(ad){return ea.fromJS(ad);}).mapKeys(function(ad){return +ad;})});},_handleScheduleToggle:function(wc){var xc=this.state.schedule;xc.shown===wc?null:this.setState({schedule:babelHelpers['extends']({},xc,{shown:wc})});},_handleScheduleTimeChange:function(wc){this.setState({schedule:babelHelpers['extends']({},this.state.schedule,{timestamp:wc})});},e:function(){return this.state.editorState;},t:function(){return this.props.thread;},tid:function(){return q.threadID(this.t());}});function mb(){var wc=new x([{strategy:function(xc,yc){bc(xc.getText()).map(function(zc){return yc.apply(undefined,zc);});},component:fc},{strategy:o(function(xc){return xc.getType()==='EMOTICON';}),component:ca}]);return aa.createEmpty(wc);}function nb(){return {shown:false,timestamp:null};}function ob(){return {attachments:bb(),editorState:mb(),seedBubble:null,isAIOpen:false,lastAIPick:null,lastAIGuesses:null,schedule:nb()};}var pb={};function qb(wc){return pb[q.threadID(wc)]||ob();}function rb(wc,xc){var yc=babelHelpers['extends']({},xc);delete yc.bubbles;delete yc.activeThread;yc.isAIOpen=false;pb[wc]=yc;}function sb(wc,xc){!bb.isOrderedMap(wc)?s(0):undefined;!Array.isArray(xc)?s(0):undefined;return wc.withMutations(function(yc){return xc.reduce(function(zc,ad){ad=ad.set('id',ad.get('id')||ad.hashCode());return zc.set(ad.get('id'),ad);},yc);});}function tb(wc){var xc=q.threadID(wc);if(wc.get('read-state')==='unread')i.ack(xc);return i.typing(xc);}function ub(){return ea.fromJS({data:{currency:'USD'},type:fb.SUGG});}function vb(wc){return q.hasCmdOrCtrl(wc)&&wc.which===66;}function wb(wc){return wc.getModifierState('Control')&&wc.which===78;}function xb(wc,xc){var yc=wc.get(xc.get('line'));return cb.isList(yc)?yc.get(xc.get('column')):yc;}function yb(wc){return (fa.hasCommandModifier(wc)&&wc.keyCode>=ga.ZERO+1&&wc.keyCode<=ga.ZERO+9);}function zb(wc,xc){var yc=xc.lastAIPick,zc=xc.lastAIGuesses,ad=zc||wc.get('guesses'),bd=q.openIntents(wc).map(function(cd){return cd.filter(q.keysIn('name','wit-intent-uuid'));});q.debug('building ai usage',q.threadID(wc));return ab({gold:yc,guesses:ad,intents:bd});}var ac=/(@\[[^\]]+\])/g;function bc(wc){var xc=undefined,yc=[];while(xc=ac.exec(wc))yc.push([xc.index,xc.index+xc[0].length]);return yc;}function cc(wc){return '@['+wc+']';}function dc(wc){var xc=wc.getCurrentContent().getBlockMap().toSeq().map(function(ad){return [ad,bc(ad.getText())[0]];}).find(function(ad){var bd=ad[0],cd=ad[1];return !!cd;},null,[]),yc=xc[0],zc=xc[1];return yc&&zc?ec.apply(undefined,[yc.getKey()].concat(zc)):null;}function ec(wc,xc,yc){return new xa({anchorKey:wc,focusKey:wc,anchorOffset:xc,focusOffset:yc,hasFocus:true,isBackward:false});}var fc=q.pure(function(wc){var xc=wc.offsetKey,yc=wc.children;return (va.createElement('span',{'data-offset-key':xc,className:"_a5n"},yc));});function gc(wc,xc,yc,zc,ad){var bd=ic(xc,zc,ad),cd=hc(xc,bd,zc,yc,ad),dd=cd.groupBy(function(gd){return gd.get('ui-scheduled')?'scheduled':gd.get('type')===fb.SUGG?fb.SUGG:'rest';}),ed=dd.get('rest',cb()).push(dd.get(fb.SUGG)).filter(function(gd){return !!gd;}),fd=dd.get('scheduled',cb());if(!wc){return fd.isEmpty()?cb():cb().push(fd);}else if(fd.isEmpty()){return ed;}else return ed.push(fd);}function hc(wc,xc,yc,zc,ad){return (pc(zc,ad).takeLast(1).concat(xc.concat(vc(wc,ad)).take(5)).concat(oc(ad)).concat(kc(wc,yc,ad)));}function ic(wc,xc,yc){return (wc.get('guesses')||cb()).flatMap(function(zc){return zc.get('items')||[zc].map(function(ad){return ad.merge(ab({position:zc.get('position'),confidence:zc.get('confidence'),'class':zc.get('class')}));});}).map(function(zc){switch(zc.get('type')){case fb.TEMPLATE:var ad=qc(wc,zc.get('body'));return jc(zc)||uc(ad,yc)?zc.set('ui-body',ad):null;case 'bubble':return jc(zc)||tc(zc.get('data'),yc)?ta.toServer(zc,xc):null;case 'close-intent':return mc(zc);case 'create-intent':return lc(zc);case 'reminder':var bd=zc.getIn(['body','description']),cd=zc.get('scheduled-time'),dd=m(cd/1000,'g:ia M j');return ab({type:fb.COMMAND,action:kb.CREATE_REMINDER,text:'Create Reminder for '+dd+': "'+bd+'"',iconCl:"_3e_w",body:zc.get('body'),'scheduled-time':cd});}}).filter(function(zc){return !!zc;});}function jc(wc){return !!(wc.get('id')&&wc.get('at'));}function kc(wc,xc,yc){return (wc.get('events')||cb()).concat(wc.get('scheduled')||cb()).toSeq().map(function(zc){switch(zc.get('type')){case 'send':return zc.set('ui-body',zc.getIn(['data','text']));case 'suggest':return zc.set('type',fb.SUGG).set('data',zc.getIn(['data','suggestion'])).updateIn(['data','merchant-name'],function(ad){return ta.findMerchantName(ad,xc);});case 'create-intent':return lc(zc.get('data')).set('id',zc.get('id'));case 'close-intent':return mc(zc.get('data')).set('id',zc.get('id'));case 'close-reminder':return nc(zc.get('data')).set('id',zc.get('id'));case fb.SURVEY:case fb.TEMPLATE:return zc.set('ui-body',qc(wc,zc.getIn(['data','body'])));case 'bubble':return ta.toServer(zc.get('data'),xc).setIn(['data','amount'],+zc.getIn(['data','data','price'])).set('id',zc.get('id'));default:q.debug('[oz-scheduled], unk scheduled',zc);}}).filter(function(zc){return !!zc;}).map(function(zc){return zc.set('ui-scheduled',true);}).sortBy(function(zc){return zc.get('at');});}function lc(wc){var xc=wc.get('name');return wc.set('type',fb.COMMAND).set('action',kb.CREATE_INTENT).set('text','Create intent '+xc).set('iconCl',"_3e_w");}function mc(wc){var xc=wc.get('source');return wc.set('type',fb.COMMAND).set('action',kb.CLOSE_INTENT).set('text','Close intent '+xc).set('iconCl',"_3e_w");}function nc(wc){var xc=wc.get('source');return wc.set('type',fb.COMMAND).set('action',kb.CLOSE_REMINDER).set('text','Close reminder '+xc).set('iconCl',"_3e_w");}function oc(wc){return ea.fromJS([{type:fb.COMMAND,action:kb.CREATE_BUBBLE,text:'Create Bubble',iconCl:"_3e_w",shortcut:'B'}]).filter(function(xc){return uc(xc.get('text'),wc);});}function pc(wc,xc){var yc=wc.filter(function(zc){return tc(zc,xc);});return (yc.isEmpty()?wc:yc).toList();}function qc(wc,xc){if(typeof xc==='string')return xc;return xc&&xc.map(function(yc){if(typeof yc==='string')return yc;return sc(wc,yc);}).toJS().join('');}function rc(wc){var xc=wc.get('index');return cc(wc.get('type')+(xc?' '+xc:''));}function sc(wc,xc){if(xc.get('type')===gb.USER_FIRST_NAME)return q.preferredName(wc);return rc(xc);}function tc(wc,xc){var yc=wc.get('data',ab());return uc(yc.get('name','')+'\n     '+yc.get('description','')+'\n     '+yc.get('target-url',''),xc);}function uc(wc,xc){return wc&&wc.toLowerCase().indexOf((xc||'').toLowerCase())>-1;}function vc(wc,xc){var yc=function(bd){return qc(wc,bd[Math.floor(bd.length*Math.random())]);},zc='\uD83D\uDC64',ad=cb([qc(wc,ea.fromJS([{type:gb.USER_FIRST_NAME}])),[zc+' Who are you?',function(){return yc(["My name is M! I'm your personal assistant in Messenger.","My name is M! I'm your personal assistant. I can help you with things like making reservations, finding the perfect gift or planning your next vacation.","My name is M! I'm your personal assistant in Messenger. I'm here to help you do things better and faster.","My name is M! I'm here to help make your life easier."]);}],[zc+' What can you do for me?',function(){return yc(["I can help you with lots of things, like figuring out where to go to dinner, finding a great gift for someone, or planning your weekend. Just ask!","I can help you with lots of things. Just ask and I'll let you know if it's something I can't do.","In general, I can help you with anything that's not illegal. Just ask and I'll let you know if there's something I can't do."]);}],['Sent the wrong info',function(){return 'Sorry! It looks like I sent you the wrong info. @[Right info]';}],[zc+' How did you pick this?',function(){return "I look at a variety of things and try to find the info that's best for you. Would you like me to send you some other options?";}],[zc+' What does M stand for?',function(){return yc(["M is just my name! ","Just M!","I'm just M, like Messenger."]);}],[zc+' Do you have a partnership with X?',function(){return "No, I just try to find the best info for you. Do you want me to send you some other options?";}],["Storing contact info",function(){return yc(["Thanks! I'll remember this for next time."]);}],["Don't have an opinion",function(){return "I don't have an opinion about that, but...@[point to resources]";}],['Not my area of expertise',function(){return "I'm not a @[lawyer, financial adviser, etc.] so I can't give you @[legal, financial, etc.] advice, but I can do some research for you. ";}],[zc+' What\'s your favorite sticker?',function(){return yc(["I can't pick a favorite!","They're all great!","I love all of the stickers equally!"]);}],["General redirect",function(){return "I'm not really sure how to answer that, but can I help you with something else?";}],["Bugs redirect",function(){return "You can actually report things like this right from Facebook. Here's how: https://www.facebook.com/help/326603310765065/ ";}],["Facebook support redirect",function(){return yc(["I'm not an expert, so I'd recommend checking out the Help Center: www.facebook.com/help (http://www.facebook.com/)","I'm not an expert in that, so I'd recommend going here: www.facebook.com/help (http://www.facebook.com/)"]);}],[zc+' What languages do you support?',function(){return "Right now I can only chat in English. Sorry for the inconvenience!";}],["Trolling (abusing M/the agents)",function(){return yc(["Is there anything I can help you with?","Unfortunately I won't be able to chat with you if you say things like that."]);}],["Generic don't support message",function(){return yc(["Unfortunately I can't do that. Is there anything else I can help you with?","Unfortunately I can't help you with that. @[Sorry for the inconvenience.] Is there anything else I can do for you?","Unfortunately I can't support this type of request. Is there anything else I can help you with?"]);}],[zc+' What are you? Are you human?',function(){return yc(["I'm M! I use artificial intelligence, but people help train me to so I'll get better and better over time.","I'm M! I use artificial intelligence, but people help train me."]);}],[zc+' What gender are you?',function(){return "I don't have a gender. I'm just M.";}],[zc+' How old are you?',function(){return "I don't have an age. Maybe 42?";}],[zc+' Who made you? Where did you come from?',function(){return yc(["I was designed by the Messenger Team.","I was created by the Messenger Team."]);}],[zc+' What do you look like?',function(){return "That's me in the picture next to this message.";}],[zc+' Can you talk or just type?',function(){return "I can send you messages here in Messenger. ";}],[zc+' Where do you live?',function(){return "Right here in Messenger.";}],[zc+' Can you call/message/email my friend?',function(){return "Unfortunately I can't do that. Is there anything else I can help you with?";}],["Medical redirect",function(){return "Unfortunately I can't support this type of request right now. Is there anything else I can help you with?";}],"I'm a little busier than usual right now. I want to give you my full attention, so I'll get back to you as soon as I can. In the meantime, feel free to send me any extra info about your request.","I'm on it!",["You're welcome.",function(){return yc(["You're welcome.","You're welcome! Let me know if there's anything else I can help you with.","You're welcome! Let me know if you need anything else.","You're welcome! Let me know if I can help you with anything else."]);}],["Anything else",function(){return yc(["Let me know if there's anything else I can help you with.","Let me know if I can help with anything else.","Great! Let me know if there's anything else I can help you with.","Let me know if there's anything else I can help you with today."]);}],"How does this look?",["I'm on it",function(){return yc(["Sure, I'm on it!","I'll look into that for you.","I'll look into that for you!","I'll do some research."]);}],"How can I help you today?","How about this?","Is this what you're looking for?","I'll take care of it!","What email should I use for the invite?","Where should I send the invite?","When would you like to dine and how many people will be joining you?",["Save phone number",yc(["Would you like me to save your phone number for future requests?","What phone number would you like me to use for the reservation?"])],"Do you have a price range in mind?","Here are some options:"]).map(function(bd){return (Array.isArray(bd)?ab({'ui-body':bd[0],type:fb.TEMPLATE,f:bd[1]}):ab({'ui-body':bd,type:fb.TEMPLATE}));}).filter(function(bd){return uc(bd.get('ui-body'),xc);});return ad;}f.exports=lb;},null);
__d('ozFormatTime',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=3600,i=60;function j(k){var l=Math.floor(k/h);k%=h;var m=Math.floor(k/i);k%=i;var n=Math.round(k),o='';if(l)o+=l+'h ';if(m)o+=m+'m ';if(n)o+=n+'s';return o;}f.exports=j;},null);
__d('OzIntentEvents.react',['OzAPI','cx','OzHelpers','ozFormatTime','OzNotify','promiseFinally','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','CIWebmailValidator','FileInput.react','immutable','ReactLayeredComponentMixin','OzDraggable.react','OzDate.react','ReactComponentWithPureRenderMixin','React','Tooltip','XUIContextualDialog.react','XUICloseButton.react','XUIDateTimePicker.react','XUIError.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){if(c.__markCompiled)c.__markCompiled();var ca=p.isValidEmail,da=r.Map,ea=r.List,fa=w.PropTypes,ga=w.createClass({displayName:'OzIntentEvents',propTypes:{intent:fa.instanceOf(da).isRequired,onCallClick:fa.func.isRequired,userEmail:fa.string},getInitialState:function(){return {composerEmail:za,composerInvite:bb(this.props.userEmail),emailShown:false,inviteShown:false,emailErrors:da(),inviteErrors:da(),emailDisabled:false,uploadSem:0};},render:function(){var lb=this.props,mb=lb.intent,nb=lb.onCallClick,ob=(mb.get('events')||ea()).toList(),pb=ob.filter(function(sb){return sb.get('type')==='completed-call';}),qb=ob.filter(function(sb){return (sb.get('type')==='send-email'||sb.get('type')==='receive-email');}),rb=ob.filter(function(sb){return sb.get('type')==='send-calendar';});return (w.createElement('div',{className:"_4h0y"},w.createElement(ja,{header:'Calls',events:pb,onCallPlay:this._handleCallPlay}),w.createElement(ja,{header:'Emails',events:qb,onEmailShow:function(sb){return this._handleEmail({email:sb.get('data'),disabled:true});}.bind(this),onEmailReply:function(sb){return this._handleEmail({email:sb.get('data')});}.bind(this)}),w.createElement(ja,{header:'Invites',events:rb,onInviteShow:function(sb){return this._handleInvite({invite:sb.get('data'),disabled:true});}.bind(this)}),w.createElement('div',{className:"_4h0-"},w.createElement(ha,{onCallClick:nb,onEmailClick:this._handleEmail,onInviteClick:this._handleInvite}),w.createElement(pa,{sign:'@'},ib(mb)),w.createElement(pa,{sign:'#'},jb(mb))),this.state.emailShown?w.createElement(qa,{email:this.state.composerEmail,disabled:this.state.emailDisabled,errors:this.state.emailErrors,onChange:function(sb){return this.setState({composerEmail:sb});}.bind(this),onSend:this._handleSendEmail,onToggle:function(sb){return this.setState({emailShown:false,emailErrors:da()});}.bind(this),onUpload:this._handleUpload,onAttOpen:function(sb){return h.everstoreURI(sb.getIn(['body','everstore-handle'])).then(function(tb){return window.open(tb);});}}):null,this.state.inviteShown?w.createElement(ta,{disabled:this.state.inviteDisabled,invite:this.state.composerInvite,errors:this.state.inviteErrors,onChange:function(sb){return this.setState({composerInvite:sb});}.bind(this),onClose:function(sb){return this.setState({inviteShown:false,inviteErrors:da()});}.bind(this),onSend:this._handleSendInvite}):null));},_handleSendEmail:function(){var lb=this.props.intent.get('id'),mb=this.state.composerEmail,nb=[[mb.getIn(ua),'Please select the to email address'],[mb.get('subject'),'Please write your subject'],[mb.getIn(xa),'Please write a message'],[this.state.uploadSem===0,'Your attachments are still uploading']].find(function(qb){var rb=qb[0],sb=qb[1];return !rb;});if(nb){l.error(nb[1]);return;}var ob=mb.set('intent-id',lb).updateIn(ua,cb).updateIn(va,cb).updateIn(wa,cb),pb=da({to:ua,cc:va,bcc:wa}).map(function(qb){return db(ob.getIn(qb));}).filter(function(qb){return qb;});if(!pb.isEmpty()){this.setState({emailErrors:pb});return;}h.sendEmail(ob);this.setState({composerEmail:za,emailShown:false,emailErrors:da()});},_handleSendInvite:function(){var lb=this.props.intent.get('id'),mb=this.state.composerInvite,nb=[[mb.get('to'),'Please select where to send the invite'],[mb.get('title'),'Please create a title'],[mb.get('start'),'Please select a start time'],[mb.get('end'),'Please select an end time'],[mb.get('start')>j.serverNow(),'Event must start in the future'],[mb.get('end')>mb.get('start'),'Event must start before it ends']].find(function(qb){var rb=qb[0],sb=qb[1];return !rb;});if(nb){l.error(nb[1]);return;}var ob=mb.set('intent-id',lb).update('to',cb),pb=da({to:'to'}).map(function(qb){return db(ob.get(qb));}).filter(function(qb){return qb;});if(!pb.isEmpty()){this.setState({inviteErrors:pb});return;}h.sendInvite(ob);this.setState({composerInvite:bb(this.props.userEmail),inviteShown:false,inviteErrors:da()});},_handleUpload:function(lb){var mb=function(ob){return this.setState({uploadSem:this.state.uploadSem+ob});}.bind(this);mb(1);var nb=h.everstoreUpload(da({blob:lb})).then(function(ob){return fb(ob,lb);}).then(function(ob){return this.state.composerEmail.update('body',function(pb){return pb.push(ob);});}.bind(this)).then(function(ob){return this.setState({composerEmail:ob});}.bind(this));m(nb,function(ob){return mb(-1);});},_handleEmail:function(){var lb=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],mb=function(ob){return ob&&ob.join(', ');},nb=lb.email?lb.email.updateIn(ua,mb).updateIn(va,mb).updateIn(wa,mb):za;this.setState({emailShown:true,composerEmail:nb,emailDisabled:lb.disabled});},_handleInvite:function(){var lb=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];this.setState({inviteShown:true,composerInvite:lb.invite||bb(this.props.userEmail),inviteDisabled:lb.disabled});},_handleCallPlay:function(lb){return h.everstoreURI(lb).then(function(mb){return window.open(mb);});}}),ha=w.createClass({displayName:'NewIntentEvent',mixins:[v,s],getInitialState:function(){return {shown:false};},render:function(){return (w.createElement('button',{ref:'add',className:"_1-hv _30yy _4h0_",onClick:function(){return this.setState({shown:true});}.bind(this)},'+'));},renderLayers:function(){var lb=this.state.shown,mb=this.props,nb=mb.onCallClick,ob=mb.onEmailClick,pb=mb.onInviteClick;if(!lb)return null;return {contextualDialog:w.createElement(y,{behaviors:{ContextualLayerAutoFlip:n,ContextualLayerUpdateOnScroll:o},position:'below',shown:lb,context:this.refs.add,onBlur:function(qb){return this.setState({shown:false});}.bind(this)},[['CALL',nb],['EMAIL',ob],['INVITE',pb]].map(function(qb,rb){var sb=qb[0],tb=qb[1];return (w.createElement('button',{key:rb,className:"_1-hv _4h10",onClick:function(){this.setState({shown:false});tb();}.bind(this)},sb));}.bind(this)))};}}),ia=function(lb){return -lb.get('id');},ja=j.pure(function(lb){var mb=lb.header,nb=lb.events,ob=lb.onEmailShow,pb=lb.onEmailReply,qb=lb.onCallPlay,rb=lb.onInviteShow;return nb&&!nb.isEmpty()?w.createElement('details',null,w.createElement('summary',{className:"_177e _3_lv"},mb,' (',nb.count(),')...'),w.createElement('div',{className:"_4h0z"},nb.map(function(event){return (w.createElement(ka,{orderBy:ia,event:event,key:event.get('id'),onEmailShow:ob,onEmailReply:pb,onCallPlay:qb,onInviteShow:rb}));}))):null;}),ka=j.pure(function(lb){var event=lb.event,mb=lb.onEmailShow,nb=lb.onEmailReply,ob=lb.onCallPlay,pb=lb.onInviteShow,qb=lb.orderBy;event=kb(event);var rb=event.get('data');switch(event.get('type')){case 'send-email':return (w.createElement(oa,{order:qb(event),sign:'@',subtitle:rb.get('subject'),actions:[['VIEW',function(sb){return mb(event);}],['REPLY',function(sb){return nb(gb(event));}]]},w.createElement(la,{data:rb,type:'to'})));case 'receive-email':return (w.createElement(oa,{order:qb(event),sign:'@',subtitle:rb.get('subject'),actions:[['VIEW',function(sb){return mb(hb(event));}],['REPLY',function(sb){return nb(gb(hb(event)));}]]},w.createElement(la,{data:rb,type:'from'})));case 'send-calendar':return (w.createElement(oa,{order:qb(event),sign:'#',subtitle:rb.get('title'),eventDate:rb.get('start'),actions:[['VIEW',function(sb){return pb(event);}]]},w.createElement(ma,{data:rb})));case 'completed-call':return (w.createElement(na,{event:event,onCallPlay:ob,orderBy:qb}));default:return null;}}),la=j.pure(function(lb){var mb=lb.data,nb=lb.type,ob=(nb=='to'?'Sent':'Received')+' at '+j.toLocaleTime(mb.get('sent-at'))+' on '+j.toLocaleDate(mb.get('sent-at')),pb=nb==='from'?mb.get('from'):mb.get('to').join(', ');return (w.createElement('span',x.propsFor(ob),'Email ',nb,' ',w.createElement('strong',null,pb)));}),ma=j.pure(function(lb){var mb=lb.data,nb='Sent at '+j.toLocaleTime(mb.get('sent-at'))+' on '+j.toLocaleDate(mb.get('sent-at'));return (w.createElement('span',x.propsFor(nb),'Invite to ',w.createElement('strong',null,mb.get('to'))));}),na=j.pure(function(lb){var event=lb.event,mb=lb.onCallPlay,nb=lb.orderBy,ob=event.get('data'),pb={'in':'Call from',out:'Call to',voicemail:'Voicemail from'}[ob.get('direction')],qb=j.parsePhoneNumber(ob.get('remote-phone')),rb=ob.get('RecordingDuration'),sb=ob.get('recording-ev-handle'),tb=sb?[['PLAY',function(vb){return mb(sb);}]]:[],ub=w.createElement('div',null,w.createElement(u,{date:new Date(event.get('timestamp')),className:"_3_lw"}),rb?w.createElement('span',null,', ',k(+rb)):null);return (w.createElement(oa,{order:nb(event),sign:'#',subtitle:ub,actions:tb},w.createElement('span',null,pb,' ',w.createElement('strong',null,qb))));}),oa=j.pure(function(lb){var mb=lb.sign,nb=lb.children,ob=lb.subtitle,pb=lb.actions,qb=lb.eventDate,rb=lb.order;return (w.createElement('div',{className:"_4h11",style:{order:rb}},w.createElement('div',{className:"_4h12"},mb),w.createElement('div',{className:"_4h18"},w.createElement('div',null,nb),w.createElement('div',null,ob?ob+(qb?' - ':''):null,qb?w.createElement(u,{date:new Date(qb),className:"_3_lw"}):null)),w.createElement('div',{className:"_4h19"},pb.map(function(sb,tb){var ub=sb[0],vb=sb[1];return (w.createElement('button',{key:tb,className:"_1-hv _30yy _4h1a",onClick:vb},ub));}))));}),pa=j.pure(function(lb){var mb=lb.sign,nb=lb.children;return nb?w.createElement('div',{className:"_4h1b"},w.createElement('span',{className:"_4h1c"},mb),nb):null;}),qa=w.createClass({displayName:'EmailComposer',propTypes:{onToggle:fa.func.isRequired,onSend:fa.func,disabled:fa.bool,email:fa.instanceOf(da).isRequired,errors:fa.instanceOf(da),onChange:fa.func.isRequired,onUpload:fa.func.isRequired,onAttOpen:fa.func.isRequired},componentDidMount:function(){var lb=['to','subject','body'].map(function(mb){return this.refs[mb];}.bind(this)).find(function(mb){return !mb.value;});lb&&lb.focus();},getInitialState:function(){return {showCC:false,showBCC:false};},render:function(){var lb=this.props,mb=lb.email,nb=lb.errors,ob=lb.onToggle,pb=lb.onUpload,qb=lb.onAttOpen,rb=lb.onChange,sb=lb.disabled,tb=lb.onSend,ub=this.state,vb=ub.showCC,wb=ub.showBCC,xb=function(ac,bc,cc){return (w.createElement(ba,{xuiError:nb.get(bc),xuiErrorPosition:'left'},w.createElement('input',{type:'text',className:"_1-i0 _4h1i",disabled:sb,placeholder:ac,ref:bc,value:mb.getIn(cc),onChange:function(dc){return rb(mb.setIn(cc,dc.target.value));}})));},yb=mb.get('body').findIndex(function(ac){return ac.get('content-type').startsWith('text/plain');});if(yb==-1)yb=0;var zb=['body',yb,'body'];return (w.createElement(t,{className:"_4h1d"},w.createElement('div',{className:"_4h1e"},w.createElement(z,{onClick:ob})),w.createElement('div',{className:"_1jg2"},xb('To','to',ua),!vb&&!sb?w.createElement('button',{className:"_1jg3",onClick:function(ac){return this.setState({showCC:true});}.bind(this)},'CC'):null,!wb&&!sb?w.createElement('button',{className:"_1jg3",onClick:function(ac){return this.setState({showBCC:true});}.bind(this)},'BCC'):null),vb?xb('Cc','cc',va):null,wb?xb('Bcc','bcc',wa):null,xb('Subject','subject',['subject']),w.createElement('textarea',{disabled:sb,placeholder:'Write your masterpiece',ref:'body',className:"_1-i0 _4h1j",value:mb.getIn(zb),onChange:function(ac){return rb(mb.setIn(zb,ac.target.value));}}),w.createElement(ra,{email:mb,onChange:rb,onAttOpen:qb}),sb?null:w.createElement('div',{className:"_5l1v"},w.createElement('button',{onClick:tb,className:"_1-hv _30yy _4h1s"},'Send'),w.createElement(q,{ref:'fileInput',onChange:function(ac){pb(ac.target.files[0]);this.refs.fileInput.getFileInput().clear();}.bind(this)},w.createElement('a',{title:'add images',className:"_5l1w _30yy"})))));}}),ra=j.pure(function(lb){var mb=lb.email,nb=lb.onAttOpen,ob=lb.onChange,pb=mb.get('body').map(function(qb,rb){return eb(qb)?null:w.createElement(sa,{key:rb,part:qb,onClick:function(sb){return nb(qb);},onRemove:function(sb){return ob(mb.update('body',function(tb){return tb['delete'](rb);}));}});}).filter(function(qb){return !!qb;});return pb.isEmpty()?null:w.createElement('div',{className:"_5l1-"},pb);}),sa=j.pure(function(lb){var mb=lb.part,nb=lb.onClick,ob=lb.onRemove;return (w.createElement('div',{className:"_5l26"},w.createElement('button',{className:"_1-hv",onClick:nb},mb.getIn(['body','filename'])),w.createElement(z,{onClick:ob})));}),ta=w.createClass({displayName:'InviteComposer',propTypes:{invite:fa.instanceOf(da).isRequired,errors:fa.instanceOf(da),onClose:fa.func.isRequired,onChange:fa.func.isRequired,onSend:fa.func.isRequired,disabled:fa.bool},componentDidMount:function(){var lb=['title','description','location','to'].map(function(mb){return this.refs[mb];}.bind(this)).find(function(mb){return !mb.value;});lb&&lb.focus();},render:function(){var lb=this.props,mb=lb.disabled,nb=lb.invite,ob=lb.errors,pb=lb.onClose,qb=lb.onChange,rb=lb.onSend,sb=function(ub,vb){return (w.createElement(ba,{xuiError:ob.get(vb),xuiErrorPosition:'left'},w.createElement('input',{type:'text',className:"_1-i0 _4h1i",disabled:mb,placeholder:ub,ref:vb,value:nb.get(vb),onChange:function(wb){return qb(nb.set(vb,wb.target.value));}})));},tb=function(ub,vb){return (w.createElement('div',null,ub+':',w.createElement(aa,babelHelpers['extends']({className:"_pto",date:new Date(nb.get(vb)||j.serverNow()),readOnly:mb,allowDuplicateDateSelection:true,onChange:function(wb){return qb(nb.set(vb,+wb));}},j.dateRestraints()))));};return (w.createElement(t,{className:"_ptp"},w.createElement('div',{className:"_ptq"},'Calendar Invite',w.createElement(z,{onClick:pb})),sb('Title','title'),sb('Description','description'),sb('Location','location'),sb('Send to...','to'),tb('Start Time','start'),tb('End Time','end'),mb?null:w.createElement('div',{className:"_5l1v"},w.createElement('button',{onClick:rb,className:"_1-hv _30yy _ptu"},'Send'))));}}),ua=['to'],va=['cc'],wa=['bcc'],xa=['body',0,'body'],ya=r.fromJS([{'content-type':'text/plain; charset=UTF-8',body:''}]),za=r.fromJS({to:'',cc:'',bcc:'',from:'',subject:'',body:ya}),ab=r.fromJS({title:'',description:'',start:null,end:null,location:'',to:''});function bb(){var lb=arguments.length<=0||arguments[0]===undefined?'':arguments[0];return (ab.set('start',j.serverNow()).set('end',j.serverNow()).set('to',lb));}function cb(lb){return lb?lb.split(/[, ]/).filter(function(mb){return mb.length;}):[];}function db(lb){lb=ea(lb);var mb=lb.filterNot(ca);return mb.isEmpty()?null:'Invalid email address(es): '+mb.join(', ')+'.';}function eb(lb){var mb=lb.get('content-type');return (mb&&mb.indexOf('text/plain')>-1||mb.indexOf('text/html')>-1);}function fb(lb,mb){return r.fromJS({'content-type':mb.type,body:{'everstore-handle':lb,filename:mb.name}});}function gb(lb){var mb=lb.getIn(['data','subject']),nb=mb.toUpperCase().startsWith('RE:')?mb:'Re: '+mb;return lb.setIn(['data','subject'],nb).setIn(['data','body'],ya);}function hb(lb){var mb=lb.get('data'),nb=mb.get('from'),ob=mb.getIn(ua);return lb.setIn(['data','from'],ob).setIn(['data','to'],ea([nb]));}function ib(lb){return lb.get('email-address')?w.createElement('strong',null,lb.get('email-address')):null;}function jb(lb){var mb=j.parsePhoneNumber(lb.get('phone-number')),nb=lb.get('phone-extension');return mb?w.createElement('span',null,w.createElement('strong',null,mb,' '),' ext. ',w.createElement('strong',null,nb)):null;}function kb(event){if(event.getIn(['data','recips'])){return event.setIn(['data','to'],event.getIn(['data','recips'])).deleteIn(['data','recips']);}else return event;}f.exports=ga;},null);
__d('OzIntentParams.react',['React','cx'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=h.createClass({displayName:'OzIntentParams',render:function(){return (h.createElement('div',{className:"_3-ue"},this.props.children));}});f.exports=j;},null);
__d('OzIntentParamsAbstractField.react',['React','cx','onlyChild'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=h.PropTypes,l=h.createClass({displayName:'OzIntentParamsAbstractField',propTypes:{hasValue:k.bool,label:k.string},render:function(){return (h.createElement('div',{className:"_5nij"+(!this.props.hasValue?' '+"_2ez0":'')},this.props.label?h.createElement('label',{className:"_2230 ellipsis"},this.props.label):null,h.createElement('div',{className:"_2ulp"},j(this.props.children))));}});f.exports=l;},null);
__d('OzIntentParamsTextField.react',['AbstractTextArea.react','DOMQuery','OzIntentParamsAbstractField.react','ReactComponentWithPureRenderMixin','React','ReactDOM','TextAreaControl','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=l.PropTypes,q=l.createClass({displayName:'OzIntentParamsTextField',mixins:[k],propTypes:{label:p.string,onAsk:p.func,onChange:p.func,question:p.string,value:p.string.isRequired},_control:null,componentDidMount:function(){var r=i.find(m.findDOMNode(this),'textarea');this._control=new n(r);this._control.setAutogrow(true);this._control.onupdate();},componentDidUpdate:function(r,s){if(r.value!==this.props.value)this._control.onupdate();},render:function(){return (l.createElement(j,{hasValue:!!this.props.value,onAsk:this.props.onAsk,question:this.props.question},l.createElement(h,{onChange:this._handleChange,placeholder:this.props.label,value:this.props.value})));},_handleChange:function(r){var s=r.target;!(s instanceof HTMLTextAreaElement)?o(0):undefined;this.props.onChange&&this.props.onChange(s.value);}});f.exports=q;},null);
__d('OzRequirementTokenizer.react',['Promise','OzHelpers','cx','immutable','OzSearchSource','ReactComponentWithPureRenderMixin','React','SearchableEntry','XUITokenizer.react','XUITokenizerToken.react','TypeaheadViewItem','TypeaheadViewPropTypes'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=k.Map,u=k.List,v=n.PropTypes,w=n.createClass({displayName:'OzRequirementTokenizer',mixins:[m],propTypes:{allRequirements:v.instanceOf(t).isRequired,onCreateRequirement:v.func.isRequired,onDeleteRequirement:v.func.isRequired,onQueryStringChange:v.func.isRequired,queryString:v.string.isRequired,selectedRequirements:v.instanceOf(u)},componentWillMount:function(){var da=this.props,ea=da.allRequirements,fa=da.witIntentUUID;this._searchSource=new l(function(ga){var ha=ga.query;return h.resolve(ba(ha,ea,fa));});},render:function(){var da=this.props.selectedRequirements||u();return (n.createElement('div',{className:"_59rt"},n.createElement(p,{className:"_4s6a",placeholder:'Add a requirement...',entries:da.map(ca).toJS(),presenter:aa,queryString:this.props.queryString,searchSource:this._searchSource,onRemoveEntryAttempt:this.props.onDeleteRequirement,onAddEntryAttempt:this.props.onCreateRequirement,onQueryStringChange:this.props.onQueryStringChange})));}}),x=i.pure(function(da){return (n.createElement(q,babelHelpers['extends']({},da,{className:"_59ru"})));}),y=n.createClass({displayName:'OzTypeaheadViewItem',mixins:[r.Mixin],propTypes:r.propTypes,render:function(){var da=this.props.highlighted;return (n.createElement('li',{className:"_59rv"+(da?' '+"_59rw":''),'aria-selected':this.props.highlighted,onMouseDown:this._onSelect,onMouseEnter:this._onHighlight,role:this.props.role},this.props.entry.getTitle()));}}),z=n.createClass({displayName:'OzTypeaheadView',mixins:[m],propTypes:s,_renderItem:function(da){var ea=da===this.props.highlightedEntry;return (n.createElement(y,{key:da.getUniqueID(),entry:da,highlighted:ea,onSelect:this.props.onSelect,onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight}));},render:function(){var da="_59rx"+(!this.props.entries.length?' '+"_599s":'');return (n.createElement('ul',{className:da,id:this.props.ariaOwneeID,role:this.props.role},this.props.entries.map(this._renderItem)));}}),aa={ViewRenderer:z,TokenRenderer:x,useLayer:false};function ba(){var da=arguments.length<=0||arguments[0]===undefined?'':arguments[0],ea=arguments[1],fa=arguments[2];if(!da)return [];var ga=function(ia){var ja=ia.get('wit-intent-uuids').has(fa)?100000:0;return -(ja+ia.get('used-count',0));},ha=ea.filter(function(ia){return ia.get('name').indexOf(da)>=0;}).sortBy(ga).map(ca).take(10).toList();return da&&!ea.has(da)?ha.push(ca(t({name:da,id:da}))).toJS():ha.toJS();}function ca(da){return new o({title:da.get('name'),uniqueID:da.get('id')});}f.exports=w;},null);
__d('OzCheckboxInput.react',['AbstractCheckboxInput.react','ReactComponentWithPureRenderMixin','React','cx','invariant','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=j.createClass({displayName:'OzCheckboxInput',mixins:[i],render:function(){return (j.createElement(h,babelHelpers['extends']({},this.props,{className:m(this.props.className,"_55sg _4k1t"),onChange:this._handleChange})));},_handleChange:function(o){var p=o.target;!(p instanceof HTMLInputElement)?l(0):undefined;this.props.onChange&&this.props.onChange(p.checked);}});f.exports=n;},null);
__d('OzSidebarItemHeader.react',['OzHelpers','immutable','Keys','OzCheckboxInput.react','OzDate.react','ReactComponentWithPureRenderMixin','React','Tooltip','XUIAbstractGlyphButton.react','XUICloseButton.react','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=i.Map,u=n.PropTypes,v=n.createClass({displayName:'OzSidebarItemHeader',mixins:[m],propTypes:{alias:u.string,closedAt:u.number,createdAt:u.number,creator:u.string,isExpanded:u.bool.isRequired,isClosed:u.bool.isRequired,isBlocked:u.bool,onChangeAlias:u.func,onDelete:u.func,onIsExpandedToggle:u.func.isRequired,onToggle:u.func.isRequired,subtitle:u.node,title:u.string.isRequired},getInitialState:function(){return {isEditing:false};},render:function(){var y=this.props,z=y.alias,aa=y.className,ba=y.closedAt,ca=y.createdAt,da=y.creator,ea=y.isClosed,fa=y.isExpanded,ga=y.isBlocked,ha=y.onDelete,ia=y.onIsExpandedToggle,ja=y.onToggle,ka=y.subtitle,la=y.title,ma=ea?ba&&new Date(ba):ca&&new Date(ca),na='Created by '+(da||'');return (n.createElement('div',{className:s(aa,"_31gu"+(fa?' '+"_31gx":'')+(ea?' '+"_31gy":'')+(ga?' '+"_27qc":''))},n.createElement(k,{checked:ea,className:"_31gz",onChange:ja}),n.createElement('div',{className:"_31g-"},n.createElement('div',null,n.createElement('span',null,ma?n.createElement(l,{className:"_56sd",date:ma}):null),n.createElement(x,{alias:z,isEditing:this.state.isEditing,name:la,onChange:this._handleChangeAlias,onStartEditing:this._handleStartEditing,onCancelEditing:function(oa){return this.setState({isEditing:false});}.bind(this),tooltip:na})),n.createElement('span',{className:"_31h0"},ka)),n.createElement('div',{className:"_3_41"},this.props.children,n.createElement(p,{className:"_31h1",onClick:ia}),ha?n.createElement('div',{className:"_31h2"},n.createElement(q,{shade:'dark',onClick:ha})):null)));},_handleStartEditing:function(){this.props.onChangeAlias&&this.setState({isEditing:true});},_handleChangeAlias:function(y){var z=this.props.onChangeAlias;if(y.which===j.RETURN){z&&z(y.target.value);this.setState({isEditing:false});}}}),w=function(y){if(y.setSelectionRange){var z=y.value.length;y.setSelectionRange(z,z);}},x=h.pure(function(y){var z=y.name,aa=y.isEditing,ba=y.alias,ca=y.tooltip,da=y.onChange,ea=y.onStartEditing,fa=y.onCancelEditing;return (aa?n.createElement('textarea',{className:"_31g_"+(' '+"_1p0b"),onKeyDown:da,placeholder:z,defaultValue:ba,onBlur:fa,ref:function(ga){if(ga){ga.focus();w(ga);}}}):n.createElement('span',babelHelpers['extends']({className:"_31g_",onClick:ea},o.propsFor(ca)),ba||z));});f.exports=v;},null);
__d('OzGenericIntent.react',['cx','OzHelpers','immutable','invariant','MessengerButton.react','OzConfig','OzFormPreview.react','OzIntentEvents.react','OzIntentParams.react','OzRequirementTokenizer.react','OzSidebarItemHeader.react','ReactComponentWithPureRenderMixin','React','SearchableEntry','OzIntentParamsTextField.react','Tooltip'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){'use strict';if(c.__markCompiled)c.__markCompiled();var x=n.Row,y=j.Map,z=t.PropTypes,aa=t.createClass({displayName:'OzGenericIntent',mixins:[s],propTypes:{intent:z.instanceOf(y).isRequired,intentMeta:z.instanceOf(y).isRequired,isExpanded:z.bool.isRequired,notes:z.string.isRequired,onCallClick:z.func.isRequired,onChangeAlias:z.func.isRequired,onClose:z.func.isRequired,onNotesChange:z.func.isRequired,onOpen:z.func.isRequired,onIsExpandedToggle:z.func.isRequired,onIsBlockedToggle:z.func.isRequired,requirements:z.instanceOf(y).isRequired,onCreateRequirement:z.func,onDelete:z.func,onDeleteRequirement:z.func,repNames:z.instanceOf(y).isRequired,userEmail:z.string},getInitialState:function(){return {requirementQuery:''};},render:function(){var da=this.props,ea=da.intent,fa=da.intentMeta,ga=da.isExpanded,ha=da.repNames,ia=ea.get('creator-fbid'),ja=ha.get(ia,ia),ka=ea.get('blocked'),la=fa.get('name')+(ka?' (Waiting)':'');return (t.createElement('div',null,t.createElement(r,{alias:ea.get('alias'),className:"_a2q",isExpanded:ga,isClosed:i.isClosedIntent(ea),isBlocked:ka,onChangeAlias:this._handleChangeAlias,onDelete:this._handleDelete,onIsExpandedToggle:this._handleIsExpandedToggle,onToggle:this._handleToggle,title:la,createdAt:ea.get('created-at'),closedAt:ea.get('closed-at'),creator:ja}),this._renderBody()));},_renderBody:function(){var da=this.props,ea=da.intent,fa=da.isExpanded;if(!fa)return null;return (t.createElement('div',null,t.createElement(ca,{blocked:ea.get('blocked'),onIsBlockedToggle:this._handleIsBlockedToggle}),m.GK.email?null:t.createElement(ba,{intent:ea,onClick:this._handleCallClick}),t.createElement(p,null,this.props.children),t.createElement('div',{className:"_1x-e"},t.createElement(q,{allRequirements:this.props.requirements,onCreateRequirement:this._handleCreateRequirement,onDeleteRequirement:this._handleDeleteRequirement,onQueryStringChange:this._handleQueryStringChange,queryString:this.state.requirementQuery,selectedRequirements:ea.get('requirements')})),t.createElement(p,null,t.createElement('div',{className:"_19ny"},t.createElement(v,{label:'Add notes about this task...',onChange:this.props.onNotesChange,value:this.props.notes}))),m.GK.email?t.createElement(o,{intent:ea,userEmail:this.props.userEmail,onCallClick:this._handleCallClick}):null));},_handleCallClick:function(){var da=this.props,ea=da.intent,fa=da.onCallClick;fa&&fa(ea);},_handleChangeAlias:function(da){var ea=this.props,fa=ea.intent,ga=ea.onChangeAlias;ga&&ga(fa,da);},_handleDelete:function(){var da=this.props,ea=da.intent,fa=da.onDelete;fa&&fa(ea.get('id'));},_handleIsBlockedToggle:function(){var da=this.props,ea=da.intent,fa=da.onIsBlockedToggle;fa(ea);},_handleIsExpandedToggle:function(){var da=this.props,ea=da.intent,fa=da.onIsExpandedToggle,ga=da.isExpanded;fa(ea,ga);},_handleCreateRequirement:function(da){var ea=this.props,fa=ea.intent,ga=ea.onCreateRequirement;if(ga)ga(fa.get('id'),da.getTitle());this.setState({requirementQuery:''});},_handleDeleteRequirement:function(da){var ea=this.props,fa=ea.intent,ga=ea.onDeleteRequirement;if(ga)ga(fa.get('id'),da.getUniqueID());},_handleQueryStringChange:function(da){var ea=da.target;!(ea instanceof HTMLInputElement)?k(0):undefined;this.setState({requirementQuery:ea.value});},_handleToggle:function(){var da=this.props,ea=da.intent,fa=da.onOpen,ga=da.onClose,ha=i.isClosedIntent(ea);this.setState({isExpanded:ha},function(ia){return ((ha?fa:ga)(ea.get('id')));});}}),ba=i.pure(function(da){var ea=da.onClick,fa=da.intent,ga=i.parsePhoneNumber(fa.get('phone-number')),ha=ga?'Use '+ga+' ext. '+fa.get('phone-extension')+' to call':'Click to create a phone number for this intent';return (t.createElement('div',{className:"_1x-f"},t.createElement(l,babelHelpers['extends']({type:'primary',label:'Make a Call',onClick:ea,style:{fontSize:'13px'}},w.propsFor(ha))),ga?t.createElement('span',null,t.createElement('strong',null,ga,' '),'ext. ',t.createElement('strong',null,fa.get('phone-extension'))):null));}),ca=i.pure(function(da){var ea=da.blocked,fa=da.onIsBlockedToggle,ga='Check when blocked by an external factor (not load)',ha=t.createElement('span',w.propsFor(ga),'Waiting?');return (t.createElement('div',{className:"_5xr7"},t.createElement(x,{label:ha},t.createElement('input',{type:'checkbox',checked:ea,onChange:fa}))));});f.exports=aa;},null);
__d('OzIntentParamsDateTimeField.react',['OzIntentParamsAbstractField.react','ReactComponentWithPureRenderMixin','React','XUIDateTimePicker.react'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'OzIntentParamsDateTimeField',mixins:[i],propTypes:{label:l.string,onChange:l.func,value:l.instanceOf(Date)},render:function(){return (j.createElement(h,{hasValue:!!this.props.value,label:this.props.label},j.createElement(k,{date:this.props.value,dateIcon:null,datePlaceholder:this.props.label,onChange:this.props.onChange,shouldSetDefaultDate:false})));}});f.exports=m;},null);
__d('OzIntentParamsEnumField.react',['immutable','OzIntentParamsAbstractField.react','ReactComponentWithPureRenderMixin','React','XUISingleSelector.react'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=l.Option,n=k.PropTypes,o=h.List,p=k.createClass({displayName:'OzIntentParamsEnumField',mixins:[j],propTypes:{label:n.string,onChange:n.func,onSave:n.func,placeholder:n.string,values:n.arrayOf(n.string).isRequired,value:n.string},getInitialState:function(){return {value:this.props.value||''};},render:function(){var q=o(this.props.values).map(function(r){return (k.createElement(m,{key:r,value:r},r));}).unshift(k.createElement(m,{key:this.props.placeholder,value:''},this.props.placeholder));return (k.createElement(i,{hasValue:!!this.state.value,label:this.props.label},k.createElement(l,{maxHeight:240,onChange:this._handleChange,value:this.state.value},q)));},_handleChange:function(q){this.props.onChange&&this.props.onChange(q.value);this.setState({value:q.value},this._save);},_save:function(){if(this.props.onSave)this.props.onSave(this.state.value);}});f.exports=p;},null);
__d('OzIntentParamsNumberField.react',['FBNumberInput.react','OzIntentParamsAbstractField.react','ReactComponentWithPureRenderMixin','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=k.PropTypes,n=k.createClass({displayName:'OzIntentParamsNumberField',mixins:[j],propTypes:{label:m.string,onChange:m.func,placeholder:m.string,value:m.number},render:function(){return (k.createElement(i,{hasValue:this.props.value!=null,label:this.props.label},k.createElement(h,{className:"_3dag",onValueChange:this.props.onChange,placeholder:this.props.placeholder,value:this.props.value})));}});f.exports=n;},null);
__d('OzIntentParamsPriceRangeField.react',['OzIntentParamsAbstractField.react','ReactComponentWithPureRenderMixin','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=[1,2,3,4],n=j.createClass({displayName:'OzIntentParamsPriceRangeField',mixins:[i],propTypes:{label:l.string,onChange:l.func,value:l.oneOf(m)},render:function(){var o=this.props.value;return (j.createElement(h,{hasValue:!!o,label:this.props.label},j.createElement('span',{className:"_8l3"},m.map(function(p){return (j.createElement('span',{className:"_8l4"+(o&&p<=o?' '+"_8l6":''),key:p,onClick:function(q){return this._handleDollarClick(q,p);}.bind(this)},'$'));}.bind(this)))));},_handleDollarClick:function(o,p){o.preventDefault();var q=this.props.value==p?null:p;this.props.onChange&&this.props.onChange(q);}});f.exports=n;},null);
__d('OzIntentParamsStringField.react',['AbstractTextInput.react','OzIntentParamsAbstractField.react','ReactComponentWithPureRenderMixin','React','invariant','debounce'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=k.PropTypes,o=k.createClass({displayName:'OzIntentParamsStringField',mixins:[j],propTypes:{label:n.string,onChange:n.func,onSave:n.func,placeholder:n.string,value:n.string},getInitialState:function(){return {value:this.props.value||''};},componentWillMount:function(){this._save=m(this._save,750,this,true);},render:function(){return (k.createElement(i,{hasValue:!!this.state.value,label:this.props.label},k.createElement(h,{onChange:this._handleChange,placeholder:this.props.placeholder,type:'text',value:this.state.value})));},_handleChange:function(p){var q=p.target;!(q instanceof HTMLInputElement)?l(0):undefined;this.props.onChange&&this.props.onChange(q.value);this.setState({value:q.value},this._save);},_save:function(){if(this.props.onSave)this.props.onSave(this.state.value);}});f.exports=o;},null);
__d('OzIntentFactoryHelpers',['immutable','React','OzIntentParamsStringField.react','OzIntentParamsNumberField.react','OzIntentParamsPriceRangeField.react','OzIntentParamsEnumField.react','OzIntentParamsDateTimeField.react'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=h.Map,k={makeStateUpdater:function(n){return function(o){var p;this._setStateAndSave((p={},p[n]=o,p));};},makeStateExtractor:function(n){return function(o){var p=o.get('params')||j(),q={};for(var r=n,s=Array.isArray(r),t=0,r=s?r:r[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var u;if(s){if(t>=r.length)break;u=r[t++];}else{t=r.next();if(t.done)break;u=t.value;}var v=u,w=v.name,x=v.type,y=l(p,w);switch(x){case 'string':case 'enum':q[w]=''+(y||'');break;case 'number':case 'pricerange':q[w]=+y||null;break;case 'datetime':q[w]=y&&new Date(y);}}return babelHelpers['extends']({},q,{notes:o.get('notes')||''});};},makeParamsUpdater:function(n){return function(o,p){return (o||j()).withMutations(function(q){for(var r=n,s=Array.isArray(r),t=0,r=s?r:r[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var u;if(s){if(t>=r.length)break;u=r[t++];}else{t=r.next();if(t.done)break;u=t.value;}var v=u,w=v.name,x=v.type;switch(x){case 'datetime':var y=p[w],z=y?{value:y.toISOString(),grain:'minute'}:undefined;m(q,w,z);break;default:m(q,w,{value:p[w]});break;}}});};},makeFieldRenderer:function(n){return function(){return n.map(function(o){var p=o.label,q=o.name,r=o.placeholder,s=o.type,t=o.values,u=k.getFieldComponent(s);return (i.createElement(u,{key:q,label:p,onChange:this._changeHandlers.get(q),placeholder:r||p,value:this.state[q],values:t}));}.bind(this));};},getFieldComponent:function(n){switch(n){case 'string':return c('OzIntentParamsStringField.react');case 'number':return c('OzIntentParamsNumberField.react');case 'pricerange':return c('OzIntentParamsPriceRangeField.react');case 'enum':return c('OzIntentParamsEnumField.react');case 'datetime':return c('OzIntentParamsDateTimeField.react');default:throw new Error('OzIntentFactoryHelpers: Unknown field type '+n+'.');}}};function l(n,o){var p=n.get(o);if(p&&!p.isEmpty())return p.first().get('value');return null;}function m(n,o,p){n.set(o,h.fromJS([p]));}f.exports=k;},null);
__d('OzIntentSchemas',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={get:function(z){switch(z){case 'restaurant':return j;case 'reminder':return k;case 'nonmedical_appointment':return l;case 'local_search':return m;case 'good_purchase':return n;case 'customer_service_general':return o;case 'weather_forecast':return p;case 'hotel_and_accommodation':return q;case 'activities_things_to_do':return r;case 'ticket_purchase':return s;case 'food_purchase':return t;case 'utility':return u;case 'vehicle_service':return v;case 'traffic':return w;case 'navigation':return x;case 'flight_request':return y;default:return i;}}},i={name:'Generic',fields:[]},j={name:'Restaurant',fields:[{type:'enum',name:'request_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','info','location','option','price','receipt','time','schedule']},{type:'string',name:'restaurant_name',label:'Name',placeholder:'Restaurant Name'},{type:'string',name:'restaurant_cuisine',label:'Cuisine'},{type:'string',name:'location',label:'Location'},{type:'number',name:'people_number',label:'Guests',placeholder:'Number of guests'},{type:'datetime',name:'datetime',label:'Date/Time'},{type:'pricerange',name:'amount_of_money',label:'Price Range'}]},k={name:'reminder',fields:[{type:'datetime',name:'datetime',label:'Reminder Time'},{type:'string',name:'reminder',label:'About'}]},l={name:'NonMedicalAppt',fields:[{type:'enum',name:'appt_action',label:'Action',placeholder:'Pick one...',values:['availability','cancel','move','confirm','book']},{type:'string',name:'appt_type',label:'Appt Type',placeholder:'Type of appointment'},{type:'string',name:'location',label:'Location',placeholder:'Location of appointment'},{type:'datetime',name:'datetime',label:'Datetime',placeholder:'Date and time of the appointment'},{type:'string',name:'local_search_query',label:'Name',placeholder:'Name of the place'}]},m={name:'LocalSearch',fields:[{type:'string',name:'local_query',label:'Query',placeholder:'Search query like yoga class...'},{type:'string',name:'location',label:'Location',placeholder:''},{type:'string',name:'local_name',label:'Name',placeholder:'Name of the place or business...'},{type:'datetime',name:'datetime',label:'Datetime',placeholder:''}]},n={name:'GoodPurchase',fields:[{type:'string',name:'good',label:'Good',placeholder:''},{type:'string',name:'provider',label:'Merchant',placeholder:''},{type:'string',name:'amount_of_money',label:'Price'},{type:'number',name:'good_number',label:'Items #',placeholder:'Number of Items'},{type:'string',name:'location',label:'Location',placeholder:''},{type:'datetime',name:'datetime',label:'Datetime'}]},o={name:'CustomerService',fields:[{type:'string',name:'provider',label:'Merchant'},{type:'string',name:'order_number',label:'Order #'}]},p={name:'Weather',fields:[{type:'string',name:'location',label:'Location'},{type:'datetime',name:'datetime',label:'Datetime'},{type:'string',name:'weather_type',label:'Type of forecast',placeholder:'temperature, snow, tide...'},{type:'string',name:'temperature_metric',label:'Metric',placeholder:'Celsius or Fahrenheit'}]},q={name:'Hotel',fields:[{type:'enum',name:'hotel_query_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','contact','extend','receipt']},{type:'string',name:'location',label:'Location'},{type:'datetime',name:'datetime',label:'Check in',placeholder:'Date and time of the appointment'},{type:'number',name:'night_number',label:'Nights #',placeholder:'Number of Nights'},{type:'number',name:'people',label:'People',placeholder:'Number of Guests'},{type:'string',name:'amount_of_money',label:'Price'},{type:'string',name:'hotel_name',label:'Hotel Name'}]},r={name:'Activities',fields:[{type:'string',name:'reservation_type',label:'Activity'},{type:'string',name:'location',label:'Location'},{type:'datetime',name:'datetime',label:'Datetime'},{type:'string',name:'amount_of_money',label:'Price'},{type:'number',name:'people_number',label:'People',placeholder:'Number of People'}]},s={name:'Tickets',fields:[{type:'enum',name:'request_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','info','location','option','price','receipt','time','schedule']},{type:'string',name:'event_type',label:'Type',placeholder:'Movie, show, concert...'},{type:'string',name:'event',label:'Name'},{type:'string',name:'event_venue',label:'Venue'},{type:'string',name:'location',label:'Location'},{type:'datetime',name:'datetime',label:'Datetime'},{type:'string',name:'amount_of_money',label:'Price'},{type:'number',name:'people_number',label:'Tickets #',placeholder:'Number of Tickets'}]},t={name:'FoodPurchase',fields:[{type:'string',name:'order',label:'Order',placeholder:''},{type:'string',name:'food_type',label:'Food Type',placeholder:''},{type:'string',name:'food_place',label:'Place'},{type:'enum',name:'delivery_type',label:'Delivery',placeholder:'Pick one...',values:['deliver','takeout']},{type:'string',name:'location',label:'Location',placeholder:''},{type:'datetime',name:'datetime',label:'Datetime'}]},u={name:'Utility',fields:[{type:'enum',name:'request_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','info','location','option','price','receipt','time','schedule']},{type:'string',name:'utility_provider',label:'Name',placeholder:'Name of the utility company'},{type:'string',name:'location',label:'Location',placeholder:''},{type:'string',name:'account_nbr',label:'Account #',placeholder:''}]},v={name:'Vehicle',fields:[{type:'enum',name:'hotel_query_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','info','location','option','price','receipt','time','schedule']},{type:'string',name:'from',label:'From'},{type:'string',name:'to',label:'To'},{type:'datetime',name:'datetime',label:'Datetime',placeholder:'Date and time of the ride'},{type:'string',name:'car_type',label:'Car Type',placeholder:'Type of car (limo, uber, lift...)'},{type:'string',name:'people_number',label:'People',placeholder:'Number of Guests'},{type:'string',name:'vehicle_provider',label:'Rental Name',placeholder:'Car rental name like Hertz, Avis..'}]},w={name:'Traffic',fields:[{type:'string',name:'from',label:'Starting Point'},{type:'string',name:'to',label:'Destination'},{type:'datetime',name:'datetime',label:'Date/Time',placeholder:'Intended departure time (not supported by automation)'}]},x={name:'Navigation',fields:[{type:'string',name:'from',label:'Starting Point'},{type:'string',name:'to',label:'Destination'},{type:'datetime',name:'datetime',label:'Date/Time',placeholder:'Intended departure time (not supported by automation)'}]},y={name:'flight_request',fields:[{type:'enum',name:'flight_query_type',label:'Action',placeholder:'Pick one...',values:['book','price','upgrade','flight_status','cancel','change']},{type:'string',name:'from',label:'From'},{type:'string',name:'to',label:'To'},{type:'datetime',name:'departure',label:'Departure'},{type:'datetime',name:'arrival',label:'Arrival'},{type:'string',name:'carrier',label:'Carrier'},{type:'string',name:'reference',label:'Reference Number'},{type:'number',name:'passenger_num',label:'Passenger Number'}]};f.exports=h;},null);
__d('OzIntentFactory',['immutable','Map','OzAPI','OzGenericIntent.react','OzIntentFactoryHelpers','OzIntentSchemas','ReactComponentWithPureRenderMixin','React','debounce'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=o.PropTypes,r=new i(),s={get:function(u){var v=m.get(u);if(!r.has(u))r.set(u,t(v));return r.get(u);}};function t(u){var v=h.Map,w=u.name,x=u.fields,y=10000,z=l.makeStateExtractor(x),aa=l.makeFieldRenderer(x),ba=l.makeParamsUpdater(x);return o.createClass({displayName:'Oz'+w+'DynamicIntent',mixins:[n],propTypes:{intent:q.instanceOf(v).isRequired,intentMeta:q.instanceOf(v).isRequired,isExpanded:q.bool.isRequired,onCallClick:q.func.isRequired,onChangeAlias:q.func,onClose:q.func.isRequired,onOpen:q.func.isRequired,onIsExpandedToggle:q.func.isRequired,onIsBlockedToggle:q.func.isRequired,requirements:q.instanceOf(v).isRequired,repNames:q.instanceOf(v).isRequired,onCreateRequirement:q.func,onDelete:q.func,onDeleteRequirement:q.func,userEmail:q.string},getInitialState:function(){return babelHelpers['extends']({isEditing:false},z(this.props.intent));},componentWillMount:function(){this._saveIntent=p(this._saveIntent,500,this,true);this._changeHandlers=v().withMutations(function(ca){for(var da=x,ea=Array.isArray(da),fa=0,da=ea?da:da[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ga;if(ea){if(fa>=da.length)break;ga=da[fa++];}else{fa=da.next();if(fa.done)break;ga=fa.value;}var ha=ga;ca.set(ha.name,l.makeStateUpdater(ha.name).bind(this));}}.bind(this));},componentWillReceiveProps:function(ca){var da=this.state.isEditing;if(h.is(ca.intent,this.props.intent)||da)return;this.setState(z(ca.intent));},componentWillUnmount:function(){window.clearTimeout(this._editingTimeout);},render:function(){return (o.createElement(k,babelHelpers['extends']({},this.props,{notes:this.state.notes,onNotesChange:this._handleNotesChange}),this._renderFields()));},_renderFields:aa,_handleNotesChange:function(ca){this._setStateAndSave({notes:ca});},_saveIntent:function(){var ca=this.props.intent;j.editIntent(ca.get('user-id'),v({id:ca.get('id'),params:ba(ca.get('params'),this.state),notes:this.state.notes}));},_setStateAndSave:function(ca){window.clearTimeout(this._editingTimeout);this.setState(babelHelpers['extends']({isEditing:true},ca),this._saveIntent);this._editingTimeout=window.setTimeout(function(da){return this.setState({isEditing:false});}.bind(this),y);}});}f.exports=s;},null);
__d('OzIntent.react',['immutable','OzIntentFactory','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.Map,m=k.PropTypes,n=k.createClass({displayName:'OzIntent',mixins:[j],propTypes:{intent:m.instanceOf(l).isRequired,intentMeta:m.instanceOf(l).isRequired,isExpanded:m.bool.isRequired,onCallClick:m.func.isRequired,onChangeAlias:m.func.isRequired,onIsExpandedToggle:m.func.isRequired,onIsBlockedToggle:m.func.isRequired,requirements:m.instanceOf(l).isRequired,repNames:m.instanceOf(l).isRequired,onClose:m.func,onCreateRequirement:m.func,onDelete:m.func,onDeleteRequirement:m.func,onOpen:m.func,userEmail:m.string},render:function(){var o=this.props,p=o.intent,q=o.intentMeta,r=o.isExpanded,s=o.onIsExpandedToggle,t=o.onIsBlockedToggle,u=o.repNames,v=o.requirements,w=o.userEmail,x=i.get(q.get('name'));return (k.createElement(x,{intent:p,intentMeta:q,isExpanded:r,onCallClick:this.props.onCallClick,onChangeAlias:this.props.onChangeAlias,onClose:this.props.onClose,onCreateRequirement:this.props.onCreateRequirement,onDelete:this.props.onDelete,onDeleteRequirement:this.props.onDeleteRequirement,onOpen:this.props.onOpen,onIsExpandedToggle:s,onIsBlockedToggle:t,repNames:u,requirements:v,userEmail:w}));}});f.exports=n;},null);
__d('OzIntentList.react',['Promise','OzHelpers','OzAPI','immutable','OzActions','OzIntent.react','OzStores','ReactComponentWithPureRenderMixin','React','ReactCSSTransitionGroup','Reflux'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=p.PropTypes,t=k.Map,u=n.ActiveThreadStore,v=p.createClass({displayName:'OzIntentList',mixins:[o,r.connect(u,'activeThread')],propTypes:{threadID:s.string.isRequired,intents:s.instanceOf(k.List).isRequired,requirements:s.instanceOf(k.Map).isRequired,repNames:s.instanceOf(t).isRequired,userEmail:s.string,witIntents:s.instanceOf(k.Map).isRequired},render:function(){var x=this.props.witIntents,y=this.props.intents.map(function(z){var aa=z.get('wit-intent-uuid'),ba=x.get(aa);if(!ba){i.error('could not find witIntent for',z);return [z,t({name:z.get('name')+' ('+aa+')'})];}return [z,ba];}).filter(function(z){return !!z;}).map(this._renderIntent).valueSeq();if(y.isEmpty())return null;return (p.createElement('div',null,p.createElement(q,{transitionName:'oz-fade-in-out',transitionEnterTimeout:300,transitionLeaveTimeout:300},y)));},_renderIntent:function(x){var y=x[0],z=x[1],aa=this.state.activeThread,ba=aa.get('activeIntent')===y.get('id');return (p.createElement(m,{intent:y,intentMeta:z,isExpanded:ba,key:y.get('id'),onCallClick:this._handleCallClick,onChangeAlias:this._handleChangeAlias,onClose:this._handleClose,onCreateRequirement:this._handleCreateRequirement,onDelete:this._handleDelete,onDeleteRequirement:this._handleDeleteRequirement,onIsExpandedToggle:this._handleIsExpandedToggle,onIsBlockedToggle:this._handleIsBlockedToggle,onOpen:this._handleOpen,repNames:this.props.repNames,requirements:this.props.requirements,userEmail:this.props.userEmail}));},_handleClose:function(x){j.closeIntent(this.props.threadID,x);},_handleDelete:function(x){j.deleteIntent(this.props.threadID,x);},_handleOpen:function(x){j.openIntent(this.props.threadID,x);},_handleDeleteRequirement:function(x,y){j.deleteIntentRequirement(this.props.threadID,x,y);},_handleCreateRequirement:function(x,y){j.createIntentRequirement(this.props.threadID,x,y);},_handleCallClick:function(x){w(this.props.threadID,x).done(function(y){return l.twilio.useIntent(y);});},_handleChangeAlias:function(x,y){j.editIntent(x.get('user-id'),t({id:x.get('id'),alias:y}));},_handleIsExpandedToggle:function(x,y){l.activateIntent(y?null:x.get('id'));},_handleIsBlockedToggle:function(x){x.get('blocked')?j.unblockIntent(this.props.threadID,x.get('id')):j.blockIntent(this.props.threadID,x.get('id'));}});function w(x,y){var z=y.get('phone-number');return z?h.resolve(y):j.addPhoneNumber(x,y.get('id')).then(function(aa){return aa.get('intents').find(function(ba){return ba.get('id')===y.get('id');});});}f.exports=v;},null);
__d('OzHistoryIntentList.react',['OzHelpers','immutable','OzIntentList.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=i.Map,n=l.PropTypes,o=l.createClass({displayName:'OzTodoIntentList',mixins:[k],propTypes:{repNames:n.instanceOf(m).isRequired,requirements:n.instanceOf(m).isRequired,thread:n.instanceOf(m).isRequired,witIntents:n.instanceOf(m).isRequired},render:function(){var p=h.intents(this.props.thread).filter(h.isClosedIntent);return (l.createElement(j,{intents:p,repNames:this.props.repNames,requirements:this.props.requirements,threadID:h.threadID(this.props.thread),userEmail:h.userEmail(this.props.thread),witIntents:this.props.witIntents}));}});f.exports=o;},null);
__d('OzIntentPicker.react',['Promise','immutable','OzSearchSource','React','SearchableDropdownInput.contrib','SearchableEntry','XUIError.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=i.Map,q=k.PropTypes,r=k.createClass({displayName:'OzIntentPicker',contextTypes:{witIntents:q.instanceOf(p).isRequired},propTypes:{onPick:q.func.isRequired,diag:q.instanceOf(p),onToggle:q.func},getInitialState:function(){return {selected:null,errors:p()};},componentWillMount:function(){this._searchSource=new j(function(w){var x=w.query;return h.resolve(s(x,this.context.witIntents));}.bind(this));},componentDidMount:function(){var w=this.refs&&this.refs.dropdown,x=!!document.querySelector('*:focus');if(w&&!x)w.focusInput();},render:function(){return (k.createElement('div',{className:"_4nd2"},k.createElement(n,{xuiError:this.state.errors.get('picker')},k.createElement(l,{ref:'dropdown',searchSource:this._searchSource,value:this._selected(),onSelect:function(w){return this.setState({selected:w});}.bind(this),placeholder:'Pick Intent'})),k.createElement('button',{className:"_4nd3 _4nd4 _30yy",onClick:this._handlePick})));},_selected:function(){var w=this.props.diag;return this.state.selected||u(w,this.context.witIntents);},_handlePick:function(){var w=p(),x=this._selected();if(!x)w=w.set('picker','You need to select an intent');this.setState({errors:w});if(w.size)return;this.props.onPick(p({name:x.getTitle(),'wit-intent-uuid':x.getUniqueID()}));}});function s(w,x){if(!w)return [];return x.filter(function(y){return (!v(y)&&(y.get('name')+y.get('doc')).toLowerCase().indexOf(w)>=0);}).map(t).valueSeq().take(15).toJS();}function t(w){return new m({title:w.get('name'),subtitle:w.get('doc'),uniqueID:w.get('id')});}function u(w,x){if(!w)return null;var y=x.get(w.get('wit-intent-uuid'));if(!y||v(y))return null;return t(y.merge(w));}function v(w){return w.get('name').match(/^dialog_/);}f.exports=r;},null);
__d('OzMessageCommentDialog.react',['ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','MessengerButton.react','React','XUIContextualDialog.react','cx','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=k.PropTypes,p=k.createClass({displayName:'OzMessageCommentDialog',propTypes:{contextRef:o.func.isRequired,feedback:o.string,onBlur:o.func,onFeedbackChange:o.func.isRequired,onSave:o.func.isRequired},render:function(){return (k.createElement(l,{behaviors:{ContextualLayerAutoFlip:h,ContextualLayerUpdateOnScroll:i},contextRef:this.props.contextRef,shown:true,position:'below',onBlur:this.props.onBlur},k.createElement('div',{className:"_2bxg"},k.createElement('textarea',{className:"_1-i0",maxLength:'200',value:this.props.feedback,onChange:this._handleFeedbackChange,placeholder:'Give a few words for detail'}),k.createElement('div',{className:"_2bxh"},k.createElement(j,{type:'primary',label:'Save',onClick:this.props.onSave})))));},_handleFeedbackChange:function(q){!(q.target instanceof HTMLTextAreaElement)?n(0):undefined;this.props.onFeedbackChange(q.target.value);}});f.exports=p;},null);
__d('OzMessageFeedbackDialog.react',['ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','InputLabel.react','OzButton.react','OzCheckboxInput.react','React','StarsInput.react','XUIContextualDialog.react','XUIContextualDialogBody.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=m.PropTypes,s=['Poor','Average','Great'],t=m.createClass({displayName:'OzMessageFeedbackDialog',propTypes:{contextRef:r.func.isRequired,executionRating:r.oneOf([0,1,2,3]),followedPolicy:r.bool,onClose:r.func,onExecutionRatingChange:r.func,onFollowedPolicyChange:r.func,onResponsivenessRatingChange:r.func,onSave:r.func,onToneRatingChange:r.func,responsivenessRating:r.oneOf([0,1,2,3]),toneRating:r.oneOf([0,1,2,3])},render:function(){return (m.createElement(o,{behaviors:{ContextualLayerAutoFlip:h,ContextualLayerUpdateOnScroll:i},contextRef:this.props.contextRef,shown:true},m.createElement(p,{className:"_5dx"},m.createElement('h3',null,'Tone'),m.createElement(n,{count:this.props.toneRating,large:true,onClick:this.props.onToneRatingChange,starLabels:s}),m.createElement('h3',null,'Execution'),m.createElement(n,{count:this.props.executionRating,large:true,onClick:this.props.onExecutionRatingChange,starLabels:s}),m.createElement('h3',null,'Responsiveness'),m.createElement(n,{count:this.props.responsivenessRating,large:true,onClick:this.props.onResponsivenessRatingChange,starLabels:s}),m.createElement('h3',null,'Followed Policy'),m.createElement('div',null,m.createElement(j,null,m.createElement(l,{checked:this.props.followedPolicy===true,onChange:this._handleYesClick}),m.createElement('label',null,'Yes')),m.createElement(j,null,m.createElement(l,{checked:this.props.followedPolicy===false,onChange:this._handleNoClick}),m.createElement('label',null,'No'))),m.createElement('div',{className:"_5dy"},m.createElement(k,{onClick:this.props.onClose},'Cancel'),m.createElement(k,{className:"_5dz",onClick:this.props.onSave,use:'confirm'},'Save')))));},_handleYesClick:function(){var u=this.props.onFollowedPolicyChange;u&&u(true);},_handleNoClick:function(){var u=this.props.onFollowedPolicyChange;u&&u(false);}});f.exports=t;},null);
__d('OzMessageFeedback.react',['cx','OzHelpers','joinClasses','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','immutable','ReactLayeredComponentMixin','MessengerButton.react','OzMessageCommentDialog.react','OzMessageFeedbackDialog.react','ReactComponentWithPureRenderMixin','React','XUIContextualDialog.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=m.Map,v=s.PropTypes,w='comment_dialog',x='feedback_dialog',y='no_dialog',z=s.createClass({displayName:'OzMessageFeedback',mixins:[n,r],propTypes:{message:v.instanceOf(u).isRequired,onSave:v.func.isRequired},getInitialState:function(){return babelHelpers['extends']({currentDialog:y},ba(this.props.message));},componentWillReceiveProps:function(da){if(da.message!==this.props.message)this.setState(ba(da.message));},render:function(){var da=this.props,ea=da.message,fa=da.onSave,ga=this.state,ha=ga.currentDialog,ia=ga.feedback,ja=ca(this.state);return (s.createElement('div',{className:"_2bxa"+(' '+"_2bxb")+(ja?' '+"_2bxc":'')+(ha!==y?' '+"_2bxd":'')},s.createElement(aa,{className:"_2bxe",onClick:function(ka){return this.setState({currentDialog:w});}.bind(this),isActive:!!ia||ha===w,ref:'comment'}),s.createElement(aa,{className:"_2bxf",onClick:function(ka){return this.setState({currentDialog:x});}.bind(this),isActive:ja||ha===x,ref:'flag'})));},renderLayers:function(){switch(this.state.currentDialog){case w:return {contextualDialog:this._renderCommentDialog()};case x:return {contextualDialog:this._renderFeedbackDialog()};default:return null;}},_renderFeedbackDialog:function(){return (s.createElement(q,{contextRef:function(){return this.refs.flag;}.bind(this),executionRating:this.state.executionRating,followedPolicy:this.state.followedPolicy,onClose:this._handleDialogClose,onExecutionRatingChange:function(da){this.setState({executionRating:da});}.bind(this),onFollowedPolicyChange:function(da){this.setState({followedPolicy:da});}.bind(this),onResponsivenessRatingChange:function(da){this.setState({responsivenessRating:da});}.bind(this),onSave:this._handleFeedbackSave,onToneRatingChange:function(da){this.setState({toneRating:da});}.bind(this),responsivenessRating:this.state.responsivenessRating,toneRating:this.state.toneRating}));},_renderCommentDialog:function(){return (s.createElement(p,{contextRef:function(){return this.refs.comment;}.bind(this),feedback:this.state.feedback,onBlur:this._handleDialogClose,onFeedbackChange:function(da){this.setState({feedback:da});}.bind(this),onSave:this._handleCommentSave}));},_handleFeedbackSave:function(){this.props.onSave(u({execution:this.state.executionRating,'followed-policy':this.state.followedPolicy,mid:this.props.message.get('mid'),responsiveness:this.state.responsivenessRating,tone:this.state.toneRating}));this._handleDialogClose();},_handleCommentSave:function(){this.props.onSave(u({feedback:this.state.feedback,mid:this.props.message.get('mid')}));this._handleDialogClose();},_handleDialogClose:function(){this.setState({currentDialog:y});}}),aa=s.createClass({displayName:'FeedbackButton',render:function(){var da=this.props,ea=da.className,fa=da.onClick,ga=da.isActive;return (s.createElement('button',{role:'button',className:j("_1-hv"+(' '+"_2bxi")+(ga?' '+"_2bxj":''),ea),onClick:fa}));}});function ba(da){return {executionRating:da.get('execution'),feedback:da.get('feedback'),followedPolicy:da.get('followed-policy'),responsivenessRating:da.get('responsiveness'),toneRating:da.get('tone')};}function ca(da){return !!(da.executionRating||da.followedPolicy!==undefined||da.responsivenessRating||da.toneRating);}f.exports=z;},null);
__d('OzInboxMessage.react',['OzAPI','cx','OzHelpers','immutable','OzConfig','OzConstants','OzIntentPicker.react','OzMessage.react','OzMessageFeedback.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=k.Map,t=m.AUTHOR_TYPES,u=r.PropTypes,v=r.createClass({displayName:'OzInboxMessage',mixins:[q],propTypes:{authorType:u.oneOf(j.values(t)),message:u.instanceOf(s).isRequired},contextTypes:{witIntents:u.instanceOf(s).isRequired},render:function(){var w=this.props,x=w.message,y=w.authorType,z=w.thread,aa=!!x.get('author');return (r.createElement('div',{className:"clearfix"+(' '+"_4y6j")+(y===t.TRAINER?' '+"_2ij4":'')+(y===t.BOT?' '+"_2ij5":'')+(y===t.USER?' '+"_2p0":'')+(l.GK.supervisor?' '+"_1w52":'')},r.createElement('div',{className:"_2pf"},r.createElement(o,{message:x})),aa?r.createElement(p,{message:x,onSave:function(ba){return h.updateMessage(j.threadID(z),ba);}}):null,this._renderIntentPicker()));},_renderIntentPicker:function(){var w=this.props,x=w.message,y=w.thread;if(x.get('ui-last-user-msg'))return (r.createElement('div',{className:"_2x3x"},r.createElement(n,{diag:y.get('intent-diag'),onPick:this._handlePick})));return null;},_handlePick:function(w){h.createIntent(j.threadID(this.props.thread),w).done();}});f.exports=v;},null);
__d('OzInboxMessageGroup.react',['OzHelpers','immutable','OzConstants','OzDate.react','OzInboxMessage.react','OzUserImage.react','ReactComponentWithPureRenderMixin','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=i.Map,r=o.PropTypes,s=j.AUTHOR_TYPES,t=o.createClass({displayName:'OzInboxMessageGroup',mixins:[n],propTypes:{authorID:r.string,authorType:r.oneOf(h.values(s)),messages:r.array.isRequired,repNames:r.instanceOf(q).isRequired,thread:r.object.isRequired,timestamp:r.number.isRequired},render:function(){return (o.createElement('div',{className:"_528w"},this._renderGroup()));},_renderGroup:function(){var u=this.props.authorType,v=s.BOT,w=s.TRAINER,x=s.USER;switch(u){case w:case v:return (o.createElement('div',{className:(u===v?"_4m3p":'')+(u===w?' '+"_4m3r":'')},this._renderMessages(),this._renderBottomMeta()));case x:return (o.createElement('div',{className:"_4m3u"},o.createElement('div',{className:"_2wyu"},this._renderPhoto()),o.createElement('div',{className:"_2wyv"},this._renderMessages(),this._renderBottomMeta())));default:h.error('got unk author type',this.props);return null;}},_renderPhoto:function(){var u=h.photo(this.props.thread);return (o.createElement('div',{className:"_528y"},o.createElement(m,{photo:u})));},_renderSeen:function(){return (o.createElement('div',{className:"_40ue"},this._renderPhoto()));},_renderMessages:function(){var u=this.props,v=u.messages,w=u.authorType,x=u.thread;return (o.createElement('div',{className:"_528z"},v.map(function(y){return (o.createElement('div',{key:h.msgID(y)},o.createElement(l,{authorType:w,message:y,thread:x}),y.get('ui-seen')?this._renderSeen():null));}.bind(this))));},_renderBottomMeta:function(){var u=this.props,v=u.authorID,w=u.repNames,x=u.timestamp;return (o.createElement('div',{className:"_4m3v"},o.createElement('span',{className:"_4m3w"},w.get(v)||v||null),o.createElement(k,{className:"_4m3x",date:new Date(x)})));}});f.exports=t;},null);
__d('OzInboxMessageList.react',['cx','OzHelpers','immutable','OzConstants','OzInboxMessageGroup.react','OzLoading.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=j.Map,q=k.AUTHOR_TYPES,r=o.PropTypes,s=m.Inline,t=20,u=o.createClass({displayName:'OzGroupList',propTypes:{repNames:r.instanceOf(p).isRequired,thread:r.instanceOf(p).isRequired,messages:r.instanceOf(p).isRequired},shouldComponentUpdate:function(ba,ca){return !(j.is(this.props.thread,ba.thread)&&j.is(this.props.repNames,ba.repNames)&&j.is(this.props.messages,ba.messages));},render:function(){var ba=this.props.messages.reduceRight(x.bind(null,this.props.thread),{groupsList:[],nextTimestamp:null,sawUserMessage:false}).groupsList.map(this._renderGroup);return o.createElement('frag',null,ba);},_renderGroup:function(ba,ca){var da=this.props.thread,ea=ba[0],fa=ba[ba.length-1],ga=ea.get('sender'),ha=ea.get('author'),ia=ea.get('timestamp'),ja=fa.get('timestamp');return (o.createElement(l,{authorID:ha,authorType:i.authorType(ea),key:ga+ia,messages:ba,repNames:this.props.repNames,thread:da,timestamp:ja}));}}),v=o.createClass({displayName:'OzInboxMessageList',mixins:[n],propTypes:{clientLimit:r.number.isRequired,loading:r.bool.isRequired,messages:r.instanceOf(p).isRequired,onScrollTop:r.func.isRequired,repNames:r.instanceOf(p).isRequired,thread:r.instanceOf(p).isRequired},componentDidMount:function(){aa(this.refs.scrollable);},componentWillUpdate:function(){this._wasScrolledToBottom=z(this.refs.scrollable);this._originalScrollHeight=this.refs.scrollable.scrollHeight;this._originalScrollTop=this.refs.scrollable.scrollTop;},componentDidUpdate:function(ba){if(this._wasScrolledToBottom||y(ba.messages,this.props.messages)||i.threadID(ba.thread)!==i.threadID(this.props.thread)){i.debug('[messagelist] scrolling bottom');aa(this.refs.scrollable);}else{var ca=this.refs.scrollable.scrollHeight-this._originalScrollHeight+this._originalScrollTop;this.refs.scrollable.scrollTop=ca;}},resize:function(){this.componentDidUpdate(this.props);},render:function(){var ba=this.props,ca=ba.loading,da=ba.sending,ea=ba.thread,fa=ba.messages,ga=ba.clientLimit;return (o.createElement('div',{onScroll:this._handleScroll,className:"_4fj7",ref:'scrollable'},o.createElement(s,{loading:ca}),o.createElement(u,{thread:ea,messages:fa.takeLast(ga),repNames:this.props.repNames}),o.createElement(s,{loading:da})));},_handleScroll:function(){if(this.refs.scrollable.scrollTop<t)this.props.onScrollTop();}});function w(ba,ca,da,ea){var fa=ba.get('timestamp'),ga=function(ia){var ja=ia>=fa,ka=!da||ia<da;return ja&&ka;},ha=ca.get('last-seen');if(ga(ha))ba=ba.set('ui-seen',true);if(!ea&&i.authorType(ba)===q.USER)ba=ba.set('ui-last-user-msg',true);return ba;}function x(ba,ca,da){var ea=ca.groupsList,fa=ca.nextTimestamp,ga=ca.sawUserMessage;da=w(da,ba,fa,ga);if(da.get('ui-last-user-msg'))ga=true;var ha=da.get('author'),ia=da.get('timestamp'),ja=i.authorType(da),ka=ea[0],la=ka&&ka[ka.length-1],ma=la&&la.get('author'),na=la?la.get('timestamp'):Infinity,oa=la&&i.authorType(la);if(ma!==ha||na-ia>60000||oa!==ja){ea.unshift([da]);}else ka.unshift(da);return {groupsList:ea,nextTimestamp:ia,sawUserMessage:ga};}function y(ba,ca){var da=ba.last(),ea=ca.last();return ea.get('timestamp')>da.get('timestamp');}function z(ba){return ba.scrollHeight-ba.scrollTop===ba.clientHeight;}function aa(ba){ba.scrollTop=ba.scrollHeight;}f.exports=v;},null);
__d('OzReminderNotesField.react',['OzIntentParamsTextField.react','ReactComponentWithPureRenderMixin','React','debounce'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'OzReminderNotesField',mixins:[i],propTypes:{seedNotes:l.string,onSave:l.func.isRequired},getInitialState:function(){return {notes:this.props.seedNotes||''};},componentWillMount:function(){this._save=k(this._save,750,this,true);},render:function(){return (j.createElement(h,{label:'Add notes about this reminder...',onChange:this._handleChange,value:this.state.notes}));},_handleChange:function(n){this.setState({notes:n},this._save);},_save:function(){this.props.onSave(this.state.notes);}});f.exports=m;},null);
__d('OzReminder.react',['OzAPI','OzHelpers','Event','immutable','OzIntentParamsAbstractField.react','OzIntentParamsStringField.react','OzReminderNotesField.react','OzSidebarItemHeader.react','ReactComponentWithPureRenderMixin','React','XUICloseButton.react','cx','formatDate','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=k.List,w=k.Map,x=q.PropTypes,y=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],z=q.createClass({displayName:'OzReminder',mixins:[p],propTypes:{ReminderEditor:x.func.isRequired,onClose:x.func.isRequired,onEdit:x.func.isRequired,onOpen:x.func.isRequired,onSnooze:x.func.isRequired,reminder:x.instanceOf(w).isRequired,repNames:x.instanceOf(w).isRequired},getInitialState:function(){return {isExpanded:i.isUrgentReminder(this.props.reminder)};},_listener:null,componentWillReceiveProps:function(ba){if(ba.reminder.get('id')===this.props.reminder.get('id')&&i.isUrgentReminder(ba.reminder)&&!i.isUrgentReminder(this.props.reminder))this.setState({isExpanded:true});},componentWillUnmount:function(){this._listener&&this._listener.remove();},render:function(){var ba=this.props,ca=ba.ReminderEditor,da=ba.onEdit,ea=ba.onSnooze,fa=ba.reminder,ga=ba.repNames,ha=fa.getIn(['body','description']),ia=i.isUrgentReminder(fa),ja=fa.getIn(['body','suggestion']),ka=fa.get('state')==='closed',la=fa.get('creator-fbid'),ma=ga.get(la,la);return (q.createElement('div',{className:"_wc0"+(ia?' '+"_wc2":'')+(i.isPaidReminder(fa)?' '+"_3d-l":'')+(ka?' '+"_3d-m":'')},q.createElement(o,{className:"_1k8u",creator:ma,isClosed:ka,isExpanded:this.state.isExpanded,onIsExpandedToggle:this._handleIsExpandedToggle,onToggle:this._handleToggle,subtitle:i.isSnoozedReminder(fa)?'(snoozed)':null,title:ha||aa(ja)},ia?q.createElement('button',{className:"_1-hv _260v _260w",alt:'Snooze',onClick:function(na){return ea(fa);}}):null,q.createElement(ca,{onSave:da,seedReminder:fa},q.createElement('a',{className:"_260y"},q.createElement('i',{className:"_5x82"})))),this._renderBody()));},_renderBody:function(){if(!this.state.isExpanded)return null;var ba=this.props.reminder,ca=ba.get('scheduled-time'),da=ba.get('last-fired'),ea=ba.get('state')==='closed',fa=i.isUrgentReminder(ba),ga=ba.get('state')==='snoozed'&&da||ca>i.serverNow()&&ca,ha=(fa||ea)&&da,ia=ba.get('days');return (q.createElement('div',{className:"_wc3"},q.createElement('div',{className:"_1k8v _3-ue"},this._renderPayment(ba),ha?q.createElement(l,{label:'Fired On'},q.createElement('span',null,t(new Date(ha),'M jS, g:ia'))):null,ga?q.createElement(l,{label:'Will Fire On'},q.createElement('span',null,t(new Date(ga),'M jS, g:ia'))):null,ia&&!ia.isEmpty()?q.createElement(l,{label:'Recurs'},q.createElement('span',null,ia.size===7?'Every Day':ia.sort().map(function(ja){return y[ja%7];}).toArray().join(' '))):null,q.createElement(n,{seedNotes:ba.get('notes')||ba.getIn(['body','description']),onSave:this._handleNotesSave}))));},_renderPayment:function(ba){var ca=ba.getIn(['body','suggestion']);if(!ca)return null;var da=ba.getIn(['body','credit-card']),ea=ca.get('name');return (q.createElement('div',null,q.createElement(l,{label:'Link'},q.createElement('div',{className:"_3d-q"},q.createElement('a',{className:"_3d-r",target:'_blank',href:ca.get('target-url'),title:ca.get('description')},'Click here to view ',ea),da?q.createElement('a',{className:"_3d-s",href:'#',title:'Show credit card information',onClick:this._handlePaymentLinkClick}):null)),q.createElement(m,{label:'Confirmation #',onSave:this._handleItemNumberSave,placeholder:'Confirmation number',value:ba.getIn(['body','item-number'])||''})));},_handleIsExpandedToggle:function(){this.setState({isExpanded:!this.state.isExpanded});},_handleNotesSave:function(ba){this.props.onEdit(this.props.reminder.set('notes',ba));},_handleItemNumberSave:function(ba){this.props.onEdit(this.props.reminder.setIn(['body','item-number'],ba));},_handleToggle:function(ba){var ca=this.props,da=ca.onClose,ea=ca.onOpen,fa=ca.reminder;ba?da(fa):ea(fa);},_handlePaymentLinkClick:function(ba){var ca=this.props.reminder.getIn(['body','credit-card']);if(!ca)return;var da=this.props.reminder.getIn(['body','suggestion','amount'])/100,ea=ca.get('number'),fa=ca.get('cvv'),ga=ca.get('month'),ha=ca.get('year'),ia=ca.get('zip');h.notifyExtension({action:'show',title:'Temporary Credit Card Information',desc:'Amount: $'+da+' Number: '+ea+' cvv: '+fa+' zip: '+ia,html:'Amount: $'+da+'<br/>\n      Number: '+ea+'<br/>\n      CVV: '+fa+'<br/>\n      Month: '+ga+'<br/>\n      Year: '+ha,id:ea,timeout:0,picture:'https://cdn4.iconfinder.com/data/icons/simple-peyment-methods/512/mastercard-128.png'});}});function aa(ba){if(!ba)return null;var ca=ba.get('amount')/100,da=ba.get('name');return 'User paid $'+ca+' for '+da;}f.exports=z;},null);
__d('OzReminders.react',['OzConstants','OzAPI','cx','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','DatePickerRestraints','OzHelpers','immutable','InputLabel.react','ReactLayeredComponentMixin','LayerHideOnBlur','MessengerButton.react','OzReminder.react','React','ReactDOM','ReactCSSTransitionGroup','XUIContextualDialog.react','XUIDateTimePicker.react','XUIError.react','onlyChild'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){if(c.__markCompiled)c.__markCompiled();var ba=h.REMINDERS,ca=o.List,da=o.Map,ea=o.Set,fa=u.PropTypes,ga=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],ha=o.fromJS({traffic:{label:'Include traffic update',params:[{name:'origin',placeholder:'Origin address',err:'What is the origin address?'},{name:'destination',placeholder:'Destination address',err:'What is the destination address?'}]},weather:{label:'Include weather forecast',params:[{name:'location',placeholder:'City',err:'What city is the forecast for?'},{name:'metric',placeholder:'Celsius or Fahrenheit',err:'You need to set Celsius or Fahrenheit'}]}}),ia=n.pure(function(ma){var na=ma.action,oa=ma.errors,pa=ma.onToggle,qa=ma.onUpdate,ra=ma.reminder,sa=!!ra.getIn(['actions',na]);return (u.createElement('div',null,u.createElement(p,null,u.createElement('input',{type:'checkbox',checked:sa,onChange:function(ta){return pa(ta,ra,na);}}),u.createElement('label',null,ha.getIn([na,'label']))),sa&&u.createElement('div',null,ha.getIn([na,'params']).map(function(ta){var ua=ta.get('name'),va=['actions',na,ua];return (u.createElement(z,{key:na+'-'+ua,xuiError:oa.getIn([na,ua])},u.createElement('input',{type:ta.get('type','text'),className:"_wbw",placeholder:ta.get('placeholder'),value:ra.getIn(va),onChange:function(wa){return qa(wa,va);}})));}).valueSeq())));}),ja=n.pure(function(ma){var na=ma.reminder,oa=ma.errors,pa=ma.onToggle,qa=ma.onUpdate;return (u.createElement('div',null,u.createElement('h3',{className:"_17f0"},'Actions'),ha.keySeq().map(function(ra){return (u.createElement(ia,{key:ra,action:ra,reminder:na,errors:oa,onToggle:pa,onUpdate:qa}));}).valueSeq()));}),ka=u.createClass({displayName:'ReminderEditor',mixins:[q],propTypes:{onSave:fa.func.isRequired,seedReminder:fa.instanceOf(da)},getInitialState:function(){return {shown:false,reminder:this.props.seedReminder||da(),errors:da()};},componentWillReceiveProps:function(ma){if(!o.is(ma.seedReminder,this.props.seedReminder))this.setState({reminder:ma.seedReminder,errors:da()});},render:function(){var ma=aa(this.props.children);return u.cloneElement(ma,{onClick:function(na){return this.setState({shown:!this.state.shown});}.bind(this)});},renderLayers:function(){var ma=this.state,na=ma.shown,oa=ma.reminder,pa=ma.errors;if(!na)return null;var qa=ea(oa.get('days'));return {contextualDialog:u.createElement(x,{behaviors:{ContextualLayerAutoFlip:k,ContextualLayerUpdateOnScroll:l,LayerHideOnBlur:r},position:'below',shown:na,context:v.findDOMNode(this),onToggle:function(ra){return this.setState({shown:ra});}.bind(this)},u.createElement('ul',{className:"_3ssq"},u.createElement('div',{className:"_wbu"},u.createElement(y,babelHelpers['extends']({xuiError:pa.get('scheduled-time'),className:"_wbv",date:new Date(oa.get('scheduled-time',n.serverNow())),allowDuplicateDateSelection:true,onChange:function(ra){this.setState({reminder:oa.set('scheduled-time',+ra)});}.bind(this)},n.dateRestraints())),u.createElement(z,{xuiError:pa.get('description')},u.createElement('input',{ref:'input',className:"_wbw",placeholder:'Describe the Reminder',value:oa.getIn(['body','description']),onChange:function(ra){this.setState({reminder:oa.setIn(['body','description'],ra.target.value)});}.bind(this)})),u.createElement('h3',{className:"_17f0"},'Recurrence'),ga.map(function(ra,sa){var ta=sa+1;return (u.createElement(p,{key:sa},u.createElement('input',{type:'checkbox',checked:qa.has(ta),onChange:function(ua){var va=ua.target.checked?qa.add(ta):qa['delete'](ta);this.setState({reminder:oa.set('days',va.toList())});}.bind(this)}),u.createElement('label',null,ra)));}.bind(this)),u.createElement(ja,{reminder:oa,errors:pa,onToggle:this._handleActionToggle,onUpdate:this._handleActionUpdate}),u.createElement('div',{className:"_wbz"},u.createElement(s,{label:this.props.seedReminder?'Update Reminder':'Add Reminder',onClick:this._handleSave,type:'primary'})))))};},_handleActionToggle:function(ma,na,oa){var pa=ma.target.checked?na.set('actions',da([[oa,da()]])):na['delete']('actions');this.setState({reminder:pa});},_handleActionUpdate:function(ma,na){this.setState({reminder:this.state.reminder.setIn(na,ma.target.value)});},_handleSave:function(){var ma=this.state.reminder,na=ma.get('scheduled-time'),oa=function(ra){return !!ma.getIn(['actions',ra]);},pa=da(),qa=n.dateRestraints().dateRestraints;if(!na){pa=pa.set('scheduled-time','When would you like the reminder?');}else if(na<n.serverNow()+60*1000){pa=pa.set('scheduled-time','Reminders should be in the future!');}else if(!m.isValidDate(new Date(na),qa))pa=pa.set('scheduled-time','Reminder is outside of the '+ba.RANGE_IN_YEARS+' year range');if(!ma.getIn(['body','description']))pa=pa.set('description','What is the reminder about?');pa=ha.reduce(function(ra,sa,ta){if(oa(ta))ra=sa.get('params').reduce(function(ua,va){return ma.getIn(['actions',ta,va.get('name')])?ua:ua.setIn([ta,va.get('name')],va.get('err'));},ra);return ra;},pa);this.setState({errors:pa});if(pa.size)return;this.setState({reminder:da(),shown:false},function(ra){return this.props.onSave(ma);}.bind(this));}}),la=u.createClass({displayName:'OzReminders',propTypes:{isHistory:fa.bool,repNames:fa.instanceOf(da).isRequired,thread:fa.object.isRequired},render:function(){return (u.createElement('div',{className:"_1x92"},u.createElement('h2',{className:"_1x93"},'Reminders'),this._renderReminders(),!this.props.isHistory?u.createElement(ka,{onSave:this._handleCreate},u.createElement('a',{className:"_59jg"},u.createElement('div',{className:"_4nd4"}),u.createElement('span',{className:"_59jh"},'Add a reminder...'))):null));},_handleCreate:function(ma){i.createReminder(n.threadID(this.props.thread),ma);},_handleClose:function(ma){i.closeReminder(n.threadID(this.props.thread),ma.get('id'),!!ma.get('days')&&ma.get('state')==='pending');},_handleEdit:function(ma){i.editReminder(n.threadID(this.props.thread),ma);},_handleOpen:function(ma){i.editReminder(n.threadID(this.props.thread),ma.set('state','pending'));},_handleSnooze:function(ma){i.snoozeReminder(n.threadID(this.props.thread),ma.get('id'));},_renderReminders:function(){var ma=this.props,na=ma.isHistory,oa=ma.repNames,pa=ma.thread,qa=pa.get('reminders',ca()).sortBy(function(ra){return ra.get('last-fired')||ra.get('scheduled-time');}).toSeq().filter(function(ra){return na?ra.get('state')==='closed':ra.get('state')!=='closed';}).map(function(ra){return (u.createElement(t,{ReminderEditor:ka,key:ra.get('id'),onClose:this._handleClose,onEdit:this._handleEdit,onOpen:this._handleOpen,onSnooze:this._handleSnooze,reminder:ra,repNames:oa}));}.bind(this));return (u.createElement('div',{className:"_wc7"},u.createElement(w,{transitionName:'oz-fade-in-out',transitionEnterTimeout:300,transitionLeaveTimeout:300},qa)));}});f.exports=la;},null);
__d('OzThreadMeta.react',['OzAPI','cx','OzHelpers','immutable','Keys','MessengerButton.react','OzFormPreview.react','OzThreadLabels.react','OzSwitch.react','ReactComponentWithPureRenderMixin','React','Tooltip'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=k.Map,u=n.Row,v=o.OzUnderageLabel,w=r.PropTypes,x=r.createClass({displayName:'OzThreadMeta',mixins:[q],propTypes:{thread:w.object.isRequired,repNames:w.instanceOf(t).isRequired},getInitialState:function(){return {newMeta:null,muted:fa(this.props.thread)};},componentWillReceiveProps:function(ga){if(j.threadID(ga.thread)!==j.threadID(this.props.thread)){this.setState({newMeta:null,muted:fa(ga.thread),locked:ga.thread.get('locked')});}else this.setState({muted:fa(ga.thread),locked:ga.thread.get('locked')});},render:function(){return (r.createElement('div',{className:"_56t0"+(this.state.newMeta?' '+"_56t1":'')},r.createElement(y,{thread:this.props.thread,buttons:this.state.newMeta?[['Cancel','secondary',this._handleCancel],['DONE','primary',this._handleDone]]:[['Edit','primary',this._handleEdit]]}),this.state.newMeta?r.createElement(ca,{meta:this.state.newMeta,onCancel:this._handleCancel,onChange:this._handleChange,onDone:this._handleDone,onMutedToggle:this._handleMutedToggle,isMuted:this.state.muted}):r.createElement(aa,{meta:ea(this.props.thread),onMutedToggle:this._handleMutedToggle,isMuted:this.state.muted}),r.createElement(ba,{thread:this.props.thread,repNames:this.props.repNames,locked:!!this.state.locked,onToggle:this._handleThreadLockToggle})));},_handleEdit:function(){this.setState({newMeta:ea(this.props.thread)});},_handleCancel:function(){this.setState({newMeta:null});},_handleDone:function(){h.saveMeta(j.threadID(this.props.thread),this.state.newMeta);this.setState({newMeta:null});},_handleChange:function(ga){this.setState({newMeta:ga});},_handleMutedToggle:function(ga){h.saveMuted(j.threadID(this.props.thread),!ga);this.setState({muted:!ga});},_handleThreadLockToggle:function(ga){var ha=this.props.thread,ia=j.threadID(ha);if(this.state.locked){this.setState({locked:false});h.unlockThread(ia,ha.get('locked-at'));}else{this.setState({locked:true});h.lockThread(ia);}}}),y=j.pure(function(ga){var ha=ga.thread,ia=ga.buttons;return (r.createElement('div',{className:"_56t2"},r.createElement('div',{className:"_56t6"},r.createElement('h2',{className:"_56tb"},j.getName(ha)),r.createElement('div',{className:"_56tc"},ia.map(function(ja,ka){var la=ja[0],ma=ja[1],na=ja[2];return (r.createElement(m,{key:la,label:la,type:ma,onClick:na}));}))),r.createElement('div',{className:"_56td"},r.createElement(v,{thread:ha}))));}),z=j.pure(function(ga){var ha=ga.isMuted,ia=ga.onMutedToggle,ja=function(ma){ia(ha);},ka='Uncheck if person dislikes our proactive messages, e.g. surveys',la=r.createElement('span',s.propsFor(ka),'Proactive?');return (r.createElement(u,{label:la},r.createElement('input',{type:'checkbox',checked:!ha,onChange:ja})));}),aa=j.pure(function(ga){var ha=ga.meta,ia=ga.isMuted,ja=ga.onMutedToggle,ka=(ha.get('address1','')+' '+ha.get('address2','')+'\n     '+ha.get('city','')+' '+ha.get('state','')+' '+ha.get('zip','')+'\n    ').trim();return (r.createElement(n,null,r.createElement(u,{label:'Nickname'},ha.get('preferred-name')),r.createElement(u,{label:'Email'},ha.get('email')),r.createElement(u,{label:'Phone'},ha.get('phone')),r.createElement(u,{label:'Address'},ka),r.createElement(z,{isMuted:ia,onMutedToggle:ja})));}),ba=j.pure(function(ga){var ha=ga.thread,ia=ga.repNames,ja=ga.locked,ka=ga.onToggle,la=ia.get(ha.get('locker-id')),ma=la?(ha.get('locked')?'Locked':'Last locked')+' by '+la:'';ma+=ma&&ha.get('locked-at')?' at '+new Date(ha.get('locked-at')).toLocaleString():'';var na=r.createElement('span',s.propsFor(ma),ja?'Click to unlock thread':'Click to lock thread');return (r.createElement(p,{className:"_z1m",isAnimated:true,reverseColors:true,isOn:ja,label:na,onToggle:ka}));}),ca=r.createClass({displayName:'EditView',mixins:[q],propTypes:{meta:w.instanceOf(t).isRequired,onCancel:w.func.isRequired,onChange:w.func.isRequired,onDone:w.func.isRequired,isMuted:w.bool.isRequired,onMutedToggle:w.func.isRequired},componentDidMount:function(){this.refs['preferred-name'].focus();},render:function(){var ga=this._renderRow;return (r.createElement('form',{className:"_56to",onKeyDown:this._handleKeyDown},r.createElement(da,null,ga('Nickname','preferred-name','Add Preferred Name')),r.createElement(da,null,ga('Email','email','Add email')),r.createElement(da,null,ga('Phone','phone','Add phone')),r.createElement(da,null,ga('Street','address1','Add Street'),ga('Street','address2','Add Street'),ga('City','city','Add City'),ga('State','state'),ga('Zip Code','zip')),r.createElement(da,null,r.createElement(z,{isMuted:this.props.isMuted,onMutedToggle:this.props.onMutedToggle}))));},_handleKeyDown:function(ga){ga.which===l.ESC?this.props.onCancel():ga.which===l.RETURN?this.props.onDone():null;},_renderRow:function(ga,ha,ia){var ja=this.props,ka=ja.meta,la=ja.onChange;return (r.createElement(u,{label:ga},r.createElement('input',{ref:ha,type:'text',className:"_1-i0 _56uv",placeholder:ia,value:ka.get(ha),onChange:function(ma){return la(ka.set(ha,ma.target.value));}})));}}),da=j.pure(function(ga){var ha=ga.children;return r.createElement('div',{className:"_56vn"},ha);});function ea(ga){return ga.get('metadata-json')||t();}function fa(ga){return !!ga.get('muted');}f.exports=x;},null);
__d('OzThreadNote.react',['OzAPI','cx','getActiveElement','OzHelpers','immutable','OzRequirementTokenizer.react','React','OzConfig'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=l.Map,q=n.PropTypes,r=1000,s=n.createClass({displayName:'OzThreadNote',propTypes:{thread:q.instanceOf(p).isRequired,requirements:q.instanceOf(p).isRequired},getInitialState:function(){return {editedText:this.props.thread.get('notes')||'',requirementQuery:''};},componentWillReceiveProps:function(t){var u=t.thread.get('notes'),v=j()===this.refs.textarea;if(u!==this.props.thread.get('notes')&&!v)this.setState({editedText:u});},render:function(){return (n.createElement('div',{className:"_1x92"},n.createElement('h2',{className:"_1x93"},'Notes'),o.GK.threadRequirements?n.createElement(m,{allRequirements:this.props.requirements,onCreateRequirement:this._handleCreateRequirement,onDeleteRequirement:this._handleDeleteRequirement,onQueryStringChange:this._handleQueryStringChange,queryString:this.state.requirementQuery,selectedRequirements:this.props.thread.get('requirements')}):null,n.createElement('textarea',{ref:'textarea',className:"_1x95",placeholder:'Leave a note',value:this.state.editedText,onChange:this._handleChange})));},_handleChange:function(){var t=this.props.thread,u=this.refs.textarea.value;this.setState({editedText:u});window.clearTimeout(this.timeout);this.timeout=window.setTimeout(function(){h.saveNote(k.threadID(t),u);},r);},_handleCreateRequirement:function(t){var u=this.props.thread;h.createThreadRequirement(k.threadID(u),t.getTitle());this.setState({requirementQuery:''});},_handleDeleteRequirement:function(t){var u=this.props.thread;h.deleteThreadRequirement(k.threadID(u),t.getUniqueID());this.setState({requirementQuery:''});},_handleQueryStringChange:function(t){this.setState({requirementQuery:t.target.value});}});f.exports=s;},null);
__d('OzTodoIntentList.react',['OzHelpers','immutable','OzIntentList.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=i.Map,n=l.PropTypes,o=l.createClass({displayName:'OzTodoIntentList',mixins:[k],propTypes:{repNames:n.instanceOf(m).isRequired,requirements:n.instanceOf(m).isRequired,thread:n.instanceOf(m).isRequired,witIntents:n.instanceOf(m).isRequired},render:function(){var p=h.openIntents(this.props.thread);return (l.createElement(j,{intents:p,repNames:this.props.repNames,requirements:this.props.requirements,threadID:h.threadID(this.props.thread),userEmail:h.userEmail(this.props.thread),witIntents:this.props.witIntents}));}});f.exports=o;},null);
__d('OzInboxShow.react',['OzStrings','OzHelpers','OzAPI','cx','immutable','OzActions','OzButton.react','OzComposer.react','OzConfirmDialog.react','OzHistoryIntentList.react','OzInboxMessageList.react','OzReminders.react','OzStores','OzTabHeader.react','OzThreadLabels.react','OzThreadMeta.react','OzThreadNote.react','OzTodoIntentList.react','OzUpdateDateTime.react','promiseFinally','ReactComponentWithPureRenderMixin','React','Reflux','ReactRouter_DEPRECATED','XUISelector.react','relativeTimeString.atlas','OzHumans','OzNotify','Tooltip'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja){if(c.__markCompiled)c.__markCompiled();var ka=fa.Option,la=l.List,ma=l.Map,na=ca.PropTypes,oa=t.PendingMessageStateStore,pa=v.OzLabelList,qa=da.createAction(),ra=da.createStore({init:function(){this._data=ma();this.listenTo(qa,this._onUpdateFetchState);},getInitialState:function(){return this._data;},_onUpdateFetchState:function(db,eb){this._data=this._data.update(db,function(fb){return (fb||ma()).merge(eb);});this.trigger(this._data);}}),sa='NO_OWNER',ta='TODO',ua='HISTORY',va=25,wa=25,xa=ca.createClass({displayName:'OzInboxShow',mixins:[ba,ea.Navigation,da.connect(ra,'fetchStates'),da.connect(oa,'pendingMessageState')],contextTypes:{uid:na.string.isRequired},propTypes:{thread:na.instanceOf(ma).isRequired,witIntents:na.instanceOf(ma).isRequired,requirements:na.instanceOf(ma).isRequired,merchants:na.instanceOf(ma).isRequired,reps:na.instanceOf(ma).isRequired,humans:na.instanceOf(ma).isRequired},getInitialState:function(){return cb();},componentDidMount:function(){this._init(this.props);},componentWillReceiveProps:function(db){if(i.threadID(db.thread)!==i.threadID(this.props.thread)){i.debug('[inboxshow] thread changed');this._init(db);}},_init:function(db){var eb=db.thread;m.updateThreads(la([eb.set('ui-ping',false)]));m.activateThread(i.threadID(eb));var fb=i.openIntents(eb).sortBy(function(gb){return gb.get('created-at');}).reverse().first();if(fb)m.activateIntent(fb.get('id'));this._sendThreadFocus();this.setState(cb(),function(gb){if(bb(db.thread).size<va)this._fetchMessages();}.bind(this));},componentWillUnmount:function(){m.activateThread(null);},render:function(){var db=this.state,eb=db.fetchStates,fb=db.pendingMessageState,gb=db.clientLimit,hb=this.props,ib=hb.reps,jb=hb.thread,kb=hb.merchants,lb=bb(jb),mb=i.threadID(jb),nb=fb.get(mb,0)>0,ob=ib.map(function(pb){return pb.get('name');});return (ca.createElement('div',{className:"_1x8x"+(i.hasTag(jb,'employee')?' '+"_1yyg":'')+(i.hasEngage(jb)?' '+"_1fi":'')},ca.createElement('div',{className:"_1x8y"},this._renderHistoryHeader(),ca.createElement('div',{className:"_1x96"},ca.createElement(r,{clientLimit:gb,loading:!!eb.getIn([mb,'loading']),onScrollTop:this._fetchMessages,messages:lb,ref:'messageList',repNames:ob,sending:nb,thread:jb})),ca.createElement('div',{className:"_237y"},ca.createElement(o,{merchants:kb,onResize:this._handleResize,thread:jb}))),ca.createElement(ya,{activeTab:this.state.activeTab,humans:this.props.humans,onOwnerChange:this._handleOwnerChange,onTabChange:this._handleTabChange,repNames:ob,reps:ib,requirements:this.props.requirements,thread:jb,witIntents:this.props.witIntents})));},_sendThreadFocus:function(){var db=this.props.thread,eb=i.threadID(db),fb=i.openIntents(db).getIn([0,'id']);eb&&fb&&j.threadFocus(eb,fb);},_fetchMessages:function(){var db=this.state.clientLimit,eb=i.threadID(this.props.thread),fb=bb(this.props.thread),gb=this.state.fetchStates.get(eb,ma()),hb=gb.get('timestamp');if(gb.get('loading')||gb.get('fetchedAll')){i.debug('[inboxshow] not fetching more messages '+eb);return;}var ib=db+va;this.setState({clientLimit:ib});if(!fb.skipLast(db).isEmpty()){i.debug('[inboxshow] using client cache instead of fetch');return;}qa(eb,ma({loading:true}));aa(j.history(eb,hb,wa),function(jb){qa(eb,ma({loading:false}));}).done(function(jb){var kb=Infinity;jb.forEach(function(lb){var mb=lb.get('timestamp');if(mb<kb)kb=mb;});qa(eb,ma({fetchedAll:jb.isEmpty()||kb===hb,timestamp:kb}));});},_handleTabChange:function(db){var eb=db[0],fb=db[1];this.setState({activeTab:fb});},_handleGrab:function(){j.grab(i.threadID(this.props.thread));},_handleResize:function(){this.refs.messageList.resize();},_handleOwnerChange:function(db){var eb=db.value;if(eb&&eb!==sa){var fb=this.props.reps.get(eb),gb=this.props.thread,hb=i.threadID(gb);if(fb.get('is-coach')&&!i.isEscalated(gb)){j.escalateTo(hb,eb);}else j.assignTo(hb,eb);if(!fb.get('is-coach')&&i.isEscalated(gb)){var ib='Please remove the "Escalated" tag to prevent the '+'thread from getting reassigned to a coach';ia.warn(ib);}}},_renderHistoryHeader:function(){var db=this.props.thread,eb=i.threadID(db),fb=i.hasTag(db,'employee')||i.hasEngage(db)?'light':'dark',gb=function(kb,lb){return ca.createElement(n,{onClick:lb},kb);},hb=function(kb){var lb=arguments.length<=1||arguments[1]===undefined?'':arguments[1];return function(mb){i.isOwner(db,this.context.uid)?kb():m.showDialog(p,{onOk:kb,body:'Are you sure? You do not currently own this thread. '+lb});}.bind(this);}.bind(this),ib=i.locationLastSeen(db),jb=ma({hour:'numeric',minute:'numeric'});return (ca.createElement('div',{className:"_1q4l"},ca.createElement('div',{className:"_4l-w"},ca.createElement('h2',{className:"_1q4m"},i.getName(db)),ca.createElement('div',{className:"_29x1"},db.getIn(['location','timezone'])?ca.createElement('span',ja.propsFor('at his/her last FB location '+ga(+ib)),ca.createElement(z,{locale:'en-US',options:jb,timezoneOffset:db.getIn(['location','timezone-offset'],0)}),' ('+db.getIn(['location','timezone'])+')'):null)),ca.createElement('div',{className:"_1q4n"},ca.createElement(pa,{className:"_1q4o",thread:db,shade:fb,removable:true,addable:true}),ca.createElement('div',{className:"_1q4p"},i.hasEngage(db)&&gb('No need to engage',hb(function(kb){return j.notready(eb);}))||db.get('ready')&&ca.createElement(n,{disabled:'true'},h.READY_BUTTON)||ca.createElement(n,{disabled:'true'},h.IS_NOTREADY)))));}}),ya=ca.createClass({displayName:'OzThreadPanel',mixins:[ba],propTypes:{activeTab:na.oneOf([ta,ua]).isRequired,onTabChange:na.func.isRequired,repNames:na.instanceOf(ma).isRequired,reps:na.instanceOf(ma).isRequired,requirements:na.instanceOf(ma).isRequired,thread:na.instanceOf(ma).isRequired,witIntents:na.instanceOf(ma).isRequired},render:function(){var db=this.props,eb=db.thread,fb=db.activeTab,gb=db.repNames,hb=db.reps,ib=db.humans,jb=db.onTabChange,kb=db.onOwnerChange,lb={onOwnerChange:kb,humans:ib,reps:hb,thread:eb};return (ca.createElement('div',{className:"_1x8z"},ca.createElement(za,lb),ca.createElement(u,{active:fb,tabs:[['Todo',ta],['History',ua]],onChange:jb}),ca.createElement('div',{className:"_ra0"},ca.createElement('div',{className:"_4fj7"},this._renderTab())),ca.createElement(w,{thread:eb,repNames:gb})));},_renderTab:function(){var db=this.props,eb=db.activeTab,fb=db.repNames,gb=db.requirements,hb=db.thread,ib=db.witIntents,jb={repNames:fb,requirements:gb,thread:hb,witIntents:ib};switch(eb){case ta:return (ca.createElement('span',null,ca.createElement(y,jb),ca.createElement(s,{repNames:fb,thread:hb}),ca.createElement(x,{key:i.threadID(hb),thread:hb,requirements:gb})));case ua:return (ca.createElement('span',null,ca.createElement(q,jb),ca.createElement(s,{isHistory:true,repNames:fb,thread:hb})));}}}),za=i.pure(function(db){var eb=db.onOwnerChange,fb=db.humans,gb=db.reps,hb=db.thread,ib=hb,jb=i.nameOrId(ib.get('last-owner')).split(' ')[0];return (ca.createElement('div',{className:"_1q4e"},gb&&!gb.isEmpty()?ca.createElement(ab,{onChange:eb,value:ib.getIn(['owner','id'])||sa,reps:gb,humans:fb}):null,ca.createElement('span',{className:"_3yre"},jb?'Last owner: '+jb:null)));}),ab=i.pure(function(db){var eb=db.reps,fb=db.humans,gb=db.value,hb=db.onChange,ib=eb.toSeq().filter(function(mb){return ha.isActive(fb.get(mb.get('fbid')));}).sortBy(function(mb){return mb.get('name');}).map(function(mb){var nb=mb.get('fbid'),ob=mb.get('is-coach',false)?"_4i62":'';return (ca.createElement(ka,{key:nb,value:nb},ca.createElement('span',{className:ob},mb.get('name'))));}),jb=ib.get(gb);ib=ib.valueSeq();if(!jb){var kb=eb.get(gb,ma()),lb=kb.get('is-coach',false)?"_4i62":'';ib=ib.toList().unshift(ca.createElement(ka,{key:'current',value:gb},ca.createElement('span',{className:lb},kb.get('name','None'))));}return (ca.createElement(fa,{size:'medium',value:gb,onChange:hb,maxheight:500},ib));}),bb=i.memoize(function(db){return db.get('messages').sortBy(function(eb){return eb.get('timestamp');});},function(db){return db.get('messages').hashCode();});function cb(){return {activeTab:ta,clientLimit:va};}f.exports=xa;},null);
__d('OzIntentDashboardUUIDFilter.react',['immutable','ReactComponentWithPureRenderMixin','React','XUISingleSelector.react'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.Map,m=j.PropTypes,n=k.Option,o=j.createClass({displayName:'OzIntentDashboardUUIDFilter',mixins:[i],propTypes:{intentMetas:m.instanceOf(l).isRequired,onUUIDChange:m.func.isRequired,uuid:m.string},render:function(){return (j.createElement(k,{maxheight:400,onChange:this._handleUUIDChange,value:this.props.uuid||'__none__'},j.createElement(n,{value:'__none__'},'Select an intent category'),p(this.props.intentMetas).valueSeq().map(function(r){return (j.createElement(n,{key:r.get('id'),value:r.get('id')},r.get('name')));})));},_handleUUIDChange:function(r){this.props.onUUIDChange(q(r.value));}});function p(r){return r.sortBy(function(s){return s.get('name');});}function q(r){return r!=='__none__'?r:undefined;}f.exports=o;},null);
__d('OzIntentDashboardFilters.react',['immutable','InputLabel.react','OzIntentDashboardUUIDFilter.react','OzTriSwitch.react','ReactComponentWithPureRenderMixin','React','XUISingleSelector.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=h.Map,q=m.PropTypes,r=n.Option,s=k.fromBoolean,t=k.toBoolean,u=m.createClass({displayName:'OzIntentDashboardFilters',mixins:[l],propTypes:{intentMetas:q.instanceOf(p).isRequired,isEmployee:q.bool,isReversed:q.bool.isRequired,onIsEmployeeChange:q.func.isRequired,onIsReversedChange:q.func.isRequired,onSortByChange:q.func.isRequired,onUUIDChange:q.func.isRequired,sortBy:q.string,sortableFields:q.instanceOf(p).isRequired,uuid:q.string},render:function(){return (m.createElement('ul',{className:"_1bo-"},m.createElement('li',null,this._renderUUIDFilter()),m.createElement('li',null,this._renderSortByFilter()),m.createElement('li',null,this._renderIsReversedFilter()),m.createElement('li',null,this._renderIsEmployeeFilter())));},_renderUUIDFilter:function(){return (m.createElement(j,{intentMetas:this.props.intentMetas,onUUIDChange:this.props.onUUIDChange,uuid:this.props.uuid}));},_renderIsEmployeeFilter:function(){return (m.createElement(k,{animated:true,label:'Employee?',onClick:function(w){this.props.onIsEmployeeChange(t(w));}.bind(this),value:s(this.props.isEmployee)}));},_renderIsReversedFilter:function(){return (m.createElement(i,null,m.createElement('input',{checked:this.props.isReversed,onChange:function(w){this.props.onIsReversedChange(w.target.checked);}.bind(this),type:'checkbox'}),m.createElement('label',null,'Reversed?')));},_renderSortByFilter:function(){return (m.createElement(n,{maxheight:400,onChange:this._handleSortByChange,value:this.props.sortBy||'__none__'},m.createElement(r,{value:'__none__'},'Select a field to sort by'),this.props.sortableFields.map(function(w,x){return (m.createElement(r,{key:x,value:x},w));}).valueSeq()));},_handleSortByChange:function(w){this.props.onSortByChange(v(w.value));}});function v(w){return w!=='__none__'?w:undefined;}f.exports=u;},null);
__d('OzIntentDashboardEventsDialog.react',['DialogFitHeight','immutable','InputLabel.react','ReactComponentWithPureRenderMixin','React','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogOkayButton.react','XUIDialogTitle.react','XUITable.react','cx','formatDate','ozFormatTime'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=i.Map,w=l.PropTypes,x=l.createClass({displayName:'OzIntentDashboardEventsDialog',mixins:[k],propTypes:{intent:w.instanceOf(v).isRequired,onToggle:w.func.isRequired,shown:w.bool.isRequired},getInitialState:function(){return {isFiltered:true};},render:function(){return (l.createElement(m,{behaviors:{DialogFitHeight:h},onToggle:this.props.onToggle,shown:this.props.shown,width:900},l.createElement(q,null,l.createElement('span',null,'Events for Intent  ',this.props.intent.get('id'))),l.createElement(n,null,l.createElement(j,null,l.createElement('input',{checked:this.state.isFiltered,onChange:function(ba){this.setState({isFiltered:ba.target.checked});}.bind(this),type:'checkbox'}),l.createElement('label',null,'Filter Non-Message Events?')),this._renderTable()),l.createElement(o,null,l.createElement(p,{use:'confirm',action:'cancel'}))));},_renderTable:function(){return (l.createElement(r,{className:"_4m7c",outerBorder:true},l.createElement('thead',null,l.createElement('tr',null,l.createElement('th',null,'Agent ID'),l.createElement('th',null,'Type'),l.createElement('th',null,'Time'),l.createElement('th',null,'Since Start'),l.createElement('th',null,'Text/Data'),l.createElement('th',null,'Attachment'))),l.createElement('tbody',null,this._getEvents().map(this._renderRow))));},_renderRow:function(event,ba,ca){var da=event.get('type'),ea=event.get('from-m?'),fa=ca.first().get('time'),ga=event.get('time');return (l.createElement('tr',{key:ba},l.createElement('td',null,event.get('agent-id')),l.createElement('td',null,da),l.createElement('td',{className:"_4m7d"},z(ga)),l.createElement('td',null,u((ga-fa)/1000)),l.createElement('td',{className:"_4m7e"+(da==='send'&&ea?' '+"_4m7j":'')},y(event)),l.createElement('td',null,aa(event.get('attachment')))));},_getEvents:function(){var ba=this.props.intent.get('events').toSeq();if(this.state.isFiltered)ba=ba.filter(function(event){var ca=event.get('type');return ca==='send'||ca==='message';});return ba;}});function y(event){var ba=event.get('text'),ca=event.get('data');return ba?ba:ca&&JSON.stringify(ca.toJS());}function z(ba){return t(ba/1000,'M d, Y g:ia');}function aa(ba){if(ba==null)return ba;var ca=JSON.parse(ba);return (l.createElement('a',{href:ca.uri,target:'_blank'},'Source'));}f.exports=x;},null);
__d('OzIntentDashboardRow.react',['immutable','ReactLayeredComponentMixin','OzIntentDashboardEventsDialog.react','ReactComponentWithPureRenderMixin','React','ReactRouter_DEPRECATED','formatDate','ozFormatTime'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=h.Map,q=m.Link,r=l.PropTypes,s=l.createClass({displayName:'OzIntentDashboardRow',mixins:[i,k],propTypes:{intent:r.instanceOf(p).isRequired,intentMeta:r.instanceOf(p)},getInitialState:function(){return {isDialogOpen:false};},render:function(){var v=this.props,w=v.intent,x=v.intentMeta,y=w.get('user-vcard')||p();return (l.createElement('tr',null,l.createElement('td',null,w.get('id')),l.createElement('td',null,l.createElement(q,{to:'/inbox/'+w.get('user-id')},y.get('name',w.get('user-id')))),l.createElement('td',null,u(y)),l.createElement('td',null,x&&x.get('name')),l.createElement('td',null,w.get('state')),l.createElement('td',null,t(w.get('created-at'))),l.createElement('td',null,o(w.get('total-time'))),l.createElement('td',null,this._renderEventsLink())));},renderLayers:function(){if(!this.state.isDialogOpen)return {};return {dialog:l.createElement(j,{intent:this.props.intent,onToggle:this._handleDialogToggle,shown:this.state.isDialogOpen})};},_renderEventsLink:function(){var v=this.props.intent.get('events');if(!v||v.isEmpty())return l.createElement('span',null,'None');return (l.createElement('a',{href:'#',onClick:this._handleEventsLinkClick},'Click to View'));},_handleDialogToggle:function(v){this.setState({isDialogOpen:v});},_handleEventsLinkClick:function(v){v.preventDefault();this.setState({isDialogOpen:true});}});function t(v){return n(v/1000,'M d, Y g:ia');}function u(v){var w=v.get('is-employee');return w==null?'UNKNOWN':w?'YES':'NO';}f.exports=s;},null);
__d('OzIntentDashboard.react',['immutable','MessengerFlexScrollableArea.react','OzIntentDashboardFilters.react','OzIntentDashboardRow.react','ReactComponentWithPureRenderMixin','React','XUITable.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=h.List,p=h.Map,q=m.PropTypes,r=p({id:'ID',state:'Status','created-at':'Created At','total-time':'Time Spent'}),s=m.createClass({displayName:'OzIntentDashboard',mixins:[l],propTypes:{intentMetas:q.instanceOf(p).isRequired,intents:q.instanceOf(o).isRequired,isEmployee:q.bool,isLoaded:q.bool.isRequired,isLoading:q.bool.isRequired,isReversed:q.bool.isRequired,onFetchRequest:q.func.isRequired,onIsEmployeeChange:q.func.isRequired,onIsReversedChange:q.func.isRequired,onSortByChange:q.func.isRequired,onUUIDChange:q.func.isRequired,sortBy:q.string,uuid:q.string},render:function(){return (m.createElement(i,{onScroll:this._handleScroll,ref:'scrollable'},m.createElement(j,{intentMetas:this.props.intentMetas,isEmployee:this.props.isEmployee,isReversed:this.props.isReversed,onIsEmployeeChange:this.props.onIsEmployeeChange,onIsReversedChange:this.props.onIsReversedChange,onSortByChange:this.props.onSortByChange,onUUIDChange:this.props.onUUIDChange,sortBy:this.props.sortBy,sortableFields:r,uuid:this.props.uuid}),this._renderTable(),this._renderLoadMoreLink()));},_renderTable:function(){var t=this.props.intentMetas;return (m.createElement(n,{outerBorder:false},m.createElement('thead',null,m.createElement('tr',null,m.createElement('th',null,'ID'),m.createElement('th',null,'User Name'),m.createElement('th',null,'Employee?'),m.createElement('th',null,'Intent'),m.createElement('th',null,'Status'),m.createElement('th',null,'Created At'),m.createElement('th',null,'Time Spent'),m.createElement('th',null,'Events'))),m.createElement('tbody',null,this.props.intents.map(function(u){return (m.createElement(k,{intent:u,intentMeta:t.get(u.get('wit-intent-uuid')),key:u.get('id')}));}))));},_renderLoadMoreLink:function(){if(this.props.isLoaded)return null;if(this.props.isLoading)return m.createElement('div',null,'Loading...');return (m.createElement('div',null,m.createElement('a',{href:'#',onClick:function(t){t.preventDefault();this.props.onFetchRequest();}.bind(this)},'Fetch More Intents')));},_handleScroll:function(){if(!this.props.isLoading&&!this.props.isLoaded&&this.refs.scrollable&&this.refs.scrollable.isScrolledToBottom())this.props.onFetchRequest();}});f.exports=s;},null);
__d('OzIntentDashboardContainer.react',['immutable','OzAPI','OzIntentDashboard.react','React'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.List,m=h.Map,n=k.PropTypes,o=30,p={intents:l(),isLoaded:false,offset:0},q=k.createClass({displayName:'OzIntentDashboardContainer',propTypes:{witIntents:n.instanceOf(m).isRequired},getInitialState:function(){return babelHelpers['extends']({},p,{isEmployee:undefined,isLoading:false,isReversed:false,sortBy:undefined,uuid:undefined});},componentDidMount:function(){this._handleFetchRequest();},render:function(){return (k.createElement(j,{intentMetas:this.props.witIntents,intents:this.state.intents,isEmployee:this.state.isEmployee,isLoaded:this.state.isLoaded,isLoading:this.state.isLoading,isReversed:this.state.isReversed,onFetchRequest:this._handleFetchRequest,onIsEmployeeChange:this._handleIsEmployeeChange,onIsReversedChange:this._handleIsReversedChange,onSortByChange:this._handleSortByChange,onUUIDChange:this._handleUUIDChange,sortBy:this.state.sortBy,uuid:this.state.uuid}));},_handleFetchRequest:function(){if(this.state.isLoading||this.state.isLoaded)return;this.setState({isLoading:true});i.intentsDashboard({offset:this.state.offset,limit:o,uuid:this.state.uuid,reverse:this.state.isReversed||undefined,'sort-by':this.state.sortBy||undefined,'is-employee':this.state.isEmployee}).done(function(r){this.setState({intents:this.state.intents.concat(r),isLoaded:r.size<o,isLoading:false,offset:this.state.offset+r.size});}.bind(this));},_handleUUIDChange:function(r){this._setFilter({uuid:r});},_handleIsEmployeeChange:function(r){this._setFilter({isEmployee:r});},_handleIsReversedChange:function(r){this._setFilter({isReversed:r});},_handleSortByChange:function(r){this._setFilter({sortBy:r});},_setFilter:function(r){this.setState(babelHelpers['extends']({},p,r),this._handleFetchRequest);}});f.exports=q;},null);
__d('OzMerchantStatus.react',['immutable','React','cx'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=h.Map,l=i.PropTypes,m=i.createClass({displayName:'OzMerchantStatus',propTypes:{merchant:l.instanceOf(k).isRequired},render:function(){var n=this.props.merchant,o=n.get('approved'),p=n.get('blacklisted');return (i.createElement('i',{className:"_4wc0"+(o?' '+"_4wbz":'')+(p?' '+"_4wb-":''),title:o&&'approved'||p&&'blacklisted'}));}});f.exports=m;},null);
__d('OzMerchantRow.react',['OzAPI','OzHelpers','immutable','Layout.react','LeftRight.react','MessengerDialogHeader.react','MessengerDialogTitle.react','Notice.atlas','OzActions','OzButton.react','OzMerchantDialog.react','OzMerchantStatus.react','ReactComponentWithPureRenderMixin','React','XUIDialog.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();var x=j.Map,y=k.Column,z=k.FillColumn,aa=u.PropTypes,ba=u.createClass({displayName:'DeleteMerchantDialog',propTypes:{merchant:aa.object.isRequired,onConfirm:aa.func.isRequired},render:function(){return (u.createElement(v,{width:544,shown:true,layerHideOnBlur:false,className:"_4ebx"},u.createElement('div',{className:"_4eby _2c9g"},u.createElement(m,null,u.createElement(n,null,'Delete merchant "'+this.props.merchant.get('name-dba')+'\"?')),u.createElement(o,{type:'error'},u.createElement('div',{className:"_4wby"},'This action is irreversible. Are you sure?'),u.createElement(l,null,u.createElement(q,{onClick:p.hideDialog},'Cancel'),u.createElement(q,{onClick:this.props.onConfirm},'Yes, permanently delete this merchant'))))));},_handleToggle:function(da){i.debug('[merchantdialog] toggle',arguments);if(!da)p.hideDialog();}}),ca=u.createClass({displayName:'OzMerchantRow',mixins:[t],propTypes:{merchant:aa.instanceOf(x).isRequired},render:function(){var da=this.props.merchant,ea=da.get('website'),fa=function(ha){return '$'+(ha?(ha/100).toFixed(2):0);},ga=function(ha){return ha||0;};return (u.createElement(k,{className:"_59hd"},u.createElement(y,{className:"mrm _728"},u.createElement(s,{merchant:da})),this._renderMerchantInfo('name-dba'),this._renderMerchantInfo('name-legal'),this._renderMerchantInfo('phone'),this._renderMerchantInfo('cumulative-transaction-amount',fa),this._renderMerchantInfo('cumulative-transaction-count',ga),u.createElement(z,{className:"mrm _4wc2 _4wc3"},u.createElement('a',{target:'_blank',href:ea},ea)),this._renderActions()));},_renderMerchantInfo:function(da,ea){var fa=this.props.merchant,ga=fa.get(da);if(ea)ga=ea(ga);return (u.createElement(y,{className:"mrm _4wc2 _72a"},ga));},_renderActions:function(){var da=this._getActions();if(!da)return null;var ea=da.map(function(fa){var ga=fa.f,ha=fa.body;return u.createElement(q,{key:ha,onClick:ga},ha);});return (u.createElement(y,{className:"mrm _6w4"},ea));},_getActions:function(){var da=[],ea=this.props.merchant;da.push({body:'Edit',f:this._handleMerchantEdit()});da.push({body:'Delete',f:this._handleMerchantDelete()});if(ea.get('blacklisted')===true){da.push({body:'Whitelist',f:this._handleMerchantBlacklist(false)});}else da.push({body:'Blacklist',f:this._handleMerchantBlacklist(true)});return da;},_handleMerchantEdit:function(){return function(da,ea){var fa=this.props.merchant;p.showDialog(r,{initialMerchant:fa,title:'Edit merchant '+fa.get('name-dba'),onMerchant:function(ga){h.editMerchant(ga);p.hideDialog();}});ea();}.bind(this);},_handleMerchantBlacklist:function(da){return function(ea,fa){var ga=this.props.merchant;h.editMerchant(x({id:ga.get('id'),blacklisted:da}));fa();}.bind(this);},_handleMerchantDelete:function(){return function(da,ea){var fa=this.props.merchant;p.showDialog(ba,{merchant:this.props.merchant,onConfirm:function(){h.deleteMerchant(x({id:fa.get('id')})).then(p.hideDialog);}});ea();}.bind(this);}});f.exports=ca;},null);
__d('OzMerchants.react',['OzAPI','immutable','Layout.react','MessengerFlexScrollableArea.react','OzActions','OzButton.react','OzMerchantDialog.react','OzMerchantRow.react','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=j.Column,s=j.FillColumn,t=i.Map,u=p.PropTypes,v=p.createClass({displayName:'OzMerchants',propTypes:{merchants:u.instanceOf(t).isRequired},getInitialState:function(){return {slice:25};},render:function(){if(this.props.merchants.isEmpty())return this._renderEmpty();return (p.createElement(j,null,p.createElement(s,null,this._renderToolbar(),this._renderMerchants())));},_createMerchant:function(){l.showDialog(n,{onMerchant:function(w){h.createMerchant(w);l.hideDialog();}});},_renderToolbar:function(){return (p.createElement(j,{className:"_726"},p.createElement(r,{className:"mrm _727 _728"},'Status'),this._renderToolbarCell('Name'),this._renderToolbarCell('Legal Name'),this._renderToolbarCell('Phone'),this._renderToolbarCell('Transaction total'),this._renderToolbarCell('Transaction count'),p.createElement(s,{className:"mrm _727"},'Website'),p.createElement(r,{className:"mrm _729"},p.createElement(m,{onClick:this._createMerchant},'New merchant'))));},_renderToolbarCell:function(w){return (p.createElement(r,{className:"mrm _727 _72a"},w));},_renderMerchants:function(){var w=this.props.merchants.sortBy(function(x){return x.get('name-dba','').toLowerCase();}).toSeq().take(this.state.slice).map(function(x){return (p.createElement(o,{key:x.get('name-dba'),merchant:x}));}).valueSeq();return (p.createElement(k,{className:"_72b",onScroll:this._handleScroll,ref:'scrollable'},w));},_renderEmpty:function(){return p.createElement('div',null,'No merchants to show');},_handleScroll:function(){if(this.refs.scrollable.isScrolledToBottom())this.setState(function(w){return {slice:w.slice+25};});}});f.exports=v;},null);
__d('OzStatsDashboardFilters.react',['Promise','immutable','OzSearchSource','OzSwitch.react','ReactComponentWithPureRenderMixin','React','SearchableDropdownInput.contrib','SearchableEntry','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=i.Map,r=m.PropTypes,s=m.createClass({displayName:'OzStatsDashboardFilters',mixins:[l],propTypes:{onTeamViewChange:r.func.isRequired,onTrainerIDChange:r.func.isRequired,reps:r.instanceOf(q).isRequired,teamView:r.bool.isRequired,trainerID:r.string.isRequired},getInitialState:function(){return {searchSource:t(this.props.reps)};},componentWillReceiveProps:function(v){if(!i.is(v.reps,this.props.reps))this.setState({searchSource:t(v.reps)});},render:function(){var v=this.props,w=v.onTeamViewChange,x=v.onTrainerIDChange,y=v.reps,z=v.teamView,aa=v.trainerID;return (m.createElement('div',{className:"_5p66"},m.createElement(k,{className:"_4vlt",isAnimated:true,isOn:z,label:'Team View',onToggle:w}),!z?m.createElement('div',{className:"_4vlu"},m.createElement(n,{value:u(y.get(aa)),onSelect:function(ba){return x(ba.getUniqueID());},placeholder:'Select a trainer...',emptySearchResultsText:'No trainers found',searchSource:this.state.searchSource})):null));}});function t(v){return new j(function(w){var x=(w.query||'').toLowerCase();return h.resolve(v.valueSeq().map(u).sortBy(function(y){return y.getTitle();}).filter(function(y){return (y.getTitle()||'').toLowerCase().indexOf(x)>-1;}).toJS());});}function u(v){return v&&new o({title:v.get('name'),uniqueID:v.get('fbid')});}f.exports=s;},null);
__d('OzStatsDashboard.react',['cx','OzHelpers','CandelaGroupScaleBuilder','formatDate','immutable','BUIInsightsLegendChart.react','BUIInsightsLineAreaChart.react','MessengerFlexScrollableArea.react','OzButton.react','OzConfig','ozFormatTime','OzStatsDashboardFilters.react','ReactComponentWithPureRenderMixin','React','XUISingleSelector.react','Timezone','XUITable.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){'use strict';if(c.__markCompiled)c.__markCompiled();var y=v.Option,z=j.group,aa=l.List,ba=l.Map,ca=l.OrderedSet,da=l.Range,ea=u.PropTypes,fa=604800,ga=u.createClass({displayName:'OzStatsDashboard',mixins:[t],propTypes:{displayTime:ea.number.isRequired,finalWeek:ea.number.isRequired,isLoading:ea.bool.isRequired,onDateChange:ea.func.isRequired,onThreadSelect:ea.func.isRequired,onTeamViewChange:ea.func.isRequired,onTrainerIDChange:ea.func.isRequired,reps:ea.instanceOf(ba).isRequired,stats:ea.oneOfType([ea.instanceOf(aa),ea.instanceOf(ba)]).isRequired,teamView:ea.bool.isRequired,trainerID:ea.string.isRequired},render:function(){var sa=this.props,ta=sa.displayTime,ua=sa.finalWeek,va=sa.onDateChange,wa=sa.onThreadSelect,xa=sa.onTeamViewChange,ya=sa.onTrainerIDChange,za=sa.reps,ab=sa.stats,bb=sa.teamView,cb=sa.trainerID;return (u.createElement('div',{className:"_16u3"},q.GK.supervisor?u.createElement(s,{onTeamViewChange:xa,onTrainerIDChange:ya,reps:za,teamView:bb,trainerID:cb}):null,u.createElement(ha,{currentWeek:ta,finalWeek:ua,onDateSelect:va}),u.createElement('div',{className:"_16u4"},bb?u.createElement(ia,{stats:ab,displayTime:ta}):u.createElement(ja,{displayTime:ta,onThreadSelect:wa,stats:ab,reps:za,trainerID:cb}))));}}),ha=i.pure(function(sa){var ta=sa.currentWeek,ua=sa.finalWeek,va=sa.onDateSelect,wa=13,xa=da(ua,ua-wa*fa,fa).map(function(ya){var za=k(ya,'M j');return (u.createElement(y,{key:za,value:ya},za));});return (u.createElement('div',{className:"_16-n"},'Stats for week starting ',u.createElement(v,{name:'OzStatsSelector',maxheight:240,onChange:va,value:ta},xa)));}),ia=i.pure(function(sa){var ta=sa.displayTime,ua=sa.stats;return (u.createElement('div',null,u.createElement(ka,{chartType:'CR',teamStats:ua,weekStart:ta}),u.createElement(ka,{chartType:'ER',teamStats:ua,weekStart:ta})));}),ja=i.pure(function(sa){var ta=sa.displayTime,ua=sa.onThreadSelect,va=sa.stats,wa=sa.reps,xa=sa.trainerID;return (u.createElement('div',null,!va.isEmpty()?u.createElement('div',null,u.createElement(pa,{chartType:'CR',stats:va,weekStart:ta}),u.createElement(pa,{chartType:'ER',stats:va,weekStart:ta})):u.createElement('div',null,'Stats loading...'),u.createElement('div',{style:{padding:'10px'}},va.map(function(ya,za){return (u.createElement(qa,{key:za,onThreadSelect:ua,section:ya,reps:wa,trainerID:xa}));}))));}),ka=i.pure(function(sa){var ta=sa.chartType,ua=sa.displayTime,va=sa.teamStats,wa=ta.toLowerCase(),xa=va.map(function(ya,za){return ba({time:parseInt(za,10),team1:ya.getIn(['1',wa])/ya.getIn(['1','n']),team2:ya.getIn(['2',wa])/ya.getIn(['2','n'])});}).toList().sortBy(function(ya){return ya.get('time');});return (va.size?u.createElement(na,{data:xa,graphSchema:la,legendItems:ma,yAxisTitle:ta+' (mins)'}):null);}),la={time:{timezoneID:w.PST8PDT,type:'time'},team1:{renderAs:'line',type:'number'},team2:{renderAs:'line',type:'number'}},ma=ca([{key:'team1',label:'Team 1'},{key:'team2',label:'Team 2'}]),na=i.pure(function(sa){var ta=sa.data,ua=sa.graphSchema,va=sa.legendItems,wa=sa.yAxisTitle,xa=[z.apply(null,va.map(function(ya){return ya.key;}).toJS())];return (u.createElement('div',{className:"_16-o"},u.createElement('div',{className:"_3aw3"},wa),u.createElement(m,{items:va,layoutInterval:200,minItemWidthPercentage:.67},u.createElement(n,{axisMarkFormatterFactory:oa,data:ta.toJS(),height:300,width:800,schema:ua,plotX:z('time').from(ta.first().get('time')).to(ta.last().get('time')+1000),plotY:xa}))));}),oa=function(sa,ta){if(ta==='vertical'){return function(ua){var va=Math.floor(ua/60)+':';if(Math.floor(ua%60)<10)va+='0';return va+Math.floor(ua%60);};}else return function(ua){return k(ua.instant,'M j');};},pa=i.pure(function(sa){var ta=sa.chartType,ua=sa.stats,va=sa.weekStart,wa=ua.sortBy(function(bb){return bb.get('start-time');}).map(function(bb){var cb=bb.get('start-time'),db=bb.getIn(['summary','n']),eb=db?bb.getIn(['summary','er'])/db:null,fb=db?bb.getIn(['summary','cr'])/db:null,gb=bb.getIn(['all-agents','er'])/bb.getIn(['all-agents','n']),hb=bb.getIn(['all-agents','cr'])/bb.getIn(['all-agents','n']);return ba({er:eb,cr:fb,time:cb,avg_er:gb,avg_cr:hb});}),xa={time:{timezoneID:w.PST8PDT,type:'time'}},ya=ta.toLowerCase(),za='avg_'+ya;xa[ya]={renderAs:'area',type:'number'};xa[za]={renderAs:'line',type:'number'};var ab=ca([{key:ya,label:ta==='ER'?'Execution Responsiveness':'Conversational Responsiveness'},{key:za,label:ta==='ER'?'Avg. ER':'Avg. CR'}]);return (u.createElement(na,{data:wa,graphSchema:xa,legendItems:ab,yAxisTitle:ta+' (mins)'}));}),qa=i.pure(function(sa){var ta=sa.onThreadSelect,ua=sa.section,va=sa.reps,wa=sa.trainerID,xa=ua.get('summary'),ya=k(ua.get('start-time'),'M j');if(!xa.get('n'))return u.createElement('div',null);return (u.createElement('div',{className:"_16-v"},u.createElement('div',{className:"_16-w"},'Stats for ',u.createElement('strong',null,ya)),u.createElement('div',{className:"_16-y"},'Average ER: ',r(xa.get('er')/xa.get('n')),', Average CR: ',r(xa.get('cr')/xa.get('n'))),u.createElement(ra,{threads:ua.get('threads',aa()),onThreadSelect:ta,reps:va,trainerID:wa})));}),ra=i.pure(function(sa){var ta=sa.threads,ua=sa.onThreadSelect,va=sa.reps,wa=sa.trainerID;return (u.createElement(x,{outerBorder:true},u.createElement('thead',null,u.createElement('tr',null,u.createElement('th',{className:"_1ruu"},'User ID'),u.createElement('th',{className:"_1ruw"},'Intent'),u.createElement('th',{className:"_1rux"},'ER'),u.createElement('th',{className:"_1ruz"},'CR'),u.createElement('th',{className:"_1ru-"},'Start Time'),u.createElement('th',{className:"_1ru_"},'End Time'),u.createElement('th',{className:"_1rv0"},'Survey'),u.createElement('th',{className:"_1rv1"},'See Thread'))),u.createElement('tbody',null,ta.map(function(xa,ya){return (u.createElement('tr',{key:ya},u.createElement('td',null,xa.get('user-id')),u.createElement('td',null,xa.get('intent-name')),u.createElement('td',null,r(xa.get('er'))),u.createElement('td',null,r(xa.get('cr'))),u.createElement('td',null,i.toLocaleTime(xa.get('start-time')*1000)),u.createElement('td',null,i.toLocaleTime(xa.get('end-time')*1000)),u.createElement('td',null,xa.get('survey')),u.createElement('td',null,u.createElement(p,{onClick:function(za){return ua(i.threadID(xa));}},'See Thread'))));}))));});f.exports=ga;},null);
__d('OzStatsDashboardContainer.react',['immutable','OzAPI','OzStatsDashboard.react','React','ReactRouter_DEPRECATED'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=h.List,n=h.Map,o=k.PropTypes,p=7,q=k.createClass({displayName:'OzStatsDashboardContainer',mixins:[l.Navigation],contextTypes:{uid:o.string.isRequired},propTypes:{reps:o.instanceOf(n).isRequired},getInitialState:function(){var r=new Date();r.setDate(r.getDate()-r.getDay());r.setHours(0);r.setMinutes(0);r.setSeconds(0);r.setMilliseconds(0);return {displayTime:r.getTime()/1000,finalWeek:r.getTime()/1000,isLoading:false,stats:m(),summary:m(),teamView:false,trainerID:this.context.uid};},componentDidMount:function(){this._handleFetchRequest();},render:function(){return (k.createElement(j,{displayTime:this.state.displayTime,finalWeek:this.state.finalWeek,isLoading:this.state.isLoading,onDateChange:this._handleDateChange,onTeamViewChange:this._handleTeamViewChange,onThreadSelect:this._handleThreadSelect,onTrainerIDChange:this._handleTrainerIDChange,reps:this.props.reps,stats:this.state.stats,teamView:this.state.teamView,trainerID:this.state.trainerID}));},_handleFetchRequest:function(){if(this.state.isLoading)return;this.setState({isLoading:true});if(this.state.teamView){i.teamStatsDashboard({start:this.state.displayTime,days:p}).done(function(r){this.setState({isLoading:false,stats:r});}.bind(this));}else i.statsDashboard({start:this.state.displayTime,days:p,'trainer-id':this.state.trainerID}).done(function(r){this.setState({isLoading:false,stats:r});}.bind(this));},_handleTeamViewChange:function(r){this.setState({stats:m(),teamView:r},this._handleFetchRequest);},_handleThreadSelect:function(r){this.transitionTo('inbox/show',{threadid:r});},_handleTrainerIDChange:function(r){this.setState({stats:m(),trainerID:r},this._handleFetchRequest);},_handleDateChange:function(r){this.setState({displayTime:r.value,stats:m()},this._handleFetchRequest);}});f.exports=q;},null);
__d('OzTop.react',['OzAPI','cx','OzHelpers','immutable','OzUserImage.react','React','ReactRouter_DEPRECATED','relativeTimeString.atlas'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=k.List,q=k.Map,r=m.PropTypes,s=m.createClass({displayName:'OzTop',mixins:[n.Navigation],propTypes:{witIntents:r.instanceOf(q).isRequired},componentWillMount:function(){var t=function(){return h.topIntents().then(function(u){return (this.setState({items:u.sortBy(function(v){return -v.get('duration-ms');})}));}.bind(this));}.bind(this);t();this._interval=setInterval(t,60*1000);},componentWillUnmount:function(){clearInterval(this._interval);},getInitialState:function(){return {items:p()};},render:function(){if(this.state.items.isEmpty())return m.createElement('div',{key:'n'},'No data!');var t=this.props.witIntents;return (m.createElement('div',{className:"_p3s"},m.createElement('table',{className:"_5env"},m.createElement('tbody',null,this.state.items.map(function(u){return this._renderTopItem(u,t);}.bind(this))))));},_handleView:function(t){return function(u){var v=j.threadID(t),w=j.hasCmdOrCtrl(u);h.view(v).then(function(){w||this.transitionTo('inbox/show',{threadid:v});}.bind(this));}.bind(this);},_renderTopItem:function(t,u){var v=t.get('thread'),w=t.getIn(['intent','id']);if(!v||!w)return null;var x=Date.now()+t.get('duration-ms'),y=t.getIn(['intent','wit-intent-uuid']),z=u.getIn([y,'name'],y),aa=j.photo(v),ba=v.getIn(['owner','name'],'No trainer');return (m.createElement('tr',{className:"_p3t",key:w},m.createElement('td',{className:"_p3u"},o(x)),m.createElement('td',{className:"_p3v"},z),m.createElement('td',{className:"_p3x"},m.createElement(l,{className:"_p3y",photo:aa}),j.getName(v)),m.createElement('td',null,ba),m.createElement('td',{className:"_p3z _30yy",onClick:this._handleView(v)},'View')));}});f.exports=s;},null);
__d('OzTrainerDashboard.react',['cx','OzHelpers','relativeTimeString.atlas','immutable','OzButton.react','OzHumans','OzStores','ReactComponentWithPureRenderMixin','React','Reflux','ReactRouter_DEPRECATED','XUITable.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=k.Map,u=n.HumanStore,v=p.PropTypes,w=p.createClass({displayName:'OzTrainerDashboard',mixins:[q.connect(u,'humans'),r.Navigation],propTypes:{reps:v.instanceOf(t).isRequired},render:function(){return (p.createElement(x,{onThreadSelect:this._handleThreadSelect,humans:this.state.humans,reps:this.props.reps}));},_handleThreadSelect:function(ba){this.transitionTo('inbox/show',{threadid:ba});}}),x=p.createClass({displayName:'Main',mixins:[o],propTypes:{onThreadSelect:v.func.isRequired,humans:v.instanceOf(t).isRequired,reps:v.instanceOf(t).isRequired},render:function(){return (p.createElement('div',{className:"_10cd"},p.createElement(s,null,p.createElement('thead',null,p.createElement('tr',null,p.createElement('th',null,'Trainer'),p.createElement('th',null,'Load'),p.createElement('th',null,'Status'),p.createElement('th',null,'Team'),p.createElement('th',null,'Link to Thread'))),p.createElement('tbody',null,this._getHumans().map(function(ba){return (p.createElement(y,{key:ba.get('id'),onSelect:this._handleThreadSelect,human:ba,rep:this.props.reps.get(ba.get('id'))}));}.bind(this))))));},_getHumans:function(){var ba=this.props,ca=ba.humans,da=ba.reps;return ca.sortBy(function(ea){return da.getIn([ea.get('id'),'name']);}).valueSeq();},_handleThreadSelect:function(ba){this.props.onThreadSelect(ba.get('tid'));}}),y=p.createClass({displayName:'DashboardRow',mixins:[o],propTypes:{onSelect:v.func.isRequired,human:v.instanceOf(t).isRequired,rep:v.instanceOf(t)},render:function(){var ba=this.props,ca=ba.onSelect,da=ba.human,ea=ba.rep;return (p.createElement('tr',null,p.createElement('td',null,z(ea,da)),p.createElement('td',null,da.get('load')),p.createElement('td',null,aa(da)),p.createElement('td',null,da.get('team')),p.createElement('td',null,da.get('tid')?p.createElement(l,{onClick:function(){return ca(da);}},'See Thread'):null)));}});function z(ba,ca){var da=ba&&ba.get('name')||'Unknown name';return ''+da+(m.isCoach(ca)?' (Coach)':'');}function aa(ba){var ca=j(+i.serverNow()-ba.get('inactive-ms',0)),da=m.isActive(ba)?'Active':'Away ('+ca+')';return m.inCoachMode(ba)?da+' | In Coach Mode':da;}f.exports=w;},null);
__d('OzMount',['OzAPI','OzHelpers','invariant','Oz.react','OzAIDashboardContainer.react','OzAll.react','OzConfig','OzFeedbackDashboard.react','OzInbox.react','OzInboxShow.react','OzIntentDashboardContainer.react','OzLoading.react','OzMerchants.react','OzStatsDashboardContainer.react','OzTop.react','OzTrainerDashboard.react','React','ReactDOM','ReloadPage','ReactRouter_DEPRECATED','URI','OzTwilio','OzServerTime'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){if(c.__markCompiled)c.__markCompiled();ca;var ea=aa.Route,fa=aa.HistoryLocation,ga=aa.Redirect,ha={mount:function(ma,na){na=babelHelpers['extends']({},na,la());i.setConfig(na);i.info('[config]',na);h.witIntents();h.merchants();h.humans();h.requirements();h.init();da.setup();var oa=x.createElement(ea,{handler:k},x.createElement(ea,{name:'inbox',handler:p},x.createElement(ea,{name:'inbox/show',path:':threadid',handler:q})),x.createElement(ea,{name:'all',path:'all',handler:m}),x.createElement(ea,{name:'merchants',path:'merchants',handler:t}),x.createElement(ea,{name:'top',path:'top',handler:v}),x.createElement(ea,{name:'intents',path:'intents',handler:r}),x.createElement(ea,{name:'ai',path:'ai',handler:l}),x.createElement(ea,{name:'feedback',path:'feedback',handler:o}),x.createElement(ea,{name:'trainers',path:'trainers',handler:w}),x.createElement(ea,{name:'stats',path:'stats',handler:u}),x.createElement(ga,{from:'',to:'/inbox'})),pa,qa=function(){h.repsSync();aa.run(oa,fa,function(ua){y.render(x.createElement(ua,{rev:na.rev,uid:na.uid,version:na.API_VERSION,skipToto:na.skipToto==='true',onUnmount:function(){pa&&pa();}}),ma);});},ra='Hello '+na.publicName+'! Oz is connecting...';y.render(x.createElement(s,{message:ra}),ma);var sa=i.getConfig('skipSky')==='true';if(sa)qa();i.info('[sky] connecting to '+na.skyTopic);var ta=function(ua){if(ua<0){alert('Something is very wrong! Could not connect to Skywalker');z.now();return;}if(typeof pa==='function')pa();pa=h.realTime(na.skyTopic,function(va,wa,xa){if(va){i.warn('[sky] could not connect: '+va);return ta(ua-1);}else i.info('[sky] connected to '+na.skyTopic+': '+wa.t,wa);if(!sa)qa();});};ta(3);}},ia=/^ozcfg(.+)/;function ja(){var ma=new ba(window.location.href).getQueryData();Object.keys(ma).forEach(function(na){if(ia.test(na))localStorage.setItem(na,ma[na]);});}function ka(){var ma,na,oa,pa={};for(ma=0;ma<localStorage.length;ma++){na=localStorage.key(ma);oa=na.match(ia);if(oa&&oa.length)pa[oa[1]]=localStorage.getItem(na);}return pa;}function la(){ja();var ma=ka(),na,oa=document.location.hostname;if(oa==='www.oz.wit.ai'){na={skyTopic:'oz/all',env:'prod',scubaCategory:'oz_console',PAGE_ID:'881263441913087',API_PATH:'https://www.oz.wit.ai/api'};}else if(oa==='intern.oz.wit.ai'||!ma.API_PATH){na={skyTopic:'oz-staging/all',env:'staging',scubaCategory:'oz_console_dev',PAGE_ID:'506060876211905',API_PATH:'https://intern.oz.wit.ai/api'};}else{var pa=oa.split('.')[1];na={skyTopic:'oz-dev/'+pa,env:'dev',scubaCategory:'oz_console_dev',PAGE_ID:'1579802578966277'};}na=babelHelpers['extends']({},na,ma,{API_VERSION:'20151027'});!na.API_PATH?j(0):undefined;return na;}f.exports=ha;},null);