/*!CK:143122632!*//*1456689054,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["hDVs3"]); }

__d('NotificationImpressions',['AsyncSignal','NotificationTokens','URI'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k='/ajax/notifications/impression.php';function l(m,n){var o={ref:n};i.untokenizeIDs(m).forEach(function(p,q){o['alert_ids['+q+']']=p;});new h(new j(k).getQualifiedURI().toString(),o).send();}f.exports={log:l};},null);
__d('NotificationBeeperConst',['keyMirror'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={IDLE_DELAY:10000,ACTIVE_DELAY_LONG:4000,FADE_OUT_LENGTH:1500,BeepStates:h({PENDING:true,RENDERED:true,READY_TO_HIDE:true,FADING_OUT:true})};f.exports=i;},null);
__d('NotificationBeeperItemContents.react',['Animation','AsyncRequest','Bootloader','FBProfilePhotoShadow.react','Image.react','ImageBlock.react','NotificationBeeperItemCloseButton.react','NotificationURI','NotificationUserActions','React','ReactDOM','TextWithEntities.react','Timestamp.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();function v(x,y){return q.createElement('span',{className:'fwb'},x);}var w=q.createClass({displayName:'NotificationBeeperItemContents',_markAsRead:function(){p.markNotificationsAsRead([this.props.beep.notificationID]);},_onClick:function(x){this._markAsRead();this.props.onHide();if(x.button===1||x.altKey||x.ctrlKey||x.metaKey||x.shiftKey)return;var y=this.props.beep;if(o.isAlbumDraftRecoveryDialogURI(y.link)){new i(y.link).send();x.preventDefault();}else if(y.photo&&o.snowliftable(y.link)){j.loadModules(["PhotoSnowlift"],function(z){z.bootstrap(y.link,x.currentTarget);});x.preventDefault();}else if(y.ajaxifyLink){j.loadModules(["AsyncDialog"],function(z){z.bootstrap(y.ajaxifyLink,x.currentTarget,'dialog');});x.preventDefault();}},_onClose:function(){this._markAsRead();this.props.onHide();},_doFlash:function(){new h(r.findDOMNode(this.refs.inner)).from('opacity','0').to('opacity','1').duration(200).go();},componentDidMount:function(){this.props.onReadyToHide(this.props.beep.notificationID);},componentDidUpdate:function(x){if(x.beep.beepID!==this.props.beep.beepID){this._doFlash();this.props.onReadyToHide(this.props.beep.notificationID);}},render:function(){var x=this.props.beep;return (q.createElement('div',{ref:'inner'},q.createElement(n,{onClick:this._onClose}),q.createElement('a',{href:x.link,onClick:this._onClick,className:"_3soi"},q.createElement(m,{className:"_3soj",spacing:'medium'},q.createElement(k,{className:"_2yt7"},q.createElement(l,{src:x.actors[0].profile_picture.uri,className:"_3sok"})),q.createElement('div',{className:"_3sol"},q.createElement(s,{renderEmoticons:true,renderEmoji:true,interpolator:v,ranges:x.text.ranges,aggregatedranges:x.text.aggregated_ranges,text:x.text.text}),q.createElement(m,{className:"_3som"},q.createElement(l,{className:"_1x8t",src:x.icon.uri}),q.createElement(t,{time:x.timestamp.time,text:x.timestamp.text,verbose:x.timestamp.verbose})))))));}});f.exports=w;},null);
__d('NotificationBeeperItem.react',['Animation','BrowserSupport','NotificationBeeperConst','NotificationBeeperItemContents.react','NotificationBeeperItemRenderersList','React','ReactDOM','Style','cx','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=j.FADE_OUT_LENGTH,s=m.createClass({displayName:'NotificationBeeperItem',getInitialState:function(){return {fadedIn:false,hidden:false};},componentDidMount:function(){var t;if(i.hasCSSAnimations()){t=this.setState.bind(this,{fadedIn:true},null);}else t=function(){new h(n.findDOMNode(this.refs.item)).from('top','-30px').from('opacity','0').to('top','0px').to('opacity','1').duration(200).ondone(this.setState.bind(this,{fadedIn:true},null)).go();}.bind(this);q(t,50);this.props.onInserted(this.props.beep);},componentWillUnmount:function(){if(this._fadeOutAnimation){this._fadeOutAnimation.stop();this._fadeOutAnimation=null;}},_onHide:function(){this.setState({hidden:true});},render:function(){var t=this.props.beep,u="_3sod"+(this.state.fadedIn?' '+"_3soe":'')+(this.state.hidden?' '+"hidden_elem":''),v=this._getRenderer(t.beepRenderer);return (m.createElement('li',{className:u,ref:'item','data-gt':t.tracking},m.createElement(v,{beep:t,onHide:this._onHide,onReadyToHide:this.props.onReadyToHide,ref:'itemContents'})));},componentDidUpdate:function(t,u,v){if(this.props.fadingOut){if(!this._fadeOutAnimation)this._fadeOutAnimation=new h(n.findDOMNode(this.refs.item)).from('opacity','1').to('opacity','0').duration(r).ondone(this._onHide).go();n.findDOMNode(this.refs.item).style.transitionDuration='0ms';}else if(this._fadeOutAnimation){this._fadeOutAnimation.stop();this._fadeOutAnimation=null;o.set(n.findDOMNode(this.refs.item),'opacity','1');}},_getRenderer:function(t){if(t in l)return l[t];return k;}});f.exports=s;},null);
__d('NotificationSound',['Sound'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=5000;h.init(['audio/mpeg']);function j(k){this._soundPath=k;this._lastPlayed=0;}Object.assign(j.prototype,{play:function(k){if(!this._soundPath)return;var l=Date.now();if(l-this._lastPlayed<i)return;this._lastPlayed=l;h.playOnlyIfImmediate(this._soundPath,k);}});f.exports=j;},null);
__d('NotificationBeeper.react',['Arbiter','ChannelConstants','NotificationBeeperConst','NotificationBeeperItem.react','NotificationBeeperPinnedPostLoader','NotificationConstants','NotificationImpressions','NotificationPhotoThumbnail','NotificationSound','NotificationUpdates','NotificationURI','NotificationUserActions','React','cx','setTimeoutAcrossTransitions','shield'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();var x=j.ACTIVE_DELAY_LONG,y=j.BeepStates,z=j.FADE_OUT_LENGTH,aa=j.IDLE_DELAY,ba=l.payload,ca='beeper',da=m.PayloadSourceType.LIVE_SEND,ea=m.PayloadSourceType.OTHER_APPLICATION,fa=t.createClass({displayName:'NotificationBeeper',getInitialState:function(){return {soundEnabled:this.props.soundEnabled,hovering:false,fading:false,beeps:{}};},componentWillMount:function(){var ga=i.getArbiterType('notif_sound_pref_changed'),ha='update-notifications';this.subscriptions=[q.subscribe(ha,function(ia,ja){if(ja.payloadsource===da||ja.payloadsource===ea){var ka=ja.nodes;if(ka&&ka.length)this._handleBeepChanges(this._convertNotifications(ka));}}.bind(this)),h.subscribe(ga,function(ia,ja){this.setState({soundEnabled:ja.obj.enabled});}.bind(this))];h.inform('NotificationBeeper/mounted',null,h.BEHAVIOR_PERSISTENT);if(ba)this._handleBeepChanges(this._convertNotifications(ba.nodes));},componentWillUnmount:function(){this.subscriptions.forEach(function(ga){ga.unsubscribe();});this.subscriptions=null;},_onMouseEnter:function(){this._hideWait&&clearTimeout(this._hideWait);var ga=[],ha=this.state.beeps;Object.keys(ha).forEach(function(ia){if(ha[ia].state!=y.PENDING){ga.push(ia);}else ha[ia].state=y.RENDERED;});s.markNotificationsAsSeen(ga);this.setState({hovering:true,fading:false,beeps:ha});},_onMouseLeave:function(){this._waitToHide(x);this.setState({hovering:false});},_onInsertedItem:function(ga){if(!this.state.hovering)this._waitToHide();if(this.state.soundEnabled&&ga.sound){if(!this._notifSound)this._notifSound=new p(this.props.soundPath);this._notifSound.play(ga.beepID);}if(this.props.shouldLogImpressions)n.log([ga.notificationID],ca);},_waitToHide:function(ga){this._hideWait&&clearTimeout(this._hideWait);this._hideWait=v(w(this._hide,this),ga||aa);},_onReadyToHide:function(ga){this.state.beeps[ga].state=y.READY_TO_HIDE;if(!this._hideWait)this._waitToHide();},_hide:function(){this._hideWait=null;var ga=this.state.beeps;Object.keys(ga).forEach(function(ha){if(ga[ha].state==y.READY_TO_HIDE)ga[ha].state=y.FADING_OUT;});this.setState({fading:true});v(w(this._finishHide,this),z);},_finishHide:function(){if(!this.state.fading)return;var ga=this.state.beeps;Object.keys(ga).forEach(function(ha){if(ga[ha].state==y.FADING_OUT)delete ga[ha];});this.setState({fading:false,beeps:ga});v(function(){var ha=this.state.beeps;Object.keys(ha).forEach(function(ia){if(ha[ia].state==y.PENDING)ha[ia].state=y.RENDERED;});this.setState({beeps:ha});}.bind(this));},_handleBeepChanges:function(ga){var ha=this.state.fading?y.PENDING:y.RENDERED,ia=this.state.beeps,ja=false;Object.keys(ga).reverse().forEach(function(ka){var la={state:ha,data:ga[ka]};if(!ia[ka]||ia[ka].data.beepID!=la.data.beepID){if(ia[ka]){ja=true;if(la.data.beepUpdatesOnTop)delete ia[ka];}ia[ka]=la;}});if(ja)this._waitToHide();this.forceUpdate();},render:function(){var ga=this.state.beeps,ha=[];Object.keys(ga).reverse().forEach(function(ka){var la=ga[ka];if(la.state==y.PENDING)return;ha.push(t.createElement(k,{key:ka,fadingOut:this.state.fading&&la.state==y.FADING_OUT,beep:la.data,onInserted:this._onInsertedItem,onReadyToHide:this._onReadyToHide}));},this);var ia=ha.length>0,ja=(!ia?"hidden_elem":'')+(' '+"_50d1");return (t.createElement('ul',{ref:'container',className:ja,'data-gt':this.props.tracking,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave},ha));},_convertNotifications:function(ga){var ha={};ga.forEach(function(ia){if(!ia.showBeep)return;var ja=ia.alert_id,ka=ja+'-'+ia.receivedTime,la=o.getThumbnail(ia.attachments,ia.attached_story);ha[ja]={notificationID:ja,notifID:ia.id,beepID:ka,beepRenderer:ia.beepRenderer,rendererData:ia.rendererData,beepUpdatesOnTop:ia.beepUpdatesOnTop,actors:ia.unaggregatedActors||ia.actors,icon:ia.icon,link:ia.url?r.localize(ia.url):'#',url:ia.url,ajaxifyLink:ia.ajaxify_url,photo:la,text:ia.unaggregatedTitle||ia.title,timestamp:ia.timestamp,receivedTime:ia.receivedTime,sound:!!ia.sound,tracking:ia.tracking};});return ha;}});f.exports=fa;},null);