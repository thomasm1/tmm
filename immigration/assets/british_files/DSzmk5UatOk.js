/*!CK:3900171409!*//*1456275913,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["Hznec"]); }

__d('P2PUserEligibilityStore',['P2PActionConstants','EventEmitter','MercuryIDs','P2PAPI','P2PDispatcher','P2PGKValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';var n,o;if(c.__markCompiled)c.__markCompiled();var p,q;n=babelHelpers.inherits(r,i);o=n&&n.prototype;function r(){o.constructor.call(this);q={};p=l.register(this.onEventDispatched.bind(this));}r.prototype.onEventDispatched=function(s){var t=s.data,u=s.type;switch(u){case h.USER_ELIGIBILITY_UDPATED:this.handleEligibilityUpdated(t);this.emit('change');break;}};r.prototype.getEligibilityByUserIDs=function(s){var t=[],u,v,w={};for(var x=0;x<s.length;x++){v=s[x];u=q[v];if(u===undefined){q[v]=null;t.push(v);}w[v]=q[v];}if(m.P2PEnabled&&t.length)k.getUserEligibility({userIDs:t});return w;};r.prototype.getEligibilityByUserID=function(s){var t=this.getEligibilityByUserIDs([s]);return t[s];};r.prototype.getEligibilityByThreadID=function(s){return (this.getEligibilityByUserID(j.getUserIDFromThreadID(s)));};r.prototype.handleEligibilityUpdated=function(s){for(var t=0;t<s.length;t++)q[s[t].user_id]=s[t].p2p_eligible;};f.exports=new r();},null);
__d('P2PSendMoneyButton.react',['CurrentEnvironment','immutable','P2PAbstractSendMoneyButton.react','P2PActions','P2PErrorDialog.react','P2PGroupSendDialog.react','P2PLogger','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PPasswordProtectionNUXDialog.react','P2PPasswordProtectionStatusTypes','P2PSendMoneyDialog.react','P2PUserEligibilityContainer.react','P2PSendMoneyNUXContextualDialog.react','P2PSendMoneySuccessDialog.react','P2PTransferParam','P2PTransferStore','P2PTransferRiskResult','P2PUnderManualReviewDialog.react','P2PVerificationFlowHelper','React','ReactDOM','ReactLayeredComponentMixin','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa){'use strict';if(c.__markCompiled)c.__markCompiled();var ga=ba.PropTypes,ha=ba.createClass({displayName:'P2PSendMoneyButton',mixins:[da],propTypes:{amount:ga.string,button:ga.object,groupThreadFBID:ga.string,flyoutAlignment:ga.string,openRequestTab:ga.bool,isNewEmptyLocalThread:ga.bool,isGroupChat:ga.bool,onTrigger:ga.func,participants:ga.instanceOf(i.List),platformData:ga.object,sendMoneyDialogShown:ga.bool,threadID:ga.string,threadFBID:ga.string},getDefaultProps:function(){return {amount:'',groupThreadFBID:'',openRequestTab:false,onTrigger:ea,sendMoneyDialogShown:false};},getInitialState:function(){return {sendMoneyNUXDismissed:false};},log:function(ia,ja){n.log(ia,babelHelpers['extends']({www_event_flow:p.UI_FLOW_P2P_SEND},ja));},canShowSendMoneyDialog:function(){return !!(this.props.participants&&this.props.participants.size);},originalCreateTransactionResponse:null,_onButtonClick:function(){var ia=this.getRecipient();this.log(o.UI_ACTN_SEND_MONEY_BUTTON_CLICKED,{object_id:ia&&ia.userID});this.canShowSendMoneyDialog()&&this.showSendMoneyDialog();},hideSendMoneyDialog:function(){k.chatSendViewClosed({threadID:this.props.threadID});},showSendMoneyDialog:function(){k.chatSendViewOpened({referrer:this.props.referrer,threadID:this.props.threadID});},_handleDialogToggle:function(ia){if(!ia){this.hideSendMoneyDialog();}else this.showSendMoneyDialog();},handlePaymentRequestSuccess:function(){this.hideSendMoneyDialog();this.props.onTrigger();},handleOnSendSuccess:function(ia){this.hideSendMoneyDialog();var ja=ia[w.RISK_RESULT];this.originalCreateTransactionResponse=ia;if(ja===y.REQUIRE_VERIFICATION){aa.startVerificationFlow(ia.id,true,this.handleVerificationCompleted);}else if(ja===y.UNDER_MANUAL_REVIEW){this.showUnderManualReviewDialog();}else this.handlePostSendSteps(false);},handleVerificationCompleted:function(ia){this.handlePostSendSteps(!ia);},handlePostSendSteps:function(ia){var ja=this.originalCreateTransactionResponse,ka=ja.passwordProtection===r.NOT_SET;if(!ia&&ja.isFirstSend){this._passwordNUXPending=ka;this.showSendSuccessDialog();}else if(ka){this.showPasswordProtectionDialog();}else k.hideDialog();this.originalCreateTransactionResponse=null;this.props.onTrigger();},handleConfirmationOKClick:function(){if(this._passwordNUXPending){this._passwordNUXPending=false;this.showPasswordProtectionDialog();}else k.hideDialog();},handleSendError:function(ia){this.showErrorDialog(ia);},handlePaymentRequestError:function(ia){this.showPaymentRequestErrorDialog(ia);},getMoneyButtonNode:function(){return ca.findDOMNode(this.refs.p2pSendMoneyButton);},getRecipient:function(){if(!this.props.isGroupChat&&this.props.participants){return this.props.participants.first();}else return this.getGroupSendRecipient();},getGroupSendRecipient:function(){return (this.props.participants&&this.props.participants.find(function(ia){return ia.userID===this.props.groupSendRecipientUserID;}.bind(this)));},showErrorDialog:function(ia){var ja=fa._("Problem Sending Money");k.showDialog(l,{error:ia,onOKClick:k.hideDialog,title:ja});},showPaymentRequestErrorDialog:function(ia){var ja=fa._("Problem Requesting Money");k.showDialog(l,{error:ia,onOKClick:k.hideDialog,title:ja});},showPasswordProtectionDialog:function(){k.showDialog(q,{onComplete:k.hideDialog});},showSendSuccessDialog:function(){k.showDialog(v,{onClose:this.handleConfirmationOKClick});},showUnderManualReviewDialog:function(){k.showDialog(z,{onClose:this.handlePostSendSteps.bind(this,false)});},shouldShowNUX:function(){return (!this.props.sendMoneyNUXDismissed&&!this.state.sendMoneyNUXDismissed&&x.shouldShowSenderNUX());},renderLayers:function(){var ia={},ja='USD',ka='$',la=this.getRecipient();if(this.canShowSendMoneyDialog()&&this.props.sendMoneyDialogShown)if(this.shouldShowNUX()){ia.nux=ba.createElement(u,{context:this.getMoneyButtonNode(),loggingData:{object_id:la&&la.userID},flyoutAlignment:this.props.flyoutAlignment,onNextClick:function(){return this.setState({sendMoneyNUXDismissed:true});}.bind(this),onToggle:this._handleDialogToggle});}else if(!this.props.groupSendRecipientUserID&&this.props.isGroupChat&&this.props.threadFBID){ia.groupSendMoneyDialog=ba.createElement(t,{participants:this.props.participants},ba.createElement(m,{amount:this.props.amount,context:this.getMoneyButtonNode(),flyoutAlignment:this.props.flyoutAlignment,openRequestTab:this.props.openRequestTab,currency:ja,onToggle:this._handleDialogToggle,participants:this.props.participants,referrer:this.props.referrer,threadID:this.props.threadID,threadFBID:this.props.threadFBID}));}else ia.sendMoneyDialog=ba.createElement(t,{participants:this.props.participants,ref:'send_money_dialog'},ba.createElement(s,{amount:this.props.amount,context:this.getMoneyButtonNode(),currency:ja,currencySymbol:ka,groupThreadFBID:this.props.groupThreadFBID,flyoutAlignment:this.props.flyoutAlignment,openRequestTab:this.props.openRequestTab,memoText:this.props.memoText,onToggle:this._handleDialogToggle,onError:this.handleSendError,onPaymentRequestError:this.handlePaymentRequestError,onPaymentRequestSuccess:this.handlePaymentRequestSuccess,onSendSuccess:this.handleOnSendSuccess,platformData:this.props.platformData,receiver:la,ref:'send_money_dialog',referrer:this.props.referrer,paymentRequestID:this.props.paymentRequestID,useModal:this.props.useModal}));return ia;},render:function(){var ia=this.getRecipient();if(this.props.isNewEmptyLocalThread&&this.props.participants.size>1)return null;return (ba.createElement(j,{button:this.props.button,className:this.props.className,isActive:this.canShowSendMoneyDialog()&&this.props.sendMoneyDialogShown,isMessenger:!!h.messengerdotcom,onClick:this._onButtonClick,recipientName:ia&&ia.short_name,ref:'p2pSendMoneyButton'}));}});f.exports=ha;},null);
__d('P2PSendMoneyContainer.react',['CurrentUser','immutable','ImmutableObject','MercuryIDs','MercuryParticipants','MercuryShareAttachmentRenderLocations','MercuryThreads','P2PSendMoneyButton.react','P2PSendMoneyDialogStore','React','StoreAndPropBasedStateMixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){'use strict';if(c.__markCompiled)c.__markCompiled();var s=q.PropTypes,t=q.createClass({displayName:'P2PSendMoneyContainer',propTypes:{button:s.node,className:s.string,flyoutAlignment:s.string,participantIDs:s.array,onTrigger:s.func,threadID:s.string},getDefaultProps:function(){return {referrer:m.CHAT};},mixins:[r(l,n,p)],statics:{calculateState:function(u){var v=u.threadID,w=null,x=u.participantIDs,y=null,z=null,aa,ba,ca=u.referrer;if(!v)return {};aa=p.getStateByThreadID(v);ba=aa&&aa.referrer;if(ca===m.WEB_INBOX&&ba===m.CHAT||ca===m.CHAT&&ba===m.WEB_INBOX)aa={};if(v){w=n.getForFBID(h.getID()).getOrFetch(v);if(!x&&w&&w.participants)x=w.participants.filter(function(da){return (h.getID()!==k.getUserIDFromParticipantID(da));});if(x){y=i.List();y=y.withMutations(function(da){x&&x.forEach(function(ea){var fa=l.getOrFetch(ea),ga=k.getUserIDFromParticipantID(ea);fa=fa&&j.set(fa,{userID:ga});if(fa)da.push(fa);});});}}z=n.get().isNewEmptyLocalThread(v);return babelHelpers['extends']({},aa,{participants:y,isNewEmptyLocalThread:z,isGroupChat:k.isGroupChat(v)&&!z,threadID:v,threadFBID:w&&w.thread_fbid,referrer:ba||ca});}},render:function(){return (q.createElement(o,babelHelpers['extends']({},this.state,{button:this.props.button,className:this.props.className,flyoutAlignment:this.props.flyoutAlignment,onTrigger:this.props.onTrigger})));}});f.exports=t;},null);