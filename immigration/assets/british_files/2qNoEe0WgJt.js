/*!CK:3189555293!*//*1456259139,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["EvLEY"]); }

__d('ChatUnreadCount',['ArbiterMixin','Map','MercuryIDs','MercurySingletonProvider','MercuryThreadInformer','MercuryThreads','MercuryUnreadState','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p,q;if(c.__markCompiled)c.__markCompiled();p=babelHelpers.inherits(r,o(h));q=p&&p.prototype;r.getForFBID=function(t){'use strict';return s.getForFBID(t);};r.get=function(){'use strict';return s.get();};function r(t){'use strict';q.constructor.call(this);this.$ChatUnreadCount1=t;this.$ChatUnreadCount2=l.getForFBID(t);this.$ChatUnreadCount3=m.getForFBID(t);this.$ChatUnreadCount4=new i();this.$ChatUnreadCount5=n.getForFBID(t);this.setupSubscriptions();}r.prototype.getUnreadCountForUID=function(t){'use strict';if(!t)return null;var u=j.getThreadIDFromUserID(t);if(!this.$ChatUnreadCount5.getIsThreadUnread(u)){this.$ChatUnreadCount4['delete'](t);return 0;}var v=this.$ChatUnreadCount3.getOrFetch(u),w=v&&v.unread_count;this.$ChatUnreadCount4.set(t,w);return w;};r.prototype.setupSubscriptions=function(){'use strict';this.$ChatUnreadCount2.subscribe('threads-updated',function(t,u){var v=Object.keys(u).some(function(w){var x=j.getUserIDFromThreadID(w);if(x===null)return false;var y=this.$ChatUnreadCount4.get(x)||0;return this.getUnreadCountForUID(x)!==y;}.bind(this));if(v)this.inform('unread-count-changed');}.bind(this));this.$ChatUnreadCount2.subscribe('unread-updated',function(){return this.inform('unread-count-changed');}.bind(this));};var s=new k(r);f.exports=r;},null);